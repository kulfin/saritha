var DynamicsEvents={CommonEvent:function(){}};DynamicsEvents.CommonEvent.prototype.initialize=function(){this.type=null};DynamicsEvents.CommonEvent.prototype.getType=function(){return this.type};DynamicsEvents.CommonEvent.prototype.getObject=function(){return this.object};DynamicsEvents.EditEvent=function(a){if(!a||!(a instanceof CommonModel))throw"Invalid argument";this.initialize();this.type="edit";this.object=a};DynamicsEvents.EditEvent.prototype=new DynamicsEvents.CommonEvent;
DynamicsEvents.AddEvent=function(a){this.initialize();this.type="add";this.object=a};DynamicsEvents.AddEvent.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.DeleteEvent=function(a){if(!a||!(a instanceof CommonModel))throw"Invalid argument";this.initialize();this.type="delete";this.object=a};DynamicsEvents.DeleteEvent.prototype=new DynamicsEvents.CommonEvent;
DynamicsEvents.RelationUpdatedEvent=function(a,b){if(!a||!(a instanceof CommonModel))throw"Invalid argument";this.initialize();this.type="relationUpdate";this.object=a;this.relation=b};DynamicsEvents.RelationUpdatedEvent.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.RelationUpdatedEvent.prototype.getRelation=function(){return this.relation};DynamicsEvents.StoreRequested=function(a){this.initialize();this.type="storeRequested";this.object=a};DynamicsEvents.StoreRequested.prototype=new DynamicsEvents.CommonEvent;
DynamicsEvents.CancelEdit=function(a){this.initialize();this.type="cancelEdit";this.object=a};DynamicsEvents.CancelEdit.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.TransactionEditEvent=function(a){this.initialize();this.type="transactionEdit";this.object=a};DynamicsEvents.TransactionEditEvent.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.ValidationInvalid=function(a,b){this.initialize();this.type="validationInvalid";this.object=a;this.messages=b};
DynamicsEvents.ValidationInvalid.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.ValidationInvalid.prototype.getMessages=function(){return this.messages};DynamicsEvents.ValidationValid=function(a){this.initialize();this.type="validationValid";this.object=a};DynamicsEvents.ValidationValid.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.MetricsEvent=function(a){this.initialize();this.type="MetricsEvent";this.object=a};DynamicsEvents.MetricsEvent.prototype=new DynamicsEvents.CommonEvent;
DynamicsEvents.RankChanged=function(a,b){this.initialize();this.type="RankedEvent";this.object=a;this.rankedType=b};DynamicsEvents.RankChanged.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.RankChanged.prototype.getRankedType=function(){return this.rankedType};DynamicsEvents.NamedEvent=function(a,b){this.initialize();this.type="NamedEvent";this.object=a;this.eventName=b};DynamicsEvents.NamedEvent.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.NamedEvent.prototype.getEventName=function(){return this.eventName};
DynamicsEvents.StoryTreeIntegrityViolation=function(a,b,c){this.initialize();this.type="StoryTreeIntegrityViolation";this.object=a;this.data=b;this.backlogId=c};DynamicsEvents.StoryTreeIntegrityViolation.prototype=new DynamicsEvents.CommonEvent;DynamicsEvents.StoryTreeIntegrityViolation.prototype.getData=function(){return this.data};DynamicsEvents.StoryTreeIntegrityViolation.prototype.getBacklogId=function(){return this.backlogId};
DynamicsEvents.StoryTreeIntegrityViolation.prototype.getIterationId=function(){return this.iterationId};DynamicsEvents.StoryTreeIntegrityViolation.prototype.isBacklogMove=function(){return this.backlogMove};
Array.prototype.unique=function(){var a=[],b=0,c=this.length;a:for(;b<c;b++){for(var d=0,e=a.length;d<e;d++)if(a[d]==this[b])continue a;a[a.length]=this[b]}return a};
ArrayUtils={remove:function(a,b){if(a){var c=jQuery.inArray(b,a);-1!==c&&a.splice(c,1)}},compare:function(a,b){try{for(var c=Math.max(a.length,b.length),d=0;d<c;d++)if(a[d]!==b[d])return!1}catch(e){return!1}return!0},compareObjects:function(a,b){if(!a&&!b)return!0;if(!a||!b)return!1;var c=ArrayUtils._getObjectFields(a),d=ArrayUtils._getObjectFields(b);if(!ArrayUtils.compare(c,d))return!1;for(d=0;d<c.length;d++)if(a[c[d]]!==b[c[d]])return!1;return!0},compareOneSided:function(a,b){if(!a&&!b)return!0;
if(!a||!b)return!1;for(var c in a)if(!a.hasOwnProperty(c)||!b.hasOwnProperty(c)||a[c]!==b[c])return!1;return!0},_getObjectFields:function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},countObjectFields:function(a){var b=0;for(field in a)a.hasOwnProperty(field)&&b++;return b}};
extendObject=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype._super=b};
var ParserUtils={TimeStrPattern:/\s*((\d+)([.,]\d+)?\s*h)?\s*((\d+)\s*min)?\s*/,TimeStrNumericPattern:/^\s*(\d+)([.,]\d+)?(\s*h)?\s*$/,timeStrToMinutes:function(b){null!=b&&0===b.indexOf(".")&&(b="0"+b);var a=ParserUtils.TimeStrNumericPattern.exec(b),c=0,e=0,d=0;a&&0<a.length?(c=parseInt(a[1],10),d=parseFloat(a[2])):(a=ParserUtils.TimeStrPattern.exec(b),c=parseInt(a[2],10),d=parseFloat(a[3]),e=parseInt(a[5],10));isNaN(e)&&(e=0);isNaN(c)&&(c=0);isNaN(d)&&(d=0);return e+Math.round(60*(c+d))}};
var HttpParamSerializer={serialize:function(b){if("object"!==typeof b)throw new TypeError("Only objects can be serialized as toplevel structures");if(b.constructor==Array)throw new TypeError("Arrays cannot be serialized as toplevel structures");if(null===b)throw new TypeError("Null cannot be serialized as a toplevel structure");return HttpParamSerializer.serializeSubstructure(b)},serializeSubstructure:function serializeSubstructure(e,f,h){void 0===h&&(h="");void 0===f&&(f={});if("object"!==typeof e)throw new TypeError("The serialized data must be an object");
var g=e.constructor==Array,c;for(c in e)if(e.hasOwnProperty(c)){var d=e[c];if(null!==d){var a=h,a=g?a+("["+c+"]"):h?a+("."+c):a+c,k=typeof d;if("object"==k&&d)serializeSubstructure(e[c],f,a);else if("string"===k||"number"===k||"boolean"===k)f[a]=null===d?"":""+d;else throw new TypeError("Cannot serialize fields of type "+k);}}return f},param:function(b,e){function f(d,a,c){jQuery.isArray(a)?jQuery.each(a,function(a,b){if(/\[\]$/.test(d))h(d,b);else{var g="object"===typeof b||jQuery.isArray(b)?a:"";
-1!==jQuery.inArray(c,e)&&""===g?f(d,b,g):f(d+"["+g+"]",b,g)}}):null!==a&&"object"===typeof a?jQuery.each(a,function(a,b){f(d+"."+a,b,a)}):h(d,a)}function h(b,a){a=jQuery.isFunction(a)?a():a;g[g.length]=encodeURIComponent(b)+"\x3d"+encodeURIComponent(a)}var g=[];e||(e=[]);if(jQuery.isArray(b)||b.jquery)jQuery.each(b,function(){h(this.name,this.value)});else for(var c in b)b.hasOwnProperty(c)&&f(c,b[c],c);return g.join("\x26").replace(" ","+")}};
var ViewPart=function(){};ViewPart.prototype.renderAlways=function(){return!1};ViewPart.prototype.getElement=function(){return this.element};ViewPart.prototype.render=function(){};ViewPart.prototype.hide=function(){this.element.hide()};ViewPart.prototype.show=function(){this.element.show()};ViewPart.prototype.isVisible=function(){return this.element.is(":visible")};
ViewPart.prototype.debug=function(b){if(this.debugLevel){var a="";this instanceof DynamicView&&(a=this.getViewId());console.log("DEBUG "+a+" "+b)}};
var CommonSubView=function(){};CommonSubView.prototype=new ViewPart;CommonSubView.viewId=0;CommonSubView.prototype.isDrawn=function(){return this.drawComplete};CommonSubView.prototype.draw=function(){this._draw();this.drawComplete=!0};CommonSubView.prototype._draw=function(){};CommonSubView.prototype.hide=function(){$("#"+this.getId()).hide()};CommonSubView.prototype.show=function(){$("#"+this.getId()).show()};
CommonSubView.prototype.getId=function(){this.id||(this.id="subview-"+CommonSubView.viewId++);return this.id};
var CommonFragmentSubView=function(){};CommonFragmentSubView.prototype=new CommonSubView;CommonFragmentSubView.prototype.getHTML=function(){return""};
var MessageDisplay={cssClasses:{messageBox:"dynamicsMessageContainer",genericMessage:"genericMessage",okMessage:"okMessage",errorMessage:"errorMessage",warningMessage:"warningMessage",titleArea:"titleArea",messageArea:"messageArea",closeButton:"closeButton"},messageList:null,initMessageList:function(){MessageDisplay.messageList||(MessageDisplay.messageList=$("\x3cul/\x3e").addClass(MessageDisplay.cssClasses.messageBox).appendTo(document.body))},GenericMessageClass:function(){}};
MessageDisplay.GenericMessageClass.prototype=new ViewPart;MessageDisplay.GenericMessageClass.prototype.init=function(){MessageDisplay.initMessageList();this.element=$("\x3cli/\x3e").appendTo(MessageDisplay.messageList);this.element.addClass(MessageDisplay.cssClasses.genericMessage);this.render();this.options.displayTime&&this.fadeOutTimer(this.options.displayTime)};
MessageDisplay.GenericMessageClass.prototype.render=function(){var a=this,b="0";this.options.closeButton&&($("\x3cdiv/\x3e").addClass(MessageDisplay.cssClasses.closeButton).text("X").appendTo(this.element).click(function(){a.fadeOut()}),b="30px");this.titleArea=$("\x3cspan/\x3e").addClass(MessageDisplay.cssClasses.titleArea).css("margin-right",b).appendTo(this.element);this.messageArea=$("\x3cdiv/\x3e").addClass(MessageDisplay.cssClasses.messageArea).appendTo(this.element).hide();this.addContent()};
MessageDisplay.GenericMessageClass.prototype.addContent=function(){this.titleArea.html(this.title);this.message&&this.messageArea.html(this.message).show()};MessageDisplay.GenericMessageClass.prototype.fadeOut=function(){var a=this;this.element.hide("blind",{},this.options.fadeOutTime,function(){a.destroy()})};MessageDisplay.GenericMessageClass.prototype.destroy=function(){this.element.remove()};
MessageDisplay.GenericMessageClass.prototype.fadeOutTimer=function(a){var b=this;setTimeout(function(){b.fadeOut()},a)};MessageDisplay.Error=function(a,b,c){return new MessageDisplay.ErrorMessageClass(a,b,c)};MessageDisplay.ErrorMessageClass=function(a,b,c){this.options={fadeOutTime:1E3,closeButton:!0};this.message=a;b&&(this.jsonData=jQuery.httpData(b,"json",null),jQuery.extend(this.options,c),this.detailedMessage=this.jsonData.errorMessage,this.trace=this.jsonData.trace);this.init();this.element.addClass(MessageDisplay.cssClasses.errorMessage)};
MessageDisplay.ErrorMessageClass.prototype=new MessageDisplay.GenericMessageClass;MessageDisplay.ErrorMessageClass.prototype.addContent=function(){this.titleArea.html(this.message);if(this.jsonData){var a;a="\x3cdl\x3e"+("\x3cdt\x3eMessage\x3c/dt\x3e\x3cdd\x3e"+this.detailedMessage+"\x3c/dd\x3e");a+="\x3cdt\x3eTrace\x3c/dt\x3e\x3cdd\x3e"+this.trace+"\x3c/dd\x3e";this.messageArea.html(a+"\x3c/dl\x3e").show()}};MessageDisplay.Ok=function(a,b){return new MessageDisplay.OkMessageClass(a,b)};
MessageDisplay.OkMessageClass=function(a,b){this.options={displayTime:2E3,fadeOutTime:200};jQuery.extend(this.options,b);this.title=a;this.init();this.element.addClass(MessageDisplay.cssClasses.okMessage)};MessageDisplay.OkMessageClass.prototype=new MessageDisplay.GenericMessageClass;MessageDisplay.Warning=function(a,b,c){return new MessageDisplay.WarningMessageClass(a,b,c)};
MessageDisplay.WarningMessageClass=function(a,b,c){this.options={displayTime:3500,fadeOutTime:200};jQuery.extend(this.options,c);this.message=b;this.title=a;this.init();this.element.addClass(MessageDisplay.cssClasses.warningMessage)};MessageDisplay.WarningMessageClass.prototype=new MessageDisplay.GenericMessageClass;
var DynamicView=function(){};DynamicView.prototype=new CommonSubView;DynamicView.instanceCounter=0;DynamicView.prototype.init=function(a,b,c){this.initWithoutEvents(a,b,c);var d=this;this.listener=function(a){if(a instanceof DynamicsEvents.EditEvent)d.onEdit(a);else if(a instanceof DynamicsEvents.DeleteEvent)d.onDelete(a);else if(a instanceof DynamicsEvents.RelationUpdatedEvent)d.onRelationUpdate(a)};this.model.addListener(this.listener);this.subViews={}};
DynamicView.prototype.initWithoutEvents=function(a,b,c){this.controller=a;this.model=b;this.parentElement=this.parentView=null;this.viewId=DynamicView.instanceCounter++;c instanceof ViewPart?(this.parentView=c,this.parentElement=c.getElement()):this.parentElement=c;this.element&&this._setViewId()};DynamicView.prototype.destroy=function(){this.listener&&this.model.removeListener(this.listener)};DynamicView.prototype._setViewId=function(){this.element.attr("id",this.getViewId())};
DynamicView.prototype.getViewId=function(){return"dynamicView_"+this.viewId};DynamicView.prototype.getModel=function(){return this.model};DynamicView.prototype.getController=function(){return this.controller};DynamicView.prototype.getParentElement=function(){return this.parentElement};DynamicView.prototype.getParentView=function(){return this.parentView};DynamicView.prototype.addSubView=function(a,b){this.subViews[a]=b;b.setParentView(this)};DynamicView.prototype.removeSubView=function(a){delete this.subViews[a]};
DynamicView.prototype.setParentView=function(a){this.parentView=a;this.parentElement=a.getElement()};DynamicView.prototype.onEdit=function(a){throw Error("Abstract method.");};DynamicView.prototype.onDelete=function(a){throw Error("Abstract method.");};DynamicView.prototype.onRelationUpdate=function(a){};
var DynamicTable=function(a,b,c,d){this.init(a,b,d);this.config={};this.currentTableRows=[];this.upperRows=[];this.middleRows=[];this.bottomRows=[];this.rowHashes=[];this.oldMiddleRows=[];this.headers=null;this.filterButtons={};this.config=c?c:new DynamicTableConfiguration;this.debugLevel=!1;this.initialize()};
DynamicTable.cssClasses={tableRow:"dynamictable-row",tableCell:"dynamictable-cell",tableHeader:"dynamictable-header",tableTailer:"dynamictable-tailer",tableCaption:"dynamictable-caption",table:"dynamictable",verticalTable:"dynamictable dynamictable-vertical",notSortable:"dynamictable-notsortable",oddRow:"dynamictable-odd",evenRow:"dynamictable-even",sortImg:"dynamictable-sortimg",sortImgUp:"dynamictable-sortimg-up",sortImgDown:"dynamictable-sortimg-down",filterImg:"dynamictable-filterimg",filterImgActive:"dynamictable-filterimg-active",
captionActions:"dynamictable-captionactions",captionAction:"dynamictable-captionaction",fieldError:"invalidValue",validationError:"validationError",validationErrorContainer:"cellError",dragHandle:"dynamictable-dragHandle",editableField:"dynamictable-editable-field"};DynamicTable.prototype=new DynamicView;DynamicTable.constants={borderPerColumn:0.4,asc:1,desc:2};
DynamicTable.prototype.initialize=function(){this.container=$('\x3cdiv id\x3d"container_'+this.getViewId()+'"/\x3e').appendTo(this.getParentElement()).addClass(DynamicTable.cssClasses.table);this.config.options.cssClass&&this.container.addClass(this.config.options.cssClass);this.infoElement=$('\x3cdiv style\x3d"position: relative; margin: auto; height: 0px;"\x3e\x3cdiv class\x3d"dynamictable-infobox"\x3e\x26nbsp;\x3c/div\x3e').appendTo(this.container).find(".dynamictable-infobox").hide();this.element=
$("\x3cdiv /\x3e").appendTo(this.container);this._setViewId();this._computeColumns();this.captionElement=$("\x3cdiv /\x3e").addClass(DynamicTable.cssClasses.tableCaption).prependTo(this.container);this.totalRowWidth&&this.totalMinWidth?(this.element.css("min-width",this.totalMinWidth),this.captionElement.width(this.totalRowWidth+"%")):this.captionElement.width("100%");var a=this.config.getColumns();this.currentSortColumn=null;this.currentSortDirection=DynamicTable.constants.asc;for(var b=0;b<a.length;b++)if(a[b]&&
a[b].isDefaultSortColumn()){this.defaultSoftColumnNum=this.currentSortColumn=b;break}this.caption=null;this.caption=new DynamicTableCaption(this.captionElement,this.config.getCaptionConfiguration(),this.config.getCaption(),this.getController());this._renderHeader();this._bindEvents();this.config.isTableDroppable()&&this._registerDropFor(this.container);this.element.data("table",this);this.container.data("table",this)};DynamicTable.prototype.renderAlways=function(){return!this.firstRenderComplete};
DynamicTable.prototype._bindEvents=function(){var a=this;this.element.bind("sortbeforestop",function(b,c){b.stopPropagation();a.middleRows=[];a.rowHashes=[];a.element.find("\x3e div.dynamicTableDataRow:not(div.ui-sortable-placeholder)").each(function(b,c){var f=$(c).data("row");a.middleRows.push(f);a.rowHashes.push(f.getModel().getHashCode())});a.debug(" before sort stop ")});this.element.bind("sortreceive",function(b,c){b.stopPropagation();var d=c.item.data("row");a.middleRows=[];a.rowHashes=[];
a.element.find("\x3e div.dynamicTableDataRow:not(div.ui-sortable-placeholder)").each(function(b,d){var c=$(d).data("row");a.middleRows.push(c);a.rowHashes.push(c.getModel().getHashCode())});b.stopPropagation();d.setParentView(a);a.debug(" sort receive + "+d.getViewId())});this.element.bind("sortremove",function(b,c){b.stopPropagation();var d=c.item.data("row");a.removeRow(d);a.debug(" sort remove + "+d.getViewId())});this.config.alwaysDrop?this._bindSortEventsForAlwaysDrop():this._bindSortEvents()};
DynamicTable.prototype._bindSortEvents=function(){var a=this;this.element.bind("sortstart",function(b,c){a.debug(" sort start "+a.getElement().parents(".ui-droppable:eq(0)").attr("id"));b.stopPropagation();c.item.data("sortactive",a.getElement().parents(".ui-droppable:eq(0)").attr("id"))});this.element.bind("sortover",function(b,c){a.debug(" sort over "+a.getElement().parents(".ui-droppable:eq(0)").attr("id"));b.stopPropagation();c.item.data("sortactive",a.getElement().parents(".ui-droppable:eq(0)").attr("id"))});
this.element.bind("sortout",function(b,c){a.debug(" sort out "+a.getViewId());b.stopPropagation();c.item.data("sortactive",!1)})};DynamicTable.prototype._bindSortEventsForAlwaysDrop=function(){this.element.bind("sortover",function(a,b){a.stopPropagation();b.item.data("sortactive",!1)});this.element.bind("sortout",function(a,b){a.stopPropagation();b.item.data("sortactive",!1)})};
DynamicTable.prototype._computeColumns=function(){for(var a=this.config.getColumns(),b=0,c=0,d=0;d<a.length;d++)a[d]&&!0===a[d].isAutoScale()&&(b++,c+=a[d].getMinWidth());d=DynamicTable.constants.borderPerColumn*b/100;this.totalMinWidth=c*(1+d);for(var c=c/(0.99-d),e=0,d=0;d<a.length;d++)if(a[d]&&!0===a[d].isAutoScale()){var f=Math.round(1E3*(a[d].getMinWidth()/c))/10,e=e+f;a[d].setWidth(f+"%")}e+=DynamicTable.constants.borderPerColumn*(b-1);e=Math.round(10*e)/10;for(d=0;d<a.length;d++)a[d]&&!0===
a[d].isFullWidth()&&a[d].setWidth(e+"%");this.totalRowWidth=e};
DynamicTable.prototype.layout=function(){for(var a=0;a<this.middleRows.length;a++){var b=this.middleRows[a].getElement();b.addClass("dynamicTableDataRow");this.config.isDraggableOnly()&&b.draggable({opacity:0.7,helper:"clone"})}var c=this;this.config.isSortable()&&(a=this.config.getSortOptions(),jQuery.extend(a,{stop:function(a,b){c.debug(" sort stop ");if(b.item.data("dropComplete"))b.item.data("dropComplete",!1);else{var f=c._stackPosition(b.item),g=b.item.data("row"),h=g.getModel();c.config.getSortCallback().call(g.getController(),
g,h,f)}},helper:function(a,b){b=$(b);var c=b.clone();c.removeClass("dynamicTableDataRow");c.css("border","1px solid black");c.height(b.height());c.width(b.width());return c}}),this.element.sortable(a));this.config.isRowDroppable()&&this.element.find("div.dynamicTableDataRow").each(function(a,b){c._registerDropFor($(b))})};
DynamicTable.prototype._toggleSortable=function(){this.config.isSortable()&&(this.currentSortColumn===this.defaultSoftColumnNum&&this.currentSortDirection===DynamicTable.constants.asc?this.element.sortable("enable"):this.element.sortable("disable"))};
DynamicTable.prototype._registerDropFor=function(a){var b=this.config.getDropOptions(),c=this,d=a.attr("id");a.droppable({greedy:!0,drop:function(a,f){c.debug("drop: "+f.draggable.data("sortactive")+" \x3d\x3d\x3d "+d);if(f.draggable.data("sortactive")===d)return!1;a.preventDefault();a.stopPropagation();var g,h=$(this);g=h.data("row")?h.data("row"):h.data("table");c.debug("dropping + "+f.draggable.data("row").getViewId());h=f.draggable.data("row").getController();g=g.getModel();b.callback.call(h,
g);f.draggable.data("dropComplete",!0)},accept:function(a){c.debug("Accepts: "+a.data("sortactive")+" \x3d\x3d\x3d "+d);if(a.data("sortactive")===d)return!1;a=a.data("row");if(!a)return!1;var f;f=$(this);f=f.data("row")?f.data("row"):f.data("table");if(!f)return!1;a=a.getModel();return b.accepts.call(f.getController(),a)},over:function(a,b){c.debug("drop over "+b.draggable.data("row").getViewId())},out:function(a,b){c.debug("drop out "+b.draggable.data("row").getViewId())}})};
DynamicTable.prototype.getDataRowAt=function(a){return this.middleRows[a]};DynamicTable.prototype._stackPosition=function(a){return(a=a.prev("div.dynamicTableDataRow").data("row"))?a.getModel():null};DynamicTable.prototype.show=function(){this.container.show();this.element.show()};DynamicTable.prototype.hide=function(){this.container.hide();this.element.hide()};
DynamicTable.prototype._renderHeader=function(){this.header=$("\x3cdiv /\x3e").prependTo(this.element).addClass(DynamicTable.cssClasses.tableHeader).addClass(DynamicTable.cssClasses.tableRow);for(var a=this.config.getColumns(),b=0;b<a.length;b++)a[b]&&!a[b].isFullWidth()&&this._renderHeaderColumn(b)};DynamicTable.prototype.filter=function(){if(this.currentFilter)for(var a=0;a<this.middleRows.length;a++)this.currentFilter(this.middleRows[a].getModel())?this.middleRows[a].show():this.middleRows[a].hide()};
DynamicTable.prototype.render=function(){for(var a=this.config.getColumns(),b=[],c=0;c<this.middleRows.length;c++)this.middleRows[c].config!=a&&b.push(this.middleRows[c]);0<b.length&&$.each(b,function(){this.remove()});this.config.getDataSource()&&(a=this.config.getDataSource().call(this.getModel()),this._renderFromDataSource(a));this._sort();a=[];a=a.concat(this.upperRows,this.middleRows,this.bottomRows);ArrayUtils.compare(a,this.currentTableRows)?this._softRender():(this.currentTableRows=a,this._hardRender(this.currentTableRows),
this.element.find("textarea.tableSortListener").trigger("tableSorted"));0===this.rowCount()?this.header.hide():this.header.show();this.layout();this.filter();this.firstRenderComplete||(this.firstRenderComplete=!0,this.config.getAfterFirstRender().call(this))};
DynamicTable.prototype._renderHeaderColumn=function(a){var b=this.config.getColumnConfiguration(a),c=$("\x3cdiv /\x3e").addClass(DynamicTable.cssClasses.tableCell);b.getWidth()&&c.width(b.getWidth());c.appendTo(this.header);var d,e=this;b.isSortable()?(d=$("\x3ca /\x3e").click(function(){e._sortByColumn(a);return!1}),$("\x3cdiv/\x3e").addClass(DynamicTable.cssClasses.sortImg).appendTo(c)):d=$("\x3cspan /\x3e");d.appendTo(c).text(b.getTitle());b.getHeaderTooltip()&&c.attr("title",b.getHeaderTooltip());
if(b.isFilterable()){var f=$("\x3cdiv/\x3e").addClass(DynamicTable.cssClasses.filterImg).appendTo(c);this.filterButtons[b.getTitle()]=f;f.click(function(){b.getFilter().call(e.getController(),f);return!1});d.css("float","left")}};DynamicTable.prototype.activateColumnFilter=function(a){(a=this.filterButtons[a])&&a.addClass(DynamicTable.cssClasses.filterImgActive)};DynamicTable.prototype.disableColumnFilter=function(a){(a=this.filterButtons[a])&&a.removeClass(DynamicTable.cssClasses.filterImgActive)};
DynamicTable.prototype.setFilter=function(a){this.currentFilter=a;if(!a)for(a=0;a<this.middleRows.length;a++)this.middleRows[a].show()};DynamicTable.prototype._softRender=function(){for(var a=this.currentTableRows.length,b=0;b<a;b++)this.currentTableRows[b].render()};DynamicTable.prototype._hardRender=function(a){var b,c=a.length;this._drawSection(a);for(b=0;b<c;b++)a[b].render()};
DynamicTable.prototype.resort=function(){this._sort();var a=[];a.concat(this.upperRows,this.middleRows,this.bottomRows);this.currentTableRows=a;this._drawSection(this.middleRows);this.element.find("textarea.tableSortListener").trigger("tableSorted")};
DynamicTable.prototype._drawSection=function(a){var b,c=a.length,d=-1;for(b=0;b<c;b++)if(a[b].isFocused()){d=b;break}if(-1<d){var e=a[d].getElement().get(0);for(b=0;b<d;b++)a[b].getElement().insertBefore(e);for(b=c-1;b>d;b--)a[b].getElement().insertAfter(e)}else for(b=0;b<c;b++)this.element.append(a[b].getElement())};
DynamicTable.prototype._renderFromDataSource=function(a){for(var b=[],c,d=0;d<a.length;d++)b.push(a[d].getHashCode());for(var e=[],d=0;d<this.middleRows.length;d++)c=this.middleRows[d].getModel(),-1===jQuery.inArray(c.getHashCode(),b)&&e.push(this.middleRows[d]);for(d=0;d<e.length;d++)e[d].remove();for(d=0;d<a.length;d++)c=a[d],-1===jQuery.inArray(c.getHashCode(),this.rowHashes)&&this._dataSourceRow(c)};
DynamicTable.prototype.createRow=function(a,b,c,d){var e=new DynamicTableRow(this.config.getColumns());this._createRow(e,a,b,c,d);this.render();return e};
DynamicTable.prototype._createRow=function(a,b,c,d,e){if("top"===d)"last"==e?this.upperRows.splice(this.upperRows.length,0,a):this.upperRows.splice(0,0,a);else if("bottom"===d)this.bottomRows.push(a);else if(c instanceof CommonModel)if(-1===jQuery.inArray(c.getHashCode(),this.rowHashes))this.middleRows.push(a),this.rowHashes.push(c.getHashCode());else return;else this.middleRows.push(a);1===this.rowCount()&&this.header.show();a.init(b,c,this);a.registerValidationManager(this.config);(b=this.config.getCssClassResolver())&&
a.setCssClassResolver(b)};DynamicTable.prototype._dataSourceRow=function(a,b){var c=new DynamicTableRow(this.config.getColumns()),d=this.config.getRowControllerFactory().call(this.getController(),c,a);this._createRow(c,d,a);c.autoCreateCells();return c};DynamicTable.prototype.rowCount=function(){return this.upperRows.length+this.middleRows.length+this.bottomRows.length};
DynamicTable.prototype._sortByColumn=function(a){a===this.currentSortColumn?this.currentSortDirection=this.currentSortDirection===DynamicTable.constants.asc?DynamicTable.constants.desc:DynamicTable.constants.asc:(this.currentSortColumn=a,this.currentSortDirection=DynamicTable.constants.asc);this._toggleSortable();this._updateSortArrow();this._sort();this.render();this.element.find("textarea.tableSortListener").trigger("tableSorted")};
DynamicTable.prototype._updateSortArrow=function(){this.header.find("."+DynamicTable.cssClasses.sortImg).removeClass(DynamicTable.cssClasses.sortImgDown).removeClass(DynamicTable.cssClasses.sortImgUp);var a=this.header.find("."+DynamicTable.cssClasses.tableCell+":eq("+this.currentSortColumn+")").find("."+DynamicTable.cssClasses.sortImg).addClass(DynamicTable.cssClasses.sortImgUp);this.currentSortDirection===DynamicTable.constants.asc?a.addClass(DynamicTable.cssClasses.sortImgUp):a.addClass(DynamicTable.cssClasses.sortImgDown)};
DynamicTable.prototype._sort=function(){if(null!==this.currentSortColumn){var a=this.config.getColumnConfiguration(this.currentSortColumn).getSortCallback();a&&(this.middleRows.sort(function(b,c){return a(b.getModel(),c.getModel())}),this.currentSortDirection===DynamicTable.constants.desc&&this.middleRows.reverse())}};DynamicTable.prototype.showInfoMessage=function(a){this.infoElement.show().text(a).width(a.length+"ex")};
DynamicTable.prototype.hideInfoMessage=function(a){(!a||a===this.infoElement.text())&&this.infoElement.hide()};DynamicTable.prototype.removeRow=function(a){-1!==jQuery.inArray(a,this.middleRows)?(ArrayUtils.remove(this.rowHashes,a.getModel().getHashCode()),ArrayUtils.remove(this.middleRows,a)):-1!==jQuery.inArray(a,this.bottomRows)?ArrayUtils.remove(this.bottomRows,a):-1!==jQuery.inArray(a,this.upperRows)&&ArrayUtils.remove(this.upperRows,a)};
DynamicTable.prototype.remove=function(){this.container.remove();this.destroy()};DynamicTable.prototype.onRelationUpdate=function(a){this.showInfoMessage("Refreshing, please wait...");var b=this;setTimeout(function(){b.config.getDataType()?b.config.getDataType()===a.getRelation()&&b.render():b.render();b.hideInfoMessage()},20);this.debug("table relation update + "+a.getObject().getHashCode())};DynamicTable.prototype.onEdit=function(a){this.debug("table edit")};DynamicTable.prototype.onDelete=function(a){this.remove()};
DynamicTable.prototype.getRowById=function(a){a=a.replace(/\./gi,"\\.");a=$("#"+a,this.element);return a.length?a=a.data("row"):null};var DynamicVerticalTable=function(a,b,c,d){this.init(a,b,d);this.config=c;this.rows=[];this.initialized=!1};DynamicVerticalTable.prototype=new DynamicView;
DynamicVerticalTable.prototype.initialize=function(){this.initialized=!0;this.container=$("\x3cdiv /\x3e").appendTo(this.getParentElement()).addClass(DynamicTable.cssClasses.verticalTable);this.config.options.cssClass&&this.container.addClass(this.config.options.cssClass);this.config.getCaption()&&this._addCaption();this.element=$("\x3cdiv /\x3e").appendTo(this.container);for(var a=this.config.getColumns(),b=new DynamicTableColumnConfiguration({width:this.config.options.leftWidth,autoScale:!0}),c=
0;c<a.length;c++){var d=a[c],e=new DynamicTableRow({visible:d.isVisible()});e.initWithoutEvents(this.getController(),this.getModel(),this);e.getElement().appendTo(this.element);d.options.width=this.config.options.rightWidth;var f=e.createCell(b);e.createCell(d).verticalTableCell=!0;f.setValue(d.getTitle());this.rows.push(e)}this.validationManager=new DynamicsValidationManager(this.element,this.config,this.getModel(),this.getController());this.render()};
DynamicVerticalTable.prototype._addCaption=function(){this.captionElement=$("\x3cdiv /\x3e").width("100%").addClass(DynamicTable.cssClasses.tableCaption).prependTo(this.container);this.caption=null;this.caption=new DynamicTableCaption(this.captionElement,this.config.getCaptionConfiguration(),this.config.getCaption(),this.getController())};DynamicVerticalTable.prototype.render=function(){if(this.initialized)for(var a=0;a<this.rows.length;a++)this.rows[a].render();else this.initialize()};
DynamicVerticalTable.prototype.openFullEdit=function(){this._applyToAllRows(DynamicTableRow.prototype.editRow,[]);this.element.find(".dynamics-editor-element:eq(0)").data("editor").focus()};DynamicVerticalTable.prototype.closeRowEdit=function(){this._applyToAllRows(DynamicTableRow.prototype.closeRowEdit,[])};DynamicVerticalTable.prototype._applyToAllRows=function(a,b){for(var c=!0,d=0;d<this.rows.length;d++)var e=a.apply(this.rows[d],b),c=c&&e;return c};DynamicVerticalTable.prototype.onEdit=function(){this.render()};
DynamicVerticalTable.prototype.onDelete=function(){this.container.remove()};DynamicVerticalTable.prototype.getValidationManager=function(){return this.validationManager};DynamicVerticalTable.prototype.renderAlways=function(){return!1};
var DynamicTableRow=function(a){this.config=a;this.cells=[];this.cellIndex={};this.htmlIdsToCell={};this.nameToCell={};this.initialize();this.dynamicCssClasses=[];this.cssClassResolver=null;this.inRowEdit=!1};DynamicTableRow.prototype=new DynamicView;
DynamicTableRow.prototype.initialize=function(){var a=this;this.element=$("\x3cdiv /\x3e").addClass(DynamicTable.cssClasses.tableRow);this.element.data("row",this);this.hasFocus=!1;this.element.bind("DynamicsFocus",function(){a.hasFocus=!0});this.element.bind("DynamicsBlur",function(){a.hasFocus=!1});this.element.delegate("div."+DynamicTable.cssClasses.tableCell,"editorClosing",$.proxy(function(a){this.htmlIdsToCell[a.currentTarget.id]&&this.htmlIdsToCell[a.currentTarget.id].editorClosing()},this));
this.element.delegate("div."+DynamicTable.cssClasses.tableCell,"editorOpening",$.proxy(function(a){this.htmlIdsToCell[a.currentTarget.id]&&this.htmlIdsToCell[a.currentTarget.id].editorOpening()},this));this.element.delegate("div."+DynamicTable.cssClasses.tableCell,"transactionEditEvent",$.proxy(function(a){if(this.htmlIdsToCell[a.currentTarget.id])this.htmlIdsToCell[a.currentTarget.id].onTransactionEdit()},this));this.element.delegate("div."+DynamicTable.cssClasses.tableCell,"dblclick",$.proxy(function(a){this.htmlIdsToCell[a.currentTarget.id]&&
this.htmlIdsToCell[a.currentTarget.id].dblClick(a)},this));this.element.delegate("div."+DynamicTable.cssClasses.tableCell,"click",$.proxy(function(a){this.htmlIdsToCell[a.currentTarget.id]&&this.htmlIdsToCell[a.currentTarget.id].click(a)},this));this.config&&(this.config.hasOwnProperty("visible")&&!this.config.visible)&&this.element.hide()};DynamicTableRow.prototype.registerValidationManager=function(a){this.validationManager=new DynamicsValidationManager(this.element,a,this.model,this.controller)};
DynamicTableRow.prototype.getValidationManager=function(){return this.validationManager};DynamicTableRow.prototype.isFocused=function(){return this.hasFocus};DynamicTableRow.prototype.hide=function(){this.element.hide()};DynamicTableRow.prototype.show=function(){this.element.show()};DynamicTableRow.prototype.render=function(){for(var a=0;a<this.cells.length;a++)this.cells[a].render();this._updateCssClasses()};
DynamicTableRow.prototype._updateCssClasses=function(){if(null!==this.cssClassResolver){for(var a=this.cssClassResolver(this.getModel()),c=this.dynamicCssClasses,b=0;b<c.length;b++)-1==$.inArray(c[b],a)&&this.element.removeClass(c[b]);for(b=0;b<a.length;b++)this.element.addClass(a[b]);this.dynamicCssClasses=a}};DynamicTableRow.prototype.layout=function(){};DynamicTableRow.prototype.setCssClassResolver=function(a){this.cssClassResolver=a};
DynamicTableRow.prototype.createCell=function(a){a=new DynamicTableCell(this,a);this.htmlIdsToCell[a.getId()]=a;a.getElement().appendTo(this.element);this.cells.push(a);return a};DynamicTableRow.prototype.autoCreateCells=function(a){for(var c=0;c<this.config.length;c++)if(this.config[c]){var b=this.config[c];if(a&&-1!==jQuery.inArray(c,a)){var d={};$.extend(!0,d,b);d.options.subViewFactory=null;b=d}d=this.createCell(b);this.cellIndex[c]=d;b.getColumnName()&&(this.nameToCell[b.getColumnName()]=d)}};
DynamicTableRow.prototype.getCell=function(a){return"string"==typeof a?this.getCellByName(a):this.cellIndex[a]};DynamicTableRow.prototype.getCellByName=function(a){return this.nameToCell[a]};DynamicTableRow.prototype.remove=function(){this.getParentView().removeRow(this);this.element.remove();this.destroy()};DynamicTableRow.prototype.onEdit=function(){this.render()};DynamicTableRow.prototype.onDelete=function(){this.remove()};
DynamicTableRow.prototype._applyToAllCells=function(a,c){for(var b=!0,d=0;d<this.cells.length;d++)var e=a.apply(this.cells[d],c),b=b&&e;return b};DynamicTableRow.prototype.isInRowEdit=function(){return this.inRowEdit};DynamicTableRow.prototype.editRow=function(){this.inRowEdit=!0;this._applyToAllCells(DynamicTableCell.prototype.openEditor,[!0])};
DynamicTableRow.prototype.openFullEdit=function(){this.editRow();var a=this.element.find(".dynamics-editor-element:eq(0)").data("editor");a&&(a instanceof TableEditors.Date||a.focus())};DynamicTableRow.prototype.closeRowEdit=function(){this.inRowEdit=!1;this._applyToAllCells(DynamicTableCell.prototype.closeEditor,[])};DynamicTableRow.prototype.isEditable=function(){return this.parentView.config.getEditableCallback().call(this.getController())};
DynamicTableRow.prototype.getViewId=function(){return this.model instanceof CommonModel&&this.model.getId()&&this.parentView instanceof DynamicTable?this.model.getHashCode():DynamicView.prototype.getViewId.call(this)};
var DynamicTableCell=function DynamicTableCell(a,b){this.id="dynamictable-cell-"+DynamicTableCell.currentId++;this.config=b;this.row=a;this.editor=this.subView=null;this.delayedRender=this.config.hasDelayedRender();this.visible=this.config.isVisible();this.initialize()};DynamicTableCell.currentId=1;DynamicTableCell.prototype=new ViewPart;DynamicTableCell.prototype.getRow=function(){return this.row};DynamicTableCell.prototype.getId=function(){return this.id};
DynamicTableCell.prototype.initialize=function(){var c=this;this.element=$('\x3cdiv id\x3d"'+this.id+'"/\x3e').addClass(DynamicTable.cssClasses.tableCell);this.cellContents=$("\x3cspan /\x3e").appendTo(this.element);var a={width:"auto",clear:"none"};this.config.getWidth()&&(a.width=this.config.getWidth());this.config.getMinWidth()&&(a["min-width"]=this.config.getMinWidth()+"px");this.config.isFullWidth()&&(a.clear="left");this.element.css(a);this.config.getCssClass()&&this.element.addClass(this.config.getCssClass());
this.config.isVisible()||this.element.hide();this.config.isDragHandle()&&this.element.addClass(DynamicTable.cssClasses.dragHandle);this.config.isVisualizedEditable()&&this.element.addClass(DynamicTable.cssClasses.editableField);if(this.config.isEditable()){this.element.attr("title","Click to edit");var b="Click to edit ",b=this.config.getTitle()?b+this.config.getTitle():b+"this field";this.element.tooltip({delay:40,track:!0,showURL:!1,isBlocked:function(){return!!c.editor},bodyHandler:function(){return $("\x3cspan\x3e"+
b+"\x3c/span\x3e")}})}if(a=this.config.getSubViewFactory()){var d=this.row.getModel();this.subView=a.call(this.row.getController(),this,d);this.subView instanceof CommonFragmentSubView?(a=$("\x3cspan /\x3e"),a.get(0).innerHTML=this.subView.getHTML(),a.appendTo(this.element)):this.subView instanceof CommonSubView&&this.visible&&this.subView.draw()}};
DynamicTableCell.prototype.dblClick=function(c){this.config.getDoubleClickCallback()&&this.config.getDoubleClickCallback().call(this.row.getController(),this.row.getModel(),this);this.config.isEditable()&&this.getRow().isEditable()&&this.openEditor()};DynamicTableCell.prototype.click=function(c){this.config.getClickCallback()&&this.config.getClickCallback().call(this.row.getController(),this.row.getModel(),this);this.config.isEditable()&&this.getRow().isEditable()&&this.openEditor()};
DynamicTableCell.prototype.getElement=function(){return this.element};DynamicTableCell.prototype.getEditor=function(){return this.editor};DynamicTableCell.prototype.hide=function(){this.visible=!1;this.cellContents.hide();this.element.hide();this.subView&&this.subView.hide()};DynamicTableCell.prototype.show=function(){this.visible=!0;this.cellContents.show();this.element.show();this.subView&&(this._renderSubView(),this.subView.show())};
DynamicTableCell.prototype._renderSubView=function(){this.subView instanceof CommonSubView&&this.visible&&(this.subView.isDrawn()||this.subView.draw(),this.subView.renderAlways()&&this.subView.render())};DynamicTableCell.prototype.render=function(){if(this.delayedRender&&!this.config.isVisible())this.delayedRender=!1;else{var c=this.row.getModel(),a=this.config.getViewGetter(),b=this.config.getDecorator(),d="";this._renderSubView();a&&(d=a.call(c),b&&(d=b.call(c,d)),this.setValue(d))}};
DynamicTableCell.prototype.setValue=function(c){this.cellContents.get(0).innerHTML=c};
DynamicTableCell.prototype.openEditor=function(c,a,b){if(this.element.is(":visible")){var d=this.config.getEditOptions(),e=d.editor;if(this.editor)return!0;if(!(!b&&!this.config.isEditable()||c&&!this.config.isOpenOnRowEdit())){c&&this.element.attr("inRowEdit",c);if((b=TableEditors.getEditorClassByName(e))&&this.config.getEditableCallback().call(this.row.getController())){this.editor=new b(this.getElement(),this.row.getModel(),d);this.closeEditorCb=a;this.editor.setFieldName(this.config.getTitle());
if(c||this.row.isInRowEdit())this.editor.setInRowEdit(!0),this.element.removeClass(DynamicTable.cssClasses.editableField);return!0}return!1}}};DynamicTableCell.prototype.closeEditor=function(){this.editor&&this.editor.close()};DynamicTableCell.prototype.editorClosing=function(){this.cellContents.show();this.editor=null;this.closeEditorCb&&(this.closeEditorCb.call(this.row.getController()),this.closeEditorCb=null)};DynamicTableCell.prototype.editorOpening=function(){this.cellContents.hide()};
DynamicTableCell.prototype.isFocused=function(){return this.editor?this.editor.isFocused():!1};DynamicTableCell.prototype.onTransactionEdit=function(){this.render()};
var DynamicTableRowActions=function(a,b,e,c){this.items=a;this.controller=b;this.model=e;this.parentView=c;this.menuOpen=!1};DynamicTableRowActions.prototype=new CommonFragmentSubView;
DynamicTableRowActions.prototype.getHTML=function(){this.toggleMenuListener=$.proxy(function(){this.menuOpen?this.close():this.open();return!1},this);return'\x3cdiv id\x3d"'+this.getId()+'" style\x3d"width: 68px;"\x3e\x3cdiv class\x3d"actionColumn"\x3e\x3cdiv class\x3d"edit" onclick\x3d"'+DelegateFactory.create(this.toggleMenuListener)+'"\x3eEdit \x26#8711;\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'};
DynamicTableRowActions.prototype.open=function(){var a=this;this.menuOpen=!0;this.menu=$("\x3cul/\x3e").appendTo(document.body).addClass("actionCell");var b=this.parentView.getElement().offset();this.menu.css({position:"absolute",overflow:"visible","z-index":"100","white-space":"nowrap",top:b.top+18,left:b.left-32,"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"});$.each(this.items,function(b,c){var d="";null!=c.tooltip&&(d='title\x3d"'+c.tooltip+'"');d=$("\x3cli "+d+
'"/\x3e').text(c.text).appendTo(a.menu);a._isEnabled(c)?d.click(function(){a._click(c);a.close();return!1}):(d.addClass("actionCell-rowaction-disabled"),d.click(function(){return!1}))});this.menu.menuTimer({closeCallback:function(){a.close()}})};DynamicTableRowActions.prototype.close=function(){this.menu.menuTimer("destroy");this.menu.remove();this.menuOpen=!1};DynamicTableRowActions.prototype._click=function(a){a.callback.call(this.controller,this.model,this.parentView)};
DynamicTableRowActions.prototype._isEnabled=function(a){var b=typeof a.enabled;return"undefined"==b?!0:"function"==b?!!a.enabled.call(this.controller,this.model,this.parentView):!!a.enabled};
var DynamicTableColumnConfiguration=function(a){this.options={width:null,minWidth:0,fullWidth:!1,autoScale:!1,get:null,getView:null,tooltip:"",headerTooltip:"",decorator:null,title:"",sortCallback:null,defaultSortColumn:!1,cssClass:null,editable:!1,visualizedEditable:!1,subViewFactory:null,visible:!0,dragHandle:!1,onDoubleClick:null,onClick:null,delayedRender:!1,editableCallback:function(){return!0},draggableOnly:!1,cssClassResolver:null,openOnRowEdit:!0,columnName:null,edit:{decorator:null,items:null,
set:function(){},editor:null,buttons:null},filter:null};$.extend(this.options,a);this.options.edit.get=this.options.get};DynamicTableColumnConfiguration.prototype.hasDelayedRender=function(){return this.options.delayedRender};DynamicTableColumnConfiguration.prototype.getWidth=function(){return this.options.width};DynamicTableColumnConfiguration.prototype.isAutoScale=function(){return this.options.autoScale};DynamicTableColumnConfiguration.prototype.setWidth=function(a){this.options.width=a};
DynamicTableColumnConfiguration.prototype.getMinWidth=function(){return this.options.minWidth};DynamicTableColumnConfiguration.prototype.getGetter=function(){return this.options.get};DynamicTableColumnConfiguration.prototype.getViewGetter=function(){return this.options.getView?this.options.getView:this.options.get};DynamicTableColumnConfiguration.prototype.getTooltip=function(){return this.options.tooltip};DynamicTableColumnConfiguration.prototype.getTitle=function(){return this.options.title};
DynamicTableColumnConfiguration.prototype.getHeaderTooltip=function(){return this.options.headerTooltip};DynamicTableColumnConfiguration.prototype.getDecorator=function(){return this.options.decorator};DynamicTableColumnConfiguration.prototype.isFullWidth=function(){return this.options.fullWidth};DynamicTableColumnConfiguration.prototype.isDragHandle=function(){return this.options.dragHandle};DynamicTableColumnConfiguration.prototype.getCssClass=function(){return this.options.cssClass};
DynamicTableColumnConfiguration.prototype.getSortCallback=function(){return this.options.sortCallback};DynamicTableColumnConfiguration.prototype.isDefaultSortColumn=function(){return this.options.defaultSortColumn};DynamicTableColumnConfiguration.prototype.setDefaultSortColumn=function(a){this.options.defaultSortColumn=a};DynamicTableColumnConfiguration.prototype.isEditable=function(){return this.options.editable};DynamicTableColumnConfiguration.prototype.isVisualizedEditable=function(){return this.options.visualizedEditable};
DynamicTableColumnConfiguration.prototype.isOpenOnRowEdit=function(){return this.options.openOnRowEdit};DynamicTableColumnConfiguration.prototype.isSortable=function(){return null!==this.options.sortCallback};DynamicTableColumnConfiguration.prototype.isFilterable=function(){return null!==this.options.filter};DynamicTableColumnConfiguration.prototype.getFilter=function(){return this.options.filter};DynamicTableColumnConfiguration.prototype.isVisible=function(){return this.options.visible};
DynamicTableColumnConfiguration.prototype.getEditOptions=function(){return this.options.edit};DynamicTableColumnConfiguration.prototype.getEditableCallback=function(){return this.options.editableCallback};DynamicTableColumnConfiguration.prototype.getSubViewFactory=function(){return this.options.subViewFactory};DynamicTableColumnConfiguration.prototype.getDoubleClickCallback=function(){return this.options.onDoubleClick};DynamicTableColumnConfiguration.prototype.getClickCallback=function(){return this.options.onClick};
DynamicTableColumnConfiguration.prototype.getColumnName=function(){return this.options.columnName};DynamicTableCaptionItemConfiguration=function(a){this.options={text:"",name:"",tooltip:null,callback:function(){},visible:!0,connectWith:null,cssClass:null};jQuery.extend(this.options,a)};DynamicTableCaptionItemConfiguration.prototype.getText=function(){return this.options.text};DynamicTableCaptionItemConfiguration.prototype.getTooltip=function(){return this.options.tooltip};
DynamicTableCaptionItemConfiguration.prototype.getCallback=function(){return this.options.callback};DynamicTableCaptionItemConfiguration.prototype.isVisible=function(){return this.options.visible};DynamicTableCaptionItemConfiguration.prototype.getConnected=function(){return this.options.connectWith};DynamicTableCaptionItemConfiguration.prototype.getName=function(){return this.options.name};DynamicTableCaptionItemConfiguration.prototype.getCssClass=function(){return this.options.cssClass};
var DynamicTableConfiguration=function(a){this.columns=[];this.captionConfig={captionItems:[],cssClasses:""};this.options={rowControllerFactory:$.noop,afterFirstRender:$.noop,dataSource:null,dropOptions:null,tableDroppable:!1,rowDroppable:!1,alwaysDrop:!1,caption:null,captionStyles:null,closeRowCallback:CommonController.prototype.closeRowEdit,sortCallback:null,editableCallback:function(){return!0},validators:[],beforeCommitFunction:null,preventCommit:!1,sortOptions:{items:"\x3e div.dynamicTableDataRow",
handle:"div."+DynamicTable.cssClasses.dragHandle}};jQuery.extend(this.options,a);jQuery.extend(this.captionConfig,this.options.captionConfig)};DynamicTableConfiguration.prototype.getCloseRowCallback=function(){return this.options.closeRowCallback};DynamicTableConfiguration.prototype.getRowControllerFactory=function(){return this.options.rowControllerFactory};DynamicTableConfiguration.prototype.getDataSource=function(){return this.options.dataSource};
DynamicTableConfiguration.prototype.isSortable=function(){return null!==this.options.sortCallback};DynamicTableConfiguration.prototype.isDraggableOnly=function(){return this.options.draggableOnly};DynamicTableConfiguration.prototype.getSortOptions=function(){return this.options.sortOptions};DynamicTableConfiguration.prototype.getSortCallback=function(){return this.options.sortCallback};DynamicTableConfiguration.prototype.getCssClassResolver=function(){return this.options.cssClassResolver};
DynamicTableConfiguration.prototype.getColumnConfiguration=function(a){return this.columns[a]};DynamicTableConfiguration.prototype.addCaptionItem=function(a){this.captionConfig.captionItems.push(new DynamicTableCaptionItemConfiguration(a))};DynamicTableConfiguration.prototype.getCaptionConfiguration=function(){return this.captionConfig};DynamicTableConfiguration.prototype.getColumns=function(){return this.columns};DynamicTableConfiguration.prototype.getCaption=function(){return this.options.caption};
DynamicTableConfiguration.prototype.getEditableCallback=function(){return this.options.editableCallback};DynamicTableConfiguration.prototype.addColumnConfiguration=function(a,b){this.columns[a]=new DynamicTableColumnConfiguration(b)};DynamicTableConfiguration.prototype.setColumnConfiguration=function(a,b){this.columns[a]=b};DynamicTableConfiguration.prototype.getDropOptions=function(){return this.options.dropOptions};DynamicTableConfiguration.prototype.isTableDroppable=function(){return this.options.tableDroppable};
DynamicTableConfiguration.prototype.isRowDroppable=function(){return this.options.rowDroppable};DynamicTableConfiguration.prototype.getDataType=function(){return this.options.dataType};DynamicTableConfiguration.prototype.getAfterFirstRender=function(){return this.options.afterFirstRender};
var DynamicTableToggleView=function DynamicTableToggleView(b,c,d){this.currentMode=DynamicTableToggleView.up;this.options={collapse:function(){},expand:function(){},expanded:!1};jQuery.extend(this.options,b);this.controller=c;this.parentView=d;this.button=null};DynamicTableToggleView.prototype=new CommonFragmentSubView;DynamicTableToggleView.collapsed=1;DynamicTableToggleView.expanded=2;DynamicTableToggleView.currentId=1;
DynamicTableToggleView.prototype._getCell=function(a){return"number"===typeof a?this.parentView.getRow().getCell(a):this.parentView.getRow().getCellByName(a)};DynamicTableToggleView.prototype.renderAlways=function(){return!this.rendered};
DynamicTableToggleView.prototype.render=function(){this.redered=!0;this.button=$("#"+this.getId());if(this.parentView instanceof DynamicTableCell)if(this.options.targetCell)this.targetViews=[this._getCell(this.options.targetCell)];else if(this.options.targetCells){this.targetViews=[];for(var a=0,b=this.options.targetCells.length;a<b;a++)this.targetViews.push(this._getCell(this.options.targetCells[a]))}};
DynamicTableToggleView.prototype.getHTML=function(){var a,b;this.options.expanded?(a="dynamictable-collapse",b="Collapse"):(a="dynamictable-expand",b="Expand");var c=$.proxy(function(){this.button.hasClass("dynamictable-expand")?this.expand():this.collapse();return!1},this);return'\x3cdiv id\x3d"'+this.getId()+'" class\x3d"'+a+'" title\x3d"'+b+'" onclick\x3d"'+DelegateFactory.create(c)+'"\x3e\x3ca href\x3d"javascript:void(0);"\x3e\x3c/a\x3e\x3c/div\x3e'};
DynamicTableToggleView.prototype.showCollapsed=function(){this.button.attr("title","Expand").removeClass("dynamictable-collapse").addClass("dynamictable-expand");this.currentMode=DynamicTableToggleView.collapsed};DynamicTableToggleView.prototype.collapse=function(){this.showCollapsed();if(this.targetViews)for(var a=0,b=this.targetViews.length;a<b;a++)this.targetViews[a].hide();this.options.collapse&&this.options.collapse.call(this.controller,this)};
DynamicTableToggleView.prototype.showExpanded=function(){this.button.attr("title","Collapse").addClass("dynamictable-collapse").removeClass("dynamictable-expand");this.currentMode=DynamicTableToggleView.expanded};DynamicTableToggleView.prototype.expand=function(){this.showExpanded();if(this.targetViews)for(var a=0,b=this.targetViews.length;a<b;a++)this.targetViews[a].render(),this.targetViews[a].show();this.options.expand&&this.options.expand.call(this.controller,this)};
var DynamicTableCaption=function(a,c,b,d){this.captionItems={};this.config=c;this.element=a;this.captionText=b;this.controller=d;this._initialize()};DynamicTableCaption.currentCaptionItemId=1;
DynamicTableCaption.prototype._initialize=function(){this.captionTextContainer=$("\x3cdiv /\x3e").css("float","left").appendTo(this.element).width("30%");this.captionItemContainer=$("\x3cul /\x3e").addClass(DynamicTable.cssClasses.captionActions).appendTo(this.element).css("float","right").width("68%");this.captionText&&this.captionTextContainer.text(this.captionText);this.config.cssClasses&&this.element.addClass(this.config.cssClasses);for(var a=0;a<this.config.captionItems.length;a++)this._addCaptionItem(this.config.captionItems[a])};
DynamicTableCaption.prototype._addCaptionItem=function(a){var c=this,b=$('\x3cli id\x3d"dynamictable-caption-item-'+DynamicTableCaption.currentCaptionItemId++ +'" /\x3e').addClass(DynamicTable.cssClasses.captionAction).appendTo(this.captionItemContainer).css("float","right");this.captionItems[a.getName()]=b;b.text(a.getText());a.getCssClass()&&b.addClass(a.getCssClass());a.isVisible()||b.hide();b.click(function(){c._click(a)})};
DynamicTableCaption.prototype._click=function(a){var c=this.captionItems[a.getName()];a.getConnected()&&(this.captionItems[a.getConnected()].toggle(),c.toggle());a.getCallback().call(this.controller)};
var ValidationMessages={textField:{required:"Required field",unique:"Already exists"},email:{notValid:"Email not in correct form: abc@def.com"},number:{isNotInteger:"Please enter an integer",mustBeGreater:"Value must be greater or equal than ",mustBeLower:"Value must be lower or equal than "},value:{invalid:"Story value must be equal to or greater than zero"},estimate:{invalid:"Incorrect format - Please enter e.g. 10 or 10pt or 10points"},exactEstimate:{invalid:"Incorrect format (e.g. 2, 2.5 or 2h 30min)"},
password:{empty:"Password is empty"}},TableEditors={getEditorClassByName:function(a){return TableEditors[a]?TableEditors[a]:null},openOnRowEdit:function(a){return TableEditors.getEditorClassByName(a).prototype instanceof TableEditors.DialogEditor?!1:!0},currentId:1,CommonEditor:function(){}};TableEditors.CommonEditor.defaultOptions={get:function(){},set:function(){}};TableEditors.CommonEditor.prototype.generateId=function(){return"editor-"+ ++TableEditors.currentId};
TableEditors.CommonEditor.prototype.init=function(a,b,c){this.editRow=!1;this.fieldName="";this.element=a;this.model=b;this.options={};jQuery.extend(this.options,TableEditors.CommonEditor.defaultOptions);jQuery.extend(this.options,c);this.errorMessages=[];this.previousValueValid=!1;this.element.trigger("editorOpening")};TableEditors.CommonEditor.prototype.close=function(){this.element.removeClass("dynamics-validation-invalid");this.element.trigger("editorClosing")};
TableEditors.CommonEditor.prototype.focus=function(){};TableEditors.CommonEditor.prototype._requestCancel=function(){this.element.trigger("cancelRequested",[this])};TableEditors.CommonEditor.prototype._requestCancelIfNotInRowEdit=function(){this.editRow||this._requestCancel()};TableEditors.CommonEditor.prototype._requestSave=function(){this.element.trigger("storeRequested",[this])};TableEditors.CommonEditor.prototype._requestSaveIfNotInRowEdit=function(){this.editRow||this._requestSave()};
TableEditors.CommonEditor.prototype._fireTransactionEditEvent=function(){this.element.trigger("transactionEditEvent")};TableEditors.CommonEditor.prototype.setInRowEdit=function(a){this.editRow=a};TableEditors.CommonEditor.prototype.setFieldName=function(a){this.fieldName=a};TableEditors.CommonEditor.prototype.getEditorValue=function(){};TableEditors.CommonEditor.prototype.setEditorValue=function(){};TableEditors.CommonEditor.prototype.addErrorMessage=function(a){this.errorMessages.push(a)};
TableEditors.CommonEditor.prototype._validate=function(){return!0};TableEditors.CommonEditor.prototype.isFocused=function(){return this.focused};TableEditors.CommonEditor.prototype._registerEditField=function(a){var b=this;a.keydown(function(a){b._handleKeyEvent(a);return!0});a.blur(function(a){b._requestSaveIfNotInRowEdit();b.element.trigger("DynamicsBlur");b.focused=!1});a.focus(function(){b.element.trigger("DynamicsFocus");b.focused=!0});a.data("editor",this).addClass("dynamics-editor-element")};
TableEditors.CommonEditor.prototype.runValidation=function(){this.errorMessages=[];var a=this._validate();a?(this.previousValueValid||this.element.trigger("validationValid",[new DynamicsEvents.ValidationValid(this.fieldName)]),this.options.set.call(this.model,this.getEditorValue()),this.element.trigger("transactionEditEvent"),this.element.removeClass("dynamics-validation-invalid")):(this.element.trigger("validationInvalid",[new DynamicsEvents.ValidationInvalid(this.fieldName,this.errorMessages)]),
this.element.addClass("dynamics-validation-invalid"));return this.previousValueValid=a};TableEditors.CommonEditor.prototype._handleKeyEvent=function(a){if(27===a.keyCode)return a.stopPropagation(),a.preventDefault(),this._requestCancel(),!1;if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),this._requestSave(),!1};TableEditors.TextFieldEditor=function(){};TableEditors.TextFieldEditor.prototype=new TableEditors.CommonEditor;
TableEditors.TextFieldEditor.defaultOptions={required:!1,size:"95%",fieldType:"text"};
TableEditors.TextFieldEditor.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.TextFieldEditor.defaultOptions);jQuery.extend(d,c);TableEditors.CommonEditor.prototype.init.call(this,a,b,d);this.options.visualizeRequired&&a.prev().addClass("required-input");this.textField=$('\x3cinput id\x3d"'+this.generateId()+'" type\x3d"'+this.options.fieldType+'"/\x3e').appendTo(this.element).width(this.options.size);this._registerEditField(this.textField)};
TableEditors.TextFieldEditor.prototype.close=function(){this.textField.remove();TableEditors.CommonEditor.prototype.close.call(this)};TableEditors.TextFieldEditor.prototype.focus=function(){this.textField.focus()};TableEditors.TextFieldEditor.prototype.select=function(){this.textField.select()};TableEditors.TextFieldEditor.prototype.setEditorValue=function(a){a||(a=this.options.get.call(this.model));this.options.decorator&&(a=this.options.decorator(a));this.textField.val(a)};
TableEditors.TextFieldEditor.prototype.getEditorValue=function(){return this.textField.val()};TableEditors.TextFieldEditor.prototype._validate=function(){var a=!0,b=jQuery.trim(this.textField.val());if(this.options.required&&(!b||0===b.length))a=!1,this.addErrorMessage(ValidationMessages.textField.required);return TableEditors.CommonEditor.prototype._validate.call(this)&&a};TableEditors.Text=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.Text.prototype=new TableEditors.TextFieldEditor;
TableEditors.Text.defaultOptions={required:!1};TableEditors.Text.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Text.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};TableEditors.Text.prototype._validate=function(){return TableEditors.TextFieldEditor.prototype._validate.call(this)};TableEditors.TeamName=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.TeamName.prototype=new TableEditors.TextFieldEditor;
TableEditors.TeamName.defaultOptions={required:!0};TableEditors.TeamName.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.TeamName.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};
TableEditors.TeamName.prototype._validate=function(){var a=jQuery.trim(this.textField.val()),b=!0;jQuery.ajax({async:!1,url:"ajax/retrieveAllTeams.action",cache:!1,dataType:"json",success:function(c,d){$.each(c,function(c,d){d.name==a&&(b=!1)})},error:function(a,b,e){MessageDisplay.Error("Unable to load data for checking teams")}});b||this.addErrorMessage(ValidationMessages.textField.unique);return TableEditors.TextFieldEditor.prototype._validate.call(this)&&b};
TableEditors.Email=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.Email.prototype=new TableEditors.TextFieldEditor;TableEditors.Email.defaultOptions={required:!0};TableEditors.Email.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Email.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};
TableEditors.Email.prototype._validate=function(){var a=!0;this.textField.val().match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)||(a=!1,this.addErrorMessage(ValidationMessages.email.notValid));return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};TableEditors.Number=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.Number.prototype=new TableEditors.TextFieldEditor;
TableEditors.Number.defaultOptions={required:!0,minValue:null,maxValue:null};TableEditors.Number.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Number.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};
TableEditors.Number.prototype._validate=function(){var a=!0,b=jQuery.trim(this.textField.val()),c=0===b.toString().search(/^[0-9]*$/),b=parseInt(b,10);c||(this.addErrorMessage(ValidationMessages.number.isNotInteger),a=!1);null!==this.options.minValue&&(c&&this.options.minValue>b)&&(this.addErrorMessage(ValidationMessages.number.mustBeGreater+this.options.minValue),a=!1);null!==this.options.maxValue&&(c&&this.options.maxValue<b)&&(this.addErrorMessage(ValidationMessages.number.mustBeLower+this.options.maxValue),
a=!1);return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};TableEditors.Estimate=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.Estimate.prototype=new TableEditors.TextFieldEditor;TableEditors.Estimate.defaultOptions={required:!1};TableEditors.Estimate.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Estimate.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};
TableEditors.Estimate.prototype._validate=function(){var a=!0,b=jQuery.trim(this.textField.val());/^([0-9]*)$/.test(b)||(a=!1,this.addErrorMessage(ValidationMessages.estimate.invalid));return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};TableEditors.StoryValue=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.StoryValue.prototype=new TableEditors.TextFieldEditor;TableEditors.StoryValue.defaultOptions={required:!1};
TableEditors.StoryValue.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Estimate.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};TableEditors.StoryValue.prototype._validate=function(){var a=!0,b=jQuery.trim(this.textField.val());/^([0-9]*)$/.test(b)||(a=!1,this.addErrorMessage(ValidationMessages.value.invalid));return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};
TableEditors.ExactEstimate=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.ExactEstimate.prototype=new TableEditors.TextFieldEditor;TableEditors.ExactEstimate.defaultOptions={required:!1};TableEditors.ExactEstimate.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.ExactEstimate.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};
TableEditors.ExactEstimate.prototype._validate=function(){var a=jQuery.trim(this.textField.val());this.options.acceptNegative&&a.match(/^\-[0-9]/)&&(a=a.substr(1));var b=/^([1-9]|[1-5]\d)\s*min$/,c=/^[ ]*[0-9]+\s*h[ ]+[0-9]+\s*min$/,d=/^[0-9]+\.[0-9]+\s*h?$/;null!=a&&0===a.indexOf(".")&&(a="0"+a);(a=a.match(/^[0-9]+\s*h?$/)||a.match(b)||a.match(c)||a.match(d)||!a)||this.addErrorMessage(ValidationMessages.exactEstimate.invalid);return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};
TableEditors.Date=function(a,b,c){this.init(a,b,c);this.setEditorValue();"true"==a.attr("inRowEdit")?"":this.focus()};TableEditors.Date.prototype=new TableEditors.TextFieldEditor;TableEditors.Date.defaultOptions={withTime:!0,size:"80%"};
TableEditors.Date.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Date.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d);this.datepickerOpen=!1;var e=this;this.textField.datepicker({dateFormat:"yy-mm-dd",numberOfMonths:3,showButtonPanel:!0,beforeShow:function(){e.datepickerOpen=!0;pattern=/(\d|[0-1][0-9]|2[0-3]):(\d|[0-5][0-9])$/;var a=e.textField.val().search(pattern);e.oldHoursAndMinutes=-1===a?"12:00":e.textField.val().substr(a,
5)},onSelect:function(){var a=e.textField.val();e.options.withTime&&(a=e.textField.val()+" "+e.oldHoursAndMinutes);e.textField.val(a);e.textField.focus()},onClose:function(){e.datepickerOpen=!1;e.textField.focus()},buttonImage:"static/img/calendar.gif",buttonImageOnly:!0,constrainInput:!1})};TableEditors.Date.prototype.close=function(){this.element.find("img").remove();this.textField.datepicker("hide");this.textField.datepicker("destroy");TableEditors.TextFieldEditor.prototype.close.call(this)};
TableEditors.Date.prototype._validate=function(){var a,b="";this.options.withTime?(a=/^\d{4}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[1-2][0-9]|3[0-1]) ([0-1][0-9]|2[0-3]):([0-5][0-9])$/,b="Invalid format (yyyy-mm-dd hh:mm)"):(a=/^\d{4}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[1-2][0-9]|3[0-1])$/,b="Invalid format (yyyy-mm-dd)");var c=jQuery.trim(this.textField.val());(a=a.test(c))||this.addErrorMessage(b);return TableEditors.TextFieldEditor.prototype._validate.call(this)&&a};
TableEditors.Date.prototype._registerEditField=function(a){var b=this;a.blur(function(a){if(b.datepickerOpen)return!1;b._requestSaveIfNotInRowEdit();b.element.trigger("DynamicsBlur");b.focused=!1});a.keydown(function(a){b._handleKeyEvent(a);return!0});a.focus(function(){b.element.trigger("DynamicsFocus");b.focused=!0});a.data("editor",this).addClass("dynamics-editor-element")};TableEditors.Date.prototype.getEditorValue=function(){return Date.fromString(this.textField.val()).getTime()};
TableEditors.Password=function(a,b,c){this.init(a,b,c);this.focus()};TableEditors.Password.prototype=new TableEditors.TextFieldEditor;TableEditors.Password.defaultOptions={required:!0,fieldType:"password"};TableEditors.Password.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Password.defaultOptions);jQuery.extend(d,c);TableEditors.TextFieldEditor.prototype.init.call(this,a,b,d)};TableEditors.Password.prototype.getEditorValue=function(){return this.textField.val()};
TableEditors.Password.prototype._validate=function(){return TableEditors.TextFieldEditor.prototype._validate.call(this)};TableEditors.InlineAutocomplete=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.InlineAutocomplete.prototype=new TableEditors.CommonEditor;TableEditors.InlineAutocomplete.defaultOptions={required:!0,dataType:"",size:"95%"};
TableEditors.InlineAutocomplete.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.InlineAutocomplete.defaultOptions);jQuery.extend(d,c);TableEditors.CommonEditor.prototype.init.call(this,a,b,d);this.options.visualizeRequired&&a.prev().addClass("required-input");this.combobox=$('\x3cspan class\x3d"autocomplete-custom-combobox"/\x3e').appendTo(this.element);this.textField=$('\x3cinput type\x3d"text" /\x3e').width(this.options.size).appendTo(this.combobox);this._registerEditField(this.textField);
var e=this;this.textField.autocomplete({source:jQuery.proxy(function(a,b){b(this._getData(a.term))},this),minLength:0}).click(function(){jQuery(this).autocomplete("search",$(this).val())}).change(function(){if(void 0===e.textField.val()||""==e.textField.val())e.value=null});var e=this,f=this.textField;wasOpen=!1;$("\x3ca\x3e").attr("title","Show all items").appendTo(this.combobox).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("autocomplete-custom-combobox-toggle ui-corner-right").mousedown(function(){wasOpen=
e.autocompleteOpen}).click(function(){wasOpen?f.autocomplete("close"):(f.click(),f.autocomplete("search",""))});this.setEditorValue()};
TableEditors.InlineAutocomplete.prototype._registerEditField=function(a){a.bind("autocompleteselect",jQuery.proxy(function(a,c){this.value=ModelFactory.updateObject(c.item.object);this.setEditorValue(this.value);this._requestSaveIfNotInRowEdit()},this));a.bind("autocompleteclose",jQuery.proxy(function(a,c){this.autocompleteOpen=!1},this));a.bind("autocompleteopen",jQuery.proxy(function(a,c){this.autocompleteOpen=!0},this));TableEditors.CommonEditor.prototype._registerEditField.call(this,a)};
TableEditors.InlineAutocomplete.prototype._handleKeyEvent=function(a){if(27===a.keyCode)return a.stopPropagation(),a.preventDefault(),this._requestCancel(),!1;if(13===a.keyCode&&!this.autocompleteOpen)return a.stopPropagation(),a.preventDefault(),this._requestSave(),!1};TableEditors.InlineAutocomplete.prototype._getData=function(a){var b=AutocompleteDataProvider.getInstance().get(this.options.dataType);a=this._filterSuggestions(b,a);return $.map(a,function(a){return{label:a.name,value:a.name,object:a.originalObject}})};
TableEditors.InlineAutocomplete.prototype._filterSuggestions=function(a,b){var c=this;return jQuery.grep(a,function(a,e){return a.enabled&&(c.matchSearchString(a.matchedString,b)||c.matchSearchString(a.name,b))})};TableEditors.InlineAutocomplete.prototype.matchSearchString=function(a,b){if(!b&&""!=b||!a)return!1;for(var c=b.replace(/[\]\[\\!#$%&()*+,./:;<=>?@_`{|}~]+/," ").split(" "),d=!0,e=0;e<c.length;e++){var f=c[e];if(-1===a.toLowerCase().indexOf(f.toLowerCase())){d=!1;break}}return d};
TableEditors.InlineAutocomplete.prototype.setEditorValue=function(a){a||(a=this.options.get.call(this.model));this.value=a;this.options.decorator&&(a=this.options.decorator(a));this.textField.val(a)};TableEditors.InlineAutocomplete.prototype.getEditorValue=function(){return this.value};
TableEditors.InlineAutocomplete.prototype._validate=function(){var a=!0;this.options.required&&!this.value&&(a=!1,this.addErrorMessage(ValidationMessages.textField.required));return TableEditors.CommonEditor.prototype._validate.call(this)&&a};TableEditors.Selection=function(a,b,c){this.init(a,b,c);this.setEditorValue();this.focus()};TableEditors.Selection.prototype=new TableEditors.CommonEditor;TableEditors.Selection.defaultOptions={required:!1,visualizeRequired:!1,size:"95%",items:{}};
TableEditors.Selection.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Selection.defaultOptions);jQuery.extend(d,c);TableEditors.CommonEditor.prototype.init.call(this,a,b,d);this.selectBox=$('\x3cselect id\x3d"'+this.generateId()+'"/\x3e').appendTo(this.element).width(this.options.size);var e=this;this.options.get.call(this.model);a=this._parseItems();jQuery.each(a,function(a,b){$("\x3coption/\x3e").text(b).val(a).appendTo(e.selectBox)});this._registerEditField(this.selectBox)};
TableEditors.Selection.prototype._parseItems=function(){return"object"===typeof this.options.items?this.options.items:this.options.items()};TableEditors.Selection.prototype._registerEditField=function(a){var b=this;a.change(function(){b._requestSaveIfNotInRowEdit()});TableEditors.CommonEditor.prototype._registerEditField.call(this,a)};TableEditors.Selection.prototype.focus=function(){this.selectBox.focus()};TableEditors.Selection.prototype.close=function(){this.selectBox.remove();TableEditors.CommonEditor.prototype.close.call(this)};
TableEditors.Selection.prototype.getEditorValue=function(){return this.selectBox.val()};TableEditors.Selection.prototype.setEditorValue=function(a){a||(a=this.options.get.call(this.model));a instanceof CommonModel?this.selectBox.val(a.getId()):this.selectBox.val(a)};TableEditors.Selection.prototype._validate=function(){return TableEditors.CommonEditor.prototype._validate.call(this)&&!0};TableEditors.Wysiwyg=function(a,b,c){this.init(a,b,c);this.setEditorValue()};TableEditors.Wysiwyg.prototype=new TableEditors.CommonEditor;
TableEditors.Wysiwyg.defaultOptions={width:"96%",height:"240"};
TableEditors.Wysiwyg.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Wysiwyg.defaultOptions);jQuery.extend(d,c);TableEditors.CommonEditor.prototype.init.call(this,a,b,d);var e=this;this.actualElement=$("\x3ctextarea\x3e\x3c/textarea\x3e").appendTo(a);this.actualElement.width(this.options.width).height(this.options.height);this.actualElement.wysiwyg({autoSave:!0});this.wysiwyg=this._getEditorWindow();this.actualElement.trigger("editorOpening");this.actualElement.addClass("tableSortListener");
this.resetEditor();this.actualElement.bind("tableSorted",function(){e.isFocused()||(e.actualElement.wysiwyg("resetFrame"),e.wysiwyg=e._getEditorWindow(),e.resetEditor(),e.setEditorValue())})};TableEditors.Wysiwyg.prototype.resetEditor=function(){var a=this.actualElement.wysiwyg("getFrame")[0],a=$(a.contentWindow);this._registerEditField(a)};TableEditors.Wysiwyg.prototype._getEditorWindow=function(){return $(this.actualElement.wysiwyg("getDocument"))};
TableEditors.Wysiwyg.prototype.setEditorValue=function(a){a||(a=this.options.get.call(this.model)||"");this.actualElement.get(0).innerHTML=a;this.actualElement.wysiwyg("setValue",a)};TableEditors.Wysiwyg.prototype.getEditorValue=function(){return this.actualElement.val()};TableEditors.Wysiwyg.prototype.focus=function(){this.actualElement.focus()};TableEditors.Wysiwyg.prototype.close=function(){this.actualElement.trigger("editorClosing");this.actualElement.wysiwyg("remove");this.actualElement.remove()};
TableEditors.Wysiwyg.prototype._registerEditField=function(a){this.actualElement.wysiwyg("getFrame").data("editor",this).addClass("dynamics-editor-element");var b=this;a.keydown(function(a){b._handleKeyEvent(a);return!0});a.blur(function(a){0===b.element.find(a.target).length&&!b.actualElement.wysiwyg("getKeepEditorOpen")&&(b._requestSaveIfNotInRowEdit(),b.element.trigger("DynamicsBlur"),b.focused=!1)});a.focus(function(a){b.element.trigger("DynamicsFocus");b.focused=!0});b.actualElement.focus()};
TableEditors.Wysiwyg.prototype._handleKeyEvent=function(a){27===a.keyCode&&!this.editRow&&this.close()};TableEditors.DialogEditor=function(){};TableEditors.DialogEditor.prototype=new TableEditors.CommonEditor;TableEditors.DialogEditor.defaultOptions={modal:!0,autoShow:!0,dialogTitle:"(Insert title here)",dialogClose:function(){return!0}};
TableEditors.DialogEditor.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.DialogEditor.defaultOptions);jQuery.extend(d,c);TableEditors.CommonEditor.prototype.init.call(this,a,b,d);this.options.autoShow&&this._openDialog()};
TableEditors.DialogEditor.prototype._openDialog=function(){var a=this,b={autoOpen:this.options.autoShow,modal:this.options.modal,buttons:{Cancel:function(){a._cancel()},Ok:function(){a._ok()}},close:function(){a._cancel()},width:500,minHeight:300,title:this.options.dialogTitle};this.dialog=$("\x3cdiv/\x3e").dialog(b)};TableEditors.DialogEditor.prototype._closeDialog=function(){this.dialog&&(this.dialog.dialog("destroy"),this.dialog.remove(),this.dialog=null)};
TableEditors.DialogEditor.prototype._ok=function(){this.options.set.apply(this.model,this.getEditorValue());this._requestSaveIfNotInRowEdit();this.close()};TableEditors.DialogEditor.prototype._cancel=function(){this._requestCancelIfNotInRowEdit();this.close()};TableEditors.DialogEditor.prototype.close=function(){this._closeDialog();this._fireTransactionEditEvent();TableEditors.CommonEditor.prototype.close.call(this);this.options.dialogClose.call()};TableEditors.AutocompleteDialog=function(){};
TableEditors.AutocompleteDialog.prototype=new TableEditors.DialogEditor;TableEditors.AutocompleteDialog.defaultOptions={dataType:"",multiSelect:!0,selectCallback:null,params:{}};
TableEditors.AutocompleteDialog.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.AutocompleteDialog.defaultOptions);jQuery.extend(d,c);TableEditors.DialogEditor.prototype.init.call(this,a,b,d);a={dataType:this.options.dataType,params:this.options.params,preSelected:[],multiSelect:this.options.multiSelect,selectCallback:this.options.selectCallback,showSelectAllItems:this.options.showSelectAllItems,showRemoveAllItems:this.options.showRemoveAllItems};this.autocompleteElement=$("\x3cdiv/\x3e").appendTo(this.dialog);
this.autocomplete=new Autocomplete(this.autocompleteElement,a);this.autocomplete.initialize();this.setEditorValue()};TableEditors.AutocompleteDialog.prototype.getEditorValue=function(){var a=this.autocomplete.getSelectedIds(),b=this.autocomplete.getSelectedItems();return[a,b]};TableEditors.AutocompleteDialog.prototype.setEditorValue=function(){var a=this.options.get.call(this.model);if(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].getId());this.autocomplete.setSelected(b)}};
TableEditors.AutocompleteSingle=function(a,b,c){this.init(a,b,c)};TableEditors.AutocompleteSingle.prototype=new TableEditors.AutocompleteDialog;TableEditors.AutocompleteSingle.defaultOptions={};TableEditors.AutocompleteSingle.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.AutocompleteDialog.defaultOptions);jQuery.extend(d,c);d.multiSelect=!1;var e=this;d.selectCallback=function(a){e._selectCallback(a)};TableEditors.AutocompleteDialog.prototype.init.call(this,a,b,d)};
TableEditors.AutocompleteSingle.prototype._selectCallback=function(a){var b=a;a.originalObject&&(b=ModelFactory.updateObject(a.originalObject));this.options.set.call(this.model,b);this.element.trigger("transactionEditEvent");this._requestSaveIfNotInRowEdit();this.close()};TableEditors.Autocomplete=function(a,b,c){this.init(a,b,c)};TableEditors.Autocomplete.prototype=new TableEditors.AutocompleteDialog;TableEditors.Autocomplete.defaultOptions={};
TableEditors.Autocomplete.prototype.init=function(a,b,c){var d={};jQuery.extend(d,TableEditors.Autocomplete.defaultOptions);jQuery.extend(d,c);d.multiSelect=!0;TableEditors.AutocompleteDialog.prototype.init.call(this,a,b,d)};
TableEditors.Labels=function(a,b,c){this.init(a,b,c);this.options.showText?(a=$('\x3cdiv style\x3d"width: 90%;" /\x3e').appendTo(this.element),a.append('\x3cspan class\x3d"labelsText"\x3eLabels:\x3c/span\x3e'),this.labelsElement=$('\x3cdiv class\x3d"inline-labeleditor"/\x3e').appendTo(a)):this.labelsElement=$("\x3cdiv /\x3e").appendTo(this.element);this.labelsView=new AutoSuggest("ajax/lookupLabels.action",{startText:"Enter labels here.",queryParam:"labelName",searchObj:"name",selectedItem:"displayName",
disableButtons:!0,cancelCallback:function(){},successCallback:function(a){},retrieveComplete:function(a){for(var b=[],c=0,g=a.length;c<g;c++)b[c]={value:a[c].displayName,name:a[c].name,displayName:a[c].displayName};return b},minChars:1},this.labelsElement);this._registerEditField(this.labelsElement)};TableEditors.Labels.prototype=new TableEditors.CommonEditor;TableEditors.Labels.defaultOptions={showText:!1,text:"Labels"};TableEditors.Labels.prototype.getEditorValue=function(){return this.labelsView.getValues()};
TableEditors.Labels.prototype._handleKeyEvent=function(a){if(27===a.keyCode)return a.stopPropagation(),a.preventDefault(),this._requestCancel(),!1;if(13===a.keyCode)return a.stopPropagation(),a.preventDefault(),!1};
var DynamicsDecorators={stateOptions:{NOT_STARTED:"Not Started",STARTED:"In Progress",PENDING:"Pending",BLOCKED:"Blocked",IMPLEMENTED:"Ready",DONE:"Done",DEFERRED:"Deferred"},adminOptions:{"true":"Yes","false":"No"},teamAdminOptions:{MYTEAMS:"Teams that I belong to",ALL:"All",NONE:"None"},teamNonAdminOptions:{MYTEAMS:"Teams that I belong to",NONE:"None"},stateDecorator:function(a){return DynamicsDecorators.stateOptions[a]},adminDecorator:function(a){return DynamicsDecorators.adminOptions[a]},conditionColorDecorator:function(a,
b,c){return function(d){var e=a.call(this),e=b(e);d=c.call(this,d);return e?'\x3cspan style\x3d"color: '+e+';"\x3e'+d+"\x3c/span\x3e":d}},linkifyDecorator:function(a){return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e'+a+"\x3c/font\x3e\x3c/a\x3e"},taskStateColorDecorator:function(a){var b=DynamicsDecorators.stateDecorator(a);return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e\x3cdiv class\x3d"taskState taskState'+a+'"\x3e'+b+"\x3c/div\x3e\x3c/font\x3e\x3c/a\x3e"},storyStateColorDecorator:function(a){var b=
DynamicsDecorators.stateDecorator(a);return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e\x3cdiv class\x3d"storyState storyState'+a+'"\x3e'+b+"\x3c/div\x3e\x3c/font\x3e\x3c/a\x3e"},enabledDisabledOptions:{"true":"Enabled","false":"Disabled"},enabledDisabledTaskColorDecorator:function(a){return'\x3cdiv class\x3d"taskState taskState'+{"false":"NOT_STARTED","true":"DONE"}[a]+'"\x3e'+DynamicsDecorators.enabledDisabledOptions[a]+"\x3c/div\x3e"},enabledDisabledStoryColorDecorator:function(a){return'\x3cdiv class\x3d"storyState storyState'+
{"false":"NOT_STARTED","true":"DONE"}[a]+'"\x3e'+DynamicsDecorators.enabledDisabledOptions[a]+"\x3c/div\x3e"},appendDecoratorFactory:function(a){return function(b){return b+a}},emptyValueWrapper:function(a,b){return function(c){c=a(c);return!c||!c.length?b:c}},exactEstimateDecorator:function(a){return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e'+("string"===typeof a?a:a?0===a?"0h":Math.round(10*a/60)/10+"h":"\x26mdash;")+"\x3c/font\x3e\x3c/a\x3e"},exactEstimateAppendManHourDecorator:function(a){return"string"===
typeof a?a:a?0===a?"0 man-hours":Math.round(10*a/60)/10+" man-hours":"\x26mdash;"},exactEstimateEditDecorator:function(a){return"string"===typeof a?a:!a?"":Math.round(10*a/60)/10+"h"},exactEstimateSumDecorator:function(a){return DynamicsDecorators.exactEstimateDecorator(a)},estimateDecorator:function(a){return!a?"\x26mdash;":a},dateTimeDecorator:function(a){if(!a)return"";var b=new Date;b.setTime(a);return b.asString()},timeDecorator:function(a){if(!a)return"";var b=new Date;b.setTime(a);return b.asString().substring(10,
16)},hiddenDecorator:function(a){return""},backlogNameLinkDecorator:function(a){return a?'\x3ca href\x3d"editBacklog.action?backlogId\x3d'+a+'"\x3e'+a+"\x3c/a\x3e":""},storyNameLinkDecorator:function(a){return a?'\x3ca href\x3d"qr.action?q\x3dstory:'+a+'"\x3e'+a+"\x3c/a\x3e":""},plainContextDecorator:function(a){return!a||!a.backlogId&&!a.storyId?"(not set)":a.name},storyContextDecorator:function(a){return a?'\x3ca class\x3d"context" title\x3d"Backlog: '+a.getName()+'" href\x3d"editBacklog.action?backlogId\x3d'+
a.getId()+'"\x3e'+a.getName()+"\x3c/a\x3e":""},storyPriorityDecorator:function(a){null!=a&&null!=a.getMyStoriesRank()&&1E4>a.getMyStoriesRank()&&jQuery("#fi\\.hut\\.soberit\\.agilefant\\.model\\.Story_"+a.getId()).addClass("dailywork-story-table-row-parent");return""},taskContextDecorator:function(a){var b="";a.backlog&&(b+='\x3ca class\x3d"context" title\x3d"Backlog: '+a.backlog.getName()+'" href\x3d"editBacklog.action?backlogId\x3d'+a.backlog.getId()+'"\x3e'+a.backlog.getName()+"\x3c/a\x3e");a.story&&
(b+='\x3cbr/\x3e\x3cspan title\x3d"Story: '+a.story.getName()+'" class\x3d"context context-story"\x3e'+a.story.getName()+"\x3c/a\x3e");a.task&&(b+='\x3cbr/\x3e\x3cspan title\x3d"Task: '+a.task.getName()+'" class\x3d"context context-task"\x3e'+a.task.getName()+"\x3c/a\x3e");return b},tasksWithoutStoryContextDecorator:function(a){return DynamicsDecorators.taskContextDecorator({backlog:a,story:null})},backlogSelectDecorator:function(a){return!a?"(none)":a.getName()},iterationSelectDecorator:function(a){return!a?
"(none)":a.getName()},parentStorySelectDecorator:function(a){var b="(none)";a&&(b=a.getName());return"\x3cspan\x3e"+b+"\x3c/span\x3e"},dateDecorator:function(a){if(!a)return"";var b=new Date;b.setTime(a);return b.asString().substr(0,10)},userNameDecorator:function(a){return a.getFullName()},responsiblesDecorator:function(a){return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e'+DynamicsDecorators.userInitialsListDecorator(a,'\x3cspan class\x3d"smallGreyText"\x3e(none)\x3c/span\x3e')+"\x3c/font\x3e\x3c/a\x3e"},
userInitialsListDecorator:function(a,b){if(!a||!a.length)return b?b:"";for(var c=[],d=0;d<a.length;d++)c.push(a[d].getInitials());return c.join(", ")},teamUserCountDecorator:function(a){return a.length+" members"},teamUserListDecorator:function(a){if(!a||!a.length)return"(no users)";for(var b=[],c=0;c<a.length;c++)b.push(a[c].getFullName());b.sort();return b.join(", ")},productTeamCountDecorator:function(a){return a.length+" teams"},productTeamListDecorator:function(a){if(!a||!a.length)return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e(no teams)\x3c/font\x3e\x3c/a\x3e';
for(var b=[],c=0;c<a.length;c++)b.push(a[c].getName());b.sort();return b.join(", ")},iterationTeamCountDecorator:function(a){return a.length+" teams"},iterationTeamListDecorator:function(a){if(!a||!a.length)return"(no teams)";for(var b=[],c=0;c<a.length;c++)b.push(a[c].getName());b.sort();return b.join(", ")},teamUserInitialsListDecorator:function(a){if(!a||!a.length)return'\x3ca href\x3d"javascript:"\x3e\x3cfont color\x3d"999"\x3e(Select users)\x3c/font\x3e\x3c/a\x3e';for(var b=[],c=0;c<a.length;c++)b.push(a[c].getInitials());
return b.join(", ")},teamListDecorator:function(a){if(!a||!a.length)return"(No teams)";for(var b=[],c=0;c<a.length;c++)b.push(a[c].getName());b.sort(function(a,b){return a.toLowerCase()>b.toLowerCase()});return b.join(", ")},annotatedUserInitialsListDecorator:function(a){if(!a||!a.length)return'\x3cspan class\x3d"smallGreyText"\x3e(none)\x3c/span\x3e';var b=[];$.each(a,function(a,d){var e=d.user.getInitials();d.workingOnTask&&(e="\x3cstrong\x3e"+e+"\x3c/strong\x3e");b.push(e)});return b.join(", ")},
totalPersonalLoadDecorator:function(a){var b=this.getBacklog().getBaselineLoad(),c=DynamicsDecorators.exactEstimateDecorator(b),d=DynamicsDecorators.exactEstimateDecorator(a);a=DynamicsDecorators.exactEstimateDecorator(a+b);return c+" + "+d+" \x3d "+a},projectStates:{GREEN:"Green",YELLOW:"Yellow",RED:"Red",GREY:"Grey",BLACK:"Black"},projectStatusToImg:{GREEN:"static/img/status-green.png",YELLOW:"static/img/status-yellow.png",RED:"static/img/status-red.png",BLACK:"static/img/status-black.png",GREY:"static/img/status-grey.png"},
projectStatusDecorator:function(a){return'\x3cimg src\x3d"'+DynamicsDecorators.projectStatusToImg[a]+'" alt\x3d"Status"/\x3e'},empty:function(){return""},idLinkDecoratorFactory:function(a){return function(b){return'\x3ca href\x3d"'+a.replace("#id",this.getId())+'"\x3e'+b+"\x3ca/\x3e"}},onEmptyDecoratorFactory:function(a){return function(b){return b?b:a}},emptyDescriptionDecorator:function(a){return DynamicsDecorators.onEmptyDecoratorFactory('\x3cspan class\x3d"smallGreyText"\x3e(empty)\x3c/span\x3e')(a)},
emptyTaskDescriptionDecorator:function(a){return DynamicsDecorators.onEmptyDecoratorFactory('\x3cspan class\x3d"smallGreyText"\x3e(Empty description)\x3c/span\x3e')(a)},propertyDecoratorFactory:function(a){return function(b){return null!==b?a.call(b):""}},linkToWorkItem:function(a){a="story:"+a;return'\x3ca href\x3d"qr.action?q\x3d'+a+'" title\x3d"Click to open the work item"\x3e'+a+"\x3c/a\x3e"},quickReference:function(a){var b="";this instanceof StoryModel?b="story:"+a:this instanceof TaskModel?
b="task:"+a:this instanceof BacklogModel&&(b="backlog:"+a);if(b)return'\x3ca href\x3d"qr.action?q\x3d'+b+'" id\x3d"reflink_'+b+'" title\x3d"Click to copy the reference link" onclick\x3d"showQuickRefLink(this); return false;" class\x3d"referenceLink"\x3e'+b+"\x3c/a\x3e"},storyIdWithHash:function(a){return a?'\x3ca href\x3d"qrq.action?q\x3dstory:'+a+'" title\x3d"Click to Open Story"\x3e'+("#"+a)+"\x3c/a\x3e":"\x26mdash;"}};
var DynamicsSplitPanel=function(a){this.parentView=a;this.element=$("\x3cdiv /\x3e").appendTo(this.parentView.getElement());this.subViewElements={};this.panels=[]};DynamicsSplitPanel.prototype=new ViewPart;DynamicsSplitPanel.prototype.renderAlways=function(){return!0};DynamicsSplitPanel.prototype.createPanel=function(a,b){this.subViewElements[a]=$("\x3cdiv /\x3e").appendTo(this.element);var c=this.subViewElements[a];b.width&&c.width(b.width);c.css("float","left");return c};
DynamicsSplitPanel.prototype.addPanel=function(a){this.panels.push(a)};DynamicsSplitPanel.prototype.render=function(){for(var a=this.panels.length,b=0;b<a;b++)this.panels[b].render()};
var DynamicsTabs=function(a,c){this.id="dtab_"+(new Date).getTime()+"_"+Math.floor(1E6*Math.random());this.tabs=[];this.options=c;this.element=$("\x3cdiv /\x3e").appendTo(a);this.titles=$("\x3cul /\x3e").appendTo(this.element);this.options.tabClass&&this.titles.addClass(this.options.tabClass);this.initialRenderComplete=!1;this.topCache=""};DynamicsTabs.prototype=new ViewPart;
DynamicsTabs.prototype.add=function(a,c,b){jQuery.extend({callback:null},b);b=this.id+"_"+this.tabs.length;var d=$('\x3cdiv id\x3d"'+b+'"/\x3e').appendTo(this.element);$("#"+b);this.initialRenderComplete?this.element.tabs("add","#"+b,a):this.topCache+='\x3cli\x3e\x3ca href\x3d"#'+b+'"\x3e'+a+"\x3c/a\x3e\x3c/li\x3e";d.css(c);a=this.element.find("#"+b);this.tabs.push(a);return a};
DynamicsTabs.prototype.render=function(){this.initialRenderComplete||(this.titles.html(this.topCache),this.element.tabs());this.initialRenderComplete=!0};
var DynamicsButtons=function(a,b,c){this.options=[];jQuery.extend(this.options,b);this.buttons=[];this.parent=c;this.controller=a};DynamicsButtons.prototype=new CommonSubView;
DynamicsButtons.prototype._draw=function(){var a=this,b,c;jQuery.each(this.options,function(e,d){c=d.text.length+2+"ex";b=$('\x3cbutton class\x3d"dynamics-button" style\x3d"width: '+c+'; height: auto !important;"\x3e'+d.text+"\x3c/button\x3e");b.appendTo(a.parent.getElement());a.buttons.push(b);b.text();b.click(function(b){a._click(e);return!1})})};DynamicsButtons.prototype.show=function(){};DynamicsButtons.prototype.hide=function(){};DynamicsButtons.prototype._click=function(a){this.options[a].callback.call(this.controller)};
DynamicsButtons.commonButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Save",callback:function(){a.getElement().trigger("storeRequested")}},{text:"Cancel",callback:function(){a.getElement().trigger("cancelRequested")}}],a)};
var DynamicTableRowButton=function(a,b,c,d,e){this.label=a.label;this.callback=a.callback;this.controller=b;this.model=c;this.parentView=d;this.width=e};DynamicTableRowButton.prototype=new CommonFragmentSubView;
DynamicTableRowButton.prototype.getHTML=function(){var a=this;this.container=$("\x3cdiv /\x3e").width(this.width+"px").appendTo(this.parentView.getElement());this.button=$('\x3cdiv class\x3d"actionColumn"\x3e\x3cdiv class\x3d"edit" style\x3d"width: '+(this.width-20)+'px"\x3e'+this.label+"\x3c/div\x3e\x3c/div\x3e");this.button.appendTo(this.container);this.button.click(function(b){a._click()});return""};
DynamicTableRowButton.prototype._click=function(){this.callback.call(this.controller,this.model,this.parentView)};
var DynamicsValidationManager=function(b,a,c,d){var e={};jQuery.extend(e,a);this.messages={};this.element=$(b);this.configuration=e;this.model=c;this.controller=d;this.errorContainer=null;this._reqisterEvents();this.activeMessages=0};DynamicsValidationManager.prototype.isValid=function(){this._runFieldValidators();this._runCompositeValidations();if(0!==this.activeMessages)return!1;this.clear();return!0};
DynamicsValidationManager.prototype.clear=function(){this.activeMessages=0;this.errorContainer&&this.errorContainer.remove();this.errorContainer=null;this.messages={}};DynamicsValidationManager.prototype._runCompositeValidations=function(){for(var b=[],a=0;a<this.configuration.options.validators.length;a++){var c=this.configuration.options.validators[a];try{c(this.model)}catch(d){b.push(d)}}0<b.length?this._addValidationErrors(b,"___compositeValidators___"):this._removeErrorMessage("___compositeValidators___")};
DynamicsValidationManager.prototype._runFieldValidators=function(){this.element.find(".dynamics-editor-element").each(function(){$(this).data("editor").runValidation()})};
DynamicsValidationManager.prototype._reqisterEvents=function(){this.element.bind("validationInvalid",jQuery.proxy(function(b,a){this._addValidationErrors(a.getMessages(),a.getObject(),a.getObject());return!1},this));this.element.bind("validationValid",jQuery.proxy(function(b,a){this._removeErrorMessage(a.getObject());0===this.activeMessages&&this.clear()},this));this.element.bind("storeRequested",jQuery.proxy(function(b,a){b.stopPropagation();this._storeRequested(b,a);return!1},this));this.element.bind("cancelRequested",
jQuery.proxy(function(b,a){b.stopPropagation();this._cancelRequested(b,a);return!1},this))};
DynamicsValidationManager.prototype._storeRequested=function(b,a){if(this.isValid()){this.configuration.options.preventCommit||(this.configuration.options.beforeCommitFunction&&"function"===typeof this.configuration.options.beforeCommitFunction?this.configuration.options.beforeCommitFunction.call(this.controller,this.model):this.model.commit());var c=this.configuration.getCloseRowCallback();c?c.call(this.controller):a&&a.close()}};
DynamicsValidationManager.prototype._cancelRequested=function(b,a){this.model.rollback();this.clear();var c=this.configuration.getCloseRowCallback();c&&c.call(this.controller);a&&a.close()};DynamicsValidationManager.prototype._createErrorContainer=function(){this.errorContainer||(this.errorContainer=$("\x3cul /\x3e").addClass("dynamics-error-container").prependTo(this.element))};
DynamicsValidationManager.prototype._addValidationErrors=function(b,a,c){this._removeErrorMessage(a);for(var d=[],e=0;e<b.length;e++)d.push(this._addErrorMessage((c?c+" : ":"")+b[e]));this.messages[a]=d};DynamicsValidationManager.prototype._addErrorMessage=function(b){this._createErrorContainer();this.activeMessages++;return $("\x3cli /\x3e").text(b).appendTo(this.errorContainer)};
DynamicsValidationManager.prototype._removeErrorMessage=function(b){var a=this.messages[b];a&&$.each(a,jQuery.proxy(function(a,b){b.remove();this.activeMessages--},this));this.messages[b]=null};
var DynamicsConfirmationDialog=function(a,b,c,d){this.title=a;this.message=b;this.okCallback=c;this.cancelCallback=d;this._show()};
DynamicsConfirmationDialog.prototype._show=function(){this.messageElement=$('\x3cdiv\x3e\x3cimg src\x3d"static/img/question.png" alt\x3d"Are you sure?" style\x3d"float: left;" /\x3e\x3cdiv style\x3d"margin-left: 90px"\x3e'+this.message+"\x3c/div\x3e\x3c/div\x3e").appendTo(document.body);var a=this;this.messageElement.dialog({modal:!0,title:this.title,minHeight:"200",minWidth:"400",width:"400",position:"center",resizable:!1,buttons:{Yes:function(){a._ok()},No:function(){a._cancel()}},open:function(){$(this).siblings(".ui-dialog-buttonpane button:eq(0)").focus()}})};
DynamicsConfirmationDialog.prototype._ok=function(){this.okCallback();this.close()};DynamicsConfirmationDialog.prototype._cancel=function(){this.cancelCallback&&this.cancelCallback();this.close()};DynamicsConfirmationDialog.prototype.close=function(){this.messageElement.dialog("destroy").remove()};
var ChangePasswordDialog=function(a){this.model=a;this._createConfig();this.init();this.autohideCells=[]};ChangePasswordDialog.prototype=new ViewPart;ChangePasswordDialog.prototype.init=function(){this._createDialog();this.formArea=$("\x3cdiv/\x3e").appendTo(this.dialogElement);this.view=new DynamicVerticalTable(this,this.model,this.config,this.formArea);this.view.render();this.view.openFullEdit()};
ChangePasswordDialog.prototype._createDialog=function(){this.dialogElement=$("\x3cdiv/\x3e").appendTo(document.body);var a=this;this.dialogElement.dialog({width:300,height:250,modal:!0,buttons:{Cancel:function(){a._cancel()},Ok:function(){a._ok()}},close:function(){a._cancel()},title:"Change password"})};ChangePasswordDialog.prototype._ok=function(){this.view.getValidationManager().isValid()&&(this.model.commit(),this._close())};
ChangePasswordDialog.prototype._cancel=function(){this.formArea.trigger("cancelRequested");this._close()};ChangePasswordDialog.prototype._close=function(){this.formArea.remove();this.dialogElement.dialog("destroy");this.dialogElement.remove()};
ChangePasswordDialog.prototype._createConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"40%",rightWidth:"59%",validators:[UserModel.Validators.passwordValidator],closeRowCallback:ChangePasswordDialog.prototype._close});a.addColumnConfiguration(0,{title:"Password",editable:!0,get:UserModel.prototype.getPassword1,edit:{editor:"Password",required:!0,set:UserModel.prototype.setPassword1}});a.addColumnConfiguration(1,{title:"Confirm password",editable:!0,get:UserModel.prototype.getPassword2,
edit:{editor:"Password",required:!0,set:UserModel.prototype.setPassword2}});this.config=a};
var LazyLoadedDialog=function(){};
LazyLoadedDialog.prototype.init=function(b){this.url=b.url;this.data=b.data;this.title=b.title;this.okCallback=b.okCallback;this.cancelCallback=b.cancelCallback;this.loadCallback=b.loadCallback;this.disableClose=b.disableClose;this.contentElement=$('\x3cdiv\x3e\x3cdiv style\x3d"text-align: center"\x3e\x3cimg src\x3d"static/img/pleasewait.gif" alt\x3d"Loading..." /\x3e\x3c/div\x3e\x3c/div\x3e').appendTo(document.body);var a=this;this.contentElement.dialog({modal:!0,title:a.title,minHeight:"200",minWidth:600,
width:600,position:"center",resizable:!1,open:function(){a.contentElement.load(a.url,a.data,function(c,d,e){"success"===d?(b.hideCancelButton?a.contentElement.dialog("option","buttons",{Ok:function(){a._ok()}}):a.contentElement.dialog("option","buttons",{Cancel:function(){a._cancel()},Ok:function(){a._ok()}}),a.loadCallback&&a.loadCallback(a.contentElement)):"error"===d&&(a.contentElement.empty(),a.contentElement.dialog("option","buttons",{Cancel:function(){a._cancel()}}),$("\x3cp\x3eError loading dialog\x3c/p\x3e").appendTo(a.contentElement));
$(this.nextElementSibling).find("Button")[0].focus()})}})};LazyLoadedDialog.prototype._ok=function(){this.okCallback&&this.okCallback();this.disableClose||this.close()};LazyLoadedDialog.prototype._cancel=function(){this.closeCallback&&this.closeCallback();this.close()};LazyLoadedDialog.prototype.close=function(){this.contentElement.dialog("destroy").remove()};var LazyLoadedFormDialog=function(){};LazyLoadedFormDialog.prototype=new LazyLoadedDialog;
LazyLoadedFormDialog.prototype._ok=function(){if(this.okCallback){for(var b=this.contentElement.find("form:eq(0)").serializeArray(),a={},c=0,d=b.length;c<d;c++){var e=b[c];a[e.name]=e.value}this.okCallback(a)}this.disableClose||this.close()};
var UserSpentEffortWidget=function(a,b){this.element=$("\x3cdiv /\x3e").appendTo(a);this.container=a;this.userId=b;this.initConfig();this.model=new HourEntryListContainer;this.effortByDayElement=$('\x3cdiv class\x3d"details"\x3e\x3c/div\x3e').appendTo(a);this.entriesByDay=new DynamicTable(this,this.model,this.hourEntryTableConfig,this.effortByDayElement);this.effortByDayElement.hide();this.reload()};
UserSpentEffortWidget.prototype.reload=function(){var a=this,b=(new Date).getUserTimeZone();this.element.load("weeklySpentEffort.action",{userTimeZone:b,userId:this.userId},function(){a._registerSpentEffortEvents()})};UserSpentEffortWidget.prototype._parseDateValues=function(a){a=a.split("-");return 2!=a.length?(console.log("SHOULD NEVER GET HERE."),{}):{week:a[1],year:a[0]}};
UserSpentEffortWidget.prototype._registerSpentEffortEvents=function(){var a=this;a.effortByDayElement.hide();this.element.find("a:not(.detailLink)").click(function(){a.element.load(this.href,function(){a._registerSpentEffortEvents()});return!1});this.element.find("select").change(function(){var b=a._parseDateValues($(this).val());b.userId=a.userId;b.userTimeZone=(new Date).getUserTimeZone();a.element.load("weeklySpentEffort.action",b,function(b){a._registerSpentEffortEvents()})});this.element.find("a.detailLink").click(function(b){$("a.detailLink",
a.element).removeClass("detailedEffort");$(this).addClass("detailedEffort");$.ajax({url:this.href,method:"post",cache:!1,dataType:"json",success:function(b,c){a.model.setData(b);a.effortByDayElement.show();a.entriesByDay.render()}});return!1})};UserSpentEffortWidget.prototype.hourEntryControllerFactory=function(a,b){return new HourEntryController(b,a,this)};
UserSpentEffortWidget.prototype.initConfig=function(){this.hourEntryTableConfig=new DynamicTableConfiguration({rowControllerFactory:UserSpentEffortWidget.prototype.hourEntryControllerFactory,dataSource:HourEntryListContainer.prototype.getHourEntries,cssClass:"ui-widget-content ui-corner-all",captionConfig:{cssClasses:"ui-helper-hidden"}});var a={minWidth:40,autoScale:!0,title:"Spent",get:HourEntryModel.prototype.getMinutesSpent,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,
columnName:"effortSpent",edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,set:HourEntryModel.prototype.setEffortSpent}},b={minWidth:40,autoScale:!0,title:"Left",visualizedEditable:!0,get:TaskModel.prototype.getEffortLeft,decorator:DynamicsDecorators.exactEstimateSumDecorator,editable:!0,columnName:"effortLeft",edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,set:TaskModel.prototype.setEffortLeft}},d={minWidth:200,autoScale:!0,
title:"Comment",editable:!0,visualizedEditable:!0,get:HourEntryModel.prototype.getDescription,edit:{editor:"Text",set:HourEntryModel.prototype.setDescription}},c={minWidth:200,autoScale:!0,title:"Context",editable:!1,get:HourEntryModel.prototype.getContext,decorator:DynamicsDecorators.taskContextDecorator};this.hourEntryTableConfig.addColumnConfiguration(0,{minWidth:40,autoScale:!0,title:"Time",get:HourEntryModel.prototype.getDate,decorator:DynamicsDecorators.timeDecorator,sortCallback:HourEntryModel.dateComparator,
defaultSortColumn:!0,editable:!0,visualizedEditable:!0,edit:{editor:"Date",withTime:!0,set:HourEntryModel.prototype.setDate,decorator:DynamicsDecorators.dateTimeDecorator}});this.hourEntryTableConfig.addColumnConfiguration(1,a);this.hourEntryTableConfig.addColumnConfiguration(2,b);this.hourEntryTableConfig.addColumnConfiguration(3,d);this.hourEntryTableConfig.addColumnConfiguration(4,c)};
var LabelsView=function(a,d,c,b){this.model=c;this.parentView=b};LabelsView.prototype=new CommonSubView;
LabelsView.prototype._draw=function(){var a=this;this.element=$("\x3cdiv\x3e\x3c/div\x3e");this.labelsElement=$("\x3cdiv\x3e\x3c/div\x3e");this.addButton=$('\x3cdiv class\x3d"label-add" style\x3d"display:hidden"\x3e\x3cb\x3eAdd\x3c/b\x3e\x3c/div\x3e');this.labelsElement.appendTo(this.element);this.addButton.appendTo(this.element);this.inputView=new AutoSuggest("ajax/lookupLabels.action",{startText:"Enter labels here.",queryParam:"labelName",searchObj:"name",selectedItem:"displayName",cancelCallback:function(){a.inputView.hide();
a.inputView.empty()},successCallback:function(d){a.addLabels(d);a.inputView.hide();a.inputView.empty()},retrieveComplete:function(a){for(var c=[],b=0,e=a.length;b<e;b++)c[b]={value:a[b].displayName,name:a[b].name,displayName:a[b].displayName};return c},minChars:1},this);this.labelsElement.appendTo(this.element);this.addButton.appendTo(this.labelsElement);this.addButton.hide();this.inputView.hide();this.addButton.click(function(){a.inputView.show();a.inputView.focus()});this.element.mouseenter(function(){a.inputView.isVisible()||
a.addButton.show()});this.element.mouseleave(function(){a.addButton.hide()});this.element.appendTo(this.parentView.getElement())};LabelsView.prototype.renderAlways=function(){return!0};LabelsView.prototype.render=function(){this.renderFully()};
LabelsView.prototype.renderLabel=function(a,d){var c=this,b=$('\x3cdiv class\x3d"label-item"\x3e\x3cspan style\x3d"float:left;"\x3e'+a.getDisplayName()+"\x3c/span\x3e\x3c/div\x3e").appendTo(d),e=$('\x3cdiv class\x3d"as-close" style\x3d"display: none"\x3eX\x3c/div\x3e'),f=$('\x3cdiv style\x3d"float:right; width: 20px; height: 16px"/\x3e');e.appendTo(f);f.appendTo(b);e.click(function(){a.remove();b.remove();0===c.labelsElement.find(".label-item").length&&$('\x3cdiv class\x3d"label-item"\x3eThis story has no labels\x3c/div\x3e').prependTo(c.labelsElement)});
b.mouseenter(function(){e.show()});b.mouseleave(function(){e.hide()})};LabelsView.prototype.renderFully=function(){var a=this.model.getLabels(),d=$("\x3cdiv\x3e\x3c/div\x3e").css("float","left");if(0===a.length)$('\x3cdiv class\x3d"label-item"\x3eThis story has no labels\x3c/div\x3e').appendTo(d);else for(var c=0,b=a.length;c<b;c++)this.renderLabel(a[c],d);this.addButton.appendTo(d);this.labelsElement.replaceWith(d);this.labelsElement=d};
LabelsView.prototype.addLabels=function(a){var d=this,c=this.model.getId();$.post("ajax/addStoryLabels.action",{storyId:c,labelNames:a},function(){d.model.reload()})};
var LabelsIcon=function(a,c,b,d){this.model=b;this.parentView=d};LabelsIcon.prototype=new CommonSubView;LabelsIcon.prototype._draw=function(){this.element=$('\x3cdiv style\x3d"text-align: center;" /\x3e');this.element.appendTo(this.parentView.getElement())};LabelsIcon.prototype.renderAlways=function(){return!0};
LabelsIcon.prototype.render=function(){var a=this.model.getLabels();this.element.empty();this.icon=$('\x3cspan class\x3d"labelIcon" /\x3e');a.length?1===a.length?(a=a[0].getDisplayName(),this.icon.text(a.substr(0,4)),this.icon.attr("title",a)):(this.icon.addClass("labelIconMultiple"),this._constructTooltip(a)):this.icon.addClass("labelIconNoLabel");this.icon.appendTo(this.element)};
LabelsIcon.prototype._constructTooltip=function(a){for(var c=[],b=0;b<a.lenght;b++)c.push(a[b].getDisplayName());this.icon.attr("title",c.join(", "))};
var AutoSuggest=function(a,b,c){this.dataSource=a;this.options=b;this.parentView=c;this.initialize()};AutoSuggest.prototype=new ViewPart;
AutoSuggest.prototype.addKeydownHandler=function(){var a=this;this.inputElement.keydown(function(b){if((188===b.keyCode||13===b.keyCode||9===b.keyCode)&&""!==this.value){var c=a.inputElement.val();if(-1<a.valuesElement.val().indexOf(c+",")){b.preventDefault();return}a.valuesElement.val(a.valuesElement.val()+c+",");var d=$('\x3cli class\x3d"as-selection-item"\x3e\x3c/li\x3e').click(function(){a.selectionsElement.children().removeClass("selected");$(this).addClass("selected")}),e=$('\x3ca class\x3d"as-close"\x3e\x26times;\x3c/a\x3e').click(function(){a.valuesElement.val(a.valuesElement.val().replace(c+
",",""));d.remove();a.inputElement.focus();return!1});a.originalElement.before(d.html(c).prepend(e));a.resultsElement.hide();a.inputElement.val("");b.preventDefault()}13===b.keyCode?0===a.resultsElement.find(".active").removeClass("active").length&&a.success():27===b.keyCode?a.cancel():188===b.keyCode&&""===this.value&&b.preventDefault()})};
AutoSuggest.prototype.initialize=function(){this.element=$('\x3cdiv style\x3d"margin:3px"\x3e\x3c/div\x3e');this.options.disableButtons||(this.cancelButton=$('\x3cimg class\x3d"label-cancel" src\x3d"static/img/cancel.png" alt\x3d"Cancel" /\x3e').appendTo(this.element),this.okButton=$('\x3cimg class\x3d"label-ok" src\x3d"static/img/ok.png" alt\x3d"Ok" /\x3e').appendTo(this.element),this.okButton.click(function(){var b=a.inputElement.val();if(-1===a.valuesElement.val().indexOf(b+",")){a.valuesElement.val(a.valuesElement.val()+
b+",");var c=$('\x3cli class\x3d"as-selection-item"\x3e\x3c/li\x3e').click(function(){a.selectionsElement.children().removeClass("selected");$(this).addClass("selected")}),d=$('\x3ca class\x3d"as-close"\x3e\x26times;\x3c/a\x3e').click(function(){a.valuesElement.val(a.valuesElement.val().replace(b+",",""));c.remove();a.inputElement.focus();return!1});a.originalElement.before(c.html(b).prepend(d))}a.resultsElement.hide();a.inputElement.val("");a.success()}),this.cancelButton.click(function(){a.cancel()}));
$('\x3cinput type\x3d"text" /\x3e').appendTo(this.element).autoSuggest(this.dataSource,this.options);this.selectionsElement=this.element.find(".as-selections");this.resultsElement=this.element.find(".as-results");this.valuesElement=this.selectionsElement.find(".as-values");this.inputElement=this.selectionsElement.find(".as-input");this.originalElement=this.selectionsElement.find(".as-original");var a=this;this.options.allowOnlySuggested||this.addKeydownHandler();this.parentView.getElement?this.element.appendTo(this.parentView.getElement()):
this.element.appendTo(this.parentView)};AutoSuggest.prototype.success=function(){if(this.options.successCallback){var a=this.getValues();0!==a.length?this.options.successCallback(a):this.cancel()}};AutoSuggest.prototype.cancel=function(){this.valuesElement.val("");this.inputElement.val("");this.options.cancelCallback&&this.options.cancelCallback()};AutoSuggest.prototype.focus=function(){this.inputElement.focus()};
AutoSuggest.prototype.getValues=function(){var a=this.valuesElement.val(),b=[];if(0<a.length){","==a.charAt(a.length-1)?(prelimData=[],prelimData=a.substring(0,a.length-1).split(",")):(prelimData=[],prelimData=a.split(","));i=0;for(len=prelimData.length;i<len;i++)b.push(prelimData[i].substring(0,255))}return b};AutoSuggest.prototype.empty=function(){this.valuesElement.val("");this.inputElement.empty();this.selectionsElement.find(".as-selection-item").remove()};
var SearchByTextWidget=function(a,b){this.parentElement=a;this.options={searchCallback:function(){alert("Not implemented")}};jQuery.extend(this.options,b);this.init()};SearchByTextWidget.prototype=new ViewPart;
SearchByTextWidget.prototype.init=function(){this.element=$("\x3cdiv/\x3e").addClass("searchByText").appendTo(this.parentElement);this.input=$('\x3cinput type\x3d"text" /\x3e').appendTo(this.element);this.clearButton=$("\x3cdiv/\x3e").text("X").hide().addClass("clearButton").appendTo(this.element);this.input.labelify({labelledClass:"inputHighlight"});var a=this;this.clearButton.click(function(){a.input.val("");$(this).hide();a._performSearch()});this.input.keyup(function(b){13===b.keyCode?a._performSearch():
27===b.keyCode&&a.clearButton.click();""!==$(this).val()?a.clearButton.show():a.clearButton.hide()})};SearchByTextWidget.prototype.clear=function(){this.input.val("")};SearchByTextWidget.prototype.getValue=function(){return this.input.val()};SearchByTextWidget.prototype._performSearch=function(){this.options.searchCallback()};
var StoryInfoWidget=function(a,b,c){this.parentView=c;this.element=c.getElement();this.model=a;this.controller=b};StoryInfoWidget.prototype=new CommonSubView;StoryInfoWidget.prototype.storyContextFactory=function(a,b){return new CellBubble({title:"Context",url:"ajax/getStoryHierarchy.action?storyId\x3d"+b.getId(),text:b.getParentStoryName()},a)};StoryInfoWidget.prototype.renderAlways=function(){return!0};StoryInfoWidget.prototype.getElement=function(){return this.container};
StoryInfoWidget.prototype._draw=function(){this.container=$("\x3cdiv /\x3e");this.hr=$('\x3cdiv class\x3d"ruler"\x3e\x26nbsp;\x3c/div\x3e').appendTo(this.container);var a=new DynamicTableConfiguration({leftWidth:"10%",rightWidth:"88%",closeRowCallback:null});a.addColumnConfiguration(0,{title:"Labels",subViewFactory:StoryController.prototype.labelsViewFactory});a.addColumnConfiguration(1,{title:"Parent story",subViewFactory:StoryInfoWidget.prototype.storyContextFactory});a.addColumnConfiguration(2,
{title:"Reference ID",get:StoryModel.prototype.getId,decorator:DynamicsDecorators.quickReference});a.addColumnConfiguration(3,{title:"Description",get:StoryModel.prototype.getDescription,decorator:DynamicsDecorators.emptyDescriptionDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Wysiwyg",set:StoryModel.prototype.setDescription}});this.storyInfo=new DynamicVerticalTable(this,this.model,a,this.container);this.container.appendTo(this.parentView.getElement())};
StoryInfoWidget.prototype.onEdit=function(){this.render()};StoryInfoWidget.prototype.render=function(){this.storyInfo.render()};
var TaskInfoWidget=function(a,b,c){this.parentView=c;this.element=c.getElement();this.model=a;this.controller=b};TaskInfoWidget.prototype=new CommonSubView;TaskInfoWidget.prototype.taskContextFactory=function(a,b){return new CellBubble({title:"Context",url:"ajax/getTaskHierarchy.action?taskId\x3d"+b.getId(),text:'\x3ca href\x3d"javascript:void(0);"\x3e Show hierarchy\x3c/a\x3e'},a)};TaskInfoWidget.prototype.renderAlways=function(){return!0};TaskInfoWidget.prototype.getElement=function(){return this.container};
TaskInfoWidget.prototype._draw=function(){this.container=$("\x3cdiv /\x3e");this.hr=$('\x3cdiv class\x3d"ruler"\x3e\x26nbsp;\x3c/div\x3e').appendTo(this.container);var a=new DynamicTableConfiguration({leftWidth:"10%",rightWidth:"88%",closeRowCallback:null});a.addColumnConfiguration(0,{title:"Reference ID",get:TaskModel.prototype.getId,decorator:DynamicsDecorators.quickReference});a.addColumnConfiguration(1,{title:"Description",get:TaskModel.prototype.getDescription,decorator:DynamicsDecorators.emptyDescriptionDecorator,
editable:!0,visualizedEditable:!0,edit:{editor:"Wysiwyg",set:TaskModel.prototype.setDescription}});this.taskInfo=new DynamicVerticalTable(this,this.model,a,this.container);this.container.appendTo(this.parentView.getElement())};TaskInfoWidget.prototype.onEdit=function(){this.render()};TaskInfoWidget.prototype.render=function(){this.taskInfo.render()};
var StoryFiltersView=function(a,c,b,d){this.model=b;this.controller=c;this.parentView=d;this.storyStates=[];this.allStoryStates=[{name:"NOT_STARTED",abbr:"N"},{name:"STARTED",abbr:"I"},{name:"PENDING",abbr:"P"},{name:"BLOCKED",abbr:"B"},{name:"IMPLEMENTED",abbr:"R"},{name:"DONE",abbr:"D"},{name:"DEFERRED",abbr:"D"}];this.storyStates=this.allStoryStates.slice();this.initialize()};StoryFiltersView.prototype=new ViewPart;
StoryFiltersView.prototype.initialize=function(){var a=this;this.element=$("\x3cdiv/\x3e");this.filters=$("\x3cform/\x3e");this.heading=$("\x3cdiv\x3eFilters\x3c/div\x3e").css({cursor:"pointer","font-weight":"bold"}).appendTo(this.filters);this.heading.click(function(){a.element.find(".collapsible").toggle()});this.labelAutosuggest=new AutoSuggest("ajax/lookupLabels.action",{startText:"by label",queryParam:"labelName",searchObj:"name",selectedItem:"displayName",disableButtons:!0,allowOnlySuggested:!0,
retrieveComplete:function(a){for(var c=[],b=0,e=a.length;b<e;b++)c[b]={value:a[b].name,name:a[b].name,displayName:a[b].displayName};return c},minChars:3},this);this.filterButton=$('\x3cbutton name\x3d"filterButton" class\x3d"dynamics-button"\x3eFilter\x3c/button\x3e');this.clearButton=$('\x3cbutton name\x3d"clearButton" class\x3d"dynamics-button"\x3eClear\x3c/button\x3e');this.labelAutosuggest.getElement().addClass("collapsible").css({margin:"0.5em 10px 0",width:"300px"}).appendTo(this.filters);this.stateButtons=
$('\x3cdiv style\x3d"margin: 0.8em 10px 0; height: 1em; line-height: 1em"\x3e\x3c/div\x3e').addClass("collapsible").appendTo(this.filters);for(var c=0,b=this.allStoryStates.length;c<b;c++)a.addStateButton(this.allStoryStates[c]);this.actionButtons=$('\x3cdiv style\x3d"margin: 0.8em 10px 0.5em"\x3e\x3c/div\x3e').addClass("collapsible").appendTo(this.filters);this.filterButton.appendTo(this.actionButtons);this.clearButton.appendTo(this.actionButtons);this.filters.appendTo(this.element);this.filters.submit(function(){a.filter();
return!1});this.clearButton.click(function(){a.clear()});this.initInputHighlights()};StoryFiltersView.prototype.initInputHighlights=function(){this.filters.find('input[type\x3d"text"]').labelify({labelledClass:"inputHighlight"})};StoryFiltersView.prototype.clear=function(){this.nameField.val("");this.labelAutosuggest.empty();this.filters.find(".inlineStoryState").fadeTo("fast",1);this.initInputHighlights();this.storyStates=this.allStoryStates.slice();this.filter()};
StoryFiltersView.prototype.renderAlways=function(){return!0};StoryFiltersView.prototype.render=function(){this.renderFully()};StoryFiltersView.prototype.renderFully=function(){};
StoryFiltersView.prototype.addStateButton=function(a){var c=this,b=$('\x3cspan class\x3d"inlineStoryState storyState'+a.name+'" style\x3d"float:left; cursor:pointer; margin-right: 4px"\x3e'+a.abbr+"\x3c/div\x3e");b.click(function(){-1!=$.inArray(a,c.storyStates)?(b.fadeTo("fast",0.5),c.removeStateFilter(a)):(b.fadeTo("fast",1),c.addStateFilter(a))});b.appendTo(this.stateButtons)};
StoryFiltersView.prototype.removeStateFilter=function(a){a=$.inArray(a,this.storyStates);-1!=a&&this.storyStates.splice(a,1)};StoryFiltersView.prototype.addStateFilter=function(a){this.storyStates.push(a)};StoryFiltersView.prototype.getNameFilter=function(){var a=this.nameField.val();"by name"==a&&(a="");return a};StoryFiltersView.prototype.getLabelFilter=function(){return this.labelAutosuggest.getValues()};
StoryFiltersView.prototype.filter=function(){for(var a=[],c=0,b=this.storyStates.length;c<b;c++)a.push(this.storyStates[c].name);this.controller.filter(this.getNameFilter(),this.getLabelFilter(),a)};
var StateFilterWidget=function(a,b){this.referenceElement=a;this.allStoryStates=[{name:"NOT_STARTED",abbr:"N"},{name:"STARTED",abbr:"I"},{name:"PENDING",abbr:"P"},{name:"BLOCKED",abbr:"B"},{name:"IMPLEMENTED",abbr:"R"},{name:"DONE",abbr:"D"},{name:"DEFERRED",abbr:"D"}];this.options={bubbleOptions:{},filterCallback:function(){},callback:function(a){MessageDisplay.Ok("Filter active: "+a)},activeStates:"NOT_STARTED STARTED PENDING BLOCKED IMPLEMENTED DONE DEFERRED".split(" ")};jQuery.extend(this.options,
b);this.options.bubbleOptions.closeCallback=jQuery.proxy(function(a){this.onBubbleClose(a[0])},this);this.initActiveStates();this.init()};StateFilterWidget.prototype=new ViewPart;StateFilterWidget.prototype.getFilter=function(){return this.activeStates};StateFilterWidget.prototype.isActive=function(){for(var a=0;a<this.allStoryStates.length;a++)if(-1===jQuery.inArray(this.allStoryStates[a].name,this.activeStates))return!0;return!1};
StateFilterWidget.prototype.initActiveStates=function(){this.activeStates=[];for(var a=0;a<this.options.activeStates.length;a++)this.activeStates.push(this.options.activeStates[a])};StateFilterWidget.prototype.clearFilter=function(){this.parentElement.find(".inlineStoryState").fadeTo("fast",1);this.activeStates="NOT_STARTED STARTED PENDING BLOCKED IMPLEMENTED DONE DEFERRED".split(" ");this.options.callback(this.isActive());this.closeAndFilter()};
StateFilterWidget.prototype.closeAndFilter=function(){this.options.filterCallback&&this.options.filterCallback();this.bubble.destroy(!0)};StateFilterWidget.prototype.onBubbleClose=function(a){a||(this.activeStates=[],jQuery.extend(this.activeStates,this.options.activeStates));this.options.callback(this.isActive())};
StateFilterWidget.prototype.init=function(){this.bubble=new Bubble(this.referenceElement,this.options.bubbleOptions);this.parentElement=this.bubble.getElement();this.stateButtons=$('\x3cdiv style\x3d"margin: 0.8em 10px 0; height: 1em; line-height: 1em"\x3e\x3c/div\x3e').appendTo(this.parentElement);for(var a=0;a<this.allStoryStates.length;a++){var b=this.allStoryStates[a],c=this.addStateButton(b);-1===jQuery.inArray(b.name,this.activeStates)&&c.fadeTo("fast",0.5)}$("\x3cbutton\x3eFilter\x3c/button\x3e").click(jQuery.proxy(function(){this.closeAndFilter()},
this)).addClass("dynamics-button").css({"margin-top":"1.5em","float":"right","min-width":"6ex",width:"6ex"}).appendTo(this.parentElement);$("\x3cbutton\x3eClear\x3c/button\x3e").click(jQuery.proxy(function(){this.clearFilter()},this)).addClass("dynamics-button").css({"margin-top":"1.5em","float":"right","min-width":"6ex",width:"6ex"}).appendTo(this.parentElement)};
StateFilterWidget.prototype.addStateButton=function(a){var b=this,c=$('\x3cspan class\x3d"inlineStoryState storyState'+a.name+'" style\x3d"float:left; cursor:pointer; margin-right: 4px"\x3e'+a.abbr+"\x3c/div\x3e");c.click(function(){-1!=$.inArray(a.name,b.activeStates)?c.fadeTo("fast",0.5,function(){b.removeStateFilter(a)}):c.fadeTo("fast",1,function(){b.addStateFilter(a)})});c.appendTo(this.stateButtons);return c};
StateFilterWidget.prototype.removeStateFilter=function(a){a=$.inArray(a.name,this.activeStates);-1!=a&&this.activeStates.splice(a,1)};StateFilterWidget.prototype.addStateFilter=function(a){this.activeStates.push(a.name)};
var SpentEffortWidget=function(a,b){this.model=a;this.onClose=b;this.initDialog()};
SpentEffortWidget.prototype.initDialog=function(){var a=this;this.element=$("\x3cdiv/\x3e");$("\x3ch2\x3eEffort logger on this element\x3c/h2\x3e").appendTo(this.element);this.objectEffortEl=$("\x3cdiv /\x3e").appendTo(this.element);$("\x3ch2\x3eMy spent effort\x3c/h2\x3e").appendTo(this.element);this.userEffortEl=$("\x3cdiv /\x3e").addClass("ui-widget-content").addClass("ui-corner-all").css({padding:"10px","margin-bottom":"2em"}).appendTo(this.element);this.element.appendTo(document.body);this.element.dialog({width:800,
position:"top",modal:!0,draggable:!0,resizable:!0,title:"Spent effort",close:function(){a.close()},buttons:{Close:function(){a.close()}}});this.hourEntryListController=new HourEntryListController({parentModel:this.model,hourEntryListElement:this.objectEffortEl,onUpdate:function(){a.entriesChanged()}});this.userSpentEffort=new UserSpentEffortWidget(this.userEffortEl,window.pageController.getCurrentUser().getId());this.firstUpdateDone=!1};
SpentEffortWidget.prototype.entriesChanged=function(){this.userSpentEffort.reload();!0==this.firstUpdateDone?jQuery(this.element[0]).parent().find("Button").focus():this.firstUpdateDone=!0};
SpentEffortWidget.prototype.close=function(){this.element.dialog("destroy").remove();this.model instanceof TaskModel?(this.model.reload(),this.reloadParent()):this.model instanceof StoryModel?(this.model.reloadMetrics(),this.reloadParent()):this.model instanceof IterationModel?(this.model.reloadMetrics(),this.reloadParent()):this.model instanceof ProjectModel&&this.model.reloadTotalSpentEffort();if(this.onClose)this.onClose()};
SpentEffortWidget.prototype.reloadParent=function(){var a=this.model.getParent();"editProject.action"==getCurrentLastSegment()&&(a instanceof ProjectModel?a.reloadTotalSpentEffort():a instanceof StoryModel&&(a=a.getParent(),a instanceof ProjectModel&&a.reloadTotalSpentEffort()))};function getCurrentLastSegment(){var a=$(location).attr("href");return getUrlLastSegment(a)};
var Bubble=function(a,b){this.referenceElement=a;this.element=this.parentElement=null;this.options={closeCallback:function(){return!1},removeOthers:!0,removeSelector:null,autoClose:!0,title:null,offsetX:100,offsetY:35,minWidth:0.6*$(document).width(),minHeight:80,zIndex:800,maxWidth:null,cssClass:null};jQuery.extend(this.options,b);this.init()};Bubble.prototype=new ViewPart;Bubble.closeAll=function(){$("body \x3e div.infobubble").trigger("destroyBubble")};Bubble.prototype.getElement=function(){return this.element};
Bubble.prototype.init=function(){this._removeOthersIfNeeded();this._createElements();this._position();this._bindEvents()};Bubble.prototype.destroy=function(){this.parentElement.remove();this.options.autoClose&&this.greySeeThroughElement.remove();$(document).unbind("keydown.agilefantBubble",this.keypressListener);this.options.closeCallback&&this.options.closeCallback(arguments)};
Bubble.prototype._createElements=function(){this.parentElement=$("\x3cdiv/\x3e").addClass("infobubble");this.element=$("\x3cdiv/\x3e").appendTo(this.parentElement);$("\x3cdiv\x3e\x26nbsp;\x3c/div\x3e").addClass("infobubble-helperarrow").appendTo(this.parentElement);this.options.cssClass&&this.parentElement.addClass(this.options.cssClass);var a=this;this.header=$('\x3cdiv style\x3d"height: 1.5em;"\x3e\x3c/div\x3e').appendTo(this.element);null!==this.options.title&&$('\x3ch3 style\x3d"float: left;"\x3e'+
this.options.title+"\x3c/h3\x3e)").appendTo(this.header);$('\x3ca title\x3d"Close bubble" class\x3d"close-button"\x3eX\x3c/a\x3e').click(function(){a.destroy()}).appendTo(this.header);if(a.options.autoClose){var b=jQuery("#bodyWrapper");b&&b[0]&&(this.greySeeThroughElement=$('\x3cdiv class\x3d"greySeeThroughElement" style\x3d"height: '+b[0].scrollHeight+'px"/\x3e').appendTo(b),this.greySeeThroughElement.click(function(){a.destroy()}))}};
function intersects(a,b,d,e,c,f){return!(d<c||a>c||e<f||b>f)}
Bubble.prototype._position=function(){var a=jQuery("#bodyWrapper"),b=a.scrollTop(),d=a.offset().top,e=a.offset().left,c=this.referenceElement.offset();this.options.maxWidth&&(this.options.minWidth&&this.options.maxWidth<this.options.minWidth)&&(this.options.minWidth=this.options.maxWidth);this.parentElement.css({top:c.top+this.options.offsetY+b-d+"px",left:c.left+this.options.offsetX-e+"px","min-width":this.options.minWidth,"min-height":this.options.minHeight,"max-width":this.options.maxWidth,"z-index":this.options.zIndex});
this.parentElement.appendTo(a)};Bubble.prototype._removeOthersIfNeeded=function(){if(this.options.removeOthers)$("body \x3e div.infobubble").trigger("destroyBubble");else if(this.options.removeSelector){var a=this.options.removeSelector;$("body \x3e div.infobubble").each(function(){$(this).is(a)&&$(this).trigger("destroyBubble")})}};
Bubble.prototype._bindEvents=function(){var a=this;this.parentElement.bind("destroyBubble",function(b){a.destroy();b.stopPropagation();return!1});this.keypressListener=function(b){if(27===b.keyCode)return a.destroy(),!1};$(document).bind("keydown.agilefantBubble",this.keypressListener)};
var CellBubble=function(a,b){this.options={text:"open",url:"noop.action",width:450,title:"title"};$.extend(this.options,a);this.parent=b};CellBubble.prototype=new CommonSubView;
CellBubble.prototype._draw=function(){var a=this;this.element=$("\x3cspan\x3e"+this.options.text+"\x3c/span\x3e").click(function(){var b=new Bubble(a.element,{offsetX:0,title:a.options.title,maxWidth:a.options.width});$('\x3cdiv\x3e\x3cdiv style\x3d"text-align: center;"\x3e\x3cimg src\x3d"static/img/pleasewait.gif" /\x3e\x3c/div\x3e\x3c/div\x3e').appendTo(b.getElement()).load(a.options.url)}).appendTo(this.parent.getElement()).css("cursor","pointer")};
var MultiEditWidget=function(a){this.storyTreeController=a;this.element=$('\x3cdiv class\x3d"multiEditContainer"/\x3e').hide().appendTo(document.body);this.init()};MultiEditWidget.prototype=new ViewPart;
MultiEditWidget.prototype.init=function(){this.content=$("\x3cul/\x3e");$("\x3cli\x3eState:\x3c/li\x3e").appendTo(this.content);this.stateSelect=$('\x3cli\x3e\x3cselect name\x3d"state" /\x3e\x3c/li\x3e').appendTo(this.content).find("select");$.each({NOT_STARTED:"Not started",STARTED:"In Progress",PENDING:"Pending",BLOCKED:"Blocked",IMPLEMENTED:"Ready",DONE:"Done",DEFERRED:"Deferred"},jQuery.proxy(function(b,a){this.stateSelect.append("\x3coption value\x3d"+b+"\x3e"+a+"\x3c/option\x3e")},this));$("\x3cli\x3eLabels:\x3c/li\x3e").appendTo(this.content);
this.labelElement=$("\x3cli\x3e\x3c/li\x3e").appendTo(this.content);this.labelsView=new AutoSuggest("ajax/lookupLabels.action",{startText:"Enter labels here.",queryParam:"labelName",searchObj:"name",selectedItem:"displayName",disableButtons:!0,cancelCallback:function(){},successCallback:function(b){},retrieveComplete:function(b){for(var a=[],e=0,d=b.length;e<d;e++)a[e]={value:b[e].displayName,name:b[e].name,displayName:b[e].displayName};return a},minChars:1},this.labelElement);var a=$("\x3cli/\x3e").appendTo(this.content);
$('\x3cbutton class\x3d"dynamics-button"\x3eSave\x3c/button\x3e').click(jQuery.proxy(function(){if("DONE"===this.stateSelect.val())for(var b=0;b<this.getSelected().length;b++){var a=this.getSelected()[b],e=this.storyTreeController;e._getStoryForId(a,function(a){MultiEditWidget.prototype.confirmTasksAndChildrenToDone(a,e,!0)})}jQuery.ajax({type:"post",async:"true",url:"ajax/editMultipleStories.action",dataType:"text",data:{storyIds:this.getSelected(),state:this.stateSelect.val(),labelNames:this.getLabels()},
success:jQuery.proxy(function(a,b){this.storyTreeController.refresh()},this)});this.close()},this)).appendTo(a);a=$("\x3cli/\x3e").appendTo(this.content);$('\x3cbutton class\x3d"dynamics-button"\x3eCancel\x3c/button\x3e').click(jQuery.proxy(function(){this.storyTreeController.clearSelectedIds();this.close()},this)).appendTo(a);this.content.appendTo(this.element)};
MultiEditWidget.prototype.confirmTasksAndChildrenToDone=function(a,b,h){var e=a.getTasks(),d=a.getChildren(),f=!1,g=!1;if(0<d.length)for(var c=0;c<d.length;c++)"DONE"!==d[c].getState()&&(f=!0);if(0<e.length)for(c=0;c<e.length;c++)"DONE"!==e[c].getState()&&(g=!0);if(f||g)if(h)new DynamicsConfirmationDialog("Set all tasks' and stories' states to done?","The '"+a.getName()+"' story has undone child tasks/stories! Do you want to set them Done as well?",function(){if(f)for(var c=0;c<d.length;c++)"DONE"!==
d[c].getState()&&(d[c].setState("DONE"),d[c].commit(),b._getStoryForId(d[c].getId(),function(a){MultiEditWidget.prototype.confirmTasksAndChildrenToDone(a,b,!1)}),b.refresh());else g&&(a.currentData.tasksToDone=!0),a.commit(),b.refresh()},function(){a.commit();b.refresh()});else if(f)for(c=0;c<d.length;c++)"DONE"!==d[c].getState()&&(d[c].setState("DONE"),d[c].commit(),b._getStoryForId(d[c].getId(),function(a){MultiEditWidget.prototype.confirmTasksAndChildrenToDone(a,b,!1)}),b.refresh());else g&&(a.currentData.tasksToDone=
!0),a.commit(),b.refresh();else a.commit(),b.refresh()};MultiEditWidget.prototype.getTree=function(){return this.storyTreeController};MultiEditWidget.prototype.getSelected=function(){return this.storyTreeController.getSelectedIds()};MultiEditWidget.prototype.getLabels=function(){return this.labelsView.getValues()};MultiEditWidget.prototype.open=function(){this.element.show("fast",jQuery.proxy(function(){this.element.animate({"max-height":"80px"},500,"easeInOutCubic")},this))};
MultiEditWidget.prototype.close=function(){this.element.animate({"max-height":"0"},500,"easeInOutCubic",jQuery.proxy(function(){this.stateSelect.val("NOT_STARTED");this.labelsView.empty();this.element.hide()},this))};
var CommonModel=function(){};CommonModel.prototype.initialize=function(){this.listeners=[];this.id=null;this.relations={};this.currentData={};this.persistedData={};this.transientData={};this.classNameToRelation={};this.metricFields=[];this.preventSetData=!1;this.suppressEvents=!0;this.clonedModelTypes=[]};CommonModel.prototype.reload=function(){throw Error("Abstract method called: reload");};
CommonModel.prototype.setData=function(a,b){this.preventSetData||(this.suppressEvents=b,this._isMetricsDataUpdated(a)&&this.callListeners(new DynamicsEvents.MetricsEvent(this)),this._setData(a),this._copyFields(a)&&!b&&this.callListeners(new DynamicsEvents.EditEvent(this)),this.suppressEvents=!0)};CommonModel.prototype._isMetricsDataUpdated=function(a){for(var b=0;b<this.metricFields.length;b++){var c=this.metricFields[b];if(void 0!==this.persistedData[c]&&void 0!==a[c]&&this.persistedData[c]!==a[c])return!0}return!1};
CommonModel.prototype._setData=function(a){throw Error("Abstract method called");};CommonModel.prototype._copyFields=function(a){var b={};for(field in this.copiedFields)this.copiedFields.hasOwnProperty(field)&&(b[this.copiedFields[field]]=a[field]);jQuery.extend(this.currentData,b);return!ArrayUtils.compareOneSided(b,this.persistedData)?(jQuery.extend(this.persistedData,b),!0):!1};
CommonModel.prototype._updateRelations=function(a,b){if(!this.relations[a]||this.relations[a].constructor!==Array)this._updateSingleRelation(a,b);else{this.relationChanged=!1;for(var c=[],d=[],g=[],e=0;e<b.length;e++){var f=ModelFactory.updateObject(b[e],this.suppressEvents);g.push(f);c.push(f.getHashCode())}var h=this,k=[];$.each(this.relations[a],function(a,b){-1===jQuery.inArray(b.getHashCode(),c)?(k.push(b),h.relationChanged=!0):d.push(b.getHashCode())});$.each(k,function(a,b){h.removeRelation(b,
!0)});for(e=0;e<g.length;e++)f=g[e],-1===jQuery.inArray(f.getHashCode(),d)&&(this.addRelation(f),d.push(f.getHashCode()),this.relationChanged=!0);this.relationChanged&&(this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,a)),this.relationChanged=!1)}};CommonModel.prototype._updateSingleRelation=function(a,b){var c=this.relations[a],d=ModelFactory.updateObject(b,!0);c!==d&&(c&&this.removeRelation(c),this.addRelation(d),this.relationChanged=!0)};
CommonModel.prototype._removeAllRelations=function(){var a=this,b=[],c=function(a,c){b.push(c)};for(field in this.relations)if(this.relations.hasOwnProperty(field)&&this.relations[field]){var d=this.relations[field];d.constructor==Array?$.each(d,c):b.push(d)}$.each(b,function(b,c){a.removeRelation(c,!0)})};CommonModel.prototype.remove=function(a,b){var c=this;this._remove(function(){c._removeAllRelations();c.callListeners(new DynamicsEvents.DeleteEvent(c));a&&a()},b)};
CommonModel.prototype._remove=function(a){throw Error("Abstract method called: _remove");};CommonModel.prototype.addRelation=function(a){a.id&&this._addOneWayRelation(a);this.id&&a._addOneWayRelation(this)};
CommonModel.prototype._addOneWayRelation=function(a){var b=this.classNameToRelation[a.getPersistedClass()];this.relations[b]&&this.relations[b].constructor===Array?-1===jQuery.inArray(a,this.relations[b])&&(this.relations[b].push(a),this.relationChanged=!0):this.relations[b]!==a&&(this.relations[b]=a,this.relationChanged=!0)};
CommonModel.prototype.removeRelation=function(a,b){this._removeOneWayRelation(a);a._removeOneWayRelation(this);b||this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,this.classNameToRelation[a.getPersistedClass()]))};
CommonModel.prototype._removeOneWayRelation=function(a){var b=this.classNameToRelation[a.getPersistedClass()];this.relations[b]&&this.relations[b].constructor===Array?(ArrayUtils.remove(this.relations[b],a),this.relationChanged=!0):this.relations[b]===a&&(this.relations[b]=null,this.relationChanged=!0)};CommonModel.prototype.addListener=function(a){this.listeners.push(a)};CommonModel.prototype.removeListener=function(a){ArrayUtils.remove(this.listeners,a)};
CommonModel.prototype.callListeners=function(a){for(var b=0;b<this.listeners.length;b++)this.listeners[b](a)};CommonModel.prototype.commit=function(){var a=this.getChangedData();this._saveData(this.getId(),a)};CommonModel.prototype.getChangedData=function(){var a={};for(field in this.currentData)if(this.currentData.hasOwnProperty(field)){var b=this.currentData[field];b!==this.persistedData[field]&&(a[field]=b)}return a};
CommonModel.prototype._saveData=function(a,b){throw Error("Abstract method called: _saveData");};CommonModel.prototype.rollback=function(){this.currentData={};jQuery.extend(this.currentData,this.persistedData);this.callListeners(new DynamicsEvents.EditEvent(this))};CommonModel.prototype.getHashCode=function(){return this.persistedClassName+"_"+this.id};CommonModel.prototype.getPersistedClass=function(){return this.persistedClassName};CommonModel.prototype.getId=function(){return this.id};
CommonModel.prototype.setId=function(a){this.id=a};CommonModel.prototype.setPreventSetData=function(a){this.preventSetData=a};CommonModel.prototype.getPersistedData=function(){return this.persistedData};CommonModel.prototype.getCurrentData=function(){return this.currentData};CommonModel.prototype.serializeFields=function(a,b){return HttpParamSerializer.serializeSubstructure(b,{},a)};
var BacklogModel=function(){};BacklogModel.prototype=new CommonModel;BacklogModel.Validators={_parseDate:function(a){return"number"===typeof a?new Date(a):Date.fromString(a)},dateValidator:function(a){var b=a.getStartDate();a=a.getEndDate();if(b>a)throw"Start date must be before end date";},parentValidator:function(a){}};BacklogModel.prototype.initializeBacklogModel=function(){this.initialize()};BacklogModel.prototype.getAssignments=function(){return this.relations.assignment};
BacklogModel.prototype.getHourEntries=function(){return this.relations.hourEntry};BacklogModel.prototype.getName=function(){return this.currentData.name};BacklogModel.prototype.addAssignments=function(a){if(a instanceof Array){var b=this;jQuery.post("ajax/addAssignees.action",{backlogId:this.getId(),userIds:a},function(a,d){b.setData(a)},"json")}};BacklogModel.prototype.addStory=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"story"))};
BacklogModel.prototype.removeStory=function(a){this.removeRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"story"))};BacklogModel.prototype.addTask=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"task"))};BacklogModel.prototype.getAssignees=function(){return this.relations.assignees};
BacklogModel.prototype.setAssignees=function(a,b){var c,d,e;this.currentData.assigneeIds=a;this.relations.assignees=[];c=0;for(d=b.length;c<d;c++)e=ModelFactory.updateObject(b[c]),this.relations.assignees.push(e);this.currentData.assigneesChanged=!0};
var IterationModel=function(){this.initializeBacklogModel();this.persistedClassName="fi.hut.soberit.agilefant.model.Iteration";this.relations={parent:null,story:[],task:[],assignment:[],hourEntry:[],assignees:[],team:[]};this.metrics={};this.copiedFields={name:"name",description:"description",startDate:"startDate",endDate:"endDate",backlogSize:"backlogSize",baselineLoad:"baselineLoad",scheduleStatus:"scheduleStatus",readonlyToken:"readonlyToken"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Product":"parent",
"fi.hut.soberit.agilefant.model.Project":"parent","fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.model.Task":"task","fi.hut.soberit.agilefant.model.Assignment":"assignment","fi.hut.soberit.agilefant.model.HourEntry":"hourEntry","fi.hut.soberit.agilefant.model.User":"assignees","fi.hut.soberit.agilefant.model.Team":"team"}};IterationModel.prototype=new BacklogModel;
IterationModel.prototype._setData=function(a){this.id=a.id;a.rankedStories&&this._updateRelations(ModelFactory.types.story,a.rankedStories);a.tasks&&this._updateRelations(ModelFactory.types.task,a.tasks);a.assignments&&this._updateRelations(ModelFactory.types.assignment,a.assignments);a.assignees&&this._updateRelations("assignees",a.assignees);a.hourEntries&&this._updateRelations(ModelFactory.types.hourEntry,a.hourEntries);a.teams&&this._updateRelations(ModelFactory.types.team,a.teams);a.iterationMetrics&&
(this.metrics=a.iterationMetrics)};
IterationModel.prototype._saveData=function(a,b){var c=this,e="ajax/storeIteration.action",d=this.serializeFields("iteration",b);b.teamsChanged&&(d.teamIds=b.teamIds,d.teamsChanged=!0,delete b.teamIds,delete b.teamsChanged);jQuery.extend(d,this.serializeFields("iteration",b));b.assigneesChanged&&jQuery.extend(d,{assigneeIds:b.assigneeIds,assigneesChanged:!0});if(0!==ArrayUtils.countObjectFields(d)){if(a)d.iterationId=a;else{var e="ajax/storeNewIteration.action",f=this.getParent();f&&(d.parentBacklogId=
f.getId())}jQuery.ajax({type:"POST",url:e,async:!0,cache:!1,data:d,dataType:"json",success:function(b,d){MessageDisplay.Ok("Iteration saved successfully");var e=ModelFactory.updateObject(b);if(!a){var f=c.getParent();f&&f.addIteration(e);e.callListeners(new DynamicsEvents.AddEvent(e));window.newElementId=b.id}},error:function(a,b,e){MessageDisplay.Error("Error saving iteration",a);c.rollback()}})}};
IterationModel.prototype.reloadStoryRanks=function(a){var b=this;jQuery.ajax({url:"ajax/retrieveRankedStories.action",data:{objectId:this.id},type:"post",dataType:"json",success:function(c,e){b._updateRelations("story",c);a&&a()}})};IterationModel.prototype.reloadTasksWithoutStory=function(a){this.reload(a)};IterationModel.prototype.reload=function(a){var b=this;jQuery.getJSON("ajax/iterationData.action",{iterationId:this.getId()},function(c,e){b.setData(c,!1);a&&a()})};
IterationModel.prototype._remove=function(a,b){var c={iterationId:this.getId()};jQuery.extend(c,b);jQuery.ajax({type:"POST",url:"ajax/deleteIteration.action",async:!0,cache:!1,dataType:"text",data:c,success:function(b,c){MessageDisplay.Ok("Iteration removed");a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting iteration.",a)}})};IterationModel.prototype.addTeam=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"team"))};
IterationModel.prototype.getStories=function(){return this.relations.story};IterationModel.prototype.getTasks=function(){return this.relations.task};IterationModel.prototype.getName=function(){return this.currentData.name};IterationModel.prototype.setName=function(a){this.currentData.name=a};IterationModel.prototype.getDescription=function(){return this.currentData.description};IterationModel.prototype.setDescription=function(a){this.currentData.description=a};IterationModel.prototype.getParent=function(){return this.relations.parent};
IterationModel.prototype.setParent=function(a){this.relations.parent=a};IterationModel.prototype.getScheduleStatus=function(){return this.currentData.scheduleStatus};IterationModel.prototype.isScheduledAt=function(a){return a[this.getScheduleStatus()]};IterationModel.prototype.getStartDate=function(){return this.currentData.startDate};IterationModel.prototype.getReadonlyToken=function(){return this.currentData.readonlyToken};
IterationModel.prototype.setReadonlyToken=function(a){this.currentData.readonlyToken=a};IterationModel.prototype.setStartDate=function(a){this.currentData.startDate=a};IterationModel.prototype.getEndDate=function(){return this.currentData.endDate};IterationModel.prototype.setEndDate=function(a){this.currentData.endDate=a};IterationModel.prototype.getBacklogSize=function(){return this.currentData.backlogSize};IterationModel.prototype.setBacklogSize=function(a){this.currentData.backlogSize=a};
IterationModel.prototype.setBacklog=function(a){this.addRelation(a)};IterationModel.prototype.getBaselineLoad=function(){return this.currentData.baselineLoad};IterationModel.prototype.setBaselineLoad=function(a){this.currentData.baselineLoad=a};IterationModel.prototype.getTeams=function(){if(this.currentData.teamIds){var a=[];$.each(this.currentData.teamIds,function(b,c){a.push(ModelFactory.getObject(ModelFactory.types.team,c))});return a}return this.relations.team};
IterationModel.prototype.setTeams=function(a,b){b&&$.each(b,function(a,b){ModelFactory.updateObject(b)});this.currentData.teamIds=a;this.currentData.teamsChanged=!0};
IterationModel.prototype.setAllTeams=function(a){if("MYTEAMS"==a||"ALL"==a){var b="ajax/retrieveAllTeams.action";"MYTEAMS"==a&&(b="ajax/retrieveMyTeams.action");a=[];jQuery.ajax({type:"POST",url:b,async:!1,cache:!1,data:{},dataType:"json",success:function(b,e){for(var d=0;d<b.length;d++)a.push(b[d].id)}});this.currentData.teamsChanged=!0;this.currentData.teamIds=a}};IterationModel.prototype.getTotalEffortSpent=function(){return this.metrics.spentEffort};
IterationModel.prototype.getTotalEffortLeft=function(){return this.metrics.effortLeft};IterationModel.prototype.getTotalOriginalEstimate=function(){return this.metrics.originalEstimate};IterationModel.prototype.reloadMetrics=function(a){var b=this;jQuery.getJSON("ajax/retrieveIterationMetrics.action",{iterationId:this.getId()},function(c,e){c&&(b.metrics=c);a&&a();b.callListeners(new DynamicsEvents.EditEvent(b));b.callListeners(new DynamicsEvents.MetricsEvent(b))})};
var ProjectModel=function(){this.initializeBacklogModel();this.persistedClassName="fi.hut.soberit.agilefant.model.Project";this.relations={product:null,iteration:[],story:[],assignment:[],hourEntry:[],assignees:[]};this.totalSpentEffort="Loading...";this.copiedFields={name:"name",description:"description",startDate:"startDate",endDate:"endDate",backlogSize:"backlogSize",baselineLoad:"baselineLoad",scheduleStatus:"scheduleStatus",status:"status"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Product":"product",
"fi.hut.soberit.agilefant.model.Iteration":"iteration","fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.transfer.StoryTO":"story","fi.hut.soberit.agilefant.model.Assignment":"assignment","fi.hut.soberit.agilefant.model.HourEntry":"hourEntry","fi.hut.soberit.agilefant.model.User":"assignees"};this.iterationsLoaded=!1};ProjectModel.prototype=new BacklogModel;
ProjectModel.prototype._setData=function(a){this.id=a.id;a.leafStories?this._updateRelations("story",a.leafStories):a.stories&&this._updateRelations(ModelFactory.types.story,a.stories);a.children&&this._updateRelations("iteration",a.children);a.assignments&&this._updateRelations(ModelFactory.types.assignment,a.assignments);a.assignees&&this._updateRelations("assignees",a.assignees);a.hourEntries&&this._updateRelations(ModelFactory.types.hourEntry,a.hourEntries);a.root&&this._updateRelations("product",
a.root)};
ProjectModel.prototype._saveData=function(a,b){var c=this,d="ajax/storeProject.action",e={};b.assigneesChanged&&(jQuery.extend(e,{assigneeIds:b.assigneeIds,assigneesChanged:!0}),delete b.assigneeIds,delete b.assigneesChanged);jQuery.extend(e,this.serializeFields("project",b));a?e.projectId=a:this.getParent()&&(d="ajax/storeNewProject.action",e.productId=this.getParent().getId());jQuery.ajax({type:"POST",url:d,async:!0,cache:!1,data:e,dataType:"json",success:function(b,d){MessageDisplay.Ok("Project saved successfully");var e=
ModelFactory.updateObject(b);a||(c.getParent().addProject(e),e.callListeners(new DynamicsEvents.AddEvent(e)),window.newElementId=b.id)},error:function(a,b,d){MessageDisplay.Error("Error saving project",a);c.rollback()}})};
ProjectModel.prototype.reloadLeafStories=function(a,b){var c=this,d={objectId:this.id};a&&a.name&&(d["storyFilters.name"]=a.name);a&&a.states&&(d["storyFilters.states"]=a.states);jQuery.ajax({url:"ajax/projectLeafStories.action",data:d,type:"post",dataType:"json",success:function(a,d){c._updateRelations("story",a);b&&b()}})};
ProjectModel.prototype.reloadStoryRanks=function(a,b){var c=this;jQuery.ajax({url:"ajax/retrieveRankedStories.action",data:{objectId:this.id},type:"post",dataType:"json",success:function(b,e){c._updateRelations("story",b);a&&a()}})};ProjectModel.prototype.reloadIterations=function(a,b){var c=this;jQuery.ajax({url:"ajax/projectIterations.action",data:{projectId:this.id},type:"post",dataType:"json",success:function(a,e){c._updateRelations("iteration",a);this.iterationsLoaded=!0;b&&b()}})};
ProjectModel.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/projectData.action",{projectId:a.getId()},function(b,c){a._setData(b,!1)})};ProjectModel.prototype._remove=function(a,b){var c={projectId:this.getId()};jQuery.extend(c,b);jQuery.ajax({type:"POST",url:"ajax/deleteProject.action",async:!0,cache:!1,dataType:"text",data:c,success:function(b,c){MessageDisplay.Ok("Project removed");a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting project.",a)}})};
ProjectModel.prototype.addIteration=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"iteration"))};ProjectModel.prototype.getPastIterations=function(){return this._getChildrenByScheduleStatus("PAST")};ProjectModel.prototype.getOngoingIterations=function(){return this._getChildrenByScheduleStatus("ONGOING")};ProjectModel.prototype.getFutureIterations=function(){return this._getChildrenByScheduleStatus("FUTURE")};
ProjectModel.prototype._getChildrenByScheduleStatus=function(a){for(var b=[],c=this.getChildren(),d=0;d<c.length;d++)c[d].getScheduleStatus()===a&&b.push(c[d]);return b};ProjectModel.prototype.getParent=function(){return this.relations.product};ProjectModel.prototype.getProductName=function(){var a=this.relations.product;return a?a.getName():""};ProjectModel.prototype.setParent=function(a){this.relations.product=a};ProjectModel.prototype.setBacklog=function(a){this.relations.product=a};
ProjectModel.prototype.getBacklogSize=function(){return this.currentData.backlogSize};ProjectModel.prototype.setBacklogSize=function(a){this.currentData.backlogSize=a};ProjectModel.prototype.getBaselineLoad=function(){return this.currentData.baselineLoad};ProjectModel.prototype.setBaselineLoad=function(a){this.currentData.baselineLoad=a};ProjectModel.prototype.getChildren=function(){return this.relations.iteration};ProjectModel.prototype.getDescription=function(){return this.currentData.description};
ProjectModel.prototype.setDescription=function(a){this.currentData.description=a};ProjectModel.prototype.getEndDate=function(){return this.currentData.endDate};ProjectModel.prototype.setEndDate=function(a){this.currentData.endDate=a};ProjectModel.prototype.getIterations=function(){return this.relations.iteration};ProjectModel.prototype.getLeafStories=function(){return this.relations.story};ProjectModel.prototype.getName=function(){return this.currentData.name};
ProjectModel.prototype.setName=function(a){this.currentData.name=a};ProjectModel.prototype.getAssigments=function(){return this.relations.assigment};ProjectModel.prototype.getScheduleStatus=function(){return this.currentData.scheduleStatus};ProjectModel.prototype.getStartDate=function(){return this.currentData.startDate};ProjectModel.prototype.setStartDate=function(a){this.currentData.startDate=a};ProjectModel.prototype.getStatus=function(){return this.currentData.status};
ProjectModel.prototype.setStatus=function(a){this.currentData.status=a};ProjectModel.prototype.getRank=function(){return this.projectRank};ProjectModel.prototype.setRank=function(a){this.projectRank=a};ProjectModel.prototype.getStories=function(){return this.relations.story};
ProjectModel.prototype.rankUnder=function(a){var b=this;a={projectId:b.getId(),rankUnderId:a};jQuery.ajax({url:"ajax/rankProjectAndMoveUnder.action",type:"post",dataType:"json",data:a,success:function(a,d){MessageDisplay.Ok("Project ranked successfully.");b.setData(a);b.callListeners(new DynamicsEvents.EditEvent(b))},error:function(a,b){MessageDisplay.Error("An error occured while ranking the project.",a)}})};
ProjectModel.prototype.rankOver=function(a){var b=this;a={projectId:b.getId(),rankOverId:a};jQuery.ajax({url:"ajax/rankProjectAndMoveOver.action",type:"post",dataType:"json",data:a,success:function(a,d){MessageDisplay.Ok("Project ranked successfully.");b.setData(a);b.callListeners(new DynamicsEvents.EditEvent(b))},error:function(a,b){MessageDisplay.Error("An error occured while ranking the project.",a)}})};
ProjectModel.prototype.unrank=function(){var a=this,b={projectId:a.getId()};jQuery.ajax({url:"ajax/unrankProject.action",type:"post",dataType:"json",data:b,success:function(b,d){MessageDisplay.Ok("Project unranked successfully.");a.callListeners(new DynamicsEvents.EditEvent(a))},error:function(a,b){MessageDisplay.Error("An error occured while unranking the project.",a)}})};
ProjectModel.prototype.rank=function(){var a=this,b={projectId:a.getId()};jQuery.ajax({url:"ajax/rankProject.action",type:"post",dataType:"text",data:b,success:function(b,d){MessageDisplay.Ok("Project ranked successfully.");a.callListeners(new DynamicsEvents.EditEvent(a))},error:function(a,b){MessageDisplay.Error("An error occured while ranking the project.",a)}})};ProjectModel.prototype.getTotalEffortSpent=function(){return this.totalSpentEffort};
ProjectModel.prototype.reloadTotalSpentEffort=function(a){var b=this;jQuery.getJSON("ajax/projectTotalSpentEffort.action",{projectId:this.getId()},function(c,d){null!=c&&(b.totalSpentEffort=c);a&&a();b.callListeners(new DynamicsEvents.EditEvent(b))})};
var ProductModel=function(){this.initializeBacklogModel();this.persistedClassName="fi.hut.soberit.agilefant.model.Product";this.relations={project:[],iteration:[],story:[],team:[]};this.currentData={};this.copiedFields={name:"name",description:"description"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Project":"project","fi.hut.soberit.agilefant.model.Iteration":"iteration","fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.model.Team":"team"}};
ProductModel.prototype=new BacklogModel;ProductModel.prototype._setData=function(a){this.id=a.id;this._copyFields(a);a.stories&&this._updateRelations(ModelFactory.types.story,a.stories);a.projects&&this._updateRelations("project",a.projects);a.teams&&this._updateRelations(ModelFactory.types.team,a.teams)};
ProductModel.prototype.reloadProjects=function(a,b){var d=this;jQuery.ajax({url:"ajax/retrieveProductProjects.action",data:{productId:this.id},type:"post",dataType:"json",success:function(a,c){d._updateRelations("project",a);b&&b()}})};
ProductModel.prototype._saveData=function(a,b){var d=this,e="ajax/storeProduct.action",c={};b.teamsChanged&&(c.teamIds=b.teamIds,c.teamsChanged=!0,delete b.teamIds,delete b.teamsChanged);jQuery.extend(c,this.serializeFields("product",b));a?c.productId=a:e="ajax/storeNewProduct.action";jQuery.ajax({type:"POST",url:e,async:!0,cache:!1,data:c,dataType:"json",success:function(b,c){MessageDisplay.Ok("Product saved successfully");var e=ModelFactory.updateObject(b);a||e.callListeners(new DynamicsEvents.AddEvent(e));
d.callListeners(new DynamicsEvents.EditEvent(d))},error:function(a,b,c){MessageDisplay.Error("Error saving product",a);d.rollback()}})};ProductModel.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/retrieveProduct.action",{productId:a.getId()},function(b,d){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))})};ProductModel.prototype.addIteration=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"iteration"))};
ProductModel.prototype.addProject=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"project"))};ProductModel.prototype.addTeam=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"team"))};ProductModel.prototype.getDescription=function(){return this.currentData.description};ProductModel.prototype.setDescription=function(a){this.currentData.description=a};ProductModel.prototype.getIterations=function(){return this.relations.iteration};
ProductModel.prototype.getName=function(){return this.currentData.name};ProductModel.prototype.setName=function(a){this.currentData.name=a};ProductModel.prototype.getProjects=function(){return this.relations.project};ProductModel.prototype.getStories=function(){return this.relations.story};ProductModel.prototype.getTeams=function(){if(this.currentData.teamIds){var a=[];$.each(this.currentData.teamIds,function(b,d){a.push(ModelFactory.getObject(ModelFactory.types.team,d))});return a}return this.relations.team};
ProductModel.prototype.setTeams=function(a,b){b&&$.each(b,function(a,b){ModelFactory.updateObject(b)});this.currentData.teamIds=a;this.currentData.teamsChanged=!0};
ProductModel.prototype.setAllTeams=function(a){if("MYTEAMS"==a||"ALL"==a){var b="ajax/retrieveAllTeams.action";"MYTEAMS"==a&&(b="ajax/retrieveMyTeams.action");a=[];jQuery.ajax({type:"POST",url:b,async:!1,cache:!1,data:{},dataType:"json",success:function(b,e){for(var c=0;c<b.length;c++)a.push(b[c].id)}});this.currentData.teamsChanged=!0;this.currentData.teamIds=a}};
var StoryModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.Story";this.relations={backlog:null,project:null,iteration:null,task:[],hourEntry:[],user:[],story:[],label:[],parent:null};this.metrics={};this.copiedFields={name:"name",storyValue:"storyValue",description:"description",state:"state",storyPoints:"storyPoints",rank:"rank",workQueueRank:"workQueueRank"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Product":"backlog","fi.hut.soberit.agilefant.model.Project":"backlog",
"fi.hut.soberit.agilefant.model.Iteration":"iteration","fi.hut.soberit.agilefant.model.User":"user","fi.hut.soberit.agilefant.model.Label":"label","fi.hut.soberit.agilefant.model.Task":"task","fi.hut.soberit.agilefant.model.StoryHourEntry":"hourEntry","fi.hut.soberit.agilefant.model.Story":"story"};this.metricFields=["storyValue","state"];this.metricFields=["storyPoints","state"]};StoryModel.prototype=new CommonModel;
StoryModel.Validators={backlogValidator:function(a){if(!a.getBacklog())throw"Please select a parent backlog";}};
StoryModel.prototype._setData=function(a){this.id=a.id;a.tasks&&this._updateRelations(ModelFactory.types.task,a.tasks);a.responsibles&&this._updateRelations(ModelFactory.types.user,a.responsibles);a.children&&this._updateRelations(ModelFactory.types.story,a.children);a.parent&&(this.relations.parent=ModelFactory.updateObject(a.parent,!0));a.backlog&&this.setBacklog(ModelFactory.updateObject(a.backlog,!0));a.iteration&&this.setIteration(ModelFactory.updateObject(a.iteration,!0));a.labels&&this._updateRelations(ModelFactory.types.label,
a.labels);a.metrics&&(this.metrics=a.metrics)};
StoryModel.prototype._copyStory=function(a){var b={};b.storyId=a.id;document.body.style.cursor="wait";var d=PageController.getInstance().getCurrentUser().getId(),c=a.getMyStoriesRank();jQuery.ajax({type:"POST",url:"ajax/copyStorySibling.action",async:!0,cache:!1,data:b,dataType:"json",success:function(b,g){var e=ModelFactory.updateObject(b);possibleIteration=a.getIteration();b&&(b.id&&possibleIteration)&&(possibleIteration.addStory(e),e.callListeners(new DynamicsEvents.AddEvent(e)));e.rankUnder(a.id,
e.getParent());null!=c&&1E4>c&&e.rankInMyStories(a.id,d);MessageDisplay.Ok("Story created successfully");document.body.style.cursor="default"},error:function(a,b,c){MessageDisplay.Error("Error saving story",a)}})};
StoryModel.prototype._extractUnfinishedStory=function(a){var b=this,d={};d.storyId=a.id;document.body.style.cursor="wait";var c=PageController.getInstance().getCurrentUser().getId(),f=a.getMyStoriesRank();jQuery.ajax({type:"POST",url:"ajax/extractUnfinishedStorySibling.action",async:!0,cache:!1,data:d,dataType:"json",success:function(d,e){var h=ModelFactory.updateObject(d);possibleIteration=a.getIteration();d&&(d.id&&possibleIteration)&&(possibleIteration.addStory(h),h.callListeners(new DynamicsEvents.AddEvent(h)));
h.rankUnder(a.id,h.getParent());null!=f&&1E4>f&&h.rankInMyStories(a.id,c);MessageDisplay.Ok("Story created successfully");document.body.style.cursor="default";b.relations.iteration&&b.relations.iteration.reload()},error:function(a,b,c){MessageDisplay.Error("Error saving story",a)}})};
StoryModel.prototype._saveData=function(a,b){var d=this.getBacklog(),c=this.getIteration(),f="ajax/storeStory.action",g={};b.usersChanged&&(jQuery.extend(g,{userIds:b.userIds,usersChanged:!0}),delete b.userIds,delete b.usersChanged,delete this.currentData.userIds,delete this.currentData.usersChanged);b.tasksToDone&&(g.tasksToDone=!0,delete b.tasksToDone,delete this.currentData.tasksToDone);this.currentData.backlog&&delete this.currentData.backlog;b.labels&&(g.labelNames=b.labels,delete this.currentData.labels,
delete b.labels);jQuery.extend(g,this.serializeFields("story",b));0!==ArrayUtils.countObjectFields(g)&&(a?g.storyId=a:f="ajax/createStory.action",d?g.backlogId=d.getId():c&&(d=c,g.backlogId=c.getId()),c&&(g.iteration=c.getId()),jQuery.ajax({type:"POST",url:f,async:!0,cache:!1,data:g,dataType:"json",success:function(b,c){MessageDisplay.Ok("Story saved successfully");var f=ModelFactory.updateObject(b);a||(f.setRank(-1),f.setWorkQueueRank(-1),d&&d.addStory(f),f.callListeners(new DynamicsEvents.AddEvent(f)),
d.callListeners(new DynamicsEvents.RankChanged(d,"story")))},error:function(a,b,c){MessageDisplay.Error("Error saving story",a)}}))};StoryModel.prototype.reload=function(a){var b=this;jQuery.getJSON("ajax/retrieveStory.action",{storyId:b.getId()},function(d,c){b.setData(d,!1);b.callListeners(new DynamicsEvents.EditEvent(b));a&&a()})};
StoryModel.prototype.reloadMetrics=function(){var a=this;jQuery.getJSON("ajax/retrieveStoryMetrics.action",{storyId:a.getId()},function(b,d){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a));a.callListeners(new DynamicsEvents.MetricsEvent(a))})};
StoryModel.prototype.canMoveStory=function(a){var b=!1,d=this;jQuery.ajax({url:"ajax/checkChangeBacklog.action",data:{storyId:this.getId(),backlogId:a},async:!1,cache:!1,type:"POST",dataType:"html",success:function(c,f){0===jQuery.trim(c).length?b=!0:d.callListeners(new DynamicsEvents.StoryTreeIntegrityViolation(d,c,a))}});return b};StoryModel.prototype.moveStory=function(a){a&&this._moveStory(a,"ajax/moveStory.action",!1)};
StoryModel.prototype.moveStoryOnly=function(a,b){this._moveStory(a,"ajax/safeMoveSingleStory.action",b)};StoryModel.prototype.moveStoryAndChildren=function(a,b){this._moveStory(a,"ajax/moveStoryAndChildren.action",b)};
StoryModel.prototype._moveStory=function(a,b,d){var c=this,f=this.relations.backlog,g=this.relations.project,e=this.relations.iteration;jQuery.ajax({url:b,data:{storyId:c.getId(),backlogId:a,moveParents:d},dataType:"json",type:"post",async:!0,cache:!1,success:function(a,b){c.callListeners(new DynamicsEvents.NamedEvent(c,"storyMoved"));c.relations.backlog=null;c.relations.project=null;c.relations.iteration=null;c._setData(a);g&&g!==c.relations.project&&(g.removeStory(c),g.reloadStoryRanks());f&&f!==
c.relations.backlog&&f.removeStory(c);e&&e!==c.relations.iteration&&e.removeStory(c);c.callListeners(new DynamicsEvents.EditEvent(c));MessageDisplay.Ok("Story moved")},error:function(a){MessageDisplay.Error("An error occurred moving the story",a)}})};StoryModel.prototype.rankUnder=function(a,b){this._rank("under",a,b)};StoryModel.prototype.rankOver=function(a,b){this._rank("over",a,b)};StoryModel.prototype.rankToTop=function(a){this._rank("top",0,a)};
StoryModel.prototype.rankToBottom=function(a){this._rank("bottom",0,a)};
StoryModel.prototype._rank=function(a,b,d){var c=this;b={storyId:c.getId(),targetStoryId:b};if(d&&d!=this.getParent()||"top"===a||"bottom"===a)b.backlogId=d.getId();jQuery.ajax({url:{over:"ajax/rankStoryOver.action",under:"ajax/rankStoryUnder.action",top:"ajax/rankStoryToTop.action",bottom:"ajax/rankStoryToBottom.action"}[a],type:"post",dataType:"json",data:b,async:!0,cache:!1,success:function(a,b){MessageDisplay.Ok("Story ranked");var e=c.getParent();e||(e=c.getIteration());c.setData(a);c.relations.project?
c.relations.project.callListeners(new DynamicsEvents.RankChanged(c.relations.project,"story")):(e.callListeners(new DynamicsEvents.RankChanged(e,"story")),e!==d&&d.callListeners(new DynamicsEvents.RankChanged(d,"story")))},error:function(a){MessageDisplay.Error("An error occurred while ranking the story",a)}})};
StoryModel.prototype._remove=function(a,b){var d={storyId:this.getId()};jQuery.extend(d,b);jQuery.ajax({type:"POST",dataType:"text",url:"ajax/deleteStory.action",data:d,async:!0,cache:!1,success:function(b,d){MessageDisplay.Ok("Story removed");a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting story.",a)}})};StoryModel.prototype.addTask=function(a){this.addRelation(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"task"))};
StoryModel.prototype.getBacklog=function(){return this.currentData.backlog?ModelFactory.getObject(ModelFactory.types.backlog,this.currentData.backlog):this.relations.project&&!this.relations.backlog?this.relations.project:this.relations.backlog};StoryModel.prototype.getIteration=function(){return this.currentData.iteration?ModelFactory.getObject(ModelFactory.types.iteration,this.currentData.iteration):this.relations.iteration};
StoryModel.prototype.getIterationOrBacklog=function(){return this.currentData.iteration?ModelFactory.getObject(ModelFactory.types.iteration,this.currentData.iteration):this.relations.iteration?this.relations.iteration:this.getBacklog()};StoryModel.prototype.setBacklog=function(a){this.addRelation(a)};StoryModel.prototype.setIteration=function(a){this.addRelation(a)};StoryModel.prototype.setBacklogByModel=function(a){this.currentData.backlog=a.getId()};
StoryModel.prototype.setIterationByModel=function(a){this.currentData.iteration=a.getId()};StoryModel.prototype.getDescription=function(){return this.currentData.description};StoryModel.prototype.setDescription=function(a){this.currentData.description=a};StoryModel.prototype.getName=function(){return this.currentData.name};StoryModel.prototype.setName=function(a){this.currentData.name=a};StoryModel.prototype.getParent=function(){return this.getIteration()?this.getIteration():this.getBacklog()};
StoryModel.prototype.getThis=function(){return this};StoryModel.prototype.getRank=function(){return this.currentData.rank};StoryModel.prototype.setRank=function(a){this.currentData.rank=a};StoryModel.prototype.setWorkQueueRank=function(a){this.currentData.workQueueRank=a};StoryModel.prototype.getResponsibles=function(){if(this.currentData.userIds){var a=[];$.each(this.currentData.userIds,function(b,d){a.push(ModelFactory.getObject(ModelFactory.types.user,d))});return a}return this.relations.user};
StoryModel.prototype.setResponsibles=function(a,b){b&&$.each(b,function(a,b){ModelFactory.updateObject(b)});this.currentData.userIds=a;this.currentData.usersChanged=!0};StoryModel.prototype.getState=function(){return this.currentData.state};StoryModel.prototype.setState=function(a){this.currentData.state=a};StoryModel.prototype.getStoryPoints=function(){return this.currentData.storyPoints};StoryModel.prototype.setStoryPoints=function(a){this.currentData.storyPoints=a};
StoryModel.prototype.getStoryValue=function(){return this.currentData.storyValue};StoryModel.prototype.setStoryValue=function(a){this.currentData.storyValue=a};StoryModel.prototype.getTasks=function(){return this.relations.task};StoryModel.prototype.getChildren=function(){return this.relations.story};StoryModel.prototype.getParentStory=function(){return this.relations.parent};StoryModel.prototype.getParentStoryName=function(){var a="";this.relations.parent&&(a=this.relations.parent.getName());return a};
StoryModel.prototype.getTotalEffortSpent=function(){return this.metrics.effortSpent};StoryModel.prototype.getTotalEffortLeft=function(){return this.metrics.effortLeft};StoryModel.prototype.getTotalOriginalEstimate=function(){return this.metrics.originalEstimate};StoryModel.prototype.getLabels=function(){return this.relations.label};StoryModel.prototype.setLabels=function(a){this.currentData.labels=a};StoryModel.prototype.getMyStoriesRank=function(){return this.currentData.workQueueRank};
StoryModel.prototype.rankInMyStories=function(a,b){var d=this;$.ajax({url:"ajax/rankMyStoryAndMoveUnder.action",data:{storyId:this.id,storyRankUnderId:a,userId:b},type:"post",success:function(a,b){MessageDisplay.Ok("Story ranked in story queue");d.callListeners(new DynamicsEvents.RankChanged(d,"myStoriesStory"))}})};
StoryModel.prototype.addResponsible=function(a){this.currentData.responsibles?this.currentData.responsibles.push(a):this.currentData.responsibles=[a];this.currentData.responsiblesChanged=!0};
var TaskModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.Task";this.relations={backlog:null,story:null,user:[],hourEntry:[]};this.transientData={};this.copiedFields={name:"name",state:"state",description:"description",effortLeft:"effortLeft",originalEstimate:"originalEstimate",rank:"rank",effortSpent:"effortSpent"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Iteration":"backlog","fi.hut.soberit.agilefant.model.User":"user","fi.hut.soberit.agilefant.model.Story":"story",
"fi.hut.soberit.agilefant.model.HourEntry":"hourEntry"};this.transientData.workingOnTaskIds=[];this.metricFields=["effortLeft","originalEstimate","effortSpent"];this.clonedModelTypes=[ModelFactory.types.workQueueTask]};TaskModel.prototype=new CommonModel;TaskModel.Validators={backlogSelectedValidator:function(a){if(!a.relations.backlog)throw"Please select a backlog";}};
TaskModel.prototype._setData=function(a){a.id&&(this.id=a.id);a.responsibles&&this._updateRelations(ModelFactory.types.user,a.responsibles);if(a.workingOnTask){var b=[];$.each(a.workingOnTask,function(a,d){b.push(d.id)});this.transientData.workingOnTaskIds=b}a.story&&this._updateRelations(ModelFactory.types.story,a.story);a.iteration&&this._updateRelations(ModelFactory.types.iteration,a.iteration)};
TaskModel.prototype.reload=function(){var a=this;$.ajax({type:"POST",url:"ajax/retrieveTask.action",async:!0,cache:!1,data:{taskId:this.id},dataType:"json",success:function(b,c){a.setData(b,!1)}})};
TaskModel.prototype._saveData=function(a,b){var c=this,d="ajax/storeTask.action",e={},g,f;b.responsiblesChanged&&(g=!0,f=b.responsibles,delete b.responsiblesChanged,delete b.responsibles);b.storyToStarted&&(e.storyToStarted=!0,delete b.storyToStarted,delete this.currentData.storyToStarted);e.task=b;a?(e.taskId=a,b.iterationChanged&&this.relations.backlog instanceof BacklogModel&&(e.iterationId=this.relations.backlog.getId(),e.iterationChanged=!0,delete b.iterationChanged)):(d="ajax/createTask.action",
this.relations.backlog instanceof BacklogModel?e.iterationId=this.relations.backlog.getId():this.relations.story instanceof StoryModel?e.storyId=this.relations.story.getId():b.storyId?e.storyId=b.storyId:b.backlogId&&(e.iterationId=b.backlogId));e=HttpParamSerializer.serialize(e);g&&(e.responsiblesChanged=!0,e.newResponsibles=f);jQuery.ajax({type:"POST",url:d,async:!0,cache:!1,data:e,dataType:"json",success:function(b,d){MessageDisplay.Ok("Task saved successfully");var f=ModelFactory.updateObject(b);
a||(c.relations.story instanceof StoryModel?c.relations.story.addTask(f):c.relations.backlog instanceof IterationModel&&c.relations.backlog.addTask(f),f.setRank(-1),f.callListeners(new DynamicsEvents.AddEvent(f)),null!=c.getStory()?c.getStory().reload():null!=c.getIteration()&&c.getIteration().reload());(e.storyToStarted||"always"===PageController.getInstance().getCurrentUser().getMarkStoryStarted())&&c.relations.story&&c.relations.story.callListeners(new DynamicsEvents.EditEvent(c.relations.story));
c.getStory()&&c.getStory().reloadMetrics();PageController.getInstance().mainController instanceof IterationController&&PageController.getInstance().mainController.reloadMetricsBox();jQuery(".ui-button:eq(0)").focus()},error:function(a,b,c){MessageDisplay.Error("Error saving task",a)}})};
TaskModel.prototype._remove=function(a,b){var c={taskId:this.getId()};jQuery.extend(c,b);jQuery.ajax({type:"POST",url:"ajax/deleteTask.action",async:!0,cache:!1,dataType:"text",data:c,success:function(b,c){MessageDisplay.Ok("Task removed");a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting task.",a)}})};
TaskModel.prototype.moveToIteration=function(a){var b=this.getParent(),c=this;a={taskId:this.getId(),iterationId:a};jQuery.ajax({type:"POST",url:"ajax/moveTask.action",async:!0,cache:!1,dataType:"json",data:a,success:function(a,e){MessageDisplay.Ok("Task moved");c.relations.backlog=null;c.relations.story=null;c._setData(a);var g=c.getParent();b.removeRelation(c);g.callListeners(new DynamicsEvents.RelationUpdatedEvent(g,"task"));c.callListeners(new DynamicsEvents.RelationUpdatedEvent(c,"parent"));
c.callListeners(new DynamicsEvents.EditEvent(c))},error:function(a,b){MessageDisplay.Error("Error moving task.",a)}})};TaskModel.prototype.setRank=function(a){this.currentData.rank=a};
TaskModel.prototype.rankUnder=function(a,b){var c=this,d={taskId:c.getId(),rankUnderId:a};b&&b!==c.getParent()?b instanceof IterationModel?d.iterationId=b.getId():b instanceof StoryModel&&(d.storyId=b.getId()):c.getParent()instanceof IterationModel?d.iterationId=c.getParent().getId():c.getParent()instanceof StoryModel&&(d.storyId=c.getParent().getId());(d.iterationId||d.storyId)&&jQuery.ajax({url:"ajax/rankTaskAndMoveUnder.action",type:"post",dataType:"json",data:d,success:function(a,d){MessageDisplay.Ok("Task ranked successfully.");
var f=c.getParent();c.setData(a);f===b&&f.reload(function(){f.callListeners(new DynamicsEvents.RankChanged(f,"task"))});f!==b&&(b.reload(),f.reload())},error:function(a,b){MessageDisplay.Error("An error occured while ranking the task.",a)}})};TaskModel.prototype.getIteration=function(){var a=this.getParent();if(a){if(a instanceof StoryModel)return a.getBacklog();if(a instanceof IterationModel)return a}return null};
TaskModel.prototype.addToMyWorkQueue=function(a){var b=this;jQuery.ajax({type:"POST",url:"ajax/addToWorkQueue.action",async:!0,cache:!1,dataType:"json",data:{taskId:b.getId()},success:function(c,d){MessageDisplay.Ok("Task appended to your task queue");b.setData(c);a&&a();b.callListeners(new DynamicsEvents.EditEvent(b));b.callListeners(new DynamicsEvents.NamedEvent(b,"addedToWorkQueue"))},error:function(a,b){MessageDisplay.Error("Error adding task to task queue.",a)}})};
TaskModel.prototype.removeFromMyWorkQueue=function(a){var b=this;jQuery.ajax({type:"POST",url:"ajax/deleteFromWorkQueue.action",async:!0,cache:!1,dataType:"json",data:{taskId:b.getId()},success:function(c,d){MessageDisplay.Ok("Task removed from your task queue");b.setData(c);a&&a();b.callListeners(new DynamicsEvents.EditEvent(b));b.callListeners(new DynamicsEvents.NamedEvent(b,"removedFromWorkQueue"))},error:function(a,b){MessageDisplay.Error("Error removing task from task queue.",a)}})};
TaskModel.prototype.resetOriginalEstimate=function(){var a=this;jQuery.ajax({url:"ajax/resetOriginalEstimate.action",type:"post",dataType:"json",data:{taskId:a.getId()},success:function(b,c){MessageDisplay.Ok("Original estimate reset.");a.setData(b)},error:function(a){MessageDisplay.Error("An error occured while ranking reseting the original estimate.",a)}})};TaskModel.prototype.getParent=function(){return this.relations.story?this.relations.story:this.relations.backlog};
TaskModel.prototype.setStory=function(a){this.addRelation(a)};TaskModel.prototype.setIteration=function(a){this.addRelation(a)};TaskModel.prototype.getDescription=function(){return this.currentData.description};TaskModel.prototype.setDescription=function(a){this.currentData.description=a};TaskModel.prototype.getEffortLeft=function(){return this.currentData.effortLeft};TaskModel.prototype.setEffortLeft=function(a){this.currentData.effortLeft=a};TaskModel.prototype.getId=function(){return this.id};
TaskModel.prototype.getName=function(){return this.currentData.name};TaskModel.prototype.setName=function(a){this.currentData.name=a};TaskModel.prototype.getOriginalEstimate=function(){return this.currentData.originalEstimate};TaskModel.prototype.setOriginalEstimate=function(a){this.currentData.originalEstimate=a};TaskModel.prototype.getRank=function(){return this.currentData.rank};TaskModel.prototype.getState=function(){return this.currentData.state};
TaskModel.prototype.setState=function(a){this.currentData.state=a};TaskModel.prototype.getStory=function(){return this.relations.story};TaskModel.prototype.getResponsibles=function(){if(this.currentData.responsibles){var a=[];$.each(this.currentData.responsibles,function(b,c){a.push(ModelFactory.getObject(ModelFactory.types.user,c))});return a}return this.relations.user};
TaskModel.prototype.getAnnotatedResponsibles=function(){var a=[],b=this;$.each(this.getResponsibles(),function(c,d){var e=-1!==$.inArray(d.id,b.transientData.workingOnTaskIds);a.push({user:d,workingOnTask:e})});return a};TaskModel.prototype.setResponsibles=function(a,b){b&&$.each(b,function(a,b){ModelFactory.updateObject(b)});this.currentData.responsibles=a;this.currentData.responsiblesChanged=!0};TaskModel.prototype.isWorkingOnTask=function(a){a=a.getId();return-1!=$.inArray(a,this.transientData.workingOnTaskIds)};
TaskModel.prototype.addResponsible=function(a){this.currentData.responsibles?this.currentData.responsibles.push(a):this.currentData.responsibles=[a];this.currentData.responsiblesChanged=!0};TaskModel.prototype.getEffortSpent=function(){return this.currentData.effortSpent};TaskModel.prototype.getContext=function(){var a=this.getParent();return a instanceof IterationModel?{backlog:a,story:null}:this.getParent()instanceof StoryModel?{backlog:a.getIteration(),story:a}:{backlog:null,story:null}};
var UserModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.User";this.relations={task:[],story:[],assignment:[],team:[],hourEntry:[]};this.currentData={initials:"",fullName:"",admin:!1};this.copiedFields={fullName:"fullName",initials:"initials",loginName:"loginName",email:"email",weekEffort:"weekEffort",enabled:"enabled",autoassignToTasks:"autoassignToTasks",markStoryStarted:"markStoryStarted",autoassignToStories:"autoassignToStories",recentItemsNumberOfWeeks:"recentItemsNumberOfWeeks",
admin:"admin",id:"id"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.model.Task":"task","fi.hut.soberit.agilefant.model.Team":"team","fi.hut.soberit.agilefant.model.Assignment":"assignment","fi.hut.soberit.agilefant.model.HourEntry":"hourEntry"}};UserModel.prototype=new CommonModel;
UserModel.Validators={passwordValidator:function(a){if(a.getPassword1()!==a.getPassword2())throw"Passwords don't match";},loginNameValidator:function(a){var b=a.getPersistedData().loginName;a=a.getCurrentData().loginName;if(b!=a&&!UserModel.Validators._ajaxCheckLoginName(a))throw"Login name already in use";},_ajaxCheckLoginName:function(a){var b=!0;jQuery.ajax({url:"ajax/isLoginNameUnique.action",data:{loginName:a},type:"POST",dataType:"json",async:!1,success:function(a,c){b=a},error:function(a,b,
e){MessageDisplay.Error("Error loading data for login name validation",a)}});return b}};UserModel.prototype._setData=function(a){this.id=a.id;this.currentData.id=a.id;a.teams&&this._updateRelations(ModelFactory.types.team,a.teams)};
UserModel.prototype._saveData=function(a,b){var d="ajax/storeUser.action",c={};this.currentData.password1&&(c.password1=this.currentData.password1,c.password2=this.currentData.password2,delete this.currentData.password1,delete this.currentData.password2);b.teamsChanged&&(jQuery.extend(c,{teamIds:b.teamIds,teamsChanged:!0}),delete b.teamIds,delete b.teamsChanged);jQuery.extend(c,this.serializeFields("user",b));a?c.userId=a:d="ajax/storeNewUser.action";jQuery.ajax({type:"POST",url:d,async:!0,cache:!1,
data:c,dataType:"json",success:function(b,c){MessageDisplay.Ok("User saved successfully");var d=ModelFactory.updateObject(b);a||d.callListeners(new DynamicsEvents.AddEvent(d))},error:function(a,b,c){MessageDisplay.Error("Error saving user",a)}})};UserModel.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/retrieveUser.action",{userId:a.getId()},function(b,d){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))})};UserModel.prototype.isAutoassignToTasks=function(){return this.currentData.autoassignToTasks};
UserModel.prototype.isAutoassignToTasksAsString=function(){return this.currentData.autoassignToTasks?"true":"false"};UserModel.prototype.setAutoassignToTasks=function(a){this.currentData.autoassignToTasks=a};UserModel.prototype.getEmail=function(){return this.currentData.email};UserModel.prototype.setEmail=function(a){this.currentData.email=a};UserModel.prototype.isEnabled=function(){return this.currentData.enabled};UserModel.prototype.setEnabled=function(a){this.currentData.enabled=a};
UserModel.prototype.getFullName=function(){return this.currentData.fullName};UserModel.prototype.setFullName=function(a){this.currentData.fullName=a};UserModel.prototype.getInitials=function(){return this.currentData.initials};UserModel.prototype.setInitials=function(a){this.currentData.initials=a};UserModel.prototype.getAdmin=function(){return this.currentData.admin};UserModel.prototype.getAdminAsString=function(){return this.currentData.admin?"Yes":"No"};
UserModel.prototype.setAdmin=function(a){this.currentData.admin=a};UserModel.prototype.getLoginName=function(){return this.currentData.loginName};UserModel.prototype.setLoginName=function(a){this.currentData.loginName=a};UserModel.prototype.getRecentItemsNumberOfWeeks=function(){return this.currentData.recentItemsNumberOfWeeks};UserModel.prototype.setRecentItemsNumberOfWeeks=function(a){this.currentData.recentItemsNumberOfWeeks=a};UserModel.prototype.getPassword1=function(){return this.currentData.password1};
UserModel.prototype.setPassword1=function(a){this.currentData.password1=a};UserModel.prototype.getPassword2=function(){return this.currentData.password2};UserModel.prototype.setPassword2=function(a){this.currentData.password2=a};UserModel.prototype.getTeams=function(){if(this.currentData.teamIds){var a=[];$.each(this.currentData.teamIds,function(b,d){a.push(ModelFactory.getObject(ModelFactory.types.team,d))});return a}return this.relations.team};
UserModel.prototype.setTeams=function(a,b){b&&$.each(b,function(a,b){ModelFactory.updateObject(b)});this.currentData.teamIds=a;this.currentData.teamsChanged=!0};UserModel.prototype.getWeekEffort=function(){return this.currentData.weekEffort};UserModel.prototype.setWeekEffort=function(a){this.currentData.weekEffort=a};UserModel.prototype.isAutoassignToStories=function(){return this.currentData.autoassignToStories};UserModel.prototype.getMarkStoryStarted=function(){return this.currentData.markStoryStarted};
UserModel.prototype.getAdmin=function(){return this.currentData.admin};UserModel.prototype.getId=function(){return this.currentData.id?this.currentData.id:this.id};
var TeamModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.Team";this.relations={user:[]};this.currentData={};this.copiedFields={name:"name"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.User":"user"}};TeamModel.prototype=new CommonModel;TeamModel.prototype._setData=function(b){this.id=b.id;b.users&&this._updateRelations(ModelFactory.types.user,b.users)};
TeamModel.prototype._remove=function(b,a){var d={teamId:this.getId()};jQuery.extend(d,a);jQuery.ajax({type:"POST",url:"ajax/deleteTeam.action",async:!0,cache:!1,dataType:"text",data:d,success:function(a,d){MessageDisplay.Ok("Team removed");b&&b()},error:function(a,b){MessageDisplay.Error("Error deleting team.",a)}})};
TeamModel.prototype._saveData=function(b,a){var d=this,e="ajax/storeTeam.action",c={};a.usersChanged&&(c.userIds=a.userIds,c.usersChanged=!0,delete a.userIds,delete a.usersChanged);a.productsChanged&&(c.productIds=a.productIds,c.productsChanged=!0,delete a.productIds,delete a.productsChanged);a.iterationsChanged&&(c.iterationIds=a.iterationIds,c.iterationsChanged=!0,delete a.iterationIds,delete a.iterationsChanged);jQuery.extend(c,this.serializeFields("team",a));b?c.teamId=b:e="ajax/storeNewTeam.action";
jQuery.ajax({type:"POST",url:e,async:!0,cache:!1,data:c,dataType:"json",success:function(a,c){MessageDisplay.Ok("Team saved successfully");var e=ModelFactory.updateObject(a);b||e.callListeners(new DynamicsEvents.AddEvent(e));d.callListeners(new DynamicsEvents.EditEvent(d))},error:function(a,b,d){MessageDisplay.Error("Error saving team",a)}})};TeamModel.prototype.getName=function(){return this.currentData.name};TeamModel.prototype.setName=function(b){this.currentData.name=b};
TeamModel.prototype.getUsers=function(){if(this.currentData.userIds){var b=[];$.each(this.currentData.userIds,function(a,d){b.push(ModelFactory.getObject(ModelFactory.types.user,d))});return b}return this.relations.user};TeamModel.prototype.setUsers=function(b,a){a&&$.each(a,function(a,b){ModelFactory.updateObject(b)});this.currentData.userIds=b;this.currentData.usersChanged=!0};
TeamModel.prototype.setAllProducts=function(b){if("true"==b){var a=[];jQuery.ajax({type:"POST",url:"ajax/retrieveAllProducts.action",async:!1,cache:!1,data:{},dataType:"json",success:function(b,e){for(i=0;i<b.length;i++)a.push(b[i].id)}});this.currentData.productsChanged=!0;this.currentData.productIds=a}};
TeamModel.prototype.setAllIterations=function(b){if("true"==b){var a=[];jQuery.ajax({type:"POST",url:"ajax/retrieveAllSAIterations.action",async:!1,cache:!1,data:{},dataType:"json",success:function(b,e){for(i=0;i<b.length;i++)a.push(b[i].id)}});this.currentData.iterationsChanged=!0;this.currentData.iterationIds=a}};
var DynamicsComparators={doCompare:function(a,b){return a>b?1:a<b?-1:0},genericComparator:function(a,b,c){a=c.call(a);b=c.call(b);return DynamicsComparators.doCompare(a,b)},valueComparatorFactory:function(a){return function(b,c){return DynamicsComparators.genericComparator(b,c,a)}},genericFilteredComparator:function(a,b,c,d){a=d(c.call(a));b=d(c.call(b));return DynamicsComparators.doCompare(a,b)},filteredValueComparatorFactory:function(a,b){return function(c,d){return DynamicsComparators.genericFilteredComparator(c,
d,a,b)}},storyBacklogNameComparator:function(a,b){return DynamicsComparators.doCompare(a.getBacklog().getName(),b.getBacklog().getName())},storyIterationNameComparator:function(a,b){var c="",d="";null!=a.getIteration()&&(c=a.getIteration().getName());null!=b.getIteration()&&(d=b.getIteration().getName());return DynamicsComparators.doCompare(c,d)}};
var AssignmentModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.Assignment";this.relations={backlog:null,user:null};this.copiedFields={personalLoad:"personalLoad",availability:"availability",assignedLoad:"assignedLoad",unassignedLoad:"unassignedLoad",availableWorktime:"availableWorktime",totalLoad:"totalLoad",unassigned:"unassigned",loadPercentage:"loadPercentage"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Project":"backlog","fi.hut.soberit.agilefant.model.Iteration":"backlog",
"fi.hut.soberit.agilefant.model.User":"user"}};AssignmentModel.prototype=new CommonModel;AssignmentModel.prototype._setData=function(a){this.id=a.id;this._copyFields(a);a.user&&this._updateRelations(ModelFactory.types.user,a.user)};
AssignmentModel.prototype._saveData=function(a,b){var c={};jQuery.extend(c,this.serializeFields("assignment",b));c.assignmentId=a;jQuery.ajax({type:"POST",url:"ajax/modifyAssigment.action",async:!0,cache:!1,data:c,dataType:"json",success:function(a,b){MessageDisplay.Ok("Assignment saved successfully");ModelFactory.updateObject(a)},error:function(a,b,c){MessageDisplay.Error("Error saving assignment",a)}})};
AssignmentModel.prototype._remove=function(a){jQuery.post("ajax/deleteAssignment.action",{assignmentId:this.getId()},function(b,c){MessageDisplay.Ok("Assignment removed");a&&a()})};AssignmentModel.prototype.getPersonalLoad=function(){return this.currentData.personalLoad};AssignmentModel.prototype.getAvailability=function(){return this.currentData.availability};AssignmentModel.prototype.setPersonalLoad=function(a){this.currentData.personalLoad=a};
AssignmentModel.prototype.setAvailability=function(a){this.currentData.availability=a};AssignmentModel.prototype.getUser=function(){return this.relations.user};AssignmentModel.prototype.getBacklog=function(){return this.relations.backlog};AssignmentModel.prototype.getAssignedLoad=function(){return this.currentData.assignedLoad};AssignmentModel.prototype.getUnassignedLoad=function(){return this.currentData.unassignedLoad};AssignmentModel.prototype.getAvailableWorktime=function(){return this.currentData.availableWorktime};
AssignmentModel.prototype.getTotalLoad=function(){return this.currentData.totalLoad};AssignmentModel.prototype.getLoadPercentage=function(){return this.currentData.loadPercentage};AssignmentModel.prototype.isUnassigned=function(){return this.currentData.unassigned};var AssignmentContainer=function(a){this.iterationId=a;this.initialize();this.relations={assignment:[]};this.copiedFields={}};AssignmentContainer.prototype=new CommonModel;
AssignmentContainer.prototype.reload=function(){var a=this;$.getJSON("ajax/iterationAssignments.action",{iterationId:this.iterationId},function(b,c){a.relations.assignment=[];for(var d=0,e=b.length;d<e;d++)a.relations.assignment.push(ModelFactory.updateObject(b[d]));a.callListeners(new DynamicsEvents.RelationUpdatedEvent(a))})};AssignmentContainer.prototype.getAssignments=function(){return this.relations.assignment};
var HourEntryModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.HourEntry";this.relations={backlog:null,story:null,task:null,user:null,hourEntryList:null};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Backlog":"backlog","fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.model.Task":"task"};this.copiedFields={date:"date",minutesSpent:"minutesSpent",description:"description"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.User":"user",
"non.existent.HourEntryList":"hourEntryList"}};HourEntryModel.Validators={usersValidator:function(a){if(1>a.getUsers().length)throw"Please select at least one user";}};HourEntryModel.dateComparator=function(a,b){return a.getDate()<b.getDate()?1:a.getDate()>b.getDate()?-1:0};HourEntryModel.prototype=new CommonModel;
HourEntryModel.prototype.getContext=function(){var a={},b=this.relations.backlog,c=this.relations.story;this.relations.task&&(a.task=this.relations.task,b=a.task.getIteration(),c=this.relations.task.getStory());c&&(a.story=c,b=c.getBacklog());b&&(a.backlog=b);return a};
HourEntryModel.prototype._setData=function(a){this.id=a.id;this._copyFields(a);a.user&&(this.relations.user=ModelFactory.updateObject(a.user));a.task&&(this.relations.task=ModelFactory.updateObject(a.task));a.story&&(this.relations.story=ModelFactory.updateObject(a.story));a.backlog&&(this.relations.backlog=ModelFactory.updateObject(a.backlog))};
HourEntryModel.logEffortForCurrentUser=function(a,b){var c=new HourEntryModel;c.setUsers([],[PageController.getInstance().getCurrentUser()]);c.setEffortSpent(b);c.setDate((new Date).asString());c.setParent(a);c.commit()};
HourEntryModel.prototype._saveData=function(a,b){var c=this.serializeFields("hourEntry",b),d="",e=this;if(a)c.hourEntryId=a,d="ajax/storeEffortEntry.action";else if(this.relations.backlog instanceof BacklogModel)if(b.minutesSpent)d="ajax/logBacklogEffort.action",c.parentObjectId=this.relations.backlog.getId();else return;else if(this.relations.story instanceof StoryModel)if(b.minutesSpent)d="ajax/logStoryEffort.action",c.parentObjectId=this.relations.story.getId();else return;else if(this.relations.task instanceof
TaskModel)if(b.minutesSpent)d="ajax/logTaskEffort.action",c.parentObjectId=this.relations.task.getId();else return;if(this.tmpUsers){for(var g=[],f=0;f<this.tmpUsers.length;f++)g.push(this.tmpUsers[f].getId());c.userIds=g}$.ajax({type:"POST",url:d,async:!0,cache:!1,data:c,dataType:"json",success:function(a,c){MessageDisplay.Ok("Effort entry saved");e.relations.hourEntryList&&e.relations.hourEntryList.reload();a&&e.setData(a)},error:function(a,c,b){MessageDisplay.Error("Error saving effort entry",
a)}})};HourEntryModel.prototype._remove=function(a){var b=this;jQuery.ajax({type:"POST",url:"ajax/deleteHourEntry.action",async:!0,cache:!1,dataType:"text",data:{hourEntryId:b.getId()},success:function(c,d){MessageDisplay.Ok("Hour entry removed");b.relations.hourEntryList&&b.relations.hourEntryList.reload();a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting hour entry.",a)}})};HourEntryModel.prototype.getDate=function(){return this.currentData.date};
HourEntryModel.prototype.getMinutesSpent=function(){return this.currentData.minutesSpent};HourEntryModel.prototype.getDescription=function(){return this.currentData.description};HourEntryModel.prototype.setDate=function(a){this.currentData.date=a};HourEntryModel.prototype.setEffortSpent=function(a){this.setMinutesSpent(ParserUtils.timeStrToMinutes(a))};HourEntryModel.prototype.setMinutesSpent=function(a){a&&(this.currentData.minutesSpent=a)};HourEntryModel.prototype.getRelatedTask=function(){return this.relations.task};
HourEntryModel.prototype.getEffortLeft=function(){if(null===this.relations.task)return"--";var a=this.relations.task.getEffortLeft();return 0===a?"0":a};HourEntryModel.prototype.setEffortLeft=function(a){null!==this.relations.task&&a&&(this.relations.task.setEffortLeft(a),this.relations.task.commit())};HourEntryModel.prototype.effortLeftEditable=function(){return null!==this.model.relations.task?!0:!1};HourEntryModel.prototype.setDescription=function(a){this.currentData.description=a};
HourEntryModel.prototype.getUser=function(){return this.relations.user};HourEntryModel.prototype.setHourEntryList=function(a){this.relations.hourEntryList=a};HourEntryModel.prototype.setUser=function(a){this.relations.user=a};HourEntryModel.prototype.getUsers=function(){return this.tmpUsers};HourEntryModel.prototype.setParent=function(a){a instanceof BacklogModel?this.relations.backlog=a:a instanceof StoryModel?this.relations.story=a:a instanceof TaskModel&&(this.relations.task=a)};
HourEntryModel.prototype.setUsers=function(a,b){if(b){this.tmpUsers=[];for(var c=0;c<b.length;c++)b[c]instanceof UserModel?this.tmpUsers.push(b[c]):this.tmpUsers.push(ModelFactory.updateObject(b[c]))}};
var TaskSplitContainer=function(b,a){this.originalTask=b;this.newTasks=a;this.newTasks||(this.newTasks=[])};TaskSplitContainer.prototype.commit=function(b){var a=this.serializeData(),c=this;jQuery.ajax({url:"ajax/splitTask.action",type:"post",dataType:"json",data:a,cache:!1,async:!0,success:function(a,e){MessageDisplay.Ok("Task split successfully");b&&b();c.originalTask.getParent().reload()},error:function(a,b,c){MessageDisplay.Error("Error splitting task",a)}})};
TaskSplitContainer.prototype.serializeData=function(){var b=this.originalTask.getChangedData(),a={};a.original=b;a.originalTaskId=this.originalTask.getId();a.original.responsiblesChanged&&(delete a.original.responsiblesChanged,delete a.original.responsibles);a.responsibles=this._responsibleIds(this.originalTask.getResponsibles());for(var b=[],c=0;c<this.newTasks.length;c++){var d=this.newTasks[c].getChangedData();this._responsibleIds(this.newTasks[c].getResponsibles());d.responsibles=[];d.responsiblesChanged&&
delete d.responsiblesChanged;b.push(d)}a.newTasks=b;return HttpParamSerializer.param(a,["responsibles"])};TaskSplitContainer.prototype._responsibleIds=function(b){for(var a=[],c=0;c<b.length;c++)a.push(b[c].getId());return a};
var UserListContainer=function(){this.initialize();this.persistedClassName="non.existent.UserList";this.relations={user:[]};this.copiedFields={};this.classNameToRelation={"fi.hut.soberit.agilefant.model.User":"user"}};UserListContainer.prototype=new CommonModel;UserListContainer.prototype._setData=function(a){a&&this._updateRelations(ModelFactory.types.user,a)};UserListContainer.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/retrieveAllUsers.action",{},function(b,c){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))})};
UserListContainer.prototype._getUsersByEnabledStatus=function(a){for(var b=[],c=0;c<this.relations.user.length;c++){var d=this.relations.user[c];d.isEnabled()===a&&b.push(d)}return b};UserListContainer.prototype.getEnabledUsers=function(){return this._getUsersByEnabledStatus(!0)};UserListContainer.prototype.getDisabledUsers=function(){return this._getUsersByEnabledStatus(!1)};
var TeamListContainer=function(){this.initialize();this.persistedClassName="non.existent.TeamList";this.relations={team:[]};this.copiedFields={};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Team":"team","fi.hut.soberit.agilefant.transfer.TeamTO":"team"}};TeamListContainer.prototype=new CommonModel;TeamListContainer.prototype._setData=function(a){a&&this._updateRelations(ModelFactory.types.team,a)};
TeamListContainer.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/retrieveAllTeams.action",{},function(b,c){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))})};TeamListContainer.prototype.getTeams=function(){return this.relations.team};
var HourEntryListContainer=function(){this.initialize();this.persistedClassName="non.existent.HourEntryList";this.relations={hourEntry:[],parent:null};this.copiedFields={};this.classNameToRelation={"fi.hut.soberit.agilefant.model.HourEntry":"hourEntry"}};HourEntryListContainer.initializeFor=function(a,c,b){var d=new HourEntryListContainer;d.setParent(a);d.limitedEntries=b;d.fillData(c)};HourEntryListContainer.prototype=new CommonModel;
HourEntryListContainer.prototype._setData=function(a){if(a){this._updateRelations(ModelFactory.types.hourEntry,a);for(a=0;a<this.relations.hourEntry.length;a++)this.relations.hourEntry[a].setHourEntryList(this)}};HourEntryListContainer.prototype.reload=function(){this.relations.parent&&(this.fillData(),this.relationChanged=!0)};
HourEntryListContainer.prototype.fillData=function(a){var c=this,b="";this.limitedEntries||(this.limitedEntries=!1);this.relations.parent instanceof BacklogModel?b="ajax/retrieveBacklogHourEntries.action":this.relations.parent instanceof StoryModel?b="ajax/retrieveStoryHourEntries.action":this.relations.parent instanceof TaskModel&&(b="ajax/retrieveTaskHourEntries.action");var d={parentObjectId:this.relations.parent.getId(),limited:this.limitedEntries};jQuery.getJSON(b,d,function(b,d){c.setData(b);
a&&a(c);c.callListeners(new DynamicsEvents.EditEvent(c))})};HourEntryListContainer.prototype.setLimitedEntries=function(a){this.limitedEntries=a};HourEntryListContainer.prototype.setParent=function(a){this.relations.parent=a};HourEntryListContainer.prototype.getHourEntries=function(a){return this.relations.hourEntry};
var PortfolioModel=function(){this.initialize();this.persistedClassName="non.existent.PortfolioModel";this.relations={};this.copiedFields={timeSpanInDays:"timeSpanInDays"};this.unrankedProjects=[];this.rankedProjects=[];this.classNameToRelation={};this.isReloading=!1};PortfolioModel.prototype=new CommonModel;
PortfolioModel.Validators={_parseDate:function(a){return"number"===typeof a?new Date(a):Date.fromString(a)},dateValidator:function(a){var b=PortfolioModel.Validators._parseDate(a.getStartDate());a=PortfolioModel.Validators._parseDate(a.getEndDate());if(b.after(a))throw"Start date must be before end date";}};
PortfolioModel.prototype._setData=function(a){var b;if(a){this.unrankedProjects=[];this.rankedProjects=[];for(var c=0,d=a.rankedProjects.length;c<d;c++)b=ModelFactory.updateObject(a.rankedProjects[c]),b.setRank(c),this.rankedProjects.push(b);c=0;for(d=a.unrankedProjects.length;c<d;c++)b=ModelFactory.updateObject(a.unrankedProjects[c]),b.setRank(b.getStartDate()),this.unrankedProjects.push(b)}};
PortfolioModel.prototype.reload=function(){if(!this.isReloading){this.isReloading=!0;var a=this;jQuery.ajax({type:"POST",dataType:"json",url:"ajax/projectPortfolioData.action",async:!0,success:function(b,c){a.setData(b);a.callListeners(new DynamicsEvents.RelationUpdatedEvent(a));a.isReloading=!1},error:function(a,c,d){MessageDisplay.ErrorMessage("Error loading dashboard.",a)}})}};PortfolioModel.prototype.getRankedProjects=function(){return this.rankedProjects};
PortfolioModel.prototype.getUnrankedProjects=function(){return this.unrankedProjects};PortfolioModel.prototype.getTimeSpanInDays=function(){return this.currentData.timeSpanInDays};
var LabelModel=function(){this.initialize();this.persistedClassName="fi.hut.soberit.agilefant.model.Label";this.relations={story:null};this.copiedFields={name:"name",displayName:"displayName",timestamp:"timestamp"};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Story":"story"}};LabelModel.prototype=new CommonModel;LabelModel.prototype._setData=function(a){};LabelModel.prototype.getName=function(){return this.currentData.name};LabelModel.prototype.getDisplayName=function(){return this.currentData.displayName};
LabelModel.prototype.getTimestamp=function(){return this.currentData.timestamp};LabelModel.prototype._remove=function(a,c){var d=this,b={labelId:d.getId()};jQuery.extend(b,c);jQuery.ajax({type:"POST",dataType:"text",url:"ajax/deleteLabel.action",data:b,async:!0,cache:!1,success:function(b,c){d.relations.story.reload();MessageDisplay.Ok("Label removed");a&&a()},error:function(a,b){MessageDisplay.Error("Error deleting label.",a)}})};
var DailyWorkModel=function(){this.initialize();this.persistedClassName="non.existent.DailyWork";this.relations={tasksWithoutStory:[],stories:[],queuedTasks:[]};this.copiedFields={};this.classNameToRelation={"fi.hut.soberit.agilefant.transfer.DailyWorkTaskTO":"queuedTasks","fi.hut.soberit.agilefant.transfer.StoryTO":"stories","fi.hut.soberit.agilefant.model.Story":"stories","fi.hut.soberit.agilefant.transfer.TaskTO":"tasksWithoutStory","fi.hut.soberit.agilefant.model.Task":"tasksWithoutStory"}};
DailyWorkModel.prototype=new CommonModel;DailyWorkModel.prototype._setData=function(a){a.stories&&this._updateRelations("stories",a.stories);a.tasksWithoutStory&&this._updateRelations("tasksWithoutStory",a.tasksWithoutStory);a.queuedTasks&&this._updateRelations("queuedTasks",a.queuedTasks)};DailyWorkModel.prototype.reload=function(){};
DailyWorkModel.prototype.reloadWorkQueue=function(a,b){var c=this;$.ajax({url:"ajax/workQueue.action",type:"post",dataType:"json",data:{userId:a},success:function(a,d){a&&c._updateRelations("queuedTasks",a);b&&b()},error:function(a,b){MessageDisplay.Error("Unable to refresh task queue.",a)}})};
DailyWorkModel.prototype.reloadTasksWithoutStory=function(a,b){var c=this;$.ajax({url:"ajax/dailyWorkTasks.action",type:"post",dataType:"json",data:{userId:a},success:function(a,d){a&&c._updateRelations("tasksWithoutStory",a);b&&b()},error:function(a,b){MessageDisplay.Error("Unable to refresh tasks without story.",a)}})};
DailyWorkModel.prototype.reloadMyStories=function(a,b){var c=this;$.ajax({url:"ajax/dailyWorkStories.action",type:"post",dataType:"json",data:{userId:a},success:function(a,d){a&&c._updateRelations("stories",a);b&&b()},error:function(a,b){MessageDisplay.Error("Unable to refresh story queue.",a)}})};DailyWorkModel.prototype.addTask=function(a){this.relations.tasksWithoutStory.push(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"tasksWithoutStory"))};
DailyWorkModel.prototype.addStory=function(a){this.relations.stories.push(a);this.callListeners(new DynamicsEvents.RelationUpdatedEvent(this,"stories"))};DailyWorkModel.prototype.getWorkQueue=function(){return this.relations.queuedTasks};DailyWorkModel.prototype.getAssignedStories=function(){return this.relations.stories};DailyWorkModel.prototype.getTasksWithoutStory=function(){return this.relations.tasksWithoutStory};
var WorkQueueTaskModel=function(){TaskModel.call(this);this.copiedFields.workQueueRank="workQueueRank";this.persistedClassName="fi.hut.soberit.agilefant.transfer.DailyWorkTaskTO"};extendObject(WorkQueueTaskModel,TaskModel);WorkQueueTaskModel.prototype.getWorkQueueRank=function(){return this.currentData.workQueueRank};
WorkQueueTaskModel.prototype.rankInWorkQueue=function(a,b){var c=this;$.ajax({url:"ajax/rankDailyTaskAndMoveUnder.action",data:{taskId:this.id,rankUnderId:a,userId:b},type:"post",success:function(a,b){MessageDisplay.Ok("Task ranked in task queue");c.callListeners(new DynamicsEvents.RankChanged(c,"workQueueTask"))}})};
ModelFactory=function(){this.rootObject=null;this.data={backlog:{},story:{},task:{},assignment:{},hourEntry:{},user:{},team:{},product:{},label:{},workQueueTask:{}}};ModelFactory.instance=null;
ModelFactory.classNameToType={"fi.hut.soberit.agilefant.model.Backlog":"backlog","fi.hut.soberit.agilefant.model.Iteration":"backlog","fi.hut.soberit.agilefant.model.Product":"backlog","fi.hut.soberit.agilefant.model.Project":"backlog","fi.hut.soberit.agilefant.transfer.ProjectTO":"backlog","fi.hut.soberit.agilefant.transfer.ProductTO":"backlog","fi.hut.soberit.agilefant.transfer.IterationTO":"backlog","fi.hut.soberit.agilefant.model.Story":"story","fi.hut.soberit.agilefant.transfer.StoryTO":"story",
"fi.hut.soberit.agilefant.model.Task":"task","fi.hut.soberit.agilefant.transfer.TaskTO":"task","fi.hut.soberit.agilefant.model.User":"user","fi.hut.soberit.agilefant.model.Team":"team","fi.hut.soberit.agilefant.model.Assignment":"assignment","fi.hut.soberit.agilefant.transfer.AssignmentTO":"assignment","fi.hut.soberit.agilefant.model.HourEntry":"hourEntry","fi.hut.soberit.agilefant.model.BacklogHourEntry":"hourEntry","fi.hut.soberit.agilefant.model.StoryHourEntry":"hourEntry","fi.hut.soberit.agilefant.model.TaskHourEntry":"hourEntry",
"fi.hut.soberit.agilefant.model.Label":"label","fi.hut.soberit.agilefant.transfer.DailyWorkTaskTO":"workQueueTask"};
ModelFactory.classNameToJsClass={"fi.hut.soberit.agilefant.model.Iteration":IterationModel,"fi.hut.soberit.agilefant.model.Project":ProjectModel,"fi.hut.soberit.agilefant.model.Product":ProductModel,"fi.hut.soberit.agilefant.transfer.IterationTO":IterationModel,"fi.hut.soberit.agilefant.transfer.ProjectTO":ProjectModel,"fi.hut.soberit.agilefant.transfer.ProductTO":ProductModel,"fi.hut.soberit.agilefant.model.Story":StoryModel,"fi.hut.soberit.agilefant.transfer.StoryTO":StoryModel,"fi.hut.soberit.agilefant.model.Task":TaskModel,
"fi.hut.soberit.agilefant.transfer.TaskTO":TaskModel,"fi.hut.soberit.agilefant.model.User":UserModel,"fi.hut.soberit.agilefant.model.Team":TeamModel,"fi.hut.soberit.agilefant.model.Assignment":AssignmentModel,"fi.hut.soberit.agilefant.transfer.AssignmentTO":AssignmentModel,"fi.hut.soberit.agilefant.model.HourEntry":HourEntryModel,"fi.hut.soberit.agilefant.model.BacklogHourEntry":HourEntryModel,"fi.hut.soberit.agilefant.model.StoryHourEntry":HourEntryModel,"fi.hut.soberit.agilefant.model.TaskHourEntry":HourEntryModel,
"fi.hut.soberit.agilefant.model.Label":LabelModel,"fi.hut.soberit.agilefant.transfer.DailyWorkTaskTO":WorkQueueTaskModel};
ModelFactory.typeToClassName={backlog:"fi.hut.soberit.agilefant.model.Backlog",iteration:"fi.hut.soberit.agilefant.model.Iteration",product:"fi.hut.soberit.agilefant.model.Product",project:"fi.hut.soberit.agilefant.model.Project",story:"fi.hut.soberit.agilefant.model.Story",task:"fi.hut.soberit.agilefant.model.Task",user:"fi.hut.soberit.agilefant.model.User",team:"fi.hut.soberit.agilefant.model.Team",assignment:"fi.hut.soberit.agilefant.model.Assignment",hourEntry:"fi.hut.soberit.agilefant.model.HourEntry",
label:"fi.hut.soberit.agilefant.model.Label"};ModelFactory.typeToLazyLoadingUri={backlog:{uri:"ajax/retrieveBacklog.action",idParam:"backlogId"},iteration:{uri:"ajax/retrieveIteration.action",idParam:"iterationId"},story:{uri:"ajax/retrieveStory.action",idParam:"storyId"}};ModelFactory.types={backlog:"backlog",iteration:"backlog",product:"backlog",project:"backlog",story:"story",task:"task",workQueueTask:"workQueueTask",user:"user",team:"team",hourEntry:"hourEntry",assignment:"assignment",label:"label"};
ModelFactory.initializeForTypes={iteration:"iteration",iterations:"iterations",ROIteration:"ROIteration",project:"project",product:"product",products:"products",dailyWork:"dailyWork",teams:"teams",users:"users",user:"user"};ModelFactory.getInstance=function(){ModelFactory.instance||(ModelFactory.instance=new ModelFactory);return ModelFactory.instance};
ModelFactory.initializeFor=function(a,b,d){if(!a||!b||!(a in ModelFactory.initializeForTypes))throw new TypeError("Type not recognized");ModelFactory.getInstance()._getData(a,b,function(a){ModelFactory.reloadEvery(a,3E4);d(a)})};ModelFactory.currentTimer=null;ModelFactory.reloadRoot=function(){ModelFactory.getInstance().getRootObject().reload()};ModelFactory.reloadEvery=function(a,b){ModelFactory.callEvery(b,function(){a.reload()})};
ModelFactory.callEvery=function(a,b){ModelFactory.currentTimer=setInterval(b,a)};ModelFactory.addObject=function(a){var b=ModelFactory.getInstance();if(!a||!(a instanceof CommonModel)||!(a.getPersistedClass()in ModelFactory.classNameToType))throw new TypeError("Invalid argument");b._addObject(a)};ModelFactory.getObject=function(a,b){var d=ModelFactory.getObjectIfExists(a,b);if(!d)throw Error("Not found");return d};
ModelFactory.getObjectIfExists=function(a,b){if(!(a in ModelFactory.types))throw new TypeError("Type not recognized");return ModelFactory.getInstance()._getObject(a,b)};ModelFactory.getOrRetrieveObject=function(a,b,d,c){var e=ModelFactory.getInstance();if(!(a in ModelFactory.types))throw new TypeError("Type not recognized");var f=e._getObject(ModelFactory.classNameToType[ModelFactory.typeToClassName[a]],b);f?d(a,b,f):e.retrieveLazily(a,b,d,c)};
ModelFactory.createObject=function(a){if(!(a in ModelFactory.classNameToJsClass)&&!(a in ModelFactory.types))throw new TypeError("Invalid type");return a in ModelFactory.types?ModelFactory.getInstance()._createObject(ModelFactory.typeToClassName[a]):ModelFactory.getInstance()._createObject(a)};
ModelFactory.updateObject=function(a,b){if(!a||"object"!==typeof a||!a.id||"number"!==typeof a.id||!a["class"])throw Error("Illegal argument for ModelFactory.updateObject :: "+a);var d=ModelFactory.getInstance(),c=d._getObject(ModelFactory.classNameToType[a["class"]],a.id);c||(c=ModelFactory.createObject(a["class"]),c.setId(a.id),d._addObject(c));c.setData(a,b);d._updateCloneModels(c,a);return c};ModelFactory.initUsers=function(a){ModelFactory.getInstance()._initUsers(a)};
ModelFactory.initProjectPortfolio=function(a){ModelFactory.getInstance()._initProjectPortfolio(a)};ModelFactory.prototype._updateCloneModels=function(a,b){for(var d=0;d<a.clonedModelTypes.length;d++){var c=this._getObject(a.clonedModelTypes[d],a.getId());c&&c.setData(b)}};ModelFactory.prototype._addObject=function(a){var b=ModelFactory.classNameToType[a.getPersistedClass()];a.getId();this.data[b][a.getId()]=a};ModelFactory.prototype._getObject=function(a,b){return this.data[a][b]};
ModelFactory.prototype._createObject=function(a){a=new ModelFactory.classNameToJsClass[a];a.addListener(ModelFactory.listener);return a};
ModelFactory.prototype._getData=function(a,b,d){var c=this,e={iteration:{url:"ajax/iterationData.action",params:{iterationId:b},callback:c._constructIteration},iterations:{url:"ajax/retrieveAllSAIterations.action",params:{},callback:c._constructIterationList},ROIteration:{url:"ajax/ROIterationData.action",params:{readonlyToken:b},callback:c._constructIteration},project:{url:"ajax/projectData.action",params:{projectId:b},callback:c._constructProject},product:{url:"ajax/retrieveProduct.action",params:{productId:b},
callback:c._constructProduct},products:{url:"ajax/retrieveAllProducts.action",params:{},callback:c._constructProductList},dailyWork:{url:"ajax/dailyWorkData.action",params:{userId:b},callback:c._constructDailyWork},teams:{url:"ajax/retrieveAllTeams.action",params:{},callback:c._constructTeamList},users:{url:"ajax/retrieveAllUsers.action",params:{},callback:c._constructUserList},user:{url:"ajax/retrieveUser.action",params:{userId:b},callback:c._constructUser}};jQuery.getJSON(e[a].url,e[a].params,function(f,
h){if("success"!==h)return!1;var g=e[a].callback.call(c,b,f);d&&d(g)})};ModelFactory.prototype._initUsers=function(a){jQuery.ajax({type:"POST",dataType:"json",url:"ajax/retrieveAllUsers.action",async:!0,success:function(b,d){for(var c=0;c<b.length;c++)ModelFactory.updateObject(b[c]);a&&a(b)},error:function(a,d,c){MessageDisplay.ErrorMessage("Error loading users.",a)}})};
ModelFactory.prototype._initProjectPortfolio=function(a){var b=this;jQuery.ajax({type:"POST",dataType:"json",url:"ajax/projectPortfolioData.action",async:!0,success:function(d,c){var e=b._constructProjectPortfolioData(d);a&&a(e)},error:function(a,b,e){MessageDisplay.ErrorMessage("Error loading dashboard.",a)}})};ModelFactory.prototype._constructUserList=function(a,b){var d=new UserListContainer;d.setData(b);return ModelFactory.getInstance().rootObject=d};
ModelFactory.prototype._constructTeamList=function(a,b){for(var d=new TeamListContainer,c=0;c<b.length;c++){var e=ModelFactory.updateObject(b[c]);d.addRelation(e)}return ModelFactory.getInstance().rootObject=d};ModelFactory.prototype._constructProductList=function(a,b){for(var d=new AccessListContainer,c=0;c<b.length;c++){var e=ModelFactory.updateObject(b[c]);d.addRelation(e)}return ModelFactory.getInstance().rootObject=d};
ModelFactory.prototype._constructIterationList=function(a,b){for(var d=new AccessListContainer,c=0;c<b.length;c++){var e=ModelFactory.updateObject(b[c]);d.addRelation(e)}return ModelFactory.getInstance().rootObject=d};ModelFactory.prototype._constructProjectPortfolioData=function(a){var b=new PortfolioModel;b.setData(a);return ModelFactory.getInstance().rootObject=b};ModelFactory.prototype._constructUser=function(a,b){ModelFactory.getInstance().rootObject=ModelFactory.updateObject(b);return ModelFactory.getInstance().rootObject};
ModelFactory.prototype._constructIteration=function(a,b){ModelFactory.getInstance().rootObject=ModelFactory.updateObject(b);return ModelFactory.getInstance().rootObject};ModelFactory.prototype._constructProject=function(a,b){ModelFactory.getInstance().rootObject=ModelFactory.updateObject(b);return ModelFactory.getInstance().rootObject};ModelFactory.prototype._constructProduct=function(a,b){ModelFactory.getInstance().rootObject=ModelFactory.updateObject(b);return ModelFactory.getInstance().rootObject};
ModelFactory.prototype._constructDailyWork=function(a,b){var d=new DailyWorkModel;d.setData(b);return ModelFactory.getInstance().rootObject=d};ModelFactory.prototype._removeObject=function(a,b){this.data[a][b]&&delete this.data[a][b]};ModelFactory.listener=function(a){a instanceof DynamicsEvents.DeleteEvent&&ModelFactory.getInstance()._removeObject(ModelFactory.classNameToType[a.getObject().getPersistedClass()],a.getObject().getId());PageController.getInstance()&&PageController.getInstance().pageListener(a)};
ModelFactory.prototype.retrieveLazily=function(a,b,d,c){c=ModelFactory.typeToLazyLoadingUri[a];if(!c)throw new TypeError("Type "+a+" cannot be loaded lazily");var e={};e[c.idParam]=b;jQuery.getJSON(c.uri,e,function(c,e){var g=ModelFactory.updateObject(c);d(a,b,g)})};
var AccessListContainer=function(){this.initialize();this.persistedClassName="non.existent.ProductList";this.relations={product:[],iteration:[]};this.copiedFields={};this.classNameToRelation={"fi.hut.soberit.agilefant.model.Product":"product","fi.hut.soberit.agilefant.transfer.ProductTO":"product","fi.hut.soberit.agilefant.model.Iteration":"iteration","fi.hut.soberit.agilefant.transfer.IterationTO":"iteration"}};AccessListContainer.prototype=new CommonModel;
AccessListContainer.prototype._setData=function(a){a.products&&(this._updateRelations(ModelFactory.types.product,a),this._updateRelations(ModelFactory.types.iteration,a))};AccessListContainer.prototype.reload=function(){var a=this;jQuery.getJSON("ajax/retrieveAllProducts.action",{},function(b,c){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))});jQuery.getJSON("ajax/retrieveAllSAIterations.action",{},function(b,c){a.setData(b);a.callListeners(new DynamicsEvents.EditEvent(a))})};
AccessListContainer.prototype.getProducts=function(){return this.relations.product};AccessListContainer.prototype.getIterations=function(){return this.relations.iteration};
var CommonController=function(){};CommonController.createColumnIndices=function(a){var b,c={};for(b=0;b<a.length;b++)c[a[b]]=b;return c};CommonController.prototype.init=function(){this.childControllers={};this.autohideCells=[];this.attachModelListener()};CommonController.prototype.attachModelListener=function(){if(this.model){var a=this;this.modelListener=function(b){a.handleModelEvents(b)};this.model.addListener(this.modelListener)}};
CommonController.prototype.addChildController=function(a,b){this.childControllers[a]||(this.childControllers[a]=[]);this.childControllers[a].push(b)};CommonController.prototype.removeChildController=function(a,b){this.childControllers[a]&&ArrayUtils.remove(this.childControllers[a],b)};CommonController.prototype.callChildcontrollers=function(a,b){if(this.childControllers[a])for(var c=0;c<this.childControllers[a].length;c++)b.call(this.childControllers[a][c])};
CommonController.prototype.openRowEdit=function(){for(var a=0;a<this.autohideCells.length;a++){var b=this.autohideCells[a];(b=this.getCurrentView().getCell(b))&&b.show()}this.getCurrentView().openFullEdit()};CommonController.prototype.closeRowEdit=function(){if(this.model.getId()){for(var a=0;a<this.autohideCells.length;a++){var b=this.autohideCells[a];(b=this.getCurrentView().getCell(b))&&b.hide()}this.getCurrentView().closeRowEdit()}else this.getCurrentView().remove(),this.model.removeListener(this.modelListener)};
CommonController.prototype.handleModelEvents=function(a){};CommonController.prototype.pageControllerDispatch=function(a){};CommonController.prototype.getCurrentView=function(){return this.view};CommonController.prototype.getCurrentConfig=function(){throw Error("Abstract method call");};
var BacklogController=function(){};BacklogController.prototype=new CommonController;BacklogController.prototype.paintAssigneeList=function(){this.assigneeListView=new DynamicTable(this,this.model,this.assigneeListConfiguration,this.assigmentListElement);this.assigneeListView.render()};
BacklogController.prototype.selectSpentEffortTab=function(){this.hourEntryListElement&&(this.hourEntryListController?this.hourEntryListController.reload():this.hourEntryListController=new HourEntryListController({parentModel:this.model,hourEntryListElement:this.hourEntryListElement}))};BacklogController.prototype.addAssignees=function(){var a=this;$(window).autocompleteDialog({dataType:"usersAndTeams",callback:function(b){a._saveAssignees(b)},title:"Select assignees"})};
BacklogController.prototype._saveAssignees=function(a){this.model.addAssignments(a)};BacklogController.prototype.openLogEffort=function(){new SpentEffortWidget(this.model)};
BacklogController.prototype.initAssigneeConfiguration=function(){var a=new DynamicTableConfiguration({rowControllerFactory:BacklogController.prototype.assignmentControllerFactory,dataSource:BacklogModel.prototype.getAssignments,caption:"Backlog assignees"});a.addCaptionItem({name:"addAssignees",text:"Add assignees",cssClass:"create",callback:BacklogController.prototype.addAssignees});a.addColumnConfiguration(0,{minWidth:200,autoScale:!0,title:"User",get:AssignmentModel.prototype.getUser,decorator:DynamicsDecorators.userNameDecorator});
a.addColumnConfiguration(1,{minWidth:200,autoScale:!0,title:"Personal load",get:AssignmentModel.prototype.getPersonalLoad,decorator:DynamicsDecorators.totalPersonalLoadDecorator});a.addColumnConfiguration(2,{minWidth:200,autoScale:!0,title:"Personal load adjustment",get:AssignmentModel.prototype.getPersonalLoad,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,edit:{editor:"ExactEstimate",acceptNegative:!0,set:AssignmentModel.prototype.setPersonalLoad,decorator:DynamicsDecorators.exactEstimateEditDecorator}});
a.addColumnConfiguration(3,{minWidth:80,autoScale:!0,title:"Availability",get:AssignmentModel.prototype.getAvailability,editable:!0,edit:{editor:"Number",minVal:0,maxVal:100,set:AssignmentModel.prototype.setAvailability}});a.addColumnConfiguration(4,{minWidth:80,autoScale:!0,subViewFactory:BacklogController.prototype.deleteAssignmentButtonFactory});this.assigneeListConfiguration=a};
BacklogController.prototype.deleteAssignmentButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Delete",callback:AssignmentController.prototype.remove}],a)};BacklogController.prototype.assignmentControllerFactory=function(a,b){return new AssignmentController(b,a,this)};
var TaskController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init();this.autohideCells=["buttons"]};TaskController.columnNames="prio name state responsibles el oe es actions details buttons".split(" ");TaskController.columnIndices=CommonController.createColumnIndices(TaskController.columnNames);TaskController.prototype=new CommonController;
TaskController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a);a instanceof DynamicsEvents.MetricsEvent&&this.model.getParent()instanceof StoryModel&&this.model.getParent().reloadMetrics()};TaskController.prototype.sortAndMoveTask=function(a,b,c){a=a.getParentView().getModel();c?b.rankUnder(c.getId(),a):b.rankUnder(-1,a)};
TaskController.prototype.moveToIteration=function(){var a=this;$(window).autocompleteSingleDialog({dataType:"currentIterations",cancel:function(){},callback:function(b){a.model.moveToIteration(b)},title:"Select iteration to move to"})};TaskController.prototype.moveTask=function(a){this.model.rankUnder(-1,a)};
TaskController.prototype.toggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({collapse:TaskController.prototype.hideDetails,expand:TaskController.prototype.showDetails,expanded:!1},this,a)};TaskController.prototype.addToMyWorkQueue=function(){this.model.addToMyWorkQueue()};TaskController.prototype.removeFromMyWorkQueue=function(){this.model.removeFromMyWorkQueue()};
TaskController.prototype.removeTask=function(){var a=this;(new LazyLoadedFormDialog).init({title:"Delete task",url:"ajax/deleteTaskForm.action",data:{taskId:a.model.getId()},okCallback:function(b){a.model.remove(function(){a.parentController.removeChildController("task",this)},b)}})};TaskController.prototype.showDetails=function(){var a=this.view.getCellByName("details");a&&a.show()};TaskController.prototype.hideDetails=function(){var a=this.view.getCellByName("details");a&&a.hide()};
TaskController.prototype.openDetails=function(){new TaskInfoDialog(this.model)};TaskController.prototype.createSplitTask=function(){var a=this.parentController;new TaskSplitDialog(this.model,function(){a.model.reload()})};
TaskController.prototype.checkTaskAndCommit=function(a){var b=a.getChangedData(),c=a.getStory(),d=PageController.getInstance().getCurrentUser();b.state&&"IMPLEMENTED"===b.state&&0<a.currentData.effortLeft?this.clearEffortLeftWhenTaskReady(a):c&&b.state&&"ask"===d.getMarkStoryStarted()&&"NOT_STARTED"===c.getState()&&"NOT_STARTED"!==b.state&&"NOT_STARTED"===a.persistedData.state?this.markStoryAsStarted(a):a.commit()};
TaskController.prototype.markStoryAsStarted=function(a){new DynamicsConfirmationDialog("Mark the story started as well?","Do you want to mark the story started as well?",function(){a.currentData.storyToStarted=!0;a.commit()},function(){a.commit()})};TaskController.prototype.clearEffortLeftWhenTaskReady=function(a){new DynamicsConfirmationDialog("Set effort left to zero?","Story marked as ready. Set effort left to zero as well?",function(){a.currentData.effortLeft=0;a.commit()},function(){a.commit()})};
TaskController.prototype.actionColumnFactory=function(a,b){return new DynamicTableRowActions([{text:"Split",callback:TaskController.prototype.createSplitTask},{text:"Move",callback:TaskController.prototype.moveToIteration},{text:"Delete",callback:TaskController.prototype.removeTask},{text:"Append to my task queue",callback:TaskController.prototype.addToMyWorkQueue,enabled:TaskController.prototype.addToQueueEnabled},{text:"Remove from my task queue",callback:TaskController.prototype.removeFromMyWorkQueue,
enabled:TaskController.prototype.removeFromQueueEnabled},{text:"Spent effort",callback:TaskController.prototype.openLogEffort,enabled:function(){return Configuration.isTimesheetsEnabled()}},{text:"Reset original estimate",callback:TaskController.prototype.resetOriginalEstimate}],this,this.model,a)};TaskController.prototype.addToQueueEnabled=function(a,b){return"DONE"===a.getState()?!1:!a.isWorkingOnTask(PageController.getInstance().getCurrentUser())};
TaskController.prototype.removeFromQueueEnabled=function(a,b){return"DONE"===a.getState()?!1:a.isWorkingOnTask(PageController.getInstance().getCurrentUser())};TaskController.prototype.resetOriginalEstimate=function(){var a=this;new DynamicsConfirmationDialog("Reset original estimate?","Do you want to reset the task's original estimate?",function(){a.model.resetOriginalEstimate()})};TaskController.prototype.contextEditable=function(){return this.getCurrentView().isInRowEdit()?!0:!1};
TaskController.prototype.effortLeftEditable=function(){return"DONE"===this.model.getState()?!1:!0};TaskController.prototype.originalEstimateEditable=function(){return"DONE"===this.model.getState()?(MessageDisplay.Warning("Editing original estimate is not allowed for done tasks."),!1):this.model.getOriginalEstimate()||this.model.getEffortLeft()?(this.resetOriginalEstimate(),!1):!0};TaskController.prototype.isEditable=function(){return!0};
TaskController.prototype.openQuickLogEffort=function(a,b){null!==a.id&&this.openLogEffort()};TaskController.prototype.quickLogEffort=function(a){""!==a&&HourEntryModel.logEffortForCurrentUser(this,a)};TaskController.prototype.openLogEffort=function(){new SpentEffortWidget(this.model)};TaskController.prototype.taskDetailsFactory=function(a,b){return new TaskInfoWidget(b,this,a)};
var AssignmentController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};AssignmentController.prototype=new CommonController;AssignmentController.prototype.remove=function(a,b){this.model.remove()};AssignmentController.prototype.handleModelEvents=function(a){};AssignmentController.prototype.canEdit=function(){return 0<this.model.getId()};
var StoryController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init();this.autohideCells=["labels","description","buttons"]};StoryController.columnNames="priority labelsIcon id name value points state responsibles el es actions labels description buttons details tasksData".split(" ");StoryController.columnIndices=CommonController.createColumnIndices(StoryController.columnNames);StoryController.prototype=new CommonController;
StoryController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a);a instanceof DynamicsEvents.RelationUpdatedEvent&&("task"===a.getRelation()&&this.view)&&(this.model.reloadMetrics(),this.view.render());a instanceof DynamicsEvents.RankChanged&&("task"===a.getRankedType()&&this.taskListView)&&this.taskListView.resort();a instanceof DynamicsEvents.StoryTreeIntegrityViolation&&this._showMoveStoryOptions(a.getData(),a.getBacklogId());a instanceof
DynamicsEvents.NamedEvent&&"storyMoved"===a.getEventName()&&this._closeMoveDialog()};StoryController.prototype._closeMoveDialog=function(){this.currentMoveStoryDialog&&(this.currentMoveStoryDialog.dialog("destroy"),this.currentMoveStoryDialog.remove(),this.currentMoveStoryDialog=null)};
StoryController.prototype._confirmMoveStory=function(a,b){var c=this.currentMoveStoryDialog.find("input[type\x3dradio]:checked:eq(0)"),d=!1;this.currentMoveStoryDialog.find("input[type\x3dcheckbox]:checked:eq(0)").length&&(d=!0);c.length?("moveTargetStoryOnly"===c.val()?a?a.moveStoryOnly(b,d):this.model.moveStoryOnly(b,d):"moveTargetAndItsChildren"===c.val()&&(a?a.moveStoryAndChildren(b,d):this.model.moveStoryAndChildren(b,d)),this.currentMoveStoryDialog&&(this.currentMoveStoryDialog.dialog("destroy"),
this.currentMoveStoryDialog=null)):this.currentMoveStoryDialog.find("#please-select-an-option").show("blind")};StoryController.prototype._showMoveStoryOptions=function(a,b){this.currentMoveStoryDialog&&(this.currentMoveStoryDialog.dialog("option","title","Error in moving story!"),this.currentMoveStoryDialog.html(a))};
StoryController.prototype._openMoveStoryDialog=function(a,b,c){var d=this,e=$("\x3cdiv/\x3e").appendTo(document.body);this.currentMoveStoryDialog=e;var f="Moving story - please wait";c&&(f="Changing backlog - please wait");var g=e.dialog({modal:!0,title:f,width:600,minHeight:300,closeOnEscape:!1,buttons:{Cancel:function(){g.dialog("close")},Confirm:function(){a?d._confirmMoveStory(a,b):d._confirmMoveStory(null,b)}},close:function(){a?a.rollback():d.model.rollback();d._closeMoveDialog()}});e.html('\x3cdiv style\x3d"text-align:center;"\x3e\x3cimg src\x3d"static/img/pleasewait.gif" /\x3e\x3c/div\x3e')};
StoryController.prototype._moveStory=function(a){this._openMoveStoryDialog(null,a,!1);this.model.canMoveStory(a)&&this.model.moveStory(a)};StoryController.prototype._changeStoryBacklog=function(a){this._openMoveStoryDialog(null,a,!0);this.model.canMoveStory(a)&&this.model.moveStory(a)};StoryController.prototype.copyStorySibling=function(a){this.parentController.copyStorySibling(a)};StoryController.prototype.extractUnfinishedStorySibling=function(a){this.parentController.extractUnfinishedStorySibling(a)};
StoryController.prototype.removeStory=function(){var a=this;(new LazyLoadedFormDialog).init({title:"Delete story",url:"ajax/deleteStoryForm.action",data:{storyId:a.model.getId()},loadCallback:function(a){a.find("input[name\x3dtaskHandlingChoice]").click(function(){var a=$(this),b=a.parents(".deleteForm").find(".taskHourEntryHandling:eq(0)");"DELETE"==a.val()?(b.show(),b.find("input:eq(0)").attr("checked","checked")):"MOVE"==a.val()&&(b.hide(),b.find("input").removeAttr("checked"))})},okCallback:function(b){a.parentController?
a.model.remove(function(){a.parentController.removeChildController("story",a)},b):a.model.remove(null,b)}})};StoryController.prototype.editDescription=function(){var a=this.getCurrentView().getCellByName("description"),b=this.getCurrentView().getCellByName("tasksData"),c=b.isVisible();b.hide();a.show();a.openEditor(!1,function(){a.hide();c&&b.show()})};
StoryController.prototype.changeBacklog=function(){var a=this;$(window).autocompleteSingleDialog({dataType:"backlogs",cancel:function(){},callback:function(b){a._changeStoryBacklog(b)},title:"Select new backlog for story"})};StoryController.prototype.moveStory=function(){var a=this;$(window).autocompleteSingleDialog({dataType:"backlogsAndIterations",cancel:function(){},callback:function(b){a._moveStory(b)},title:"Select backlog to move to"});jQuery(".autocomplete-searchBoxContainer:eq(0) input").focus()};
StoryController.prototype.rankStory=function(a,b,c){var d=null,e=a.getParentView().getModel();c?b.rankUnder(c.getId(),e):(d=a.getParentView().getDataRowAt(1).getModel(),b.rankOver(d.getId(),e))};StoryController.prototype.moveStoryToBacklog=function(a){this.model.moveStory(a.getId())};StoryController.prototype.labelsViewFactory=function(a,b){return new LabelsView({},this,b,a)};StoryController.prototype.labelsIconFactory=function(a,b){return new LabelsIcon({},this,b,a)};
StoryController.prototype.storyDetailsFactory=function(a,b){return new StoryInfoWidget(b,this,a)};StoryController.prototype.storyTaskListFactory=function(a,b){$('\x3cdiv class\x3d"ruler"\x3e\x26nbsp;\x3c/div\x3e').appendTo(a.getElement());var c=$("\x3cdiv/\x3e").appendTo(a.getElement());return this.taskListView=new DynamicTable(this,this.model,StoryController.taskListConfig,c)};
StoryController.prototype.showTaskColumn=function(){var a=this.getCurrentView().getCellByName("tasksData"),b=this.getCurrentView().getCell("details");a&&a.show();b&&b.show()};StoryController.prototype.hideTaskColumn=function(){var a=this.getCurrentView().getCellByName("tasksData"),b=this.getCurrentView().getCell("details");a&&a.hide();b&&b.hide()};StoryController.prototype.showDescriptionColumn=function(){this.getCurrentView().getElement().addClass("bottom-margin")};
StoryController.prototype.hideDescriptionColumn=function(){this.getCurrentView().getElement().removeClass("bottom-margin")};StoryController.prototype.showTasks=function(){this.toggleView.expand()};StoryController.prototype.hideTasks=function(){this.toggleView.collapse()};StoryController.prototype.taskControllerFactory=function(a,b){var c=new TaskController(b,a,this);this.addChildController("task",c);return c};
StoryController.prototype.createTask=function(){var a=ModelFactory.createObject(ModelFactory.types.task);a.setStory(this.model);var b=PageController.getInstance().getCurrentUser();b.isAutoassignToTasks()&&a.addResponsible(b.getId());b=new TaskController(a,null,this);a=this.taskListView.createRow(b,a,"top");b.view=a;a.autoCreateCells([TaskController.columnIndices.prio,TaskController.columnIndices.actions]);a.render();b.openRowEdit()};
StoryController.prototype.taskToggleFactory=function(a,b){var c=this;return this.toggleView=new DynamicTableToggleView({collapse:function(){c.getCurrentView().getElement().removeClass("bottom-margin")},expand:function(){c.getCurrentView().getElement().addClass("bottom-margin")},expanded:!1,targetCells:["tasksData","details"]},this,a)};
StoryController.prototype.descriptionToggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({collapse:StoryController.prototype.hideDescriptionColumn,expand:StoryController.prototype.showDescriptionColumn,expanded:!1,targetCells:["details"]},this,a)};StoryController.prototype.rankStoryToTop=function(a,b){a.rankToTop(this.parentController.model)};StoryController.prototype.rankStoryToBottom=function(a,b){a.rankToBottom(this.parentController.model)};
StoryController.prototype._getStoryActionItems=function(a){a=[];a.push({text:"Move",callback:StoryController.prototype.moveStory});this.parentController instanceof StoryListController&&(a.push({text:"Copy",callback:StoryController.prototype.copyStorySibling}),a.push({text:"Extract unfinished",tooltip:"Creates a new story and moved the unfinished tasks (status other than Ready or Done) to it",callback:StoryController.prototype.extractUnfinishedStorySibling}));Configuration.isTimesheetsEnabled()&&a.push({text:"Spent effort",
callback:StoryController.prototype.openLogEffort});a.push({text:"Delete",callback:StoryController.prototype.removeStory});return a};StoryController.prototype.projectStoryActionFactory=function(a,b){var c=this._getStoryActionItems(!0);return new DynamicTableRowActions(c,this,this.model,a)};StoryController.prototype.storyActionFactory=function(a,b){var c=this._getStoryActionItems(!1);return new DynamicTableRowActions(c,this,this.model,a)};
StoryController.prototype.rankToTopAction=function(a,b){return new DynamicTableRowButton({label:"To top",callback:StoryController.prototype.rankStoryToTop},this,this.model,a,50)};StoryController.prototype.rankToBottomAction=function(a,b){return new DynamicTableRowButton({label:"To bottom",callback:StoryController.prototype.rankStoryToBottom},this,this.model,a,70)};StoryController.prototype.acceptsDraggable=function(a){return a instanceof TaskModel?!0:!1};StoryController.prototype.openLogEffort=function(){new SpentEffortWidget(this.model)};
StoryController.prototype.openQuickLogEffort=function(a,b){this.openLogEffort()};StoryController.prototype.quickLogEffort=function(a){""!==a&&HourEntryModel.logEffortForCurrentUser(this,a)};
StoryController.prototype.searchForTask=function(){if(window.location.hash){var a=window.location.hash,a=a.substring(a.lastIndexOf("_")+1),b=this;if(this.childControllers.task)for(var c=0;c<this.childControllers.task.length;c++)if(this.childControllers.task[c].model.id==a){a=this.childControllers.task[c].view;setTimeout(function(){b.showTasks()},0);a=a.getElement().offset();jQuery("#bodyWrapper").scrollTop(a.top-jQuery("#bodyWrapper").offset().top);break}}};
(function(){var a=new DynamicTableConfiguration({rowControllerFactory:StoryController.prototype.taskControllerFactory,dataSource:StoryModel.prototype.getTasks,dataType:"task",caption:"Tasks",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},sortCallback:TaskController.prototype.sortAndMoveTask,cssClass:"corner-border task-table dynamicTable-sortable-tasklist",sortOptions:{items:"\x3e .dynamicTableDataRow",handle:"."+DynamicTable.cssClasses.dragHandle,connectWith:".dynamicTable-sortable-tasklist \x3e .ui-sortable"},
beforeCommitFunction:TaskController.prototype.checkTaskAndCommit});a.addCaptionItem({name:"createTask",text:"Create task",cssClass:"createTask",visible:!0,callback:StoryController.prototype.createTask});a.addColumnConfiguration(TaskController.columnIndices.prio,{minWidth:24,autoScale:!0,cssClass:"task-row",title:"#",headerTooltip:"Priority",sortCallback:DynamicsComparators.valueComparatorFactory(TaskModel.prototype.getRank),defaultSortColumn:!0,subViewFactory:TaskController.prototype.toggleFactory});
a.addColumnConfiguration(TaskController.columnIndices.name,{minWidth:180,autoScale:!0,cssClass:"task-row",title:"Name",headerTooltip:"Task name",get:TaskModel.prototype.getName,editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Text",set:TaskModel.prototype.setName,required:!0}});a.addColumnConfiguration(TaskController.columnIndices.state,{minWidth:80,autoScale:!0,cssClass:"task-row",title:"State",headerTooltip:"Task state",get:TaskModel.prototype.getState,decorator:DynamicsDecorators.taskStateColorDecorator,
editable:!0,edit:{editor:"Selection",set:TaskModel.prototype.setState,items:DynamicsDecorators.stateOptions}});a.addColumnConfiguration(TaskController.columnIndices.responsibles,{minWidth:60,autoScale:!0,cssClass:"task-row",title:"Responsibles",headerTooltip:"Task responsibles",get:TaskModel.prototype.getResponsibles,getView:TaskModel.prototype.getAnnotatedResponsibles,decorator:DynamicsDecorators.annotatedUserInitialsListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",
dialogTitle:"Select users",dataType:"usersAndTeams",set:TaskModel.prototype.setResponsibles}});a.addColumnConfiguration(TaskController.columnIndices.el,{minWidth:30,autoScale:!0,cssClass:"task-row",title:"Left",headerTooltip:"Effort left in man-hours",get:TaskModel.prototype.getEffortLeft,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,editableCallback:TaskController.prototype.effortLeftEditable,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,
set:TaskModel.prototype.setEffortLeft}});Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(TaskController.columnIndices.es,{minWidth:30,autoScale:!0,cssClass:"task-row",title:"Spent",headerTooltip:"Effort spent in man-hours",get:TaskModel.prototype.getEffortSpent,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!1,visualizedEditable:!0,onClick:TaskController.prototype.openQuickLogEffort,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.empty,set:TaskController.prototype.quickLogEffort}});
a.addColumnConfiguration(TaskController.columnIndices.actions,{minWidth:35,autoScale:!0,cssClass:"task-row",title:"Edit",subViewFactory:TaskController.prototype.actionColumnFactory});a.addColumnConfiguration(TaskController.columnIndices.details,{columnName:"details",fullWidth:!0,visible:!1,targetCell:TaskController.columnIndices.details,subViewFactory:TaskController.prototype.taskDetailsFactory,delayedRender:!0});a.addColumnConfiguration(TaskController.columnIndices.buttons,{columnName:"buttons",
fullWidth:!0,visible:!1,cssClass:"task-row",subViewFactory:DynamicsButtons.commonButtonFactory});StoryController.taskListConfig=a})();StoryController.prototype.contextEditable=function(){return this.getCurrentView().isInRowEdit()?!0:!1};
var IterationController=function(a){this.id=a.id;this.storyListElement=a.storyListElement;this.iterationInfoElement=a.backlogDetailElement;this.assigmentListElement=a.assigmentListElement;this.taskListElement=a.taskListElement;this.hourEntryListElement=a.hourEntryListElement;this.metricsElement=a.metricsElement;this.smallBurndownElement=a.smallBurndownElement;this.burndownElement=a.burndownElement;this.tabs=a.tabs;this.historyElement=a.historyElement;this.init();this.initAssigneeConfiguration();this.initIterationInfoConfig();
this.initialize();var b=this;this.tabs.bind("tabsselect",function(a,d){1===d.index&&b.selectAssigneesTab()});window.pageController.setMainController(this)};IterationController.columnNames="name reference startDate endDate plannedSize baselineLoad assignees description".split(" ");IterationController.columnIndices=CommonController.createColumnIndices(IterationController.columnNames);
IterationController.columnConfigs={name:{title:"Name",get:IterationModel.prototype.getName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,visualizeRequired:!0,set:IterationModel.prototype.setName}},reference:{title:"Reference ID",get:BacklogModel.prototype.getId,decorator:DynamicsDecorators.quickReference},startDate:{title:"Start Date",get:IterationModel.prototype.getStartDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Date",size:"18ex",
decorator:DynamicsDecorators.dateTimeDecorator,required:!0,visualizeRequired:!0,withTime:!0,set:IterationModel.prototype.setStartDate}},endDate:{title:"End Date",get:IterationModel.prototype.getEndDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,required:!0,visualizeRequired:!0,withTime:!0,size:"18ex",set:IterationModel.prototype.setEndDate}},plannedSize:{title:"Planned Size",get:IterationModel.prototype.getBacklogSize,
decorator:DynamicsDecorators.exactEstimateAppendManHourDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"10ex",set:IterationModel.prototype.setBacklogSize}},baselineLoad:{title:"Baseline load",get:IterationModel.prototype.getBaselineLoad,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"10ex",
set:IterationModel.prototype.setBaselineLoad}},assignees:{title:"Iteration assignees",headerTooltip:"Iteration assignees",get:BacklogModel.prototype.getAssignees,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:BacklogModel.prototype.setAssignees}},description:{title:"Description",get:IterationModel.prototype.getDescription,editable:!0,visualizedEditable:!0,decorator:DynamicsDecorators.emptyDescriptionDecorator,
edit:{editor:"Wysiwyg",set:IterationModel.prototype.setDescription}}};IterationController.prototype=new BacklogController;
IterationController.prototype.removeIteration=function(){var a=this,b=new LazyLoadedFormDialog;b.init({title:"Delete iteration",url:"ajax/deleteIterationForm.action",disableClose:!0,data:{IterationId:a.model.getId()},okCallback:function(b){if((b=b.confirmationString)&&"yes"==b.toLowerCase())window.location.href="deleteIteration.action?confirmationString\x3dyes\x26iterationId\x3d"+a.model.getId()},closeCallback:function(){b.close()}})};
IterationController.prototype.shareIteration=function(){var a=this,b=new LazyLoadedFormDialog,c=a.model.getReadonlyToken();c?b.init({title:"Share Iteration",url:"ajax/shareIterationForm.action",hideCancelButton:!0,data:{IterationId:a.model.getId(),ReadonlyToken:c}}):jQuery.ajax({type:"POST",url:"ajax/createReadonlyToken.action",async:!1,cache:!1,data:{IterationId:a.model.getId()},dataType:"json",success:function(d,f){b.init({title:"Share Iteration",url:"ajax/shareIterationForm.action",hideCancelButton:!0,
data:{IterationId:a.model.getId(),ReadonlyToken:c}});ModelFactory.updateObject(d)},error:function(b,c,e){MessageDisplay.Error("Error creating read only link",b);a.rollback()}})};
IterationController.prototype.unshareIteration=function(){var a=this,b=new LazyLoadedFormDialog;a.model.getReadonlyToken()?b.init({title:"Unshare iteration",url:"ajax/unshareIterationForm.action",data:{IterationId:a.model.getId()},okCallback:function(b){jQuery.ajax({type:"POST",url:"ajax/clearReadonlyToken.action",async:!1,cache:!1,data:{IterationId:a.model.getId()},dataType:"json",success:function(b,c){MessageDisplay.Ok("Share link removed");a.model.setReadonlyToken(null)},error:function(b,c,e){MessageDisplay.Error("Error unsharing read only link",
b);a.rollback()}})},closeCallback:function(){b.close()}}):MessageDisplay.Warning("Iteration currently does not have read only URL.")};IterationController.prototype.openLogEffort=function(){new SpentEffortWidget(this.model,jQuery.proxy(function(){this.reloadMetricsBox()},this))};IterationController.prototype.pageControllerDispatch=function(a){a instanceof DynamicsEvents.AddEvent&&(a.getObject()instanceof TaskModel||a.getObject()instanceof StoryModel)&&this.reloadMetrics()};
IterationController.prototype.handleModelEvents=function(a){if(a instanceof DynamicsEvents.MetricsEvent||a instanceof DynamicsEvents.RelationUpdatedEvent)a.getObject()instanceof TaskModel?this.reloadMetrics():a.getObject()instanceof StoryModel?this.reloadMetricsBox():a instanceof DynamicsEvents.RelationUpdatedEvent&&(a.getObject()instanceof IterationModel&&"story"===a.getRelation())&&this.reloadMetricsBox()};
IterationController.prototype.isAssigneesTabSelected=function(){return 1===this.tabs.tabs("option","selected")};IterationController.prototype.paintIterationInfo=function(){this.iterationInfoView=new DynamicVerticalTable(this,this.model,this.iterationDetailConfig,this.iterationInfoElement);this.iterationInfoView.render()};
IterationController.prototype.reloadBurndown=function(){var a=this.burndownElement.attr("src");this.burndownElement.attr("src",a+"#");a=this.smallBurndownElement.attr("src");this.smallBurndownElement.attr("src",a+"#")};IterationController.prototype.reloadMetricsBox=function(){this.metricsElement.load("ajax/iterationMetrics.action",{iterationId:this.id});this.reloadBurndown();document.body.style.cursor="default"};
IterationController.prototype.reloadMetrics=function(){this.reloadBurndown();this.reloadMetricsBox();this.isAssigneesTabSelected()&&this.selectAssigneesTab()};IterationController.prototype.initializeStoryList=function(){this.storyListController=new StoryListController(this.model,this.storyListElement,this)};IterationController.prototype.initializeTaskList=function(){this.tasksWithoutStoryController=new TasksWithoutStoryController(this.model,this.taskListElement,this)};
IterationController.prototype.initialize=function(){var a=this,b=$("#iterationLoadingOverlay");b.fadeIn();b.show();ModelFactory.initializeFor(ModelFactory.initializeForTypes.iteration,this.id,function(b){a.model=b;a.attachModelListener();a.paintIterationInfo();a.initializeStoryList();a.initializeTaskList();jQuery("#iterationPleasewait").remove()});this.assigneeContainer=new AssignmentContainer(this.id);this.assigneeListView=new DynamicTable(this,this.assigneeContainer,this.assigneeListConfiguration,
this.assigmentListElement)};IterationController.prototype.selectAssigneesTab=function(){this.assigneeContainer.reload()};
IterationController.prototype.initIterationInfoConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"79%",closeRowCallback:null,validators:[BacklogModel.Validators.dateValidator]});a.addColumnConfiguration(IterationController.columnIndices.name,IterationController.columnConfigs.name);a.addColumnConfiguration(IterationController.columnIndices.reference,IterationController.columnConfigs.reference);a.addColumnConfiguration(IterationController.columnIndices.startDate,IterationController.columnConfigs.startDate);
a.addColumnConfiguration(IterationController.columnIndices.endDate,IterationController.columnConfigs.endDate);a.addColumnConfiguration(IterationController.columnIndices.plannedSize,IterationController.columnConfigs.plannedSize);a.addColumnConfiguration(IterationController.columnIndices.baselineLoad,IterationController.columnConfigs.baselineLoad);a.addColumnConfiguration(IterationController.columnIndices.assignees,IterationController.columnConfigs.assignees);a.addColumnConfiguration(IterationController.columnIndices.description,
IterationController.columnConfigs.description);this.iterationDetailConfig=a};
IterationController.prototype.initAssigneeConfiguration=function(){var a=new DynamicTableConfiguration({rowControllerFactory:BacklogController.prototype.assignmentControllerFactory,dataSource:AssignmentContainer.prototype.getAssignments,caption:"Iteration workload by user"});a.addColumnConfiguration(0,{minWidth:150,autoScale:!0,title:"User",get:AssignmentModel.prototype.getUser,defaultSortColumn:!0,sortCallback:DynamicsComparators.valueComparatorFactory(AssignmentModel.prototype.getId),decorator:DynamicsDecorators.conditionColorDecorator(AssignmentModel.prototype.isUnassigned,
function(a){if(a)return"red"},DynamicsDecorators.userNameDecorator)});a.addColumnConfiguration(1,{minWidth:100,autoScale:!0,title:"Iteration availability",get:AssignmentModel.prototype.getAvailability,decorator:DynamicsDecorators.appendDecoratorFactory("%"),editableCallback:AssignmentController.prototype.canEdit,editable:!0,visualizedEditable:!0,edit:{editor:"Number",minVal:0,maxVal:100,set:AssignmentModel.prototype.setAvailability}});a.addColumnConfiguration(2,{minWidth:100,autoScale:!0,title:"Personal adjustment",
get:AssignmentModel.prototype.getPersonalLoad,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",acceptNegative:!0,set:AssignmentModel.prototype.setPersonalLoad,decorator:DynamicsDecorators.exactEstimateEditDecorator}});a.addColumnConfiguration(3,{minWidth:100,autoScale:!0,title:"Assigned effort sum",get:AssignmentModel.prototype.getAssignedLoad,decorator:DynamicsDecorators.exactEstimateEditDecorator});a.addColumnConfiguration(4,{minWidth:100,
autoScale:!0,title:"Unassigned effort sum",get:AssignmentModel.prototype.getUnassignedLoad,decorator:DynamicsDecorators.exactEstimateEditDecorator});this.assigneeListConfiguration=a};
var StoryListController=function(a,b,c){this.model=a;this.element=b;this.parentController=c;this.init();this.initConfig();this.initializeView()};StoryListController.prototype=new CommonController;StoryListController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a);if(a instanceof DynamicsEvents.RankChanged&&"story"===a.getRankedType()){var b=this;this.model.reloadStoryRanks(function(){b.getCurrentView().resort()})}};
StoryListController.prototype.initializeView=function(){this.view=new DynamicTable(this,this.model,this.getCurrentConfig(),this.element);this.view.render()};StoryListController.prototype.getCurrentConfig=function(){return this.storyListConfig};StoryListController.prototype.initConfig=function(){this.storyListConfig=this._getTableConfig();this._addColumnConfigs(this.storyListConfig)};
StoryListController.prototype.filterStoriesByState=function(a){var b=this,c=function(a){return!b.stateFilters||-1!==jQuery.inArray(a.getState(),b.stateFilters)},d=new StateFilterWidget(a,{bubbleOptions:{title:"Filter by state",offsetX:-15,minWidth:100,minHeight:20},callback:function(a){b.stateFilters=d.getFilter();a?(b.getCurrentView().activateColumnFilter("State"),b.getCurrentView().setFilter(c)):(b.getCurrentView().disableColumnFilter("State"),b.getCurrentView().setFilter(null));b.getCurrentView().filter()},
activeStates:b.stateFilters})};StoryListController.prototype.storyControllerFactory=function(a,b){var c=new StoryController(b,a,this);this.addChildController("story",c);return c};
StoryListController.prototype.createStory=function(){var a=ModelFactory.createObject(ModelFactory.types.story);a.setBacklog(this.model);var b=PageController.getInstance().getCurrentUser();b.isAutoassignToStories()&&a.setResponsibles([b.getId()]);b=new StoryController(a,null,this);a=this.getCurrentView().createRow(b,a,"top");b.view=a;a.autoCreateCells([StoryController.columnIndices.priority,StoryController.columnIndices.labels,StoryController.columnIndices.actions,StoryController.columnIndices.tasksData]);
a.render();b.openRowEdit();a.getCellByName("tasksData").hide()};StoryListController.prototype.copyStorySibling=function(a){var b=ModelFactory.createObject(ModelFactory.types.story);b.setIteration(this.model);b._copyStory(a)};StoryListController.prototype.extractUnfinishedStorySibling=function(a){var b=ModelFactory.createObject(ModelFactory.types.story);b.setIteration(this.model);b._extractUnfinishedStory(a)};StoryListController.prototype.showTasks=function(){this.callChildcontrollers("story",StoryController.prototype.showTasks)};
StoryListController.prototype.hideTasks=function(){this.callChildcontrollers("story",StoryController.prototype.hideTasks)};
StoryListController.prototype.confirmTasksToDone=function(a){var b=a.getChangedData(),c=a.getTasks();if(b.state&&"DONE"===b.state&&0<c.length){for(var b=!1,d=0;d<c.length;d++)"DONE"!==c[d].getState()&&(b=!0);b?new DynamicsConfirmationDialog("Set all tasks' states to done?","Do you want to mark all tasks as done as well?",function(){a.currentData.tasksToDone=!0;a.commit()},function(){a.commit()}):a.commit()}else a.commit()};
StoryListController.prototype.firstRenderComplete=function(){if(window.location.hash){var a=this.view.getRowById(window.location.hash.substring(1));if(a)a.getController().showTasks(),a=a.getElement().offset(),jQuery("#bodyWrapper").scrollTop(a.top-jQuery("#bodyWrapper").offset().top);else if(a=StoryController.prototype.showTasks,this.childControllers.story)for(var b=0;b<this.childControllers.story.length;b++)if(a.call(this.childControllers.story[b]),StoryController.prototype.searchForTask.call(this.childControllers.story[b]),
window.location.hash)StoryController.prototype.hideTasks.call(this.childControllers.story[b]);else break}};
StoryListController.prototype._getTableConfig=function(){var a=new DynamicTableConfiguration({rowControllerFactory:StoryListController.prototype.storyControllerFactory,dataSource:IterationModel.prototype.getStories,sortCallback:StoryController.prototype.rankStory,caption:"Stories",dataType:"story",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"ui-widget-content ui-corner-all iteration-story-table",rowDroppable:!0,dropOptions:{callback:TaskController.prototype.moveTask,
accepts:StoryController.prototype.acceptsDraggable},beforeCommitFunction:StoryListController.prototype.confirmTasksToDone,afterFirstRender:$.proxy(function(){this.firstRenderComplete()},this)});a.addCaptionItem({name:"createStory",text:"Create story",cssClass:"create",callback:StoryListController.prototype.createStory});a.addCaptionItem({name:"showTasks",text:"Show tasks",connectWith:"hideTasks",cssClass:"hide",visible:!0,callback:StoryListController.prototype.showTasks});a.addCaptionItem({name:"hideTasks",
text:"Hide tasks",visible:!1,connectWith:"showTasks",cssClass:"show",callback:StoryListController.prototype.hideTasks});return a};
StoryListController.prototype._addColumnConfigs=function(a){a.addColumnConfiguration(StoryController.columnIndices.priority,StoryListController.columnConfig.prio);Configuration.isLabelsInStoryList()&&a.addColumnConfiguration(StoryController.columnIndices.labelsIcon,StoryListController.columnConfig.labelsIcon);a.addColumnConfiguration(StoryController.columnIndices.id,StoryListController.columnConfig.id);a.addColumnConfiguration(StoryController.columnIndices.name,StoryListController.columnConfig.name);
a.addColumnConfiguration(StoryController.columnIndices.value,StoryListController.columnConfig.value);a.addColumnConfiguration(StoryController.columnIndices.points,StoryListController.columnConfig.points);a.addColumnConfiguration(StoryController.columnIndices.state,StoryListController.columnConfig.state);a.addColumnConfiguration(StoryController.columnIndices.responsibles,StoryListController.columnConfig.responsibles);a.addColumnConfiguration(StoryController.columnIndices.el,StoryListController.columnConfig.effortLeft);
Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(StoryController.columnIndices.es,StoryListController.columnConfig.effortSpent);a.addColumnConfiguration(StoryController.columnIndices.actions,StoryListController.columnConfig.actions);a.addColumnConfiguration(StoryController.columnIndices.labels,StoryListController.columnConfig.labels);a.addColumnConfiguration(StoryController.columnIndices.description,StoryListController.columnConfig.description);a.addColumnConfiguration(StoryController.columnIndices.buttons,
StoryListController.columnConfig.buttons);a.addColumnConfiguration(StoryController.columnIndices.details,StoryListController.columnConfig.details);a.addColumnConfiguration(StoryController.columnIndices.tasksData,StoryListController.columnConfig.tasks)};StoryListController.columnConfig={};StoryListController.columnConfig.prio={minWidth:24,autoScale:!0,title:"#",headerTooltip:"Priority",sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getRank),defaultSortColumn:!0,subViewFactory:StoryController.prototype.taskToggleFactory};
StoryListController.columnConfig.id={minWidth:30,autoScale:!0,title:"ID",headerTooltip:"Story ID",get:CommonModel.prototype.getId,decorator:DynamicsDecorators.storyIdWithHash,editable:!1};StoryListController.columnConfig.labelsIcon={minWidth:40,autoScale:!0,title:"Labels",headerTooltip:"Story's labels",subViewFactory:StoryController.prototype.labelsIconFactory};
StoryListController.columnConfig.labels={columnName:"labels",fullWidth:!0,visible:!1,get:StoryModel.prototype.getLabels,editable:!0,edit:{editor:"Labels",showText:!0,set:StoryModel.prototype.setLabels}};
StoryListController.columnConfig.name={minWidth:200,autoScale:!0,title:"Name",headerTooltip:"Story name",get:StoryModel.prototype.getName,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getName),editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Text",set:StoryModel.prototype.setName,required:!0}};
StoryListController.columnConfig.points={minWidth:50,autoScale:!0,title:"Points",headerTooltip:"Estimate in story points",get:StoryModel.prototype.getStoryPoints,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryPoints),decorator:DynamicsDecorators.estimateDecorator,editable:!0,visualizedEditable:!0,editableCallback:StoryController.prototype.storyValueOrPointsEditable,edit:{editor:"Estimate",set:StoryModel.prototype.setStoryPoints}};
StoryListController.columnConfig.value={minWidth:50,autoScale:!0,title:"Value",headerTooltip:"Give a story value",get:StoryModel.prototype.getStoryValue,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryValue),decorator:DynamicsDecorators.estimateDecorator,editable:!0,visualizedEditable:!0,editableCallback:StoryController.prototype.storyValueOrPointsEditable,edit:{editor:"StoryValue",set:StoryModel.prototype.setStoryValue}};
StoryListController.columnConfig.state={minWidth:70,autoScale:!0,title:"State",headerTooltip:"Story state",get:StoryModel.prototype.getState,decorator:DynamicsDecorators.storyStateColorDecorator,filter:StoryListController.prototype.filterStoriesByState,editable:!0,edit:{editor:"Selection",set:StoryModel.prototype.setState,items:DynamicsDecorators.stateOptions}};
StoryListController.columnConfig.responsibles={minWidth:60,autoScale:!0,title:"Responsibles",headerTooltip:"Story responsibles",get:StoryModel.prototype.getResponsibles,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:StoryModel.prototype.setResponsibles}};
StoryListController.columnConfig.effortLeft={minWidth:30,autoScale:!0,cssClass:"sum-column",title:"Left",headerTooltip:"Total sum of stories' tasks' effort left estimates in man-hours",decorator:DynamicsDecorators.exactEstimateSumDecorator,get:StoryModel.prototype.getTotalEffortLeft};
StoryListController.columnConfig.effortSpent={minWidth:30,autoScale:!0,title:"Spent",headerTooltip:"Total task effort spent in man-hours",decorator:DynamicsDecorators.exactEstimateDecorator,get:StoryModel.prototype.getTotalEffortSpent,editable:!1,visualizedEditable:!0,onClick:StoryController.prototype.openQuickLogEffort,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.empty,set:StoryController.prototype.quickLogEffort}};
StoryListController.columnConfig.actions={minWidth:33,autoScale:!0,title:"Edit",subViewFactory:StoryController.prototype.storyActionFactory};StoryListController.columnConfig.description={columnName:"description",fullWidth:!0,visible:!1,get:StoryModel.prototype.getDescription,decorator:DynamicsDecorators.emptyDescriptionDecorator,editable:!0,edit:{editor:"Wysiwyg",set:StoryModel.prototype.setDescription}};StoryListController.columnConfig.buttons={columnName:"buttons",fullWidth:!0,visible:!1,subViewFactory:DynamicsButtons.commonButtonFactory};
StoryListController.columnConfig.details={columnName:"details",fullWidth:!0,visible:!1,targetCell:StoryController.columnIndices.details,subViewFactory:StoryController.prototype.storyDetailsFactory,delayedRender:!0};StoryListController.columnConfig.tasks={columnName:"tasksData",fullWidth:!0,visible:!1,cssClass:"story-task-container",targetCell:StoryController.columnIndices.tasksData,subViewFactory:StoryController.prototype.storyTaskListFactory,delayedRender:!0};
var ProductController=function(a){this.id=a.id;this.productDetailsElement=a.productDetailsElement;this.projectListElement=a.projectListElement;this.iterationListElement=a.iterationListElement;this.assigmentListElement=a.assigmentListElement;this.hourEntryListElement=a.hourEntryListElement;this.backlogsContainer=a.backlogsElement;this.backlogsElement=this.backlogsContainer.find(".content");this.backlogsOverlay=this.backlogsContainer.find(".loadingOverlay");this.storyTreeElement=a.storyTreeElement;
this.tabs=a.tabs;var c=this;this.textFilterElement=a.textFilterElement;this.textFilter=new SearchByTextWidget($("#searchByText"),{searchCallback:function(){c.filter()}});this.init();this.initializeProductDetailsConfig();this.initializeProjectListConfig();this.initAssigneeConfiguration();this.changeTabIfFragmentFound();this.paint();window.pageController.setMainController(this)};ProductController.prototype=new BacklogController;
ProductController.prototype.filter=function(){var a=this.tabs.tabs("option","selected");0===a?this.storyTreeController.filter(this.getTextFilter(),this.getStateFilters()):1===a?this.filterLeafStories():2===a&&this.projectListView.filter()};ProductController.prototype.getStateFilters=function(){return this.storyTreeController.storyFilters.statesToKeep};ProductController.prototype.getTextFilter=function(){return this.textFilter.getValue()};
ProductController.prototype.paintStoryTree=function(){this.storyTreeController||(this.storyTreeController=new StoryTreeController(this.id,"product",this.storyTreeElement,{},this));this.storyTreeController.refresh()};ProductController.prototype.projectRowControllerFactory=function(a,c){var b=new ProjectRowController(c,a,this);this.addChildController("project",b);return b};
ProductController.prototype.paintProductDetails=function(){this.productDetailsView=new DynamicVerticalTable(this,this.model,this.productDetailConfig,this.productDetailsElement);this.productDetailsView.render()};ProductController.prototype.pageControllerDispatch=function(a){a instanceof DynamicsEvents.AddEvent&&(a=this.tabs.tabs("option","selected"),0===a&&this.paintStoryTree(),1===a&&this.paintLeafStories(),2===a&&this.paintProjectList())};
ProductController.prototype.paintLeafStories=function(){var a=this;this.backlogsOverlay.fadeIn();this.backlogsElement.load("ajax/productBacklogView.action?productId\x3d"+this.id,jQuery.proxy(function(){this.backlogsOverlay.fadeOut();this.backlogsElement.find(".widgetList \x3e li").each(function(){var a=$(this).hasClass("staticWidget");$(this).aefWidget({ajaxWidget:!1,initialReload:!1,realWidget:!a})});this.backlogsElement.find(".storyList \x3e li").draggable({connectWith:".storyList",placeholder:"placeholder",
appendTo:"body",helper:function(a,b){return $("\x3cdiv/\x3e").css({width:"200px","white-space":"normal",background:"white",padding:"0.5em",border:"1px dashed #ccc"}).html($(a.target).html()).get(0)},containment:"document",dropOnEmpty:!0,revert:"invalid"}).each(function(){$(this).click(function(){var a=StoryTreeController.prototype._getStoryForId,b=$(this).attr("storyid"),d=$(this);new StoryInfoBubble(b,{_getStoryForId:a,refreshNode:function(){a(b,function(a){var b=a.currentData.state,c={NOT_STARTED:"N",
STARTED:"I",PENDING:"P",BLOCKED:"B",IMPLEMENTED:"R",DONE:"D",DEFERRED:"D"}[b],h=DynamicsDecorators.stateOptions[b],b=$("\x3cspan/\x3e").addClass("inlineStoryState").addClass("storyState"+b).attr("title",h).text(c);d.empty().append(b).append(" "+a.currentData.name)})},createNode:function(){},removeNode:function(){d.remove()},mock:!0},d,{offsetX:0})})});this.backlogsElement.find(".droppableWidget").droppable({hoverClass:"ui-droppable-widget-hover",drop:function(c,b){var d=b.draggable.attr("storyid"),
e=$(this).attr("backlogid"),g=b.draggable.parents(".storyList:eq(0)"),f=b.draggable.next();a.moveStory(d,e,$.proxy(function(){f?b.draggable.insertBefore(f):b.draggable.appendTo(g)},this));b.draggable.appendTo($(this).find(".storyList"));return!0},over:function(a,b){}})},this))};ProductController.prototype.filterLeafStories=function(){var a=this.getTextFilter();this.backlogsElement.find(".storyList li").show().not(":contains("+a+")").hide()};
ProductController.prototype.moveStory=function(a,c,b){var d=function(){jQuery.ajax({url:"ajax/moveStory.action",data:{storyId:a,backlogId:c},dataType:"json",type:"post",async:!0,cache:!1,success:function(a,b){MessageDisplay.Ok("Story moved.")}})},e=function(a){var b=$("\x3cdiv\x3e\x3c/div\x3e").html(a).appendTo(document.body);b.find("div.possibleAction").hide();b.dialog({modal:!0,width:"500px",close:function(){b.dialog("destroy")},buttons:{OK:function(){b.dialog("destroy")}},title:"Unable to move story"})};
jQuery.ajax({url:"ajax/checkChangeBacklog.action",data:{storyId:a,backlogId:c},async:!0,cache:!1,type:"POST",dataType:"html",success:function(a,c){0===jQuery.trim(a).length?d():(b(),e(a))}})};
ProductController.prototype.paintProjectList=function(){var a=this;a.projectListView||(a.projectFilters=["ONGOING","FUTURE"],$('\x3cspan\x3eShow \x3cinput type\x3d"checkbox" name\x3d"ONGOING" checked\x3d"checked"/\x3eOngoing \x3cinput type\x3d"checkbox" name\x3d"FUTURE" checked\x3d"checked"/\x3e Future \x3cinput type\x3d"checkbox" name\x3d"PAST" /\x3e Past projects \x3c/span\x3e').appendTo(this.projectListElement).find("input").click(function(c){c=$(this);var b=c.attr("name");c.is(":checked")&&-1===
jQuery.inArray(a.projectFilters,b)?a.projectFilters.push(b):ArrayUtils.remove(a.projectFilters,b);a.projectListView.filter()}),this.projectListView=new DynamicTable(this,this.model,this.projectListConfig,this.projectListElement),this.projectListView.setFilter(function(c){if(c.getScheduleStatus()&&-1===jQuery.inArray(c.getScheduleStatus(),a.projectFilters))return!1;var b=a.getTextFilter();return 0<b.length&&-1===c.getName().indexOf(b)?!1:!0}));this.model.reloadProjects()};
ProductController.prototype.paint=function(){var a=this,c=this.tabs.tabs("option","selected");ModelFactory.initializeFor(ModelFactory.initializeForTypes.product,this.id,function(b){a.model=b;a.paintProductDetails();1===c&&a.paintLeafStories();2===c&&a.paintProjectList()});0===c&&this.paintStoryTree();this.tabs.bind("tabsselect",function(b,c){a.textFilter.clear();a.storyTreeController&&(a.storyTreeController.resetFilter(),a.storyTreeController.clearSelectedIds());0===c.index?a.paintStoryTree():1===
c.index?a.paintLeafStories():2===c.index&&a.paintProjectList()})};ProductController.prototype.changeTabIfFragmentFound=function(){window.location.hash.match(/fi\.hut\.soberit\.agilefant\.model\.Story_(\d+)/)&&this.tabs.tabs("select",0)};
ProductController.prototype.createProject=function(){var a=ModelFactory.createObject(ModelFactory.typeToClassName.project);a.setParent(this.model);var c=new Date,b=new Date;c.zeroTime();c.addHours(8);b.zeroTime();b.addMonths(1);b.addHours(18);a.setStartDate(c.getTime());a.setEndDate(b.getTime());c=new ProjectRowController(a,null,this);a=this.projectListView.createRow(c,a,"top");c.view=a;a.autoCreateCells([ProjectRowController.columnIndices.actions]);a.render();c.openRowEdit()};
ProductController.prototype.initializeProductDetailsConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"79%",closeRowCallback:null});a.addColumnConfiguration(0,{title:"Name",get:ProductModel.prototype.getName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,set:ProductModel.prototype.setName}});a.addColumnConfiguration(1,{title:"Reference ID",get:BacklogModel.prototype.getId,decorator:DynamicsDecorators.quickReference});a.addColumnConfiguration(2,{title:"Description",
get:ProductModel.prototype.getDescription,editable:!0,visualizedEditable:!0,decorator:DynamicsDecorators.emptyDescriptionDecorator,edit:{editor:"Wysiwyg",set:ProductModel.prototype.setDescription}});this.productDetailConfig=a};
ProductController.prototype.removeProduct=function(){var a=this,c=new LazyLoadedFormDialog;c.init({title:"Delete product",url:"ajax/deleteProductForm.action",disableClose:!0,data:{ProductId:a.model.getId()},okCallback:function(b){var c=b.confirmationString;if(c&&"yes"==c.toLowerCase()&&(c=b.confirmationString)&&"yes"==c.toLowerCase())window.location.href="deleteProduct.action?confirmationString\x3dyes\x26productId\x3d"+a.model.getId()},closeCallback:function(){c.close()}})};
ProductController.prototype.initializeProjectListConfig=function(){var a=new DynamicTableConfiguration({rowControllerFactory:ProductController.prototype.projectRowControllerFactory,dataSource:ProductModel.prototype.getProjects,caption:"Projects",dataType:"project",captionConfig:{cssClasses:""},cssClass:"product-project-table",validators:[BacklogModel.Validators.dateValidator]});a.addCaptionItem({name:"createProject",text:"Create project",cssClass:"create",callback:ProductController.prototype.createProject});
a.addColumnConfiguration(ProjectRowController.columnIndices.link,{minWidth:25,autoScale:!0,title:"ID",headerTooltip:"Project id [link to page]",cssClass:"backlog-id-link",get:ProjectModel.prototype.getId,decorator:DynamicsDecorators.backlogNameLinkDecorator,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getId)});a.addColumnConfiguration(ProjectRowController.columnIndices.name,{minWidth:150,autoScale:!0,title:"Name",headerTooltip:"Project name",get:ProjectModel.prototype.getName,
sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getName),editable:!0,visualizedEditable:!0,edit:{editor:"Text",set:ProjectModel.prototype.setName,required:!0}});a.addColumnConfiguration(ProjectRowController.columnIndices.assignees,{minWidth:130,autoScale:!0,title:"Project assignees",headerTooltip:"Project assignees",get:BacklogModel.prototype.getAssignees,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",
dialogTitle:"Select users",dataType:"usersAndTeams",set:BacklogModel.prototype.setAssignees}});a.addColumnConfiguration(ProjectRowController.columnIndices.status,{minWidth:25,autoScale:!0,title:"Status",headerTooltip:"Project status",get:ProjectModel.prototype.getStatus,decorator:DynamicsDecorators.projectStatusDecorator,editable:!0,edit:{editor:"Selection",set:ProjectModel.prototype.setStatus,items:DynamicsDecorators.projectStates}});a.addColumnConfiguration(ProjectRowController.columnIndices.startDate,
{minWidth:80,autoScale:!0,title:"Start date",headerTooltip:"Start date",get:ProjectModel.prototype.getStartDate,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getStartDate),decorator:DynamicsDecorators.dateTimeDecorator,defaultSortColumn:!0,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,set:ProjectModel.prototype.setStartDate,withTime:!0,required:!0}});a.addColumnConfiguration(ProjectRowController.columnIndices.endDate,
{minWidth:80,autoScale:!0,title:"End date",headerTooltip:"End date",get:ProjectModel.prototype.getEndDate,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getEndDate),decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,set:ProjectModel.prototype.setEndDate,withTime:!0,required:!0}});a.addColumnConfiguration(ProjectRowController.columnIndices.actions,{minWidth:26,autoScale:!0,
title:"Edit",subViewFactory:ProjectRowController.prototype.projectActionFactory});a.addColumnConfiguration(ProjectRowController.columnIndices.description,{fullWidth:!0,visible:!1,get:ProjectModel.prototype.getDescription,cssClass:"productstory-data",editable:!0,visualizedEditable:!0,edit:{editor:"Wysiwyg",set:ProjectModel.prototype.setDescription}});a.addColumnConfiguration(ProjectRowController.columnIndices.buttons,{fullWidth:!0,visible:!1,cssClass:"productstory-data",subViewFactory:DynamicsButtons.commonButtonFactory});
this.projectListConfig=a};
var IterationRowController=function IterationRowController(b,c,d){this.model=b;this.view=c;this.parentController=d;this.init();this.autohideCells=[IterationRowController.columnIndices.description,IterationRowController.columnIndices.buttons]};IterationRowController.prototype=new BacklogController;IterationRowController.columnNames="expand link name assignees startDate endDate left spent storiesData buttons".split(" ");IterationRowController.columnIndices=CommonController.createColumnIndices(IterationRowController.columnNames);
IterationRowController.prototype.toggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({collapse:IterationRowController.prototype.hideDetails,expand:IterationRowController.prototype.showDetails,expanded:!1},this,a)};
IterationRowController.prototype.showDetails=function(){var a=this.view.getCell(IterationRowController.columnIndices.storiesData);if(a){var b={iterationId:this.model.id};a.getElement().html('\x3cimg src\x3d"static/img/working.gif" alt\x3d"Please wait..."/\x3e"');a.element.load("ajax/iterationRowMetrics.action",b);a.show()}};IterationRowController.prototype.hideDetails=function(){var a=this.view.getCell(IterationRowController.columnIndices.storiesData);a&&a.hide()};
var ProjectController=function(a){var b=this;this.id=a.id;this.tabs=a.tabs;this.parentView=a.storyListElement;this.projectDetailsElement=a.projectDetailsElement;$.cookie("agilefant-leafstory-filters")&&(this.leafStoriesStateFilters=$.cookie("agilefant-leafstory-filters").split(","));this.textFilterElement=a.textFilterElement;this.textFilter=new SearchByTextWidget($(a.textFilterElement),{searchCallback:function(){b.filter()}});this.init();this.initializeProjectDetailsConfig();this.initializeIterationListConfig();
this.initializeStoryConfig();this.changeTabIfFragmentFound();this.paint();window.pageController.setMainController(this)};ProjectController.prototype=new BacklogController;
ProjectController.prototype.filter=function(){var a=this,b=this.tabs.tabs("option","selected");1===b?(this.storyListView.showInfoMessage("Searching..."),this.model.reloadLeafStories(this.getLeafStoryFilters(),function(){a.storyListView.hideInfoMessage("Searching...")})):0===b?this.storyTreeController.filter(this.getTextFilter(),this.getStoryTreeStateFilters()):2===b&&this.iterationsView.filter()};
ProjectController.prototype.filterLeafStories=function(){this.storyListView.showInfoMessage("Filtering...");this.model.reloadLeafStories(this.getLeafStoryFilters(),jQuery.proxy(function(){this.storyListView.hideInfoMessage("Filtering...")},this))};ProjectController.prototype.getLeafStoryFilters=function(){var a={};this.getTextFilter()&&(a.name=this.getTextFilter());this.leafStoriesStateFilters&&(a.states=this.leafStoriesStateFilters);return a};
ProjectController.prototype.getStoryTreeStateFilters=function(){return this.storyTreeController.storyFilters.statesToKeep};ProjectController.prototype.getTextFilter=function(){return this.textFilter.getValue()};
ProjectController.prototype.filterLeafStoriesByState=function(a){var b=this,c=new StateFilterWidget(a,{bubbleOptions:{title:"Filter by state",offsetX:-15,minWidth:100,minHeight:20},filterCallback:function(){b.leafStoriesStateFilters=c.getFilter();b.filterLeafStories()},callback:function(a){a?(b.storyListView.activateColumnFilter("State"),$.cookie("agilefant-leafstory-filters",b.leafStoriesStateFilters.join(","),{expires:31})):(b.storyListView.disableColumnFilter("State"),$.cookie("agilefant-leafstory-filters",
null))},activeStates:b.leafStoriesStateFilters})};ProjectController.columnNames="name reference startDate endDate plannedSize effortSpent baselineLoad assignees description".split(" ");ProjectController.columnIndices=CommonController.createColumnIndices(ProjectController.columnNames);
ProjectController.columnConfigs={name:{title:"Name",get:ProjectModel.prototype.getName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,visualizeRequired:!0,set:ProjectModel.prototype.setName}},reference:{title:"Reference ID",get:BacklogModel.prototype.getId,decorator:DynamicsDecorators.quickReference},startDate:{title:"Start Date",get:ProjectModel.prototype.getStartDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Date",size:"18ex",
decorator:DynamicsDecorators.dateTimeDecorator,required:!0,visualizeRequired:!0,withTime:!0,set:ProjectModel.prototype.setStartDate}},endDate:{title:"End Date",get:ProjectModel.prototype.getEndDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,required:!0,visualizeRequired:!0,withTime:!0,size:"18ex",set:ProjectModel.prototype.setEndDate}},plannedSize:{title:"Planned Size",get:ProjectModel.prototype.getBacklogSize,
decorator:DynamicsDecorators.exactEstimateAppendManHourDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"10ex",set:ProjectModel.prototype.setBacklogSize}},effortSpent:{minWidth:30,title:"Effort Spent",decorator:DynamicsDecorators.exactEstimateAppendManHourDecorator,get:ProjectModel.prototype.getTotalEffortSpent,editable:!1,visualizedEditable:!0,onClick:StoryController.prototype.openQuickLogEffort,edit:{editor:"ExactEstimate",
decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"10ex",set:StoryController.prototype.quickLogEffort}},baselineLoad:{title:"Baseline load",get:ProjectModel.prototype.getBaselineLoad,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"10ex",set:ProjectModel.prototype.setBaselineLoad}},assignees:{title:"Project assignees",headerTooltip:"Project assignees",get:BacklogModel.prototype.getAssignees,
decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:BacklogModel.prototype.setAssignees}},description:{title:"Description",get:ProjectModel.prototype.getDescription,editable:!0,visualizedEditable:!0,decorator:DynamicsDecorators.emptyDescriptionDecorator,edit:{editor:"Wysiwyg",set:ProjectModel.prototype.setDescription}}};
ProjectController.prototype.handleModelEvents=function(a){var b=this;a instanceof DynamicsEvents.RankChanged&&"story"===a.getRankedType()&&this.model.reloadLeafStories(this.getLeafStoryFilters(),function(){b.storyListView.resort()})};ProjectController.prototype.pageControllerDispatch=function(a){a instanceof DynamicsEvents.AddEvent&&0===this.tabs.tabs("option","selected")&&this.storyTreeController.refresh()};
ProjectController.prototype._paintLeafStories=function(a){var b=this;this.storyListView||(this.storyListView=new DynamicTable(this,this.model,this.storyListConfig,a),this.leafStoriesStateFilters&&this.storyListView.activateColumnFilter("State"));this.storyListView.showInfoMessage("Loading...");this.model.reloadLeafStories(this.getLeafStoryFilters(),function(){b.storyListView.hideInfoMessage("Loading...")})};
ProjectController.prototype._paintIterations=function(a){var b=this;this.iterationsView||(this.iterationFilters=["ONGOING","FUTURE"],$('\x3cspan\x3eShow \x3cinput type\x3d"checkbox" name\x3d"ONGOING" checked\x3d"checked"/\x3eOngoing \x3cinput type\x3d"checkbox" name\x3d"FUTURE" checked\x3d"checked"/\x3e Future \x3cinput type\x3d"checkbox" name\x3d"PAST" /\x3e Past iterations \x3c/span\x3e').appendTo(a).find("input").click(function(a){a=$(this);var d=a.attr("name");a.is(":checked")&&-1===jQuery.inArray(b.iterationFilters,
d)?b.iterationFilters.push(d):ArrayUtils.remove(b.iterationFilters,d);b.iterationsView.filter()}),this.iterationsView=new DynamicTable(this,this.model,this.iterationListConfig,a),this.iterationsView.setFilter(function(a){return a.getScheduleStatus()&&-1===jQuery.inArray(a.getScheduleStatus(),b.iterationFilters)||0<b.getTextFilter().length&&-1===a.getName().indexOf(b.getTextFilter())?!1:!0}));this.iterationsView.showInfoMessage("Loading...");this.model.reloadIterations(null,function(){b.iterationsView.hideInfoMessage("Loading...");
b.iterationsView.render()})};ProjectController.prototype._paintStoryTree=function(a){this.storyTreeController||(this.storyTreeController=new StoryTreeController(this.id,"project",a,{},this));this.storyTreeController.refresh()};
ProjectController.prototype.paint=function(){var a=this,b=this.tabs.tabs("option","selected");this.tabs.tabs("select",2===b?0:2);this.tabs.bind("tabsselect",function(b,d){a.textFilter.clear();a.storyTreeController&&a.storyTreeController.resetFilter();1===d.index?a._paintLeafStories(d.panel):0===d.index?a._paintStoryTree(d.panel):2===d.index&&a._paintIterations(d.panel)});ModelFactory.getInstance()._getData(ModelFactory.initializeForTypes.project,this.id,function(c){c.reloadTotalSpentEffort();a.model=
c;a.attachModelListener();a.paintProjectDetails();a.tabs.tabs("select",b)})};
ProjectController.prototype.removeProject=function(){var a=this,b=new LazyLoadedFormDialog;b.init({title:"Delete project",url:"ajax/deleteProjectForm.action",disableClose:!0,data:{ProjectId:a.model.getId()},okCallback:function(b){var d=b.confirmationString;if(d&&"yes"==d.toLowerCase()&&(d=b.confirmationString)&&"yes"==d.toLowerCase())window.location.href="deleteProject.action?confirmationString\x3dyes\x26projectId\x3d"+a.model.getId()},closeCallback:function(){b.close()}})};
ProjectController.prototype.paintProjectDetails=function(){this.projectDetailsView=new DynamicVerticalTable(this,this.model,this.projectDetailConfig,this.projectDetailsElement);this.projectDetailsView.render()};ProjectController.prototype.iterationRowControllerFactory=function(a,b){var c=new IterationRowController(b,a,this);this.addChildController("iteration",c);return c};
ProjectController.prototype.createIteration=function(){var a=ModelFactory.createObject(ModelFactory.typeToClassName.iteration);a.setParent(this.model);var b=new Date,c=new Date;b.zeroTime();b.addHours(8);c.zeroTime();c.addDays(14);c.addHours(18);a.setStartDate(b.getTime());a.setEndDate(c.getTime());b=new IterationRowController(a,null,this);a=this.iterationsView.createRow(b,a,"top");b.view=a;a.autoCreateCells([0,IterationRowController.columnIndices.actions,StoryController.columnIndices.tasksData]);
a.render();b.openRowEdit()};
ProjectController.prototype.createStory=function(){var a=ModelFactory.createObject(ModelFactory.types.story);a.setBacklog(this.model);var b=PageController.getInstance().getCurrentUser();b.isAutoassignToStories()&&a.setResponsibles([b.getId()]);b=new StoryController(a,null,this);a=this.storyListView.createRow(b,a,"top");b.view=a;a.autoCreateCells([0,1,6,7]);a.getCellByName("description").show();a.getCellByName("buttons").show();a.getCellByName("backlog").hide();a.render();b.openRowEdit()};
ProjectController.prototype.storyControllerFactory=function(a,b){var c=new StoryController(b,a,this);this.addChildController("story",c);return c};ProjectController.prototype.getSelectableBacklogs=function(){var a={};a[this.model.getId()]="(none)";for(var b=this.model.getChildren(),c=0;c<b.length;c++)a[b[c].getId()]=b[c].getName();return a};
ProjectController.prototype.changeTabIfFragmentFound=function(){var a=window.location.hash;a.match(/fi\.hut\.soberit\.agilefant\.model\.Story_(\d+)/)?this.tabs.tabs("select",0):a.match(/fi\.hut\.soberit\.agilefant\.model\.Task_(\d+)/)&&this.tabs.tabs("select",1)};
ProjectController.prototype.initializeProjectDetailsConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"79%",closeRowCallback:null,validators:[BacklogModel.Validators.dateValidator]});a.addColumnConfiguration(ProjectController.columnIndices.name,ProjectController.columnConfigs.name);a.addColumnConfiguration(ProjectController.columnIndices.reference,ProjectController.columnConfigs.reference);a.addColumnConfiguration(ProjectController.columnIndices.startDate,ProjectController.columnConfigs.startDate);
a.addColumnConfiguration(ProjectController.columnIndices.endDate,ProjectController.columnConfigs.endDate);a.addColumnConfiguration(ProjectController.columnIndices.plannedSize,ProjectController.columnConfigs.plannedSize);a.addColumnConfiguration(ProjectController.columnIndices.effortSpent,ProjectController.columnConfigs.effortSpent);a.addColumnConfiguration(ProjectController.columnIndices.baselineLoad,ProjectController.columnConfigs.baselineLoad);a.addColumnConfiguration(ProjectController.columnIndices.assignees,
ProjectController.columnConfigs.assignees);a.addColumnConfiguration(ProjectController.columnIndices.description,ProjectController.columnConfigs.description);this.projectDetailConfig=a};
ProjectController.prototype.initializeIterationListConfig=function(){var a=new DynamicTableConfiguration({rowControllerFactory:ProjectController.prototype.iterationRowControllerFactory,dataSource:ProjectModel.prototype.getIterations,dataType:"iteration",caption:"Iterations",cssClass:"project-iteration-table",validators:[BacklogModel.Validators.dateValidator]});this._iterationListColumnConfig(a);a.addCaptionItem({name:"createIteration",text:"Create iteration",cssClass:"create",callback:ProjectController.prototype.createIteration});
this.iterationListConfig=a};
ProjectController.prototype._iterationListColumnConfig=function(a){a.addColumnConfiguration(IterationRowController.columnIndices.expand,{minWidth:16,autoScale:!0,title:"",headerTooltip:"Expand/collapse",defaultSortColumn:!1,subViewFactory:IterationRowController.prototype.toggleFactory});a.addColumnConfiguration(IterationRowController.columnIndices.link,{minWidth:25,autoScale:!0,title:"ID",headerTooltip:"Iteration id [link to page]",cssClass:"backlog-id-link",get:IterationModel.prototype.getId,decorator:DynamicsDecorators.backlogNameLinkDecorator,
sortCallback:DynamicsComparators.valueComparatorFactory(IterationModel.prototype.getId)});a.addColumnConfiguration(IterationRowController.columnIndices.name,{minWidth:150,autoScale:!0,title:"Name",headerTooltip:"Iteration name",get:IterationModel.prototype.getName,sortCallback:DynamicsComparators.valueComparatorFactory(IterationModel.prototype.getName),editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Text",set:IterationModel.prototype.setName,required:!0}});a.addColumnConfiguration(IterationRowController.columnIndices.assignees,
{minWidth:130,autoScale:!0,title:"Iteration assignees",headerTooltip:"Iteration assignees",get:BacklogModel.prototype.getAssignees,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:BacklogModel.prototype.setAssignees}});a.addColumnConfiguration(IterationRowController.columnIndices.left,{minWidth:30,autoScale:!0,cssClass:"sum-column",title:"Left",headerTooltip:"Total sum of tasks' effort left estimates in man-hours",
decorator:DynamicsDecorators.exactEstimateSumDecorator,get:IterationModel.prototype.getTotalEffortLeft});a.addColumnConfiguration(IterationRowController.columnIndices.spent,{minWidth:30,autoScale:!0,title:"Spent",headerTooltip:"Total effort spent in man-hours (stories, tasks, the iteration)",decorator:DynamicsDecorators.exactEstimateDecorator,get:IterationModel.prototype.getTotalEffortSpent,editable:!1,visualizedEditable:!0,onClick:StoryController.prototype.openQuickLogEffort,edit:{editor:"ExactEstimate",
decorator:DynamicsDecorators.empty,set:StoryController.prototype.quickLogEffort}});a.addColumnConfiguration(IterationRowController.columnIndices.startDate,{minWidth:80,autoScale:!0,title:"Start date",headerTooltip:"Start date",get:IterationModel.prototype.getStartDate,sortCallback:DynamicsComparators.valueComparatorFactory(IterationModel.prototype.getStartDate),decorator:DynamicsDecorators.dateTimeDecorator,defaultSortColumn:!0,editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,
set:IterationModel.prototype.setStartDate,required:!0,withTime:!0}});a.addColumnConfiguration(IterationRowController.columnIndices.endDate,{minWidth:80,autoScale:!0,title:"End date",headerTooltip:"End date",get:IterationModel.prototype.getEndDate,sortCallback:DynamicsComparators.valueComparatorFactory(IterationModel.prototype.getEndDate),decorator:DynamicsDecorators.dateTimeDecorator,editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,
set:IterationModel.prototype.setEndDate,required:!0,withTime:!0}});a.addColumnConfiguration(IterationRowController.columnIndices.storiesData,{fullWidth:!0,visible:!1,delayedRender:!0});a.addColumnConfiguration(IterationRowController.columnIndices.buttons,{fullWidth:!0,visible:!1,subViewFactory:DynamicsButtons.commonButtonFactory})};
ProjectController.prototype.initializeStoryConfig=function(){var a=this,b=new DynamicTableConfiguration({rowControllerFactory:ProjectController.prototype.storyControllerFactory,dataSource:ProjectModel.prototype.getLeafStories,dataType:"story",cssClass:"project-story-table",sortCallback:StoryController.prototype.rankStory,caption:"Project Backlog"});b.addCaptionItem({name:"createStory",text:"Create story",cssClass:"create",callback:ProjectController.prototype.createStory});b.addCaptionItem({name:"showTasks",
text:"Show tasks",connectWith:"hideTasks",cssClass:"hide",visible:!0,callback:StoryListController.prototype.showTasks});b.addCaptionItem({name:"hideTasks",text:"Hide tasks",visible:!1,connectWith:"showTasks",cssClass:"show",callback:StoryListController.prototype.hideTasks});b.addColumnConfiguration(0,{minWidth:24,autoScale:!0,title:"#",columnName:"expand",headerTooltip:"Priority",defaultSortColumn:!0,subViewFactory:StoryController.prototype.taskToggleFactory,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getRank)});
b.addColumnConfiguration(1,{minWidth:30,autoScale:!0,title:"ID",headerTooltip:"Story id [link to page]",cssClass:"story-id-link",get:CommonModel.prototype.getId,decorator:DynamicsDecorators.storyNameLinkDecorator,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getId),editable:!1});b.addColumnConfiguration(2,{minWidth:280,autoScale:!0,title:"Name",headerTooltip:"Story name",get:StoryModel.prototype.getName,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getName),
dragHandle:!0,editable:!0,visualizedEditable:!0,edit:{editor:"Text",set:StoryModel.prototype.setName,required:!0}});b.addColumnConfiguration(3,{minWidth:100,autoScale:!0,title:"Parent story",headerTooltip:"The parent story of this story",get:StoryModel.prototype.getParentStory,decorator:DynamicsDecorators.parentStorySelectDecorator});b.addColumnConfiguration(4,{minWidth:50,autoScale:!0,title:"Value",headerTooltip:"A given story value or weight",get:StoryModel.prototype.getStoryValue,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryValue),
editable:!0,visualizedEditable:!0,editableCallback:StoryController.prototype.storyValueOrPointsEditable,decorator:DynamicsDecorators.estimateDecorator,edit:{editor:"StoryValue",set:StoryModel.prototype.setStoryValue}});b.addColumnConfiguration(5,{minWidth:50,autoScale:!0,title:"Points",headerTooltip:"Estimate in story points",get:StoryModel.prototype.getStoryPoints,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryPoints),editable:!0,visualizedEditable:!0,editableCallback:StoryController.prototype.storyValueOrPointsEditable,
decorator:DynamicsDecorators.estimateDecorator,edit:{editor:"Estimate",set:StoryModel.prototype.setStoryPoints}});b.addColumnConfiguration(6,{minWidth:70,autoScale:!0,title:"State",headerTooltip:"Story state",get:StoryModel.prototype.getState,decorator:DynamicsDecorators.storyStateColorDecorator,editable:!0,filter:ProjectController.prototype.filterLeafStoriesByState,edit:{editor:"Selection",set:StoryModel.prototype.setState,items:DynamicsDecorators.stateOptions}});b.addColumnConfiguration(7,{minWidth:70,
autoScale:!0,title:"Responsibles",headerTooltip:"Story responsibles",get:StoryModel.prototype.getResponsibles,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:StoryModel.prototype.setResponsibles}});b.addColumnConfiguration(8,{minWidth:100,autoScale:!0,columnName:"backlog",title:"Iteration",headerTooltip:"The iteration the story has been scheduled to (if any)",get:StoryModel.prototype.getIteration,
decorator:DynamicsDecorators.iterationSelectDecorator,sortCallback:DynamicsComparators.storyIterationNameComparator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Selection",items:function(){return a.getSelectableBacklogs()},set:StoryModel.prototype.moveStory}});b.addColumnConfiguration(9,{minWidth:40,columnName:"edit",autoScale:!0,title:"Actions",subViewFactory:StoryController.prototype.projectStoryActionFactory});b.addColumnConfiguration(10,{minWidth:40,columnName:"ranktotop",
autoScale:!0,title:"",subViewFactory:StoryController.prototype.rankToTopAction});b.addColumnConfiguration(11,{minWidth:60,columnName:"ranktobottom",autoScale:!0,title:"",subViewFactory:StoryController.prototype.rankToBottomAction});Configuration.isLabelsInStoryList()&&b.addColumnConfiguration(12,StoryListController.columnConfig.labels);b.addColumnConfiguration(13,{columnName:"description",fullWidth:!0,visible:!1,editable:!0,visualizedEditable:!0,get:StoryModel.prototype.getDescription,edit:{editor:"Wysiwyg",
set:StoryModel.prototype.setDescription}});b.addColumnConfiguration(14,{fullWidth:!0,visible:!1,columnName:"details",subViewFactory:StoryController.prototype.storyDetailsFactory,delayedRender:!0});b.addColumnConfiguration(15,{columnName:"buttons",fullWidth:!0,visible:!1,cssClass:"projectstory-data",subViewFactory:DynamicsButtons.commonButtonFactory});b.addColumnConfiguration(16,{columnName:"tasksData",fullWidth:!0,visible:!1,cssClass:"story-task-container",targetCell:StoryController.columnIndices.tasksData,
subViewFactory:StoryController.prototype.storyTaskListFactory,delayedRender:!0});this.storyListConfig=b};
var ProjectRowController=function ProjectRowController(a,c,d){this.model=a;this.view=c;this.parentController=d;this.init();this.autohideCells=[ProjectRowController.columnIndices.description,ProjectRowController.columnIndices.buttons]};ProjectRowController.prototype=new BacklogController;ProjectRowController.columnNames="link name assignees status startDate endDate actions description buttons".split(" ");ProjectRowController.columnIndices=CommonController.createColumnIndices(ProjectRowController.columnNames);
ProjectRowController.prototype.projectActionFactory=function(b,a){return new DynamicTableRowActions([{text:"Edit",callback:CommonController.prototype.openRowEdit},{text:"Delete",callback:ProjectRowController.prototype.removeProject}],this,this.model,b)};
ProjectRowController.prototype.removeProject=function(){var b=this,a=new LazyLoadedFormDialog;a.init({title:"Delete project",url:"ajax/deleteProjectForm.action",disableClose:!0,data:{ProjectId:b.model.getId()},okCallback:function(c){var d=c.confirmationString;d&&"yes"==d.toLowerCase()&&(b.model.remove(function(){b.parentController.removeChildController("project",b);window.pageController&&window.pageController.refreshMenu()},c),a.close())},closeCallback:function(){a.close()}})};
var DailyWorkController=function(a){this.model=null;this.options={userId:null,workQueueElement:null,assignedStoriesElement:null,tasksWithoutStoryElement:null,emptyDailyWorkNoteBox:null,onUserLoadUpdate:function(){}};jQuery.extend(this.options,a);this.init();this.initialize();window.pageController.setMainController(this)};DailyWorkController.prototype=new CommonController;
DailyWorkController.prototype.pageControllerDispatch=function(a){if(a instanceof DynamicsEvents.AddEvent){if(a.getObject()instanceof TaskModel&&a.getObject().getParent()instanceof BacklogModel&&(this.model.addTask(a.getObject()),0<a.getObject().getOriginalEstimate()))this.options.onUserLoadUpdate();a.getObject()instanceof StoryModel&&this.model.addStory(a.getObject())}};
DailyWorkController.prototype.handleModelEvents=function(a){if(a instanceof DynamicsEvents.NamedEvent){var b=a.getEventName();("removedFromWorkQueue"===b||"addedToWorkQueue"===b)&&this.model.reloadWorkQueue(this.options.userId)}if(a.getObject()instanceof TaskModel&&!(a instanceof DynamicsEvents.RankChanged)&&!(a instanceof DynamicsEvents.EditEvent))this.options.onUserLoadUpdate();if(a instanceof DynamicsEvents.RelationUpdatedEvent&&a.getObject()instanceof TaskModel){if("user"===a.getRelation())this.options.onUserLoadUpdate();
if("parent"===a.getRelation()){var c=this;this.model.reloadWorkQueue(this.options.userId,function(){c.workQueueController.getCurrentView().render()});this.model.reloadTasksWithoutStory(this.options.userId)}}};DailyWorkController.prototype.initialize=function(){var a=this,b=$("#dailyworkLoadingOverlay");b.fadeIn();b.show();ModelFactory.initializeFor(ModelFactory.initializeForTypes.dailyWork,this.options.userId,function(b){a.model=b;a._showNoteBox();a._paintLists();jQuery("#dailyworkPleasewait").remove()})};
DailyWorkController.prototype._showNoteBox=function(){0===this.model.getWorkQueue().length&&(0===this.model.getAssignedStories().length&&0===this.model.getTasksWithoutStory().length)&&this.options.emptyDailyWorkNoteBox.show()};
DailyWorkController.prototype._paintLists=function(){this.tasksWithoutStoryController=new DailyWorkTasksWithoutStoryController(this.model,this.options.tasksWithoutStoryElement,this);this.assignedStoriesController=new DailyWorkStoryListController(this.model,this.options.assignedStoriesElement,this,{userId:this.options.userId});this.workQueueController=new WorkQueueController(this.model,this.options.workQueueElement,this,{userId:this.options.userId})};
var TasksWithoutStoryController=function(a,b,c){this.model=a;this.element=b;this.parentController=c;this.init();this.initConfig();this.initializeView()};TasksWithoutStoryController.prototype=new CommonController;TasksWithoutStoryController.columnConfig={};TasksWithoutStoryController.columnConfig.prio={minWidth:24,autoScale:!0,title:"#",headerTooltip:"Priority",sortCallback:DynamicsComparators.valueComparatorFactory(TaskModel.prototype.getRank),defaultSortColumn:!0,subViewFactory:TaskController.prototype.toggleFactory};
TasksWithoutStoryController.columnConfig.name={minWidth:200,autoScale:!0,title:"Name",headerTooltip:"Task name",get:TaskModel.prototype.getName,editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Text",set:TaskModel.prototype.setName,required:!0}};
TasksWithoutStoryController.columnConfig.state={minWidth:60,autoScale:!0,title:"State",headerTooltip:"Task state",get:TaskModel.prototype.getState,decorator:DynamicsDecorators.taskStateColorDecorator,editable:!0,edit:{editor:"Selection",set:TaskModel.prototype.setState,items:DynamicsDecorators.stateOptions}};
TasksWithoutStoryController.columnConfig.context={minWidth:60,autoScale:!0,title:"Iteration",headerTooltip:"Task iteration",get:TaskModel.prototype.getIteration,decorator:DynamicsDecorators.tasksWithoutStoryContextDecorator,editable:!0,editableCallback:TaskController.prototype.contextEditable,edit:{editor:"InlineAutocomplete",dataType:"currentIterations",decorator:DynamicsDecorators.propertyDecoratorFactory(BacklogModel.prototype.getName),set:TaskModel.prototype.setIteration}};
TasksWithoutStoryController.columnConfig.responsibles={minWidth:60,autoScale:!0,title:"Responsibles",headerTooltip:"Task responsibles",get:TaskModel.prototype.getResponsibles,getView:TaskModel.prototype.getAnnotatedResponsibles,decorator:DynamicsDecorators.annotatedUserInitialsListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:TaskModel.prototype.setResponsibles}};
TasksWithoutStoryController.columnConfig.effortLeft={minWidth:30,autoScale:!0,title:"Left",headerTooltip:"Effort left in man-hours",get:TaskModel.prototype.getEffortLeft,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,editableCallback:TaskController.prototype.effortLeftEditable,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,set:TaskModel.prototype.setEffortLeft}};
TasksWithoutStoryController.columnConfig.effortSpent={minWidth:30,autoScale:!0,title:"Spent",headerTooltip:"Spent effort in man-hours",get:TaskModel.prototype.getEffortSpent,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!1,visualizedEditable:!0,onClick:TaskController.prototype.openQuickLogEffort,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.empty,set:TaskController.prototype.quickLogEffort}};
TasksWithoutStoryController.columnConfig.actions={columnName:"actions",minWidth:33,autoScale:!0,title:"Edit",subViewFactory:TaskController.prototype.actionColumnFactory};TasksWithoutStoryController.columnConfig.details={columnName:"details",fullWidth:!0,visible:!1,targetCell:TaskController.columnIndices.details,subViewFactory:TaskController.prototype.taskDetailsFactory,delayedRender:!0};TasksWithoutStoryController.columnConfig.buttons={columnName:"buttons",fullWidth:!0,visible:!1,subViewFactory:DynamicsButtons.commonButtonFactory};
TasksWithoutStoryController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a);if(a instanceof DynamicsEvents.RankChanged&&"task"===a.getRankedType()){var b=this;this.model.reloadTasksWithoutStory(function(){b.getCurrentView().resort()})}};TasksWithoutStoryController.prototype.initializeView=function(){this.view=new DynamicTable(this,this.model,this.getCurrentConfig(),this.element);this.view.render()};
TasksWithoutStoryController.prototype.getCurrentConfig=function(){return this.taskListConfig};TasksWithoutStoryController.prototype.taskControllerFactory=function(a,b){var c=new TaskController(b,a,this);this.addChildController("task",c);return c};
TasksWithoutStoryController.prototype.createTask=function(a){var b=ModelFactory.createObject(ModelFactory.types.task);this.model&&this.model instanceof IterationModel&&b.setIteration(this.model);var c=PageController.getInstance().getCurrentUser();(c.isAutoassignToTasks()||a)&&b.addResponsible(c.getId());a=new TaskController(b,null,this);b=this.getCurrentView().createRow(a,b,"top");a.view=b;b.autoCreateCells([0]);b.render();a.openRowEdit();b.getCellByName("actions").hide();b.getCellByName("buttons").show();
b.getCellByName("details").hide()};TasksWithoutStoryController.prototype.initConfig=function(){this.taskListConfig=this._getTableConfig();this._addColumnConfigs(this.taskListConfig)};TasksWithoutStoryController.prototype.firstRenderComplete=function(){if(window.location.hash){var a=this.view.getRowById(window.location.hash.substring(1));if(a){setTimeout(function(){a.getController().toggleView.expand()},0);var b=a.getElement().offset();jQuery("#bodyWrapper").scrollTop(b.top-jQuery("#bodyWrapper").offset().top)}}};
TasksWithoutStoryController.prototype._getTableConfig=function(){var a=new DynamicTableConfiguration({rowControllerFactory:TasksWithoutStoryController.prototype.taskControllerFactory,dataSource:IterationModel.prototype.getTasks,dataType:"task",caption:"Tasks without story",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"dynamicTable-sortable-tasklist ui-widget-content ui-corner-all task-table tasksWithoutStory-table",sortCallback:TaskController.prototype.sortAndMoveTask,
sortOptions:{items:"\x3e .dynamicTableDataRow",handle:"."+DynamicTable.cssClasses.dragHandle,connectWith:".dynamicTable-sortable-tasklist \x3e .ui-sortable"},beforeCommitFunction:TaskController.prototype.checkTaskAndCommit,tableDroppable:!0,dropOptions:{accepts:function(a){return a instanceof TaskModel},callback:TaskController.prototype.moveTask},afterFirstRender:$.proxy(function(){this.firstRenderComplete()},this)});a.addCaptionItem({name:"createTask",text:"Create task",cssClass:"create",callback:TasksWithoutStoryController.prototype.createTask});
return a};
TasksWithoutStoryController.prototype._addColumnConfigs=function(a){a.addColumnConfiguration(TaskController.columnIndices.prio,TasksWithoutStoryController.columnConfig.prio);a.addColumnConfiguration(TaskController.columnIndices.name,TasksWithoutStoryController.columnConfig.name);a.addColumnConfiguration(TaskController.columnIndices.state,TasksWithoutStoryController.columnConfig.state);a.addColumnConfiguration(TaskController.columnIndices.responsibles,TasksWithoutStoryController.columnConfig.responsibles);a.addColumnConfiguration(TaskController.columnIndices.el,
TasksWithoutStoryController.columnConfig.effortLeft);Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(TaskController.columnIndices.es,TasksWithoutStoryController.columnConfig.effortSpent);a.addColumnConfiguration(TaskController.columnIndices.actions,TasksWithoutStoryController.columnConfig.actions);a.addColumnConfiguration(TaskController.columnIndices.details,TasksWithoutStoryController.columnConfig.details);a.addColumnConfiguration(TaskController.columnIndices.buttons,TasksWithoutStoryController.columnConfig.buttons)};
var DailyWorkStoryListController=function(a,b,c,d){this.options={userId:null};jQuery.extend(this.options,d);StoryListController.call(this,a,b,c)};extendObject(DailyWorkStoryListController,StoryListController);DailyWorkStoryListController.columnNames="priority labels name points context detailedContext state responsibles el es actions description buttons details tasksData".split(" ");DailyWorkStoryListController.columnIndices=CommonController.createColumnIndices(DailyWorkStoryListController.columnNames);
DailyWorkStoryListController.prototype._getTableConfig=function(){var a=new DynamicTableConfiguration({caption:"My story queue",dataType:"stories",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"ui-widget-content ui-corner-all iteration-story-unranked-table",dataSource:DailyWorkModel.prototype.getAssignedStories,beforeCommitFunction:StoryListController.prototype.confirmTasksToDone,rowControllerFactory:StoryListController.prototype.storyControllerFactory,
sortCallback:$.proxy(function(a,c,d){this.rankInMyStories(a,c,d)},this),sortOptions:{items:"\x3e .dynamicTableDataRow",handle:"."+DynamicTable.cssClasses.dragHandle}});a.addCaptionItem({name:"createStory",text:"Create story",cssClass:"create",callback:DailyWorkStoryListController.prototype.createStory});return a};
DailyWorkStoryListController.prototype.createStory=function(a){var b=ModelFactory.createObject(ModelFactory.types.story),c=PageController.getInstance().getCurrentUser();(c.isAutoassignToStories()||a)&&b.setResponsibles([c.getId()]);a=new StoryController(b,null,this);b=this.getCurrentView().createRow(a,b,"top");a.view=b;b.autoCreateCells([StoryController.columnIndices.priority,StoryController.columnIndices.labels,StoryController.columnIndices.actions,StoryController.columnIndices.tasksData]);b.render();
a.openRowEdit();b.getCellByName("buttons").show();b.getCellByName("labels").hide();b.getCellByName("tasksData").hide()};DailyWorkStoryListController.prototype.storyContextFactory=function(a,b){return new CellBubble({title:"Story's context",url:"ajax/getStoryHierarchy.action?storyId\x3d"+b.getId(),text:'\x3cstrong style\x3d"font-size: 80%"\x3e[?]\x3c/strong\x3e'},a)};
DailyWorkStoryListController.prototype._addColumnConfigs=function(a){a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.priority,DailyWorkStoryListController.columnConfig.priority);Configuration.isLabelsInStoryList()&&a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.labels,StoryListController.columnConfig.labels);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.name,StoryListController.columnConfig.name);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.points,
StoryListController.columnConfig.points);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.state,StoryListController.columnConfig.state);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.context,DailyWorkStoryListController.columnConfig.context);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.detailedContext,DailyWorkStoryListController.columnConfig.detailedContext);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.responsibles,
StoryListController.columnConfig.responsibles);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.el,StoryListController.columnConfig.effortLeft);Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.es,StoryListController.columnConfig.effortSpent);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.actions,StoryListController.columnConfig.actions);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.description,
StoryListController.columnConfig.description);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.buttons,StoryListController.columnConfig.buttons);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.details,StoryListController.columnConfig.details);a.addColumnConfiguration(DailyWorkStoryListController.columnIndices.tasksData,StoryListController.columnConfig.tasks);a.columns[DailyWorkStoryListController.columnIndices.name].options.minWidth=200};
DailyWorkStoryListController.columnConfig={};DailyWorkStoryListController.columnConfig.context={minWidth:120,autoScale:!0,title:"Backlog",get:StoryModel.prototype.getParent,decorator:DynamicsDecorators.storyContextDecorator,editable:!0,editableCallback:StoryController.prototype.contextEditable,edit:{editor:"InlineAutocomplete",dataType:"backlogsAndIterations",decorator:DynamicsDecorators.propertyDecoratorFactory(BacklogModel.prototype.getName),set:StoryModel.prototype.setBacklog}};
DailyWorkStoryListController.columnConfig.detailedContext={minWidth:15,autoScale:!0,title:"",headerTooltip:"",subViewFactory:DailyWorkStoryListController.prototype.storyContextFactory};
DailyWorkStoryListController.columnConfig.priority={minWidth:24,autoScale:!0,title:"#",get:StoryModel.prototype.getThis,decorator:DynamicsDecorators.storyPriorityDecorator,headerTooltip:"Priority",cssClass:"dailywork-story-table-row",sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getMyStoriesRank),defaultSortColumn:!0,subViewFactory:StoryController.prototype.taskToggleFactory};
DailyWorkStoryListController.prototype.rankInMyStories=function(a,b,c){b instanceof StoryModel&&(c?b.rankInMyStories(c.getId(),this.options.userId):b.rankInMyStories(-1,this.options.userId))};
DailyWorkStoryListController.prototype.handleModelEvents=function(a){var b=this;this.parentController&&this.parentController.handleModelEvents(a);a instanceof DynamicsEvents.RankChanged&&"myStoriesStory"===a.getRankedType()&&this.model.reloadMyStories(this.options.userId,function(){b.getCurrentView().resort();b.getCurrentView().render()})};
var DailyWorkTasksWithoutStoryController=function(a,b,c){TasksWithoutStoryController.call(this,a,b,c);this.autohideCells=[DailyWorkTasksWithoutStoryController.columnIndices.description,DailyWorkTasksWithoutStoryController.columnIndices.actions,DailyWorkTasksWithoutStoryController.columnIndices.detailedContext]};extendObject(DailyWorkTasksWithoutStoryController,TasksWithoutStoryController);DailyWorkTasksWithoutStoryController.columnNames="prio name state context detailedContext responsibles el es actions details buttons".split(" ");
DailyWorkTasksWithoutStoryController.columnIndices=CommonController.createColumnIndices(DailyWorkTasksWithoutStoryController.columnNames);DailyWorkTasksWithoutStoryController.prototype.createTask=function(){TasksWithoutStoryController.prototype.createTask.call(this,!0)};
DailyWorkTasksWithoutStoryController.prototype._getTableConfig=function(){var a=new DynamicTableConfiguration({caption:"My tasks without story",dataType:"stories",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"dynamicTable-sortable-tasklist ui-widget-content ui-corner-all task-table tasksWithoutStory-table",dataType:"tasksWithoutStory",rowControllerFactory:TasksWithoutStoryController.prototype.taskControllerFactory,dataSource:DailyWorkModel.prototype.getTasksWithoutStory,
validators:[TaskModel.Validators.backlogSelectedValidator],beforeCommitFunction:TaskController.prototype.checkTaskAndCommit});a.addCaptionItem({name:"createTask",text:"Create task",cssClass:"create",callback:DailyWorkTasksWithoutStoryController.prototype.createTask});return a};
DailyWorkTasksWithoutStoryController.prototype.createTask=function(a){var b=ModelFactory.createObject(ModelFactory.types.task);this.model&&this.model instanceof IterationModel&&b.setIteration(this.model);var c=PageController.getInstance().getCurrentUser();(c.isAutoassignToTasks()||a)&&b.addResponsible(c.getId());a=new TaskController(b,null,this);b=this.getCurrentView().createRow(a,b,"top");a.view=b;b.autoCreateCells([0,4]);b.render();a.openRowEdit();b.getCellByName("actions").hide();b.getCellByName("buttons").show();
b.getCellByName("details").hide()};
DailyWorkTasksWithoutStoryController.prototype._addColumnConfigs=function(a){a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.prio,TasksWithoutStoryController.columnConfig.prio);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.name,TasksWithoutStoryController.columnConfig.name);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.state,TasksWithoutStoryController.columnConfig.state);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.context,TasksWithoutStoryController.columnConfig.context);
a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.detailedContext,WorkQueueController.columnConfig.detailedContext);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.responsibles,TasksWithoutStoryController.columnConfig.responsibles);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.el,TasksWithoutStoryController.columnConfig.effortLeft);Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.es,
TasksWithoutStoryController.columnConfig.effortSpent);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.actions,TasksWithoutStoryController.columnConfig.actions);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.details,TasksWithoutStoryController.columnConfig.details);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.buttons,TasksWithoutStoryController.columnConfig.buttons)};
var WorkQueueController=function(a,b,c,d){this.options={userId:null};jQuery.extend(this.options,d);TasksWithoutStoryController.call(this,a,b,c)};extendObject(WorkQueueController,DailyWorkTasksWithoutStoryController);WorkQueueController.columnConfig={};WorkQueueController.columnConfig.prio={minWidth:24,autoScale:!0,title:"#",headerTooltip:"Priority",sortCallback:DynamicsComparators.valueComparatorFactory(WorkQueueTaskModel.prototype.getWorkQueueRank),defaultSortColumn:!0,subViewFactory:TaskController.prototype.toggleFactory};
WorkQueueController.columnConfig.context={minWidth:60,autoScale:!0,title:"Iteration",headerTooltip:"Task context",get:TaskModel.prototype.getContext,decorator:DynamicsDecorators.taskContextDecorator,editable:!1};WorkQueueController.prototype.handleModelEvents=function(a){var b=this;this.parentController&&this.parentController.handleModelEvents(a);a instanceof DynamicsEvents.RankChanged&&"workQueueTask"===a.getRankedType()&&this.model.reloadWorkQueue(this.options.userId,function(){b.getCurrentView().resort()})};
WorkQueueController.prototype.taskContextFactory=function(a,b){return new CellBubble({title:"Context",url:"ajax/getTaskContext.action?taskId\x3d"+b.getId(),text:'\x3cstrong style\x3d"font-size: 80%"\x3e[?]\x3c/strong\x3e'},a)};WorkQueueController.prototype.rankInWorkQueue=function(a,b,c){b instanceof WorkQueueTaskModel&&(c?b.rankInWorkQueue(c.getId(),this.options.userId):b.rankInWorkQueue(-1,this.options.userId))};
WorkQueueController.prototype._getTableConfig=function(){return new DynamicTableConfiguration({caption:"My task queue",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"dynamicTable-sortable-tasklist ui-widget-content ui-corner-all task-table",rowControllerFactory:TasksWithoutStoryController.prototype.taskControllerFactory,dataType:"queuedTasks",dataSource:DailyWorkModel.prototype.getWorkQueue,sortCallback:$.proxy(function(a,b,c){this.rankInWorkQueue(a,
b,c)},this),sortOptions:{items:"\x3e .dynamicTableDataRow",handle:"."+DynamicTable.cssClasses.dragHandle}})};
WorkQueueController.prototype._addColumnConfigs=function(a){a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.prio,WorkQueueController.columnConfig.prio);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.name,TasksWithoutStoryController.columnConfig.name);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.state,TasksWithoutStoryController.columnConfig.state);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.context,
WorkQueueController.columnConfig.context);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.detailedContext,WorkQueueController.columnConfig.detailedContext);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.responsibles,TasksWithoutStoryController.columnConfig.responsibles);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.el,TasksWithoutStoryController.columnConfig.effortLeft);Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.es,
TasksWithoutStoryController.columnConfig.effortSpent);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.actions,TasksWithoutStoryController.columnConfig.actions);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.details,TasksWithoutStoryController.columnConfig.details);a.addColumnConfiguration(DailyWorkTasksWithoutStoryController.columnIndices.buttons,TasksWithoutStoryController.columnConfig.buttons)};
WorkQueueController.columnConfig.detailedContext={columnName:"detailedContext",minWidth:15,autoScale:!0,title:"",headerTooltip:"",subViewFactory:WorkQueueController.prototype.taskContextFactory};
var TaskSplitDialog=function(a,b){var c=this;this.model=a;this.init();this.initDialog();this.initConfigs();this.render();this.editListener=function(a){c._transactionEditListener(a)};this.model.addListener(this.editListener);this.newModels=[];this.rows=[];this.onSuccessCallback=b};TaskSplitDialog.prototype=new CommonController;
TaskSplitDialog.prototype.initDialog=function(){var a=this;this.element=$("\x3cdiv/\x3e").appendTo(document.body);this.element.dialog({width:750,position:"top",modal:!0,draggable:!0,resizable:!0,title:"Split task",close:function(){a._cancel()},buttons:{Cancel:function(){a._cancel()},Save:function(){a._save()}}});this.taskInfoElement=$("\x3cdiv/\x3e").addClass("task-info").appendTo(this.element);this.taskListElement=$("\x3cdiv/\x3e").addClass("task-split-list").appendTo(this.element)};
TaskSplitDialog.prototype.render=function(){this.taskInfoView=new DynamicVerticalTable(this,this.model,this.taskInfoConfig,this.taskInfoElement);this.taskInfoView.render();this.tasksView=new DynamicTable(this,this.model,this.taskListConfig,this.taskListElement)};TaskSplitDialog.prototype._transactionEditListener=function(a){a instanceof DynamicsEvents.TransactionEditEvent&&(a.getObject()===this.model?this.taskInfoView.render():jQuery.each(this.rows,function(a,c){c.render()}))};
TaskSplitDialog.prototype.areAllRowsValid=function(){for(var a=this.taskInfoView.getValidationManager().isValid(),b=this.tasksView.upperRows,c=0;c<b.length;c++)a=b[c].getValidationManager().isValid()&&a;return a};TaskSplitDialog.prototype._save=function(){this.areAllRowsValid()&&(this.saveTasks(),this.close())};TaskSplitDialog.prototype._cancel=function(){this.model.rollback();this.tasksView.remove();this.close()};TaskSplitDialog.prototype.close=function(){this._removeListeners();this.element.dialog("destroy").remove()};
TaskSplitDialog.prototype._removeListeners=function(){this.model.removeListener(this.editListener)};TaskSplitDialog.prototype.taskControllerFactory=function(a,b){b.addListener(this.editListener);this.rows.push(a);var c=new TaskController(b,a,this);this.addChildController("task",c);return c};
TaskSplitDialog.prototype.createTask=function(){var a=ModelFactory.createObject(ModelFactory.types.task);this.newModels.push(a);var b=new TaskController(a,null,this),c=this.tasksView.createRow(b,a,"top","last");$.each(this.model.getResponsibles(),function(b,c){a.addResponsible(c.getId())});b.view=c;c.autoCreateCells([TaskSplitDialog.columnIndices.description]);c.render();c.editRow();this.rows.push(c)};TaskSplitDialog.prototype.saveTasks=function(){(new TaskSplitContainer(this.model,this.newModels)).commit(this.onSuccessCallback)};
TaskSplitDialog.prototype.rowCancelFactory=function(a,b){var c=this,d=[];b.getId()||d.push({text:"Cancel",callback:function(){ArrayUtils.remove(c.rows,a.getRow());ArrayUtils.remove(c.newModels,b);a.getRow().remove()}});return new DynamicsButtons(this,d,a)};TaskSplitDialog.prototype.initConfigs=function(){this._initOriginalTaskConfig();this._initTaskListConfig()};
TaskSplitDialog.prototype._initOriginalTaskConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"75%",cssClass:"ui-widget-content ui-corner-all",preventCommit:!0,closeRowCallback:null});a.addColumnConfiguration(0,{title:"Name",get:TaskModel.prototype.getName,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Text",required:!0,set:TaskModel.prototype.setName}});a.addColumnConfiguration(1,{openOnRowEdit:!1,title:"Effort left",headerTooltip:"Effort left in hours",
get:TaskModel.prototype.getEffortLeft,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,set:TaskModel.prototype.setEffortLeft}});a.addColumnConfiguration(2,{title:"State",get:TaskModel.prototype.getState,decorator:DynamicsDecorators.taskStateColorDecorator,editable:!0,edit:{editor:"Selection",items:DynamicsDecorators.stateOptions,set:TaskModel.prototype.setState}});a.addColumnConfiguration(3,
{minWidth:60,autoScale:!0,title:"Responsibles",headerTooltip:"Task responsibles",get:TaskModel.prototype.getResponsibles,getView:TaskModel.prototype.getAnnotatedResponsibles,decorator:DynamicsDecorators.annotatedUserInitialsListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:TaskModel.prototype.setResponsibles}});this.taskInfoConfig=a};
TaskSplitDialog.columnIndices={name:0,state:1,responsibles:2,cancel:3,description:4};
TaskSplitDialog.prototype._initTaskListConfig=function(){var a=this,b=new DynamicTableConfiguration({caption:"New tasks",cssClass:"ui-widget-content ui-corner-all",rowControllerFactory:TaskSplitDialog.prototype.taskControllerFactory,dataSource:TaskModel.prototype.getChildren,preventCommit:!0,closeRowCallback:null});b.addCaptionItem({text:"Create a task",name:"createTask",cssClass:"create",callback:TaskSplitDialog.prototype.createTask});b.addColumnConfiguration(TaskSplitDialog.columnIndices.name,{minWidth:280,
autoScale:!0,cssClass:"projecttask-row",title:"Name",headerTooltip:"Task name",get:TaskModel.prototype.getName,editable:!0,visualizedEditable:!0,defaultSortColumn:!0,edit:{editor:"Text",set:TaskModel.prototype.setName,required:!0}});b.addColumnConfiguration(TaskSplitDialog.columnIndices.state,{minWidth:80,autoScale:!0,cssClass:"projecttask-row",title:"State",headerTooltip:"Task state",get:TaskModel.prototype.getState,decorator:DynamicsDecorators.taskStateColorDecorator,editable:!0,edit:{editor:"Selection",
set:TaskModel.prototype.setState,items:DynamicsDecorators.stateOptions}});b.addColumnConfiguration(TaskSplitDialog.columnIndices.responsibles,{minWidth:100,autoScale:!0,cssClass:"projecttask-row",title:"Responsibles",headerTooltip:"Task responsibles",get:TaskModel.prototype.getResponsibles,getView:TaskModel.prototype.getAnnotatedResponsibles,decorator:DynamicsDecorators.annotatedUserInitialsListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",
dataType:"usersAndTeams",set:TaskModel.prototype.setResponsibles}});b.addColumnConfiguration(TaskSplitDialog.columnIndices.cancel,{visible:!0,minWidth:70,autoScale:!0,cssClass:"projecttask-row",title:"Cancel",subViewFactory:function(c,b){return a.rowCancelFactory(c,b)}});b.addColumnConfiguration(TaskController.columnIndices.description,{columnName:"description",fullWidth:!0,visible:!1,get:TaskModel.prototype.getDescription,cssClass:"projecttask-data",editable:!0,visualizedEditable:!0,edit:{editor:"Wysiwyg",
set:TaskModel.prototype.setDescription}});this.taskListConfig=b};
var UserController=function(a){this.id=a.id;this.infoElement=a.userInfoElement;this.userSettingsElement=a.userSettingsElement;this.init();this.initConfigs();this.paint()};UserController.prototype=new BacklogController;UserController.prototype.paint=function(){var a=this;ModelFactory.initializeFor(ModelFactory.initializeForTypes.user,this.id,function(b){a.model=b;a._renderTables()})};
UserController.prototype._renderTables=function(){this.infoView=new DynamicVerticalTable(this,this.model,this.userInfoConfig,this.infoElement);this.infoView.render()};UserController.prototype.changePassword=function(){new ChangePasswordDialog(this.model)};UserController.prototype.initConfigs=function(){this._initUserInfoConfig()};UserController.columnIndices={fullName:0,loginName:1,password:2,initials:3,email:4,weekEffort:5,recentItemsNumberOfWeeks:6,teams:7};
UserController.prototype._initUserInfoConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"79%",cssClass:"ui-widget-content ui-corner-all",caption:"User info",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},validators:[UserModel.Validators.loginNameValidator],closeRowCallback:null}),b=PageController.getInstance().getCurrentUser(),c=function(){return"******"};if(b.getAdmin()||b.getId()==this.id)a.addColumnConfiguration(UserController.columnIndices.fullName,
{title:"Name",get:UserModel.prototype.getFullName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,set:UserModel.prototype.setFullName}}),a.addColumnConfiguration(UserController.columnIndices.loginName,{title:"Login name",get:UserModel.prototype.getLoginName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,set:UserModel.prototype.setLoginName}}),a.addColumnConfiguration(UserController.columnIndices.initials,{title:"Initials",get:UserModel.prototype.getInitials,editable:!0,
visualizedEditable:!0,edit:{editor:"Text",required:!0,set:UserModel.prototype.setInitials}}),a.addColumnConfiguration(UserController.columnIndices.email,{title:"Email",get:UserModel.prototype.getEmail,editable:!0,visualizedEditable:!0,edit:{editor:"Email",required:!0,set:UserModel.prototype.setEmail}}),a.addColumnConfiguration(UserController.columnIndices.weekEffort,{title:"Weekly hours",get:UserModel.prototype.getWeekEffort,editable:!0,visualizedEditable:!0,decorator:DynamicsDecorators.exactEstimateDecorator,
edit:{editor:"ExactEstimate",required:!0,set:UserModel.prototype.setWeekEffort,decorator:DynamicsDecorators.exactEstimateEditDecorator}}),a.addColumnConfiguration(UserController.columnIndices.recentItemsNumberOfWeeks,{title:"Recent items (weeks)",get:UserModel.prototype.getRecentItemsNumberOfWeeks,editable:!0,visualizedEditable:!0,edit:{editor:"Number",required:!0,set:UserModel.prototype.setRecentItemsNumberOfWeeks}}),b.getAdmin()?a.addColumnConfiguration(UserController.columnIndices.teams,{title:"Teams",
get:UserModel.prototype.getTeams,decorator:DynamicsDecorators.teamListDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dataType:"teams",dialogTitle:"Select teams",set:UserModel.prototype.setTeams}}):a.addColumnConfiguration(UserController.columnIndices.teams,{title:"Teams",get:UserModel.prototype.getTeams,decorator:DynamicsDecorators.teamListDecorator,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.password,{title:"Password",get:c,visualizedEditable:!0,onClick:UserController.prototype.changePassword});
!b.getAdmin()&&b.getId()!=this.id&&(a.addColumnConfiguration(UserController.columnIndices.fullName,{title:"Name",get:UserModel.prototype.getFullName,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.loginName,{title:"Login name",get:UserModel.prototype.getLoginName,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.initials,{title:"Initials",get:UserModel.prototype.getInitials,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.email,{title:"Email",
get:UserModel.prototype.getEmail,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.weekEffort,{title:"Weekly hours",decorator:DynamicsDecorators.exactEstimateDecorator,get:UserModel.prototype.getWeekEffort,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.recentItemsNumberOfWeeks,{title:"Recent items (weeks)",get:UserModel.prototype.getRecentItemsNumberOfWeeks,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.teams,{title:"Teams",get:UserModel.prototype.getTeams,
decorator:DynamicsDecorators.teamListDecorator,editable:!1}),a.addColumnConfiguration(UserController.columnIndices.password,{title:"Password",get:c}));this.userInfoConfig=a};
var StoryInfoBubble=function(a,b,f,e){this.id=a;this.treeController=b;this.storyElement=f;this.options=e;this.init()};extendObject(StoryInfoBubble,StoryController);StoryInfoBubble.prototype.init=function(){this.id&&(this.createBubble(),this.populateContent())};
StoryInfoBubble.prototype.checkForMoveStory=function(a){if(a.currentData.backlog||a.currentData.iteration){a.currentData.backlog?this._openMoveStoryDialog(a,a.currentData.backlog):this._openMoveStoryDialog(a,a.currentData.iteration);var b=this;setTimeout(function(){a.currentData.backlog&&!a.currentData.iteration?a.canMoveStory(a.currentData.backlog)&&(b._closeMoveDialog(),a.commit()):!a.currentData.backlog&&a.currentData.iteration&&a.canMoveStory(a.currentData.iteration)&&(b._closeMoveDialog(),a.commit())},
200)}else a.commit()};
StoryInfoBubble.prototype.confirmTasksAndChildrenToDone=function(a,b,f){var e=a.getTasks(),d=a.getChildren(),h=a.getChangedData();if("DONE"===h.state){var k=!1,g=!1;if(0<d.length)for(var c=0;c<d.length;c++)"DONE"!==d[c].getState()&&(k=!0);if(0<e.length)for(c=0;c<e.length;c++)"DONE"!==e[c].getState()&&(g=!0);if(k||g)if(f)h.state&&"DONE"===h.state&&0<e.length?new DynamicsConfirmationDialog("Set all tasks' and stories' states to done?","The '"+a.getName()+"' story has undone child tasks/stories! Do you want to set them Done as well?",function(){for(var c=
0;c<d.length;c++)"DONE"!==d[c].getState()&&(d[c].setState("DONE"),d[c].commit()),b._getStoryForId(d[c].getId(),function(a){StoryInfoBubble.prototype.confirmTasksAndChildrenToDone(a,b,!1)});g&&(a.currentData.tasksToDone=!0);a.commit()},function(){a.commit()}):a.commit();else{for(c=0;c<d.length;c++)"DONE"!==d[c].getState()&&(d[c].setState("DONE"),d[c].commit(),b._getStoryForId(d[c].getId(),function(a){StoryInfoBubble.prototype.confirmTasksAndChildrenToDone(a,b,!1)}));g&&(a.currentData.tasksToDone=!0);
a.commit()}!k&&!f&&b.refresh()}};StoryInfoBubble.prototype.handleModelEvents=function(a){StoryController.prototype.handleModelEvents.call(this,a);a instanceof DynamicsEvents.NamedEvent&&"storyMoved"===a.getEventName()?(this.treeController.refresh(),this.bubble.destroy()):"off"!==Configuration.getBranchMetricsType()&&(a instanceof DynamicsEvents.MetricsEvent&&a.getObject().getId()==this.id)&&this.refreshBranchMetrics()};
StoryInfoBubble.prototype.createBubble=function(){var a=this;this.bubble=new Bubble(this.storyElement,$.extend({},{closeCallback:function(){a.treeController.refreshNode(a.storyElement);Bubble.closeAll()},title:"Story info"},this.options));this.element=this.bubble.getElement()};
StoryInfoBubble.prototype.populateContent=function(){var a=this;this.storyInfoConfig=this._createConfig();this.storyInfoElement=$('\x3cdiv style\x3d"clear: both;"/\x3e').appendTo(this.element);$('\x3cdiv style\x3d"width: 100%; text-align:center;"\x3e\x3cspan\x3e\x3cimg src\x3d"static/img/pleasewait.gif" /\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(this.storyInfoElement);this.treeController._getStoryForId(this.id,function(b){a.model=b;a.attachModelListener();a.storyInfoElement.html("");a.storyInfoView=
new DynamicVerticalTable(a,a.model,a.storyInfoConfig,a.storyInfoElement);a.storyInfoView.render();a.addLinks()});"off"!==Configuration.getBranchMetricsType()&&(this.branchMetricsElement=$('\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e').appendTo(this.element),this.refreshBranchMetrics())};
StoryInfoBubble.prototype.refreshBranchMetrics=function(){this.branchContent||(this.branchContent=$("\x3cdiv/\x3e").appendTo(this.branchMetricsElement));this.branchContent.html('\x3cdiv style\x3d"text-align:center;"\x3e\x3cimg src\x3d"static/img/working.gif" alt\x3d"Please wait..." style\x3d"display: inline-block;"/\x3e\x3c/div\x3e').load("ajax/retrieveBranchMetrics.action?storyId\x3d"+this.id)};
StoryInfoBubble.prototype.addLinks=function(){var a=this,b=$('\x3cdiv style\x3d"height: 1.5em;" /\x3e').addClass("details-links");this.element.find(".close-button").after(b);$('\x3ca href\x3d"javascript:"\x3espent effort\x3c/a\x3e').click(function(){a.bubble.destroy();a.openLogEffort()}).appendTo(b);this.treeController.mock||($('\x3ca href\x3d"javascript:"\x3eadd child\x3c/a\x3e').click(function(){a.bubble.destroy();a.treeController.createNode(a.storyElement,"inside",a.model)}).appendTo(b),$('\x3ca href\x3d"javascript:"\x3eadd sibling\x3c/a\x3e').click(function(){a.bubble.destroy();
a.treeController.createNode(a.storyElement,"after",a.model)}).appendTo(b));$('\x3ca href\x3d"javascript:"\x3edelete\x3c/a\x3e').click(function(){a.bubble.destroy();a.treeController._getStoryForId(a.id,function(b){b.addListener(function(b){b instanceof DynamicsEvents.DeleteEvent&&a.treeController.removeNode(a.storyElement)});(new StoryController(b,null,null)).removeStory()})}).appendTo(b)};
StoryInfoBubble.prototype._createConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"28%",rightWidth:"71%",closeRowCallback:null,beforeCommitFunction:function(a){StoryInfoBubble.prototype.confirmTasksAndChildrenToDone(a,this.treeController,!0);StoryInfoBubble.prototype.checkForMoveStory(a)},validators:[]});a.addColumnConfiguration(0,{title:"Name",get:StoryModel.prototype.getName,editable:!0,visualizedEditable:!0,edit:{editor:"Text",required:!0,set:StoryModel.prototype.setName}});a.addColumnConfiguration(1,
{title:"Points",get:StoryModel.prototype.getStoryPoints,decorator:DynamicsDecorators.estimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Number",required:!1,set:StoryModel.prototype.setStoryPoints}});a.addColumnConfiguration(2,{title:"Reference ID",get:StoryModel.prototype.getId,decorator:DynamicsDecorators.linkToWorkItem});a.addColumnConfiguration(3,{title:"State",get:StoryModel.prototype.getState,decorator:DynamicsDecorators.storyStateColorDecorator,editable:!0,edit:{editor:"Selection",
set:StoryModel.prototype.setState,items:DynamicsDecorators.stateOptions}});a.addColumnConfiguration(4,{title:"Value",get:StoryModel.prototype.getStoryValue,decorator:DynamicsDecorators.estimateDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Number",required:!1,set:StoryModel.prototype.setStoryValue}});a.addColumnConfiguration(5,{title:"Product\x26nbsp;/\x26nbsp;Project",headerTooltip:"The backlog, where the story resides",get:StoryModel.prototype.getBacklog,decorator:DynamicsDecorators.backlogSelectDecorator,
editable:!0,visualizedEditable:!0,edit:{editor:"AutocompleteSingle",dialogTitle:"Select backlog",dataType:"backlogs",set:StoryModel.prototype.setBacklogByModel}});a.addColumnConfiguration(6,{title:"Iteration",headerTooltip:"The iteration where the story has been assigned to",get:StoryModel.prototype.getIteration,decorator:DynamicsDecorators.iterationSelectDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"AutocompleteSingle",dialogTitle:"Select iteration",dataType:"currentIterations",set:StoryModel.prototype.setIterationByModel}});
a.addColumnConfiguration(7,{title:"Responsibles",get:StoryModel.prototype.getResponsibles,decorator:DynamicsDecorators.responsiblesDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:StoryModel.prototype.setResponsibles}});a.addColumnConfiguration(8,{title:"Labels",subViewFactory:StoryInfoBubble.prototype.labelsViewFactory});a.addColumnConfiguration(9,{title:"Description",get:StoryModel.prototype.getDescription,editable:!0,
visualizedEditable:!0,decorator:StoryInfoBubble.prototype.descriptionDecorator,edit:{editor:"Wysiwyg",set:StoryModel.prototype.setDescription}});return a};StoryInfoBubble.prototype.descriptionDecorator=function(a){return!a?DynamicsDecorators.emptyDescriptionDecorator():'\x3cdiv style\x3d"max-height: 20em; overflow: auto;"\x3e'+a+"\x3c/div\x3e"};StoryInfoBubble.prototype.labelsViewFactory=function(a,b){return new LabelsView({},this,b,a)};
var UserListController=function(a){this.enabledUserListElement=a.enabledElement;this.disabledUserListElement=a.disabledElement;this.model=null;this.init();this.initConfig();this.paint();window.pageController&&window.pageController.setMainController(this)};UserListController.prototype=new CommonController;UserListController.prototype.pageControllerDispatch=function(a){(a instanceof DynamicsEvents.AddEvent||a instanceof DynamicsEvents.DeleteEvent)&&a.getObject()instanceof UserModel&&this.model.reload()};
UserListController.prototype.handleModelEvents=function(a){a instanceof DynamicsEvents.EditEvent&&a.getObject()instanceof UserModel&&(this.userListView.render(),this.disabledUserListView.render())};UserListController.prototype.userControllerFactory=function(a,b){var c=new UserRowController(b,a,this);this.addChildController("user",c);return c};UserListController.prototype.createUser=function(){new CreateDialog.User};
UserListController.prototype.paintEnabledUserList=function(){this.userListView=new DynamicTable(this,this.model,this.enabledUserListConfig,this.enabledUserListElement);this.userListView.render()};UserListController.prototype.paintDisabledUserList=function(){this.disabledUserListView=new DynamicTable(this,this.model,this.disabledUserListConfig,this.disabledUserListElement);this.disabledUserListView.render()};
UserListController.prototype.paint=function(){var a=this;ModelFactory.initializeFor(ModelFactory.initializeForTypes.users,1,function(b){a.model=b;a.paintEnabledUserList();a.paintDisabledUserList()})};
UserListController.prototype.initConfig=function(){this.enabledUserListConfig=new DynamicTableConfiguration({caption:"Enabled users",dataSource:UserListContainer.prototype.getEnabledUsers,rowControllerFactory:UserListController.prototype.userControllerFactory,cssClass:"ui-widget-content ui-corner-all administration-user-table",validators:[UserModel.Validators.loginNameValidator],captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"}});var a=PageController.getInstance().getCurrentUser();
this.enabledUserListConfig.addCaptionItem({text:"Create user",name:"createUser",callback:UserListController.prototype.createUser});this.disabledUserListConfig=new DynamicTableConfiguration({caption:"Disabled users",dataSource:UserListContainer.prototype.getDisabledUsers,rowControllerFactory:UserListController.prototype.userControllerFactory,cssClass:"ui-widget-content ui-corner-all administration-user-table",validators:[UserModel.Validators.loginNameValidator],captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"}});
var b={minWidth:150,autoScale:!0,title:"Name",get:UserModel.prototype.getFullName,decorator:DynamicsDecorators.idLinkDecoratorFactory("editUser.action?userId\x3d#id"),defaultSortColumn:!0,sortCallback:DynamicsComparators.valueComparatorFactory(UserModel.prototype.getFullName)},c={minWidth:80,autoScale:!0,title:"Initials",get:UserModel.prototype.getInitials,sortCallback:DynamicsComparators.valueComparatorFactory(UserModel.prototype.getInitials)};DynamicsComparators.valueComparatorFactory(UserModel.prototype.getEmail);
DynamicsComparators.valueComparatorFactory(UserModel.prototype.getWeekEffort);if(a.getAdmin())var d={minWidth:60,autoScale:!0,title:"Actions",subViewFactory:UserRowController.prototype.userActionFactory};var e={minWidth:60,autoScale:!0,title:"Administrator",get:UserModel.prototype.getAdminAsString,sortCallback:DynamicsComparators.valueComparatorFactory(UserModel.prototype.getInitials)};this.enabledUserListConfig.addColumnConfiguration(0,b);this.enabledUserListConfig.addColumnConfiguration(1,c);a.getAdmin()&&
this.enabledUserListConfig.addColumnConfiguration(4,d);this.enabledUserListConfig.addColumnConfiguration(5,e);this.disabledUserListConfig.addColumnConfiguration(0,b);this.disabledUserListConfig.addColumnConfiguration(1,c);a.getAdmin()&&this.disabledUserListConfig.addColumnConfiguration(4,d);this.disabledUserListConfig.addColumnConfiguration(5,e)};
var UserRowController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};UserRowController.prototype=new CommonController;UserRowController.prototype.userActionFactory=function(a,b){return new DynamicTableRowActions([{text:"Enable",callback:UserRowController.prototype.enableUser,enabled:UserRowController.prototype.showEnableAction},{text:"Disable",callback:UserRowController.prototype.disableUser,enabled:UserRowController.prototype.showDisableAction}],this,this.model,a)};
UserRowController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a)};UserRowController.prototype.showEnableAction=function(){return!this.model.isEnabled()};UserRowController.prototype.showDisableAction=function(){return this.model.isEnabled()};UserRowController.prototype.disableUser=function(){this.model.setEnabled(!1);this.model.commit()};UserRowController.prototype.enableUser=function(){this.model.setEnabled(!0);this.model.commit()};
UserRowController.prototype.changePassword=function(){var a=this.model,b=$("\x3cdiv/\x3e").appendTo(document.body);$("\x3cdiv/\x3e").text("Change password of "+a.getFullName()).appendTo(b);var c=$("\x3cdiv/\x3e").text("New password: ").appendTo(b),d=$('\x3cinput type\x3d"password"/\x3e').appendTo(c);b.dialog({modal:!0,buttons:{Cancel:function(){b.dialog("destroy");b.remove()},Ok:function(){a.setPassword1(d.val());b.dialog("destroy");b.remove()}}})};
UserRowController.prototype.userButtonsFactory=function(a,b){return new DynamicsButtons(this,[{text:"Save",callback:UserRowController.prototype.saveUser},{text:"Cancel",callback:UserRowController.prototype.cancelEdit}],a)};UserRowController.prototype.userToggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({collapse:UserRowController.prototype.hideDetails,expand:UserRowController.prototype.showDetails,expanded:!1},this,a)};UserRowController.prototype.hideDetails=function(){this.view.getCell(UserRowController.columnIndices.password).hide()};
UserRowController.prototype.showDetails=function(){this.view.getCell(UserRowController.columnIndices.password).show()};UserRowController.prototype.cancelEdit=function(){this.model.getId()?(this.model.setInTransaction(!1),this.view.closeRowEdit(),this.view.getCell(UserRowController.columnIndices.password).hide(),this.view.getCell(UserRowController.columnIndices.buttons).hide(),this.model.rollback()):this.view.remove()};
UserRowController.prototype.saveUser=function(){var a=!this.model.getId();this.view.saveRowEdit()&&(this.model.commit(),a?this.view.remove():this.view.getCell(StoryController.columnIndices.buttons).hide())};
var TeamListController=function(a){this.teamListElement=a.element;this.model=null;this.init();this.initConfig();this.paint();window.pageController&&window.pageController.setMainController(this)};TeamListController.prototype=new CommonController;TeamListController.prototype.teamControllerFactory=function(a,b){var c=new TeamRowController(b,a,this);this.addChildController("team",c);return c};TeamListController.prototype.createTeam=function(){new CreateDialog.Team};
TeamListController.prototype.paintTeamList=function(){this.teamListView=new DynamicTable(this,this.model,this.teamListConfig,this.teamListElement);this.teamListView.render()};TeamListController.prototype.pageControllerDispatch=function(a){(a instanceof DynamicsEvents.AddEvent||a instanceof DynamicsEvents.DeleteEvent)&&a.getObject()instanceof TeamModel&&this.model.reload()};
TeamListController.prototype.paint=function(){var a=this;ModelFactory.initializeFor(ModelFactory.initializeForTypes.teams,1,function(b){a.model=b;a.paintTeamList()})};TeamListController.prototype.toggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({expanded:!1,targetCell:3},this,a)};
TeamListController.prototype.initConfig=function(){this.teamListConfig=new DynamicTableConfiguration({caption:"Teams",dataSource:TeamListContainer.prototype.getTeams,rowControllerFactory:TeamListController.prototype.teamControllerFactory,cssClass:"ui-widget-content ui-corner-all administration-team-table",validators:[],captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"}});var a=PageController.getInstance().getCurrentUser();a.getAdmin()&&this.teamListConfig.addCaptionItem({text:"Create team",
name:"createTeam",callback:TeamListController.prototype.createTeam});var b=a.getAdmin()?{minWidth:200,autoScale:!0,title:"Name",get:TeamModel.prototype.getName,defaultSortColumn:!0,cssClass:"strong-text",sortCallback:DynamicsComparators.valueComparatorFactory(TeamModel.prototype.getName),editable:!0,visualizedEditable:!0,edit:{editor:"Text",set:TeamModel.prototype.setName}}:{minWidth:200,autoScale:!0,title:"Name",get:TeamModel.prototype.getName,defaultSortColumn:!0,cssClass:"strong-text",sortCallback:DynamicsComparators.valueComparatorFactory(TeamModel.prototype.getName),
editable:!1},c={minWidth:30,autoScale:!0,title:"Members",decorator:DynamicsDecorators.teamUserCountDecorator,get:TeamModel.prototype.getUsers},d=a.getAdmin()?{autoScale:!1,fullWidth:!0,get:TeamModel.prototype.getUsers,decorator:DynamicsDecorators.teamUserListDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dataType:"usersAndTeams",dialogTitle:"Select users",set:TeamModel.prototype.setUsers,showSelectAllItems:!0,showRemoveAllItems:!0}}:{autoScale:!1,fullWidth:!0,get:TeamModel.prototype.getUsers,
decorator:DynamicsDecorators.teamUserListDecorator,editable:!1};if(a.getAdmin())var e={minWidth:30,autoScale:!0,title:"Actions",subViewFactory:TeamRowController.prototype.teamActionFactory};this.teamListConfig.addColumnConfiguration(0,b);this.teamListConfig.addColumnConfiguration(1,c);this.teamListConfig.addColumnConfiguration(3,d);this.teamListConfig.addColumnConfiguration(2,e)};
var TeamRowController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};TeamRowController.prototype=new CommonController;TeamRowController.prototype.teamActionFactory=function(a,b){return new DynamicTableRowActions([{text:"Delete",callback:TeamRowController.prototype.removeTeam,enabled:!0}],this,this.model,a)};TeamRowController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a)};
TeamRowController.prototype.removeTeam=function(a){var b=this;(new LazyLoadedFormDialog).init({title:"Delete Team",url:"ajax/deleteTeamForm.action",data:{teamId:b.model.getId()},okCallback:function(a){b.model.remove(function(){b.parentController.removeChildController("team",this)},a)}})};
var CreateDialog={configurations:{product:{title:"Create a new product"},project:{title:"Create a new project"},iteration:{title:"Create a new iteration"},story:{title:"Create a new story"},user:{title:"Create a new user"},team:{title:"Create a new team"},effortEntry:{title:"Log effort"}},returnNull:function(){return null},returnEmptyString:function(){return""}},CreateDialogClass=function(){};CreateDialogClass.prototype=new ViewPart;
CreateDialogClass.prototype.init=function(a){var b=this;this.element=$("\x3cdiv/\x3e").appendTo(document.body);var c={modal:!0,resizable:!1,draggable:!0,width:750,position:"top",buttons:{Cancel:function(){b._cancel()},Ok:function(){b._ok()}}};jQuery.extend(c,a);this.element.dialog(c);this.initializeForm()};CreateDialogClass.prototype.initFormConfig=function(){throw"Abstract method called: initFormConfig";};
CreateDialogClass.prototype._ok=function(){this.view.getValidationManager().isValid()&&(this.model.commit(),this.close())};CreateDialogClass.prototype._cancel=function(){this.close()};CreateDialogClass.prototype.close=function(){this.element.dialog("destroy").remove();this.closeCallback&&this.closeCallback()};CreateDialogClass.prototype.getModel=function(){return this.model};CreateDialogClass.prototype.getElement=function(){return this.element};
CreateDialogClass.prototype.setCloseCallback=function(a){this.closeCallback=a};CreateDialogClass.prototype.initializeForm=function(){this.form=$("\x3cform/\x3e").appendTo(this.element);this.formArea=$("\x3cdiv/\x3e").appendTo(this.form);this.view=new DynamicVerticalTable(this,this.model,this.formConfig,this.formArea);this.view.render();this.view.openFullEdit()};CreateDialog.Product=function(){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.product);this.initFormConfig();this.init(CreateDialog.configurations.product)};
CreateDialog.Product.prototype=new CreateDialogClass;CreateDialog.Product.columnIndices={name:0,description:1,teams:2,warning:3};
CreateDialog.Product.prototype.initFormConfig=function(){var a=PageController.getInstance().getCurrentUser(),b=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"75%",closeRowCallback:CreateDialogClass.prototype.close});b.addColumnConfiguration(CreateDialog.Product.columnIndices.name,{title:"Name",editable:!0,get:ProductModel.prototype.getName,edit:{editor:"Text",required:!0,visualizeRequired:!0,set:ProductModel.prototype.setName}});b.addColumnConfiguration(CreateDialog.Product.columnIndices.description,
{title:"Description",get:ProductModel.prototype.getDescription,editable:!0,edit:{editor:"Wysiwyg",set:ProductModel.prototype.setDescription}});b.addColumnConfiguration(CreateDialog.Product.columnIndices.teams,{title:"Grant which teams access to product?",get:function(){return"MYTEAMS"},editable:!0,edit:{editor:"Selection",items:a.getAdmin()?DynamicsDecorators.teamAdminOptions:DynamicsDecorators.teamNonAdminOptions,set:ProductModel.prototype.setAllTeams,size:"25ex",required:!0}});b.addColumnConfiguration(CreateDialog.Product.columnIndices.warning,
{title:"",cssClass:"warning-text",editable:!1,get:function(){return a.getAdmin()?"Warning! If you select 'none', you won't be able to access the product. You can modify access rights later from 'Administration' \x3d\x3e 'Access rights'.":"Warning! If you select 'none', you won't be able to access the product. You can ask your Agilefant admin to grant you access rights."}});this.formConfig=b};
CreateDialog.Project=function(a,b){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.project);var c=new Date,d=new Date;c.zeroTime();c.addHours(8);d.zeroTime();d.addDays(14);d.addHours(18);this.model.setStartDate(c.getTime());this.model.setEndDate(d.getTime());CreateDialog.fillBacklogField(this.model,a,b);this.initFormConfig();this.init(CreateDialog.configurations.project)};CreateDialog.Project.prototype=new CreateDialogClass;
CreateDialog.Project.columnIndices={name:0,parent:1,startDate:2,endDate:3,assignees:4,description:5};
CreateDialog.Project.prototype.initFormConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"24%",rightWidth:"75%",validators:[BacklogModel.Validators.dateValidator,BacklogModel.Validators.parentValidator],closeRowCallback:CreateDialogClass.prototype.close});a.addColumnConfiguration(CreateDialog.Project.columnIndices.name,ProjectController.columnConfigs.name);a.addColumnConfiguration(CreateDialog.Project.columnIndices.parent,{title:"Product",get:ProjectModel.prototype.getParent,decorator:DynamicsDecorators.backlogSelectDecorator,
editable:!0,edit:{editor:"InlineAutocomplete",dataType:"products",visualizeRequired:!0,decorator:DynamicsDecorators.propertyDecoratorFactory(BacklogModel.prototype.getName),set:ProjectModel.prototype.setParent}});a.addColumnConfiguration(CreateDialog.Project.columnIndices.startDate,ProjectController.columnConfigs.startDate);a.addColumnConfiguration(CreateDialog.Project.columnIndices.endDate,ProjectController.columnConfigs.endDate);a.addColumnConfiguration(CreateDialog.Project.columnIndices.assignees,
ProjectController.columnConfigs.assignees);a.addColumnConfiguration(CreateDialog.Project.columnIndices.description,ProjectController.columnConfigs.description);this.formConfig=a};
CreateDialog.Iteration=function(a,b){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.iteration);var c=new Date,d=new Date;c.zeroTime();c.addHours(8);d.zeroTime();d.addDays(14);d.addHours(18);this.model.setStartDate(c.getTime());this.model.setEndDate(d.getTime());CreateDialog.fillBacklogField(this.model,a,b);this.initFormConfig();this.init(CreateDialog.configurations.iteration)};CreateDialog.Iteration.prototype=new CreateDialogClass;
CreateDialog.Iteration.columnIndices={name:0,parent:1,startDate:2,endDate:3,assignees:4,description:5,teams:6,warning:7};
CreateDialog.Iteration.prototype.initFormConfig=function(){var a=PageController.getInstance().getCurrentUser(),b=new DynamicTableConfiguration({leftWidth:"24%",rightWidth:"75%",closeRowCallback:CreateDialogClass.prototype.close,validators:[BacklogModel.Validators.dateValidator,BacklogModel.Validators.parentValidator]});b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.name,IterationController.columnConfigs.name);b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.parent,{title:"Project (leave empty to create a standalone iteration)",
get:IterationModel.prototype.getParent,decorator:DynamicsDecorators.backlogSelectDecorator,editable:!0,edit:{required:!1,editor:"InlineAutocomplete",dataType:"projects",decorator:DynamicsDecorators.propertyDecoratorFactory(BacklogModel.prototype.getName),set:IterationModel.prototype.setParent}});b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.startDate,IterationController.columnConfigs.startDate);b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.endDate,IterationController.columnConfigs.endDate);
b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.assignees,IterationController.columnConfigs.assignees);b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.description,IterationController.columnConfigs.description);b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.teams,{title:"Grant which teams access to iteration?",get:function(){return"MYTEAMS"},editable:!0,edit:{editor:"Selection",items:a.getAdmin()?DynamicsDecorators.teamAdminOptions:DynamicsDecorators.teamNonAdminOptions,
set:IterationModel.prototype.setAllTeams,size:"25ex",required:!0}});b.addColumnConfiguration(CreateDialog.Iteration.columnIndices.warning,{title:"",cssClass:"warning-text",editable:!1,get:function(){return a.getAdmin()?"Warning! If you select 'none', you won't be able to access the standalone iteration. You can modify access rights later from 'Administration' \x3d\x3e 'Access rights'.":"Warning! If you select 'none', you won't be able to access the standalone iteration. You can ask your Agilefant admin to grant you access rights."}});
this.formConfig=b};CreateDialog.Story=function(a,b){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.story);var c=PageController.getInstance().getCurrentUser();c.isAutoassignToStories()&&this.model.setResponsibles([c.getId()]);CreateDialog.fillBacklogField(this.model,a,b);this.initFormConfig();this.init(CreateDialog.configurations.story)};CreateDialog.Story.prototype=new CreateDialogClass;CreateDialog.Story.columnIndices={name:0,backlog:1,state:2,storyPoints:3,responsibles:4,description:5};
CreateDialog.Story.prototype.initFormConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"24%",rightWidth:"75%",closeRowCallback:CreateDialogClass.prototype.close,validators:[]});a.addColumnConfiguration(CreateDialog.Story.columnIndices.name,{title:"Name",editable:!0,get:StoryModel.prototype.getName,edit:{editor:"Text",required:!0,visualizeRequired:!0,set:StoryModel.prototype.setName}});a.addColumnConfiguration(CreateDialog.Story.columnIndices.storyValue,{title:"Story value",editable:!0,
get:StoryModel.prototype.getStoryValue,edit:{editor:"Number",required:!1,set:StoryModel.prototype.setStoryValue}});a.addColumnConfiguration(CreateDialog.Story.columnIndices.backlog,{title:"Backlog",get:StoryModel.prototype.getIterationOrBacklog,decorator:DynamicsDecorators.backlogSelectDecorator,editable:!0,edit:{editor:"InlineAutocomplete",dataType:"backlogsAndIterations",decorator:DynamicsDecorators.propertyDecoratorFactory(BacklogModel.prototype.getName),set:StoryModel.prototype.setBacklog,visualizeRequired:!0}});
a.addColumnConfiguration(CreateDialog.Story.columnIndices.state,{title:"State",editable:!0,get:StoryModel.prototype.getState,edit:{editor:"Selection",set:StoryModel.prototype.setState,items:DynamicsDecorators.stateOptions}});a.addColumnConfiguration(CreateDialog.Story.columnIndices.storyPoints,{title:"Story points",editable:!0,get:StoryModel.prototype.getStoryPoints,edit:{editor:"Number",required:!1,set:StoryModel.prototype.setStoryPoints}});a.addColumnConfiguration(CreateDialog.Story.columnIndices.responsibles,
{title:"Responsibles",get:StoryModel.prototype.getResponsibles,decorator:DynamicsDecorators.emptyValueWrapper(DynamicsDecorators.userInitialsListDecorator,"(Select users)"),editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:StoryModel.prototype.setResponsibles}});a.addColumnConfiguration(CreateDialog.Story.columnIndices.description,{title:"Description",get:StoryModel.prototype.getDescription,editable:!0,edit:{editor:"Wysiwyg",
set:StoryModel.prototype.setDescription}});this.formConfig=a};CreateDialog.StoryFromTree=function(a,b){this.model=a;this.ajax=b;var c=PageController.getInstance().getCurrentUser();c.isAutoassignToStories()&&this.model.setResponsibles([c.getId()]);this.initFormConfig();this.formConfig.columns[CreateDialog.Story.columnIndices.backlog].options.editable=!1;this.init(CreateDialog.configurations.story)};extendObject(CreateDialog.StoryFromTree,CreateDialog.Story);
CreateDialog.StoryFromTree.prototype._ok=function(){this.view.getValidationManager().isValid()&&(this.ajax(this.model),this.close())};
CreateDialog.User=function(){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.user);var a=this;jQuery.ajax({url:"ajax/teamChooserData.action",type:"post",dataType:"json",success:function(b,c){var d=[];try{for(var e=0;e<b.length;e++){var f=b[e];f["class"]=ModelFactory.typeToClassName.team;d.push(f.id)}a.model.setTeams(d,b)}catch(g){}a.initFormConfig();a.init(CreateDialog.configurations.user)}})};CreateDialog.User.prototype=new CreateDialogClass;
CreateDialog.User.columnIndices={name:0,loginName:1,initials:2,email:3,password1:4,password2:5,admin:6,teams:7,warning:8};
CreateDialog.User.prototype.initFormConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"24%",rightWidth:"75%",validators:[UserModel.Validators.passwordValidator,UserModel.Validators.loginNameValidator],closeRowCallback:CreateDialogClass.prototype.close});a.addColumnConfiguration(CreateDialog.User.columnIndices.name,{title:"Name",editable:!0,get:UserModel.prototype.getFullName,edit:{editor:"Text",required:!0,visualizeRequired:!0,size:"40ex",set:UserModel.prototype.setFullName}});a.addColumnConfiguration(CreateDialog.User.columnIndices.loginName,
{title:"Login name",editable:!0,get:UserModel.prototype.getLoginName,edit:{editor:"Text",size:"10ex",required:!0,visualizeRequired:!0,set:UserModel.prototype.setLoginName}});a.addColumnConfiguration(CreateDialog.User.columnIndices.initials,{title:"Initials",editable:!0,get:UserModel.prototype.getInitials,edit:{editor:"Text",required:!0,visualizeRequired:!0,size:"10ex",set:UserModel.prototype.setInitials}});a.addColumnConfiguration(CreateDialog.User.columnIndices.email,{title:"Email",editable:!0,get:UserModel.prototype.getEmail,
edit:{editor:"Email",required:!0,visualizeRequired:!0,size:"40ex",set:UserModel.prototype.setEmail}});a.addColumnConfiguration(CreateDialog.User.columnIndices.password1,{title:"Password",editable:!0,get:UserModel.prototype.getPassword1,edit:{editor:"Password",size:"20ex",set:UserModel.prototype.setPassword1,required:!0,visualizeRequired:!0}});a.addColumnConfiguration(CreateDialog.User.columnIndices.password2,{title:"Confirm password",editable:!0,get:UserModel.prototype.getPassword2,edit:{editor:"Password",
size:"20ex",set:UserModel.prototype.setPassword2,required:!0,visualizeRequired:!0}});var b=PageController.getInstance().getCurrentUser(),c=function(){return"No"};b.getAdmin()?a.addColumnConfiguration(CreateDialog.User.columnIndices.admin,{title:"Administrator",editable:!0,get:UserModel.prototype.getAdmin,edit:{editor:"Selection",items:DynamicsDecorators.adminOptions,size:"20ex",set:UserModel.prototype.setAdmin,required:!0}}):a.addColumnConfiguration(CreateDialog.User.columnIndices.admin,{title:"Administrator",
editable:!1,get:c});a.addColumnConfiguration(CreateDialog.User.columnIndices.teams,{title:"Teams",get:UserModel.prototype.getTeams,decorator:DynamicsDecorators.teamListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dataType:"teams",dialogTitle:"Select teams",set:UserModel.prototype.setTeams,showSelectAllItems:!0,showRemoveAllItems:!0}});a.addColumnConfiguration(CreateDialog.User.columnIndices.warning,{title:"",cssClass:"warning-text",editable:!1,get:function(){return b.getAdmin()?
"By default the user is added to all teams.":"By default the user is added to all teams that you belong to."}});this.formConfig=a};CreateDialog.Team=function(){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.team);this.initFormConfig();this.init(CreateDialog.configurations.team)};CreateDialog.Team.prototype=new CreateDialogClass;CreateDialog.Team.columnIndices={name:0,users:1,products:2,iterations:3};
CreateDialog.Team.prototype.initFormConfig=function(){var a=PageController.getInstance().getCurrentUser(),b=new DynamicTableConfiguration({leftWidth:"24%",rightWidth:"75%",closeRowCallback:CreateDialogClass.prototype.close});b.addColumnConfiguration(CreateDialog.Team.columnIndices.name,{title:"Name",editable:!0,get:TeamModel.prototype.getName,edit:{editor:"TeamName",required:!0,visualizeRequired:!0,set:TeamModel.prototype.setName}});b.addColumnConfiguration(CreateDialog.Team.columnIndices.users,{minWidth:60,
autoScale:!0,title:"Users",cssClass:"user-chooser",headerTooltip:"Users",get:TeamModel.prototype.getUsers,decorator:DynamicsDecorators.teamUserInitialsListDecorator,editable:!0,visualizedEditable:!0,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dialogClose:function(){jQuery(".ui-button:eq(1)").focus()},dataType:"usersAndTeams",set:TeamModel.prototype.setUsers,showSelectAllItems:!0,showRemoveAllItems:!0}});a.getAdmin()&&(a=function(){return"true"},b.addColumnConfiguration(CreateDialog.Team.columnIndices.products,
{title:"Grant the team access to all products?",get:a,editable:!0,edit:{editor:"Selection",items:DynamicsDecorators.adminOptions,set:TeamModel.prototype.setAllProducts,size:"20ex",required:!0}}),b.addColumnConfiguration(CreateDialog.Team.columnIndices.iterations,{title:"Grant the team access to all standalone iterations?",get:a,editable:!0,edit:{editor:"Selection",items:DynamicsDecorators.adminOptions,set:TeamModel.prototype.setAllIterations,size:"20ex",required:!0}}));this.formConfig=b};
CreateDialog.EffortEntry=function(){this.model=ModelFactory.createObject(ModelFactory.typeToClassName.hourEntry);this.model.setUsers([],[PageController.getInstance().getCurrentUser()]);this.model.setDate((new Date).asString());this.initFormConfig();this.init(CreateDialog.configurations.effortEntry)};CreateDialog.EffortEntry.prototype=new CreateDialogClass;CreateDialog.EffortEntry.columnIndices={effortSpent:0,date:1,users:2,comment:3};
CreateDialog.EffortEntry.prototype.initFormConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"75%",closeRowCallback:CreateDialogClass.prototype.close,validators:[HourEntryModel.Validators.usersValidator]});a.addColumnConfiguration(CreateDialog.EffortEntry.columnIndices.effortSpent,{title:"Effort Spent",editable:!0,get:HourEntryModel.prototype.getMinutesSpent,edit:{editor:"ExactEstimate",required:!0,size:"8em",set:HourEntryModel.prototype.setEffortSpent}});a.addColumnConfiguration(CreateDialog.EffortEntry.columnIndices.date,
{title:"Date",editable:!0,get:HourEntryModel.prototype.getDate,edit:{editor:"Date",required:!0,withTime:!0,set:HourEntryModel.prototype.setDate}});a.addColumnConfiguration(CreateDialog.EffortEntry.columnIndices.users,{title:"Users",editable:!0,get:HourEntryModel.prototype.getUsers,decorator:DynamicsDecorators.userInitialsListDecorator,openOnRowEdit:!1,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",required:!0,set:HourEntryModel.prototype.setUsers}});a.addColumnConfiguration(CreateDialog.EffortEntry.columnIndices.comment,
{title:"Comment",get:HourEntryModel.prototype.getDescription,editable:!0,edit:{editor:"Text",set:HourEntryModel.prototype.setDescription}});this.formConfig=a};CreateDialog.idToClass={createNewProduct:CreateDialog.Product,createNewProject:CreateDialog.Project,createNewIteration:CreateDialog.Iteration,createNewStory:CreateDialog.Story,createNewUser:CreateDialog.User,createNewTeam:CreateDialog.Team,createNewEffortEntry:CreateDialog.EffortEntry};CreateDialog.createById=function(a){return new CreateDialog.idToClass[a]};
CreateDialog.createByIdWithAutofilledBacklogId=function(a,b,c){return new CreateDialog.idToClass[a](b,c)};CreateDialog.fillBacklogField=function(a,b,c){c?(b=ModelFactory.getObject(ModelFactory.types.iteration,c),a.setIteration(b)):b&&(b=ModelFactory.getObject(ModelFactory.types.backlog,b),a.setBacklog(b))};
var TaskInfoDialog=function(a){this.model=a;this.initDialog()};TaskInfoDialog.prototype=new CommonController;TaskInfoDialog.prototype.initDialog=function(){var a=this;this.element=$("\x3cdiv/\x3e").appendTo(document.body);this.element.dialog({width:750,position:"top",modal:!0,draggable:!0,resizable:!0,title:"Task info: "+this.model.getName(),close:function(){a.close()}});this.tabsElement=$("\x3cdiv/\x3e").addClass("task-info").appendTo(this.element);this.render()};
TaskInfoDialog.prototype.render=function(){var a=$("\x3cul\x3e").appendTo(this.tabsElement);$('\x3cli\x3e\x3ca href\x3d"#taskinfo-1"\x3eInfo\x3c/a\x3e').appendTo(a);$('\x3cli\x3e\x3ca href\x3d"#taskinfo-2"\x3eHistory\x3c/a\x3e').appendTo(a);Configuration.isTimesheetsEnabled()&&$('\x3cli\x3e\x3ca href\x3d"#taskinfo-3"\x3eSpent Effort\x3c/a\x3e').appendTo(a);this.renderInfoTab();this.renderHistoryTab();this.renderSpentEffortTab();this.tabsElement.tabs();a=this.tabsElement.tabs("option","selected");
this.selectTab(a);var b=this;this.tabsElement.bind("tabsselect",function(a,c){b.selectTab(c.index)})};TaskInfoDialog.prototype.selectTab=function(a){2==a&&(this.hourEntryListController?this.hourEntryListController.reload():this.hourEntryListController=new HourEntryListController({parentModel:this.model,hourEntryListElement:this.spentEffortTabElement}))};TaskInfoDialog.prototype.renderInfoTab=function(){this.infoTabElement=$('\x3cdiv id\x3d"taskinfo-1"\x3e\x3c/div\x3e').appendTo(this.tabsElement)};
TaskInfoDialog.prototype.renderHistoryTab=function(){this.historyTabElement=$('\x3cdiv id\x3d"taskinfo-2"\x3e\x3c/div\x3e').appendTo(this.tabsElement)};TaskInfoDialog.prototype.renderSpentEffortTab=function(){this.spentEffortTabElement=$('\x3cdiv id\x3d"taskinfo-3"\x3e\x3c/div\x3e').appendTo(this.tabsElement)};TaskInfoDialog.prototype.close=function(){this.element.dialog("destroy").remove()};
var HourEntryController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};HourEntryController.columnIndices={date:0,user:1,spentEffort:2,effortLeft:3,description:4,actions:5,buttons:6,data:7};HourEntryController.prototype=new CommonController;
HourEntryController.prototype.removeHourEntry=function(){var a=this;new DynamicsConfirmationDialog("Are you sure?","Are you sure you want to delete logged effort?",function(){a.parentController.removeChildController("hourEntry",this);a.model.remove()})};HourEntryController.prototype.saveNewEntryButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Save",callback:function(){a.getElement().trigger("storeRequested")}}],a)};
HourEntryController.prototype.deleteButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Delete",callback:HourEntryController.prototype.removeHourEntry}],a)};
var HourEntryListController=function(a){this.hourEntryListElement=a.hourEntryListElement;this.hourEntryTableElement=$("\x3cdiv\x3e\x3c/div\x3e").appendTo(this.hourEntryListElement);this.parentModel=a.parentModel;this.options=a;this.model=null;this.init();this.initButtonsView();this.initConfig();this.paint()};HourEntryListController.prototype=new CommonController;
HourEntryListController.prototype.hourEntryControllerFactory=function(a,b){var c=new HourEntryController(b,a,this);this.addChildController("hourEntry",c);return c};
HourEntryListController.prototype.paintHourEntryTable=function(){this.hourEntryTableView=new DynamicTable(this,this.model,this.hourEntryTableConfig,this.hourEntryTableElement);this.hourEntryTableView.getElement().css({overflow:"auto","max-height":"20em"});var a=this.hourEntryTableConfig.getColumns(),b=null;this.addEntryConfig=[];this.addEntryConfig[HourEntryController.columnIndices.date]=new DynamicTableColumnConfiguration(a[0].options);this.addEntryConfig[HourEntryController.columnIndices.user]=
new DynamicTableColumnConfiguration(a[1].options);this.addEntryConfig[HourEntryController.columnIndices.spentEffort]=new DynamicTableColumnConfiguration(a[2].options);this.addEntryConfig[HourEntryController.columnIndices.effortLeft]=new DynamicTableColumnConfiguration(a[3].options);this.addEntryConfig[HourEntryController.columnIndices.description]=new DynamicTableColumnConfiguration(a[4].options);this.addEntryConfig[HourEntryController.columnIndices.actions]=new DynamicTableColumnConfiguration(a[5].options);
this.addEntryConfig[HourEntryController.columnIndices.date].options.visualizedEditable=!1;this.addEntryConfig[HourEntryController.columnIndices.spentEffort].options.visualizedEditable=!1;this.addEntryConfig[HourEntryController.columnIndices.description].options.visualizedEditable=!1;this.addEntryConfig[HourEntryController.columnIndices.user].options.editable=!0;this.addEntryConfig[HourEntryController.columnIndices.user].options.visualizedEditable=!0;this.addEntryConfig[HourEntryController.columnIndices.user].options.edit=
{editor:"Autocomplete",dialogTitle:"Select users",dialogClose:function(){b.select()},dataType:"usersAndTeams",required:!0,set:HourEntryModel.prototype.setUsers};this.addEntryConfig[HourEntryController.columnIndices.user].options.get=HourEntryModel.prototype.getUsers;this.addEntryConfig[HourEntryController.columnIndices.user].options.openOnRowEdit=!1;this.addEntryConfig[HourEntryController.columnIndices.user].options.decorator=DynamicsDecorators.userInitialsListDecorator;this.addEntryConfig[HourEntryController.columnIndices.actions].options.subViewFactory=
HourEntryController.prototype.saveNewEntryButtonFactory;this.showLogEffortRow();this.hourEntryTableView.render();this.logEffortController.openRowEdit();b=this.logEffortRow.getCellByName("effortSpent").getEditor();jQuery.getJSON("ajax/retrieveLatestHourEntryDelta.action",{},function(a,d){a&&b.setEditorValue(a.delta);b.select()})};
HourEntryListController.prototype.showLogEffortRow=function(){this.logEffortModel=ModelFactory.createObject(ModelFactory.types.hourEntry);this.logEffortModel.setParent(this.parentModel);this.logEffortModel.setHourEntryList(this.parentModel);this.logEffortModel.setUsers([],[PageController.getInstance().getCurrentUser()]);this.logEffortModel.setDate(new Date);this.logEffortModel.setHourEntryList(this.model);this.logEffortController=new HourEntryController(this.logEffortModel,null,this);this.logEffortRow=
new DynamicTableRow(this.addEntryConfig);this.logEffortController.view=this.logEffortRow;this.hourEntryTableView._createRow(this.logEffortRow,this.logEffortController,this.logEffortModel,"top");this.logEffortRow.autoCreateCells()};
HourEntryListController.prototype.logEffort=function(){var a=this.parentController;this===a.logEffortController&&(a.logEffortRow.remove(),a.showLogEffortRow(),a.hourEntryTableView.render(),a.logEffortController.openRowEdit(),a.logEffortRow.getCellByName("effortSpent").getEditor().focus(),a.paintHourEntryButtons())};HourEntryListController.prototype.paintHourEntryButtons=function(){(this.limited=5<=this.model.getHourEntries().length)&&this._addSeeAllButton()};
HourEntryListController.prototype._addSeeAllButton=function(){this.seeAllButton||(this.seeAllButton=new DynamicsButtons(this,[{text:"See all",callback:jQuery.proxy(function(){this.showAllEntries()},this)}],this.hourEntryButtonsView),this.seeAllButton.draw())};
HourEntryListController.prototype.paint=function(){var a=this;HourEntryListContainer.initializeFor(this.parentModel,function(b){a.model=b;a.paintHourEntryTable();a.paintHourEntryButtons();a.options.onUpdate&&a.model.addListener(function(){a.options.onUpdate()})},!0)};
HourEntryListController.prototype.initButtonsView=function(){var a=$('\x3cdiv style\x3d"text-align: right"\x3e\x3c/div\x3e').appendTo(this.hourEntryListElement);this.hourEntryButtonsView=new ViewPart;this.hourEntryButtonsView.element=a};HourEntryListController.prototype.reload=function(){this.model.reload()};HourEntryListController.prototype.showAllEntries=function(){this.limited=!1;this.model.setLimitedEntries(!1);this.hourEntryButtonsView.hide();this.reload()};
HourEntryListController.prototype.initConfig=function(){this.hourEntryTableConfig=new DynamicTableConfiguration({rowControllerFactory:HourEntryListController.prototype.hourEntryControllerFactory,dataSource:HourEntryListContainer.prototype.getHourEntries,closeRowCallback:HourEntryListController.prototype.logEffort,cssClass:"ui-widget-content ui-corner-all",captionConfig:{cssClasses:"ui-helper-hidden"}});var a={minWidth:120,autoScale:!0,title:"User",headerTooltip:"Select users for this effort",get:HourEntryModel.prototype.getUser,
decorator:DynamicsDecorators.userNameDecorator},b={minWidth:50,autoScale:!0,title:"Spent",headerTooltip:"Effort spent in man-hours",get:HourEntryModel.prototype.getMinutesSpent,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,visualizedEditable:!0,columnName:"effortSpent",edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,size:"65%",set:HourEntryModel.prototype.setEffortSpent,required:!1}},c={minWidth:30,autoScale:!0,title:"Left",headerTooltip:"Effort left in man-hours",
get:HourEntryModel.prototype.getEffortLeft,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!0,editableCallback:HourEntryModel.prototype.effortLeftEditable,columnName:"effortLeft",edit:{editor:"ExactEstimate",decorator:DynamicsDecorators.exactEstimateEditDecorator,set:HourEntryModel.prototype.setEffortLeft,required:!1}},d={minWidth:200,autoScale:!0,headerTooltip:"Comment this effort",title:"Comment",editable:!0,visualizedEditable:!0,get:HourEntryModel.prototype.getDescription,edit:{editor:"Text",
set:HourEntryModel.prototype.setDescription}};this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.date,{minWidth:120,autoScale:!0,title:"Date",headerTooltip:"Select date",get:HourEntryModel.prototype.getDate,decorator:DynamicsDecorators.dateTimeDecorator,sortCallback:HourEntryModel.dateComparator,defaultSortColumn:!0,editable:!0,visualizedEditable:!0,edit:{editor:"Date",withTime:!0,set:HourEntryModel.prototype.setDate,decorator:DynamicsDecorators.dateTimeDecorator}});
this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.user,a);this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.spentEffort,b);this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.effortLeft,c);this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.description,d);this.hourEntryTableConfig.addColumnConfiguration(HourEntryController.columnIndices.actions,{minWidth:50,autoScale:!0,
cssClass:"hourEntry-row",title:" ",subViewFactory:HourEntryController.prototype.deleteButtonFactory})};
var StoryTreeController=function(a,b,c,e,d){this.id=a;this.type=b;this.filters=[];this.parentElement=c;this.container=$("\x3cdiv /\x3e").addClass("storyTreeContainer").appendTo(this.parentElement);this.headerElement=$("\x3cdiv/\x3e").appendTo(this.container);this.element=$("\x3cdiv/\x3e").appendTo(this.container);this.parentController=d;this.options={refreshCallback:null,disableRootSort:!1};this.storyFilters={statesToKeep:"NOT_STARTED STARTED PENDING BLOCKED IMPLEMENTED DONE DEFERRED".split(" ")};
jQuery.extend(this.options,e);this.initHeader()};StoryTreeController.prototype=new CommonController;StoryTreeController.createNodeUrls={inside:"ajax/treeCreateStoryUnder.action",after:"ajax/treeCreateStorySibling.action"};StoryTreeController.moveNodeUrls={before:"ajax/moveStoryBefore.action",after:"ajax/moveStoryAfter.action",inside:"ajax/moveStoryUnder.action"};StoryTreeController.multiMoveNodeUrls={before:"ajax/moveMultipleBefore.action",after:"ajax/moveMultipleAfter.action",inside:"ajax/moveMultipleUnder.action"};
StoryTreeController.prototype.resetFilter=function(){this.storyFilters={statesToKeep:"NOT_STARTED STARTED PENDING BLOCKED IMPLEMENTED DONE DEFERRED".split(" ")};this.filterImg.removeClass("storytree-filterimg-active")};
StoryTreeController.prototype.renderComplete=function(){if(!this.firstRenderComplete){this.firstRenderComplete=!0;var a=window.location.hash;if(-1!==a.indexOf("Story_")&&(a=a.match(/Story_(\d+)/i),2===a.length)){var a="#storytree_"+a[1],b=this.tree._get_node(a);if(b){if(!b.is(":visible"))for(var c=this.tree.get_path(b,!0),e=0;e<c.length;e++)this.tree.open_node("#"+c[e]);this.openNodeDetails(b);a=this.element.find(a).offset();jQuery("#bodyWrapper").scrollTop(a.top-jQuery("#bodyWrapper").offset().top)}}}};
StoryTreeController.prototype.refresh=function(){this.tree?this.tree.refresh():this.initTree()};StoryTreeController.prototype.refreshNode=function(a){var b=$(a),c=this,e=c.tree.is_checked($(a));jQuery.get("ajax/treeRetrieveStory.action",{storyId:parseInt($(b).attr("storyId"),10)},function(a,f,h){f=$(a);a=f.find("a:eq(0)");f=f.attr("rel");b.attr("rel",f);b.find("a:eq(0)").replaceWith(a);b.trigger("node_refresh.jstree");c.tree.deselect_node(b);e&&(c.tree.select_node(b),c.tree.check_node(b))})};
StoryTreeController.prototype.initHeader=function(){var a=this,b=$('\x3cdiv class\x3d"dynamictable-caption" style\x3d"margin-bottom: 1em;"\x3e\x3c/div\x3e').appendTo(this.headerElement),b=$('\x3cdiv style\x3d"float: left; width:50%"\x3e\x3cspan style\x3d"float: left;"\x3eStory Breakdown\x3c/span\x3e\x3c/div\x3e').appendTo(b);this.filterImg=$("\x3cdiv/\x3e").addClass("storytree-filterimg").appendTo(b);b=$("\x3cul/\x3e").addClass("dynamictable-captionactions").css({width:"40%","float":"left"}).appendTo(this.headerElement);
$("\x3cdiv/\x3e").addClass("dynamictable-captionactions").css({display:"block","margin-bottom":"35px"}).appendTo(this.headerElement);this.filterImg.click(function(){var b=new StateFilterWidget($(this),{bubbleOptions:{title:"Filter by state",offsetX:-15,minWidth:100,minHeight:20},filterCallback:function(){a.storyFilters.statesToKeep=b.getFilter();a.parentController.filter()},callback:function(b){b?a.filterImg.addClass("storytree-filterimg-active"):a.filterImg.removeClass("storytree-filterimg-active")},
activeStates:a.storyFilters.statesToKeep})});$("\x3cli\x3eCreate story\x3c/li\x3e").css({"float":"left"}).addClass("dynamictable-captionaction create").click(function(){a.createNode(-1,0,0)}).appendTo(b);this.expandButton=$("\x3cli\x3eExpand all\x3c/li\x3e").css({"float":"left"}).addClass("dynamictable-captionaction create").appendTo(b);this.collapseButton=$("\x3cli\x3eCollapse all\x3c/li\x3e").css({"float":"left"}).hide().addClass("dynamictable-captionaction create").appendTo(b);this.expandButton.click(function(){$(this).hide();
a.collapseButton.show();a.treeExpanded=!0;a.tree.open_all()});a.collapseButton.click(function(){$(this).hide();a.expandButton.show();a.treeExpanded=!1;a.tree.close_all()})};StoryTreeController.prototype._storyFilters=function(a,b){var c={};this.storyFilters.name&&(c["storyFilters.name"]=this.storyFilters.name);this.storyFilters.statesToKeep&&(c["storyFilters.states"]=this.storyFilters.statesToKeep);"project"==this.type?c.projectId=this.id:"product"==this.type&&(c.productId=this.id);return c};
StoryTreeController.prototype.filter=function(a,b){this.storyFilters.statesToKeep=b;this.storyFilters.name=a;this.refresh()};StoryTreeController.prototype.hasFilters=function(){return this.storyFilters.name||this.storyFilters.states&&6===this.storyFilters.states.length};StoryTreeController.prototype._searchByText=function(){this.storyFilters.name&&this.tree.search(this.storyFilters.name)};
StoryTreeController.prototype.initTree=function(){$.jstree._themes="static/css/jstree/";var a={project:{url:"ajax/getProjectStoryTree.action",data:{projectId:this.id}},product:{url:"ajax/getProductStoryTree.action",data:{productId:this.id}}},b=this,c=$('\x3cdiv class\x3d"loadingOverlay"\x3e\x3cdiv class\x3d"pleaseWait"\x3e\x3cimg src\x3d"static/img/pleasewait.gif" /\x3e Please wait... \x3c/div\x3e\x3cdiv class\x3d"overlay"\x3e\x3c/div\x3e\x3c/div\x3e').appendTo(this.parentElement).fadeIn();this.tree=
$(this.element).jstree({plugins:"html_data themes types dnd crrm cookies ui search aefCheckbox".split(" "),core:{animation:0,html_titles:!0},html_data:{ajax:{url:a[this.type].url,type:"POST",beforeSend:function(a){c.show();return a},data:function(){var e={"storyFilters.states":b.storyFilters.statesToKeep};b.storyFilters.name&&(e["storyFilters.name"]=b.storyFilters.name);jQuery.extend(e,a[b.type].data);return e},complete:function(){c.fadeOut();b.renderComplete();b._searchByText()}}},themes:{theme:"storytree",
dots:!0,icons:!1,theme_path:"static/css/jstree/agilefant/style.css"},types:{validChildren:["story","iteration_story"],types:{story:{max_children:-1,valid_children:"all"},iteration_story:{max_children:-1,valid_children:"none"}}},crrm:{move:{default_position:"before"}},dnd:{copy_modifier:"",open_timeout:1E3},cookies:{save_selected:!1},ui:{select_limit:-1,select_multiple_modifier:"on",initially_select:[]},search:{case_insensitive:!0},aefCheckbox:{select_callback:jQuery.proxy(function(a){this.toggleEditBox(a)},
this)}});this.tree=jQuery.jstree._reference(this.element);this.editBox=new MultiEditWidget(this);this.element.delegate("a","mouseenter",function(a){$.vakata.dnd.is_drag&&"iteration_story"==$(this).closest("li").attr("rel")&&($(".iterationStoryToolTip").stop(),$(".iterationStoryToolTip").css({top:a.pageY-20,left:a.pageX+20}),$(".iterationStoryToolTip").animate({opacity:"1"},100))});this.element.delegate("a","mouseleave",function(a){$(".iterationStoryToolTip").stop();$(".iterationStoryToolTip").animate({opacity:"0"},
100)});this.element.bind("move_node.jstree",function(a,c){1<c.rslt.o.length?b.moveMultipleStories(c.rslt.o,c.rslt.r,c.rslt.p,c.inst,c.rlbk):b.moveStory(c.rslt.o,c.rslt.r,c.rslt.p,c.inst,c.rlbk)});this.element.delegate("span","click.jstree",function(a){b.openNodeDetails($(a.target).parents("li:eq(0)"));return!1});this.element.bind("select_node.jstree",function(a,c){b.tree.check_node(c.rslt.obj)});this.element.bind("deselect_node.jstree",function(a,c){b.tree.uncheck_node(c.rslt.obj)})};
StoryTreeController.prototype.getSelectedIds=function(){var a=[];this.tree.get_checked().each(function(){a.push(parseInt($(this).attr("storyId"),10))});return a};StoryTreeController.prototype.clearSelectedIds=function(){this.tree.uncheck_all();this.tree.deselect_all()};StoryTreeController.prototype.toggleEditBox=function(a){0<a&&!this.editBox.isVisible()?this.editBox.open():a||this.editBox.close()};
StoryTreeController.prototype._treeLoaded=function(){this.treeExpanded&&this.tree.open_all();this.hasFilters()&&this.expandButton.click()};
StoryTreeController.prototype.moveMultipleStories=function(a,b,c,e,d){a=$(a).map(function(){return $(this).attr("storyid")}).toArray();b=$(b).attr("storyid");$.ajax({url:StoryTreeController.multiMoveNodeUrls[c],data:{storyIds:a,referenceStoryId:b},type:"post",async:!0,error:function(a,b,c){a&&(b=jQuery.httpData(a,"json",null),b.constructor==Array?(a='\x3cul style\x3d"margin: 0; width: 400px; font-weight: normal; white-space: nowrap;"\x3e\x3cli\x3e'+b.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e",
MessageDisplay.Warning("Can\x26apos;t move story. Reason:",a,{closeButton:!0,displayTime:null})):MessageDisplay.Error("Error moving story",a));jQuery.jstree.rollback(d)}})};
StoryTreeController.prototype.moveStory=function(a,b,c,e,d){a=$(a).attr("storyid");b=$(b).attr("storyid");$.ajax({url:StoryTreeController.moveNodeUrls[c],data:{storyId:a,referenceStoryId:b},type:"post",async:!0,error:function(a,b,c){a&&(b=jQuery.httpData(a,"json",null),b.constructor==Array?(a='\x3cul style\x3d"margin: 0; width: 400px; font-weight: normal; white-space: nowrap;"\x3e\x3cli\x3e'+b.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e",MessageDisplay.Warning("Can\x26apos;t move story. Reason:",
a,{closeButton:!0,displayTime:null})):MessageDisplay.Error("Error moving story",a));jQuery.jstree.rollback(d)}})};StoryTreeController.prototype.checkStoryMove=function(a,b,c,e,d){return"iteration_story"===$(b).attr("rel")&&"inside"===c?(MessageDisplay.Warning("Iteration stories can not have children"),!1):this.options.disableRootSort&&-1===e.parent(b)&&"inside"!==c?(alert("Not implemented."),!1):!0};
StoryTreeController.prototype._getStoryForId=function(a,b){ModelFactory.getInstance().retrieveLazily(ModelFactory.types.story,a,function(a,e,d){b(d)},function(a,b,d){MessageDisplay.Error("Story cannot be loaded",a)})};
StoryTreeController.prototype.saveStory=function(a,b,c,e,d){c.html('\x3cimg src\x3d"static/img/working.gif" style\x3d"margin-left: 5em;"/\x3e');var f;e.backlogId=this.id;d?(f=StoryTreeController.createNodeUrls[b],e.storyId=d.getId()):f="ajax/treeCreateRootStory.action";$.post(f,e,jQuery.proxy(function(e){this._replaceNodeWithFragment(e,a,b,c)},this),"html")};
StoryTreeController.prototype._replaceNodeWithFragment=function(a,b,c,e){e.remove();a=$(a);this.tree.create(b,c,{data:a.find("a:eq(0)").html()},null,!0).attr({id:a.attr("id"),rel:a.attr("rel"),storystate:a.attr("storystate"),storyid:a.attr("storyid")})};
StoryTreeController.prototype.createNode=function(a,b,c){var e=this;if("iteration_story"===$(a).attr("rel")&&"inside"===b)return MessageDisplay.Warning("Iteration stories can not have children"),!1;var d=$('\x3cinput type\x3d"text" size\x3d"75"/\x3e').css({margin:"0px"});this.tree.create(a,b,{},function(f){f.find("a").hide();f.find("span").hide();var h=$("\x3cdiv /\x3e").css({"white-space":"nowrap",display:"inline-block",height:"16px"}).appendTo(f);d.appendTo(h);var k=function(){h.remove();e.tree.remove(f)};
$("\x3ca\x3emore...\x3c/a\x3e").appendTo(h).addClass("openCreateDialogLink").click(function(){var g=ModelFactory.createObject(ModelFactory.typeToClassName.story);g.setName(d.val());c instanceof StoryModel?g.setBacklogByModel(c.getBacklog()):g.setBacklogByModel(e.parentController.model);new CreateDialog.StoryFromTree(g,function(d){var g=d.currentData.userIds,h=d.currentData.labels;delete d.currentData.userIds;delete d.currentData.labels;d=d.serializeFields("story",d.currentData);d.userIds=g;d.labelNames=
h;e.saveStory(a,b,f,d,c)})});var l=function(g){jQuery.trim(d.val())?(g.stopPropagation(),g.preventDefault(),e.saveStory(a,b,f,{"story.name":d.val()},c)):d.addClass("validation-error")};$('\x3cinput type\x3d"button" value\x3d"save" /\x3e').appendTo(h).click(jQuery.proxy(function(a){l(a)},this));d.keyup(jQuery.proxy(function(a){13===a.keyCode?l(a):27===a.keyCode&&k()},this));$('\x3cinput type\x3d"button" value\x3d"cancel" /\x3e').click(k).appendTo(h)},!0);d.focus()};
StoryTreeController.prototype.removeNode=function(a){var b=!1;a.children("li");0<a.find("li").length&&(b=!0);this.tree.remove(a);b&&this.tree.refresh()};StoryTreeController.prototype.openNodeDetails=function(a){new StoryInfoBubble($(a).attr("storyid"),this,$(a),{})};
var PortfolioController=function(a){this.rankedProjectsElement=a.rankedProjectsElement;this.unrankedProjectsElement=a.unrankedProjectsElement;this.timelineElement=a.timelineElement;this.init();this.initConfig();this.paint();window.pageController&&window.pageController.setMainController(this)};PortfolioController.prototype=new CommonController;
PortfolioController.prototype.paint=function(){var a=this;ModelFactory.initProjectPortfolio(function(b){a.model=b;a.paintRankedProjects();a.paintUnrankedProjects();a.paintTimeline();a.attachModelListener();a.pageLayout()})};PortfolioController.prototype.pageControllerDispatch=function(a){a instanceof DynamicsEvents.AddEvent&&a.getObject()instanceof ProjectModel&&this.model.reload()};
PortfolioController.prototype.pageLayout=function(){0===this.model.getRankedProjects().length?(this.timelineElement.parent().hide(),this.rankedProjectsElement.hide()):(this.timelineElement.parent().show(),this.rankedProjectsElement.show());0===this.model.getUnrankedProjects().length?this.unrankedProjectsElement.hide():this.unrankedProjectsElement.show()};
PortfolioController.prototype.handleModelEvents=function(a){a instanceof DynamicsEvents.RelationUpdatedEvent?(this.pageLayout(),0!==this.model.getRankedProjects().length&&(this.timelineElement.css("height",32*this.model.getRankedProjects().length+20+"px"),this.eventSource.loadData(),this.timeline.layout())):a instanceof DynamicsEvents.EditEvent&&this.eventSource.loadData()};PortfolioController.prototype.reload=function(){this.model.reload()};
PortfolioController.prototype.acceptsDraggable=function(a){return a instanceof ProjectModel?!0:!1};PortfolioController.prototype.paintRankedProjects=function(){this.rankedProjectsView=new DynamicTable(this,this.model,this.rankedProjectsConfig,this.rankedProjectsElement);this.rankedProjectsView.render()};PortfolioController.prototype.paintUnrankedProjects=function(){this.unrankedProjectsView=new DynamicTable(this,this.model,this.unrankedProjectsConfig,this.unrankedProjectsElement);this.unrankedProjectsView.render()};
PortfolioController.prototype._calculateTimelineUnitSize=function(){var a=this.timelineElement.width(),b=this.model.endDate.getMonth(),c=this.model.startDate.getMonth(),b=b>c?b-c:12-Math.abs(c-b);return a/b};
PortfolioController.prototype.paintTimeline=function(){this.timelineElement.css("height",32*this.model.getRankedProjects().length+20+"px");this.model.startDate=new Date;this.model.endDate=new Date;this.model.startDate.zeroTime();this.model.endDate.zeroTime();this.model.endDate.addDays(this.model.getTimeSpanInDays());this.model.endDate.getMonth();this.model.startDate.getMonth();var a=new Date;a.addDays(this.model.getTimeSpanInDays()/2);var b=new Timeline.PortfolioEventSource;this.eventSource=b;var c=
Timeline.ClassicTheme.create();c.timeline_start=this.model.startDate;c.timeline_stop=this.model.endDate;c.event.duration.impreciseOpacity=0;c.event.track.height=30;c.mouseWheel=null;a=[Timeline.createBandInfo({width:"100%",date:a,intervalUnit:Timeline.DateTime.MONTH,intervalPixels:this._calculateTimelineUnitSize(),eventSource:b,theme:c,eventPainter:Timeline.ClickEventPainter})];b.setModel(this.model);this.timeline=Timeline.create(this.timelineElement[0],a);b.loadData();var d=this;$(window).resize(function(){var a=
d._calculateTimelineUnitSize();d.timeline.getBand(0).getEther()._pixelsPerInterval=a;d.timeline.paint()})};PortfolioController.prototype.portfolioRowControllerFactory=function(a,b){var c=new PortfolioRowController(b,a,this);this.addChildController("project",c);return c};
PortfolioController.prototype.initConfig=function(){var a=new DynamicTableConfiguration({rowControllerFactory:PortfolioController.prototype.portfolioRowControllerFactory,dataSource:PortfolioModel.prototype.getRankedProjects,caption:"Ranked projects",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"ui-widget-content ui-corner-all portfolio-ranked-project-table",sortCallback:PortfolioRowController.prototype.rankAndMoveProject,sortOptions:{items:"\x3e .dynamicTableDataRow",
handle:"."+DynamicTable.cssClasses.dragHandle,connectWith:".dynamicTable-sortable-tasklist \x3e .ui-sortable"}}),b=[];b.push({minWidth:3,autoScale:!0,title:"Status",headerTooltip:"Project status",get:ProjectModel.prototype.getStatus,decorator:DynamicsDecorators.projectStatusDecorator,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getRank),defaultSortColumn:!0,editable:!0,edit:{editor:"Selection",set:ProjectModel.prototype.setStatus,items:DynamicsDecorators.projectStates}});
b.push({minWidth:26,autoScale:!0,title:"Name",headerTooltip:"Project name",get:ProjectModel.prototype.getName,editable:!0,visualizedEditable:!0,dragHandle:!0,edit:{editor:"Text",set:ProjectModel.prototype.setName,required:!0}});b.push({minWidth:16,autoScale:!0,title:"Product",headerTooltip:"Product name",get:ProjectModel.prototype.getProductName,editable:!1});b.push({minWidth:16,autoScale:!0,title:"Project assignees",headerTooltip:"Project assignees",get:BacklogModel.prototype.getAssignees,decorator:DynamicsDecorators.responsiblesDecorator,
editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dialogTitle:"Select users",dataType:"usersAndTeams",set:BacklogModel.prototype.setAssignees}});b.push({minWidth:10,autoScale:!0,title:"Start date",headerTooltip:"Start date",get:ProjectModel.prototype.getStartDate,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getStartDate),decorator:DynamicsDecorators.dateTimeDecorator,defaultSortColumn:!1,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,
set:ProjectModel.prototype.setStartDate,withTime:!0,required:!0}});b.push({minWidth:10,autoScale:!0,title:"End date",headerTooltip:"End date",get:ProjectModel.prototype.getEndDate,sortCallback:DynamicsComparators.valueComparatorFactory(ProjectModel.prototype.getEndDate),decorator:DynamicsDecorators.dateTimeDecorator,defaultSortColumn:!1,editable:!0,visualizedEditable:!0,edit:{editor:"Date",decorator:DynamicsDecorators.dateTimeDecorator,set:ProjectModel.prototype.setEndDate,withTime:!0,required:!0}});
a.addColumnConfiguration(PortfolioRowController.columnIndices.status,b[0]);a.addColumnConfiguration(PortfolioRowController.columnIndices.name,b[1]);a.addColumnConfiguration(PortfolioRowController.columnIndices.product,b[2]);a.addColumnConfiguration(PortfolioRowController.columnIndices.assignees,b[3]);a.addColumnConfiguration(PortfolioRowController.columnIndices.startDate,b[4]);a.addColumnConfiguration(PortfolioRowController.columnIndices.endDate,b[5]);a.addColumnConfiguration(PortfolioRowController.columnIndices.actions,
{minWidth:6,autoScale:!0,title:"Actions",headerTooltip:"Move to unranked projects",subViewFactory:PortfolioRowController.prototype.moveToUnrankedButtonFactory});this.rankedProjectsConfig=a;a=new DynamicTableConfiguration({rowControllerFactory:PortfolioController.prototype.portfolioRowControllerFactory,dataSource:PortfolioModel.prototype.getUnrankedProjects,validators:[PortfolioModel.Validators.dateValidator],caption:"Unranked projects",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},
cssClass:"ui-widget-content ui-corner-all portfolio-unranked-project-table"});a.addColumnConfiguration(PortfolioRowController.columnIndices.status,b[0]);a.addColumnConfiguration(PortfolioRowController.columnIndices.name,b[1]);a.addColumnConfiguration(PortfolioRowController.columnIndices.product,b[2]);a.addColumnConfiguration(PortfolioRowController.columnIndices.assignees,b[3]);a.addColumnConfiguration(PortfolioRowController.columnIndices.startDate,b[4]);a.addColumnConfiguration(PortfolioRowController.columnIndices.endDate,
b[5]);a.addColumnConfiguration(PortfolioRowController.columnIndices.actions,{minWidth:6,autoScale:!0,title:"Actions",headerTooltip:"Move to ranked projects",subViewFactory:PortfolioRowController.prototype.moveToRankedButtonFactory});this.unrankedProjectsConfig=a};
var PortfolioRowController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};PortfolioRowController.prototype=new CommonController;PortfolioRowController.columnIndices={status:0,name:1,product:2,assignees:3,startDate:4,endDate:5,actions:6};PortfolioRowController.prototype.handleModelEvents=function(a){a instanceof DynamicsEvents.EditEvent?this.parentController.reload():a instanceof DynamicsEvents.RelationUpdatedEvent&&this.parentController.reload()};
PortfolioRowController.prototype.rankAndMoveProject=function(a,b,c){var d=-1,e=-1;c?d=c.getId():e=a.getParentView().getDataRowAt(1).getModel().getId();-1!==d?b.rankUnder(d):-1!==e&&b.rankOver(e)};PortfolioRowController.prototype.acceptsDraggable=function(a){return a instanceof ProjectModel};PortfolioRowController.prototype.moveToRankedButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Rank",callback:PortfolioRowController.prototype.rank}],a)};
PortfolioRowController.prototype.moveToUnrankedButtonFactory=function(a,b){return new DynamicsButtons(this,[{text:"Unrank",callback:PortfolioRowController.prototype.unrank}],a)};PortfolioRowController.prototype.rank=function(){this.model.rank()};PortfolioRowController.prototype.unrank=function(){this.model.unrank()};
var MyAssignmentsMenuController=function(a,b){this.init(a,b)};MyAssignmentsMenuController.prototype.init=function(a,b){this.parentElement=a;this.parentElement.html("");this.emptyListNote=$('\x3cdiv style\x3d"margin: 0.5em"\x3eNo items assigned to you\x3c/span\x3e').appendTo(this.parentElement).hide();this.element=$("\x3cdiv/\x3e").appendTo(this.parentElement);this.toggleControl=b;this.tree=null;this.initTree()};
MyAssignmentsMenuController.prototype.initTree=function(){var a=this;this.element.dynatree({keyboard:!1,autoFocus:!1,onClick:function(a,c){$(c.target).hasClass("ui-dynatree-title")&&(window.location.href=c.target.href)},onExpand:function(b,c){a.element.find("a.ui-dynatree-title").each(function(a,b){b.href="editBacklog.action?backlogId\x3d"+$(b.parentNode).attr("dtnode").data.id})},onPostInit:function(b,c){a.element.find("a.ui-dynatree-title").each(function(a,b){b.href="editBacklog.action?backlogId\x3d"+
$(b.parentNode).attr("dtnode").data.id});null===a.element.dynatree("getRoot").childList?a.emptyListNote.show():a.emptyListNote.hide()},initAjax:{url:"ajax/myAssignmentsMenuData.action"},persist:!0,debugLevel:0,cookieId:"agilefant-my-assignments-menu-dynatree"});this.tree=this.element.dynatree("getTree")};MyAssignmentsMenuController.prototype.reload=function(){this.tree.reload()};
var AdministrationMenuController=function(a,b){this.init(a,b)};AdministrationMenuController.prototype.init=function(a,b){this.element=a;this.element.html("");this.toggleControl=b;this.tree=null;this.initTree()};
AdministrationMenuController.prototype.initTree=function(){this.element.dynatree({keyboard:!1,autoFocus:!1,onClick:function(a,c){$(c.target).hasClass("ui-dynatree-title")&&(window.location.href=c.target.href)},debugLevel:0,initAjax:null});this.tree=this.element.dynatree("getTree");var a=this.element.dynatree("getRoot"),b=PageController.getInstance().getCurrentUser();a.addChild({title:"My Settings",icon:!1,key:"editUser.action"});a.addChild({title:"Users",icon:!1,key:"listUsers.action"});a.addChild({title:"Teams",
icon:!1,key:"listTeams.action"});b.getAdmin()&&(a.addChild({title:"Access rights",icon:!1,key:"accessRights.action"}),a.addChild({title:"Account settings",icon:!1,key:"systemSettings.action"}),a.addChild({title:"Database export",icon:!1,key:"databaseExport.action"}));this.element.find("a.ui-dynatree-title").each(function(a,c){c.href=$(c.parentNode).attr("dtnode").data.key});var d=getCurrentLastSegment();this.element.find("a.ui-dynatree-title").each(function(a,c){var b=getUrlLastSegment(c);null!=d&&
(null!=b&&d==b)&&c.setAttribute("style","background-color: #D9DDE7 !important; font-weight: bold;")})};function getUrlLastSegment(a){a=$.url(a);return a.segment().pop()}function getCurrentLastSegment(){var a=$(location).attr("href");return getUrlLastSegment(a)}AdministrationMenuController.prototype.reload=function(){};
var PersonalLoadController=function(){};PersonalLoadController.prototype=new CommonController;PersonalLoadController.totalLoadTab=0;PersonalLoadController.detailedLoadTab=1;PersonalLoadController.userSpentEffortElementIndex=2;PersonalLoadController.recent=3;
PersonalLoadController.prototype.init=function(a){this.tabs=a.tabs;this.userSpentEffortElement=a.spentEffortTab;this.userId=a.userId;this.recentElement=a.recent;var d=this;this.userLoadView=new UserLoadPlotWidget(this.userId,{total:{element:a.totalPlot},detailed:{element:a.detailedPlot,legend:a.legend}});this.tabs.find("ul:eq(0)").show();this.tabs.tabs({show:function(a,b){d._tabSelect(b)}});$(window).resize(function(){d.userLoadView.paint()});this.tabs.tabs("select",1);this.tabs.tabs("select",0)};
PersonalLoadController.prototype._selectuserSpentEffortElement=function(){this.spentEffortWidget||(this.spentEffortWidget=new UserSpentEffortWidget(this.userSpentEffortElement,this.userId))};PersonalLoadController.prototype.updateLoadGraph=function(){this.userLoadView.reset()};
PersonalLoadController.prototype.paintRecent=function(){this.tagCloud||(this.tagCloud=$("\x3cul\x3e\x3c/ul\x3e").appendTo(this.recentElement),this.editTagCloud=$("\x3cul\x3e\x3c/ul\x3e").appendTo(this.recentElement));var a=function(a){return function(e){a.empty();for(var b=0;b<e.length;b++){var c=e[b];$("\x3cli value\x3d"+c.count+'" style\x3d"cursor: pointer;"\x3e'+c.story.name+"\x3c/li\x3e").appendTo(a).click(function(){window.location="qr.action?q\x3dstory:"+c.story.id})}a.tagcloud({height:160,
sizemax:25,type:"list",seed:23})}};$.get("ajax/storyAccessData.action",{userId:this.userId},$.proxy(a(this.tagCloud),this));$.get("ajax/storyEditAccessData.action",{userId:this.userId},$.proxy(a(this.editTagCloud),this))};
PersonalLoadController.prototype._tabSelect=function(a){a.index===PersonalLoadController.userSpentEffortElementIndex&&this._selectuserSpentEffortElement();a.index===PersonalLoadController.totalLoadTab&&this.userLoadView.paintTotal();a.index===PersonalLoadController.detailedLoadTab&&this.userLoadView.paintDetailed();a.index===PersonalLoadController.recent&&this.paintRecent()};
var AccessListController=function(a){this.accessListElement=a.element;this.accessIterationListElement=a.iterationElement;this.modelIteration=this.model=null;this.init();this.initConfig();this.initIterationConfig();this.paint();window.pageController&&window.pageController.setMainController(this)};AccessListController.prototype=new CommonController;AccessListController.prototype.accessControllerFactory=function(a,b){var c=new AccessRowController(b,a,this);this.addChildController("access",c);return c};
AccessListController.prototype.accessIterationControllerFactory=function(a,b){var c=new AccessRowController(b,a,this);this.addChildController("access",c);return c};AccessListController.prototype.paintAccessList=function(){this.accessListView=new DynamicTable(this,this.model,this.accessListConfig,this.accessListElement);this.accessListView.render()};
AccessListController.prototype.paintIterationAccessList=function(){this.accessIterationListView=new DynamicTable(this,this.modelIteration,this.accessIterationListConfig,this.accessIterationListElement);this.accessIterationListView.render()};AccessListController.prototype.pageControllerDispatch=function(a){(a instanceof DynamicsEvents.AddEvent||a instanceof DynamicsEvents.DeleteEvent)&&a.getObject()instanceof ProductModel&&this.model.reload()};
AccessListController.prototype.paint=function(){var a=this;ModelFactory.initializeFor(ModelFactory.initializeForTypes.products,1,function(b){a.model=b;a.paintAccessList()});ModelFactory.initializeFor(ModelFactory.initializeForTypes.iterations,1,function(b){a.modelIteration=b;a.paintIterationAccessList()})};AccessListController.prototype.toggleFactory=function(a,b){return this.toggleView=new DynamicTableToggleView({expanded:!1,targetCell:3},this,a)};
AccessListController.prototype.initConfig=function(){this.accessListConfig=new DynamicTableConfiguration({caption:"Product Access",dataSource:AccessListContainer.prototype.getProducts,rowControllerFactory:AccessListController.prototype.accessControllerFactory,cssClass:"ui-widget-content ui-corner-all administration-team-table",validators:[],captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"}});var a={minWidth:200,autoScale:!0,title:"Product",get:ProductModel.prototype.getName,
defaultSortColumn:!0,cssClass:"strong-text",sortCallback:DynamicsComparators.valueComparatorFactory(ProductModel.prototype.getName)},b={minWidth:30,autoScale:!0,title:"Teams",decorator:DynamicsDecorators.productTeamCountDecorator,get:ProductModel.prototype.getTeams},c={autoScale:!1,fullWidth:!0,get:ProductModel.prototype.getTeams,decorator:DynamicsDecorators.productTeamListDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dataType:"teamsAndProducts",dialogTitle:"Select teams to have access",
set:ProductModel.prototype.setTeams,showSelectAllItems:!0,showRemoveAllItems:!0}};this.accessListConfig.addColumnConfiguration(0,a);this.accessListConfig.addColumnConfiguration(1,b);this.accessListConfig.addColumnConfiguration(3,c)};
AccessListController.prototype.initIterationConfig=function(){this.accessIterationListConfig=new DynamicTableConfiguration({caption:"Standalone Iteration Access",dataSource:AccessListContainer.prototype.getIterations,rowControllerFactory:AccessListController.prototype.accessControllerFactory,cssClass:"ui-widget-content ui-corner-all administration-team-table",validators:[],captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"}});var a={minWidth:200,autoScale:!0,title:"Iteration",
get:IterationModel.prototype.getName,defaultSortColumn:!0,cssClass:"strong-text",sortCallback:DynamicsComparators.valueComparatorFactory(IterationModel.prototype.getName)},b={minWidth:30,autoScale:!0,title:"Teams",decorator:DynamicsDecorators.iterationTeamCountDecorator,get:IterationModel.prototype.getTeams},c={autoScale:!1,fullWidth:!0,get:IterationModel.prototype.getTeams,decorator:DynamicsDecorators.iterationTeamListDecorator,editable:!0,visualizedEditable:!0,edit:{editor:"Autocomplete",dataType:"teamsAndIterations",
dialogTitle:"Select teams to have access",set:IterationModel.prototype.setTeams,showSelectAllItems:!0,showRemoveAllItems:!0}};this.accessIterationListConfig.addColumnConfiguration(0,a);this.accessIterationListConfig.addColumnConfiguration(1,b);this.accessIterationListConfig.addColumnConfiguration(3,c)};
var AccessRowController=function(a,b,c){this.model=a;this.view=b;this.parentController=c;this.init()};AccessRowController.prototype=new CommonController;AccessRowController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a)};
var ROIterationController=function(a){this.id=a.id;this.readonlyToken=a.readonlyToken;this.storyListElement=a.storyListElement;this.iterationInfoElement=a.backlogDetailElement;this.hourEntryListElement=a.hourEntryListElement;this.metricsElement=a.metricsElement;this.smallBurndownElement=a.smallBurndownElement;this.burndownElement=a.burndownElement;this.tabs=a.tabs;this.historyElement=a.historyElement;this.init();this.initIterationInfoConfig();this.initialize();var b=this;this.tabs.bind("tabsselect",
function(a,c){1===c.index&&b.historyElement.load("ajax/ROIterationHistoryByToken.action",{readonlyToken:b.readonlyToken})});window.pageController.setMainController(this)};ROIterationController.columnNames="name reference startDate endDate plannedSize baselineLoad assignees description".split(" ");ROIterationController.columnIndices=CommonController.createColumnIndices(ROIterationController.columnNames);
ROIterationController.columnConfigs={name:{title:"Name",get:IterationModel.prototype.getName,editable:!1},reference:{title:"Reference ID",get:BacklogModel.prototype.getId,decorator:DynamicsDecorators.quickReference},startDate:{title:"Start Date",get:IterationModel.prototype.getStartDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!1},endDate:{title:"End Date",get:IterationModel.prototype.getEndDate,decorator:DynamicsDecorators.dateTimeDecorator,editable:!1},plannedSize:{title:"Planned Size",
get:IterationModel.prototype.getBacklogSize,decorator:DynamicsDecorators.exactEstimateAppendManHourDecorator,editable:!1},baselineLoad:{title:"Baseline load",get:IterationModel.prototype.getBaselineLoad,decorator:DynamicsDecorators.exactEstimateDecorator,editable:!1},assignees:{title:"Iteration assignees",headerTooltip:"Iteration assignees",get:BacklogModel.prototype.getAssignees,decorator:DynamicsDecorators.responsiblesDecorator,editable:!1,openOnRowEdit:!1},description:{title:"Description",get:IterationModel.prototype.getDescription,
editable:!1,decorator:DynamicsDecorators.emptyDescriptionDecorator}};ROIterationController.prototype=new BacklogController;ROIterationController.prototype.openLogEffort=function(){new SpentEffortWidget(this.model,jQuery.proxy(function(){this.reloadMetricsBox()},this))};
ROIterationController.prototype.handleModelEvents=function(a){if(a instanceof DynamicsEvents.MetricsEvent||a instanceof DynamicsEvents.RelationUpdatedEvent)a.getObject()instanceof TaskModel&&this.reloadMetrics(),a.getObject()instanceof StoryModel&&this.reloadMetricsBox(),a instanceof DynamicsEvents.RelationUpdatedEvent&&(a.getObject()instanceof IterationModel&&"story"===a.getRelation())&&this.reloadMetricsBox()};
ROIterationController.prototype.paintIterationInfo=function(){this.iterationInfoView=new DynamicVerticalTable(this,this.model,this.iterationDetailConfig,this.iterationInfoElement);this.iterationInfoView.render()};ROIterationController.prototype.reloadBurndown=function(){var a=this.burndownElement.attr("src");this.burndownElement.attr("src",a+"#");a=this.smallBurndownElement.attr("src");this.smallBurndownElement.attr("src",a+"#")};
ROIterationController.prototype.initializeMetricsBox=function(){this.metricsElement.load("ajax/ROIterationMetricsByToken.action",{readonlyToken:this.readonlyToken})};ROIterationController.prototype.reloadMetricsBox=function(){this.initializeMetricsBox();this.reloadBurndown();document.body.style.cursor="default"};ROIterationController.prototype.reloadMetrics=function(){this.reloadBurndown();this.reloadMetricsBox()};
ROIterationController.prototype.initializeStoryList=function(){this.storyListController=new ROStoryListController(this.model,this.storyListElement,this)};ROIterationController.prototype.initialize=function(){var a=this;ModelFactory.initializeFor(ModelFactory.initializeForTypes.ROIteration,this.readonlyToken,function(b){a.model=b;a.attachModelListener();a.paintIterationInfo();a.initializeStoryList();a.initializeMetricsBox()})};
ROIterationController.prototype.initIterationInfoConfig=function(){var a=new DynamicTableConfiguration({leftWidth:"20%",rightWidth:"79%",closeRowCallback:null,validators:[BacklogModel.Validators.dateValidator]});a.addColumnConfiguration(ROIterationController.columnIndices.name,ROIterationController.columnConfigs.name);a.addColumnConfiguration(ROIterationController.columnIndices.reference,ROIterationController.columnConfigs.reference);a.addColumnConfiguration(ROIterationController.columnIndices.startDate,
ROIterationController.columnConfigs.startDate);a.addColumnConfiguration(ROIterationController.columnIndices.endDate,ROIterationController.columnConfigs.endDate);a.addColumnConfiguration(ROIterationController.columnIndices.plannedSize,ROIterationController.columnConfigs.plannedSize);a.addColumnConfiguration(ROIterationController.columnIndices.baselineLoad,ROIterationController.columnConfigs.baselineLoad);a.addColumnConfiguration(ROIterationController.columnIndices.assignees,ROIterationController.columnConfigs.assignees);
a.addColumnConfiguration(ROIterationController.columnIndices.description,ROIterationController.columnConfigs.description);this.iterationDetailConfig=a};
var ROStoryListController=function(a,b,c){this.model=a;this.element=b;this.parentController=c;this.init();this.initConfig();this.initializeView()};ROStoryListController.prototype=new CommonController;ROStoryListController.prototype.handleModelEvents=function(a){this.parentController&&this.parentController.handleModelEvents(a);if(a instanceof DynamicsEvents.RankChanged&&"story"===a.getRankedType()){var b=this;this.model.reloadStoryRanks(function(){b.getCurrentView().resort()})}};
ROStoryListController.prototype.initializeView=function(){this.view=new DynamicTable(this,this.model,this.getCurrentConfig(),this.element);this.view.render()};ROStoryListController.prototype.getCurrentConfig=function(){return this.storyListConfig};ROStoryListController.prototype.initConfig=function(){this.storyListConfig=this._getTableConfig();this._addColumnConfigs(this.storyListConfig)};
ROStoryListController.prototype.filterStoriesByState=function(a){var b=this,c=function(a){return!b.stateFilters||-1!==jQuery.inArray(a.getState(),b.stateFilters)},d=new StateFilterWidget(a,{bubbleOptions:{title:"Filter by state",offsetX:-15,minWidth:100,minHeight:20},callback:function(a){b.stateFilters=d.getFilter();a?(b.getCurrentView().activateColumnFilter("State"),b.getCurrentView().setFilter(c)):(b.getCurrentView().disableColumnFilter("State"),b.getCurrentView().setFilter(null));b.getCurrentView().filter()},
activeStates:b.stateFilters})};ROStoryListController.prototype.storyControllerFactory=function(a,b){var c=new StoryController(b,a,this);this.addChildController("story",c);return c};
ROStoryListController.prototype._getTableConfig=function(){return new DynamicTableConfiguration({rowControllerFactory:ROStoryListController.prototype.storyControllerFactory,dataSource:IterationModel.prototype.getStories,sortCallback:StoryController.prototype.rankStory,caption:"Stories",dataType:"story",captionConfig:{cssClasses:"dynamictable-caption-block ui-widget-header ui-corner-all"},cssClass:"ui-widget-content ui-corner-all iteration-story-table",rowDroppable:!0,dropOptions:{callback:TaskController.prototype.moveTask,
accepts:StoryController.prototype.acceptsDraggable},afterFirstRender:$.proxy(function(){},this)})};
ROStoryListController.prototype._addColumnConfigs=function(a){Configuration.isLabelsInStoryList()&&a.addColumnConfiguration(StoryController.columnIndices.labelsIcon,ROStoryListController.columnConfig.labelsIcon);a.addColumnConfiguration(StoryController.columnIndices.id,ROStoryListController.columnConfig.id);a.addColumnConfiguration(StoryController.columnIndices.name,ROStoryListController.columnConfig.name);a.addColumnConfiguration(StoryController.columnIndices.value,ROStoryListController.columnConfig.value);
a.addColumnConfiguration(StoryController.columnIndices.points,ROStoryListController.columnConfig.points);a.addColumnConfiguration(StoryController.columnIndices.state,ROStoryListController.columnConfig.state);a.addColumnConfiguration(StoryController.columnIndices.responsibles,ROStoryListController.columnConfig.responsibles);a.addColumnConfiguration(StoryController.columnIndices.el,ROStoryListController.columnConfig.effortLeft);Configuration.isTimesheetsEnabled()&&a.addColumnConfiguration(StoryController.columnIndices.es,
ROStoryListController.columnConfig.effortSpent);a.addColumnConfiguration(StoryController.columnIndices.labels,ROStoryListController.columnConfig.labels);a.addColumnConfiguration(StoryController.columnIndices.description,ROStoryListController.columnConfig.description);a.addColumnConfiguration(StoryController.columnIndices.buttons,ROStoryListController.columnConfig.buttons)};ROStoryListController.columnConfig={};
ROStoryListController.columnConfig.id={minWidth:30,autoScale:!0,title:"ID",headerTooltip:"Story ID",get:CommonModel.prototype.getId,editable:!1};ROStoryListController.columnConfig.labelsIcon={minWidth:40,autoScale:!0,title:"Labels",headerTooltip:"Story's labels",subViewFactory:StoryController.prototype.labelsIconFactory};ROStoryListController.columnConfig.labels={columnName:"labels",fullWidth:!0,visible:!1,get:StoryModel.prototype.getLabels,editable:!1};
ROStoryListController.columnConfig.name={minWidth:200,autoScale:!0,title:"Name",headerTooltip:"Story name",get:StoryModel.prototype.getName,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getName),editable:!1};
ROStoryListController.columnConfig.points={minWidth:50,autoScale:!0,title:"Points",headerTooltip:"Estimate in story points",get:StoryModel.prototype.getStoryPoints,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryPoints),decorator:DynamicsDecorators.estimateDecorator,editable:!1};
ROStoryListController.columnConfig.value={minWidth:50,autoScale:!0,title:"Value",headerTooltip:"Story value",get:StoryModel.prototype.getStoryValue,sortCallback:DynamicsComparators.valueComparatorFactory(StoryModel.prototype.getStoryValue),decorator:DynamicsDecorators.estimateDecorator,editable:!1};
ROStoryListController.columnConfig.state={minWidth:70,autoScale:!0,title:"State",headerTooltip:"Story state",get:StoryModel.prototype.getState,decorator:DynamicsDecorators.storyStateColorDecorator,filter:StoryListController.prototype.filterStoriesByState,editable:!1};
ROStoryListController.columnConfig.responsibles={minWidth:60,autoScale:!0,title:"Responsibles",headerTooltip:"Story responsibles",get:StoryModel.prototype.getResponsibles,decorator:DynamicsDecorators.responsiblesDecorator,editable:!1,openOnRowEdit:!1};ROStoryListController.columnConfig.effortLeft={minWidth:30,autoScale:!0,cssClass:"sum-column",title:"Left",headerTooltip:"Total sum of stories' tasks' effort left estimates in man-hours",decorator:DynamicsDecorators.exactEstimateSumDecorator,get:StoryModel.prototype.getTotalEffortLeft};
ROStoryListController.columnConfig.effortSpent={minWidth:30,autoScale:!0,title:"Spent",headerTooltip:"Total task spent effort in man-hours",decorator:DynamicsDecorators.exactEstimateDecorator,get:StoryModel.prototype.getTotalEffortSpent,editable:!1};ROStoryListController.columnConfig.description={columnName:"description",fullWidth:!0,visible:!1,get:StoryModel.prototype.getDescription,decorator:DynamicsDecorators.emptyDescriptionDecorator,editable:!1};
StoryListController.columnConfig.buttons={columnName:"buttons",fullWidth:!0,visible:!1,subViewFactory:DynamicsButtons.commonButtonFactory};
var AutocompleteSearch=function(a,b){this.searchInput=this.element=null;this.bundle=a;this.suggestionList=null;this.items=[];this.matchedItems=[];this.selectedItem=-1;this.timer=null;this.options={visibleSuggestions:5};jQuery.extend(this.options,b)};AutocompleteSearch.prototype.setItems=function(a){this.items=a};
AutocompleteSearch.prototype.initialize=function(a){var b=this;this.element=a;this.element.addClass(AutocompleteVars.cssClasses.searchParent);this.combobox=$('\x3cspan class\x3d"autocomplete-custom-combobox"/\x3e').appendTo(this.element);this.searchInput=$('\x3cinput type\x3d"text"/\x3e').appendTo(this.combobox);this.searchInput.click(function(){b.timeoutUpdateMatches()});this.suggestionList=$("\x3cul/\x3e").hide().addClass(AutocompleteVars.cssClasses.suggestionList).appendTo(this.element);this.bindEvents();
var c=this.searchInput;wasOpen=!1;$("\x3ca\x3e").attr("title","Show all items").appendTo(this.combobox).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("autocomplete-custom-combobox-toggle ui-corner-right").mousedown(function(){wasOpen=b.suggestionList.is(":visible")}).click(function(){c.val("");wasOpen?b.cancelSelection():(c.click(),c.autocomplete("search",""))})};
AutocompleteSearch.prototype.bindEvents=function(){var a=this;this.searchInput.bind("keyup",function(b){b=b.keyCode;b===AutocompleteVars.keyCodes.up?a.shiftSelectionUp():b===AutocompleteVars.keyCodes.down?a.shiftSelectionDown():b===AutocompleteVars.keyCodes.enter?a.handleEnterEvent():b===AutocompleteVars.keyCodes.esc?a.cancelSelection():a.timeoutUpdateMatches()})};
AutocompleteSearch.prototype.shiftSelectionUp=function(){-1!==this.selectedItem&&(this.suggestionList.is(":hidden")&&this.updateMatches(),this.selectedItem--,this.updateSelectedListItem())};AutocompleteSearch.prototype.shiftSelectionDown=function(){this.selectedItem!==this.matchedItems.length-1&&(this.suggestionList.is(":hidden")&&this.updateMatches(),this.selectedItem++,this.updateSelectedListItem())};
AutocompleteSearch.prototype.updateSelectedListItem=function(){this.suggestionList.children().removeClass(AutocompleteVars.cssClasses.selectedLi);this.suggestionList.children().eq(this.selectedItem);this.suggestionList.children().eq(this.selectedItem).addClass(AutocompleteVars.cssClasses.selectedLi)};AutocompleteSearch.prototype.handleEnterEvent=function(){""===this.searchInput.val()?this.bundle.selectAndClose():this.selectCurrentItem()};AutocompleteSearch.prototype.selectCurrentItem=function(){this.suggestionList.children("li").eq(this.selectedItem).click()};
AutocompleteSearch.prototype.selectItem=function(a){this.bundle.selectItem(a);this.cancelSelection()};AutocompleteSearch.prototype.cancelSelection=function(){this.selectedItem=-1;this.suggestionList.hide()};AutocompleteSearch.prototype.clearInput=function(){this.searchInput.val("");this.cancelSelection()};AutocompleteSearch.prototype.setSearchBoxValue=function(a){this.searchInput.val(a);this.cancelSelection()};
AutocompleteSearch.prototype.timeoutUpdateMatches=function(){var a=this;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){a.updateMatches()},AutocompleteVars.inputWaitTime)};AutocompleteSearch.prototype.updateMatches=function(){var a=this.searchInput.val();this.matchedItems=this.filterSuggestions(this.items,a);this.renderSuggestionList()};
AutocompleteSearch.prototype.filterSuggestions=function(a,b){var c=this;return jQuery.grep(a,function(a,e){return a.enabled&&(c.matchSearchString(a.matchedString,b)||c.matchSearchString(a.name,b))&&!c.bundle.isItemSelected(a.id)})};AutocompleteSearch.prototype.matchSearchString=function(a,b){if(!b&&""!=b||!a)return!1;for(var c=b.replace(/[\]\[\\!#$%&()*+,./:;<=>?@_`{|}~]+/," ").split(" "),f=!0,e=0;e<c.length;e++){var d=c[e];if(-1===a.toLowerCase().indexOf(d.toLowerCase())){f=!1;break}}return f};
AutocompleteSearch.prototype.renderSuggestionList=function(){var a=this;this.suggestionList.empty();if(0===this.matchedItems.length){var b=$("\x3cli/\x3e").attr("title","No items found with the given input.").appendTo(a.suggestionList),c=$("\x3cspan/\x3e").appendTo(b);a.addSuggestionListItemIcon(c,"noResults");$("\x3cspan/\x3e").text("No items found").appendTo(b);b.click(function(){a.cancelSelection()})}else $.each(this.matchedItems,function(b,c){var d=$("\x3cli/\x3e").attr("title",c.name).appendTo(a.suggestionList),
g=$("\x3cspan/\x3e").appendTo(d);a.addSuggestionListItemIcon(g,c.baseClassName);$("\x3cspan/\x3e").text(c.name).appendTo(d);d.click(function(){a.selectItem(c)})});this.suggestionList.show()};
AutocompleteSearch.prototype.addSuggestionListItemIcon=function(a,b){var c={"fi.hut.soberit.agilefant.model.User":AutocompleteVars.cssClasses.suggestionUserIcon,"fi.hut.soberit.agilefant.model.Team":AutocompleteVars.cssClasses.suggestionTeamIcon,"fi.hut.soberit.agilefant.model.Backlog":AutocompleteVars.cssClasses.suggestionBacklogIcon,noResults:AutocompleteVars.cssClasses.noResultsIcon};a.addClass(AutocompleteVars.cssClasses.suggestionIcon);a.addClass(c[b])};AutocompleteSearch.prototype.focus=function(){this.searchInput.focus()};
var AutocompleteSelected=function(a){this.selectedList=null;this.selectedIds=[];this.items=[];this.parent=a};AutocompleteSelected.prototype.setItems=function(a){this.items=a};AutocompleteSelected.prototype.getSelectedIds=function(){return this.selectedIds};AutocompleteSelected.prototype.getSelectedItems=function(){for(var a=[],b=0;b<this.items.length;b++)-1!==jQuery.inArray(this.items[b].id,this.selectedIds)&&a.push(this.items[b].originalObject);return a};
AutocompleteSelected.prototype.initialize=function(a){this.element=a;this.element.addClass(AutocompleteVars.cssClasses.selectedParent);this.selectedList=$("\x3cul/\x3e").addClass(AutocompleteVars.cssClasses.selectedItemsList).appendTo(this.element)};AutocompleteSelected.prototype.isItemSelected=function(a){return-1!==jQuery.inArray(a,this.selectedIds)};
AutocompleteSelected.prototype.getItemsByIdList=function(a){if(!a)return[];for(var b=[],c=0;c<this.items.length;c++)-1!==jQuery.inArray(this.items[c].id,a)&&b.push(this.items[c]);return b};AutocompleteSelected.prototype.checkValidityForAddition=function(a){return!a||!a.name||"object"!==typeof a||!a.id&&!(a.idList&&a.idList.constructor==Array)?!1:!0};AutocompleteSelected.prototype.addItemById=function(a){for(var b=0;b<this.items.length;b++)this.items[b].id===a&&this.addItem(this.items[b])};
AutocompleteSelected.prototype.addItem=function(a){if(this.checkValidityForAddition(a))if(a.idList){a=this.getItemsByIdList(a.idList);for(var b=0;b<a.length;b++)this.selectItem(a[b])}else this.selectItem(a)};AutocompleteSelected.prototype.selectItem=function(a){if(a&&!("object"!==typeof a||this.isItemSelected(a.id)))this.selectedIds.push(a.id),this.addListItem(a)};
AutocompleteSelected.prototype.addListItem=function(a){var b=this,c=$("\x3cli/\x3e").appendTo(this.selectedList);$("\x3cspan/\x3e").text(a.name).addClass(AutocompleteVars.cssClasses.selectedItemName).appendTo(c);$("\x3cspan/\x3e").text("X").addClass(AutocompleteVars.cssClasses.selectedItemRemove).appendTo(c).click(function(){b.removeItem(a.id,c)})};AutocompleteSelected.prototype.removeItem=function(a,b){ArrayUtils.remove(this.selectedIds,a);b.remove();this.parent.focusSearchField()};
AutocompleteSelected.prototype.removeAllItems=function(){this.selectedIds=[];this.selectedList.empty()};
var AutocompleteRecent=function(a,b,d,c){this.cookieName="agilefant-autocomplete-"+b;this.recentlySelected=[];this.element=a;this.parent=d;this.options={caption:"Recently used",recentShowCount:5}};AutocompleteRecent.prototype.initialize=function(){this.getDataFromCookie()};
AutocompleteRecent.prototype.render=function(){var a=this;this.caption=$("\x3cspan/\x3e").text(this.options.caption).appendTo(this.element);this.suggestionList=$("\x3cul/\x3e").addClass(AutocompleteVars.cssClasses.recentList);this.element.append(this.suggestionList);var b=this.parent.getItemsByIdList(this.recentlySelected);$.each(b,function(b,c){$("\x3cli/\x3e").text(c.name).attr("title",c.name).appendTo(a.suggestionList).click(function(){a.parent.selectItem(c)})})};
AutocompleteRecent.prototype.pushToRecent=function(a){if(a.idList)for(var b=0;b<a.idList.length;b++)this._addToRecent(a.idList[b]);else this._addToRecent(a.id);this.storeCookie()};AutocompleteRecent.prototype._addToRecent=function(a){ArrayUtils.remove(this.recentlySelected,a);this.recentlySelected.unshift(a);this.recentlySelected=this.recentlySelected.splice(0,5)};
AutocompleteRecent.prototype.getDataFromCookie=function(){this.recentlySelected=[];var a=jQuery.cookie(this.cookieName);a||(a="");for(var a=a.split(","),b=0;b<a.length;b++)this.recentlySelected.push(parseInt(a[b],10))};AutocompleteRecent.prototype.storeCookie=function(){var a=this.recentlySelected.join(","),b=new Date;b.addDays(30);jQuery.cookie(this.cookieName,a,{expires:b})};
var AutocompleteVars={cssClasses:{autocompleteDialog:"autocomplete-dialog",leftPanel:"autocomplete-left",rightPanel:"autocomplete-right",autocompleteElement:"autocomplete",searchParent:"autocomplete-searchBoxContainer",selectedParent:"autocomplete-selectedBoxContainer",suggestionList:"autocomplete-suggestionList",selectedLi:"autocomplete-selected",selectedItemsList:"autocomplete-selectedItemsList",selectedItemName:"autocomplete-selectedName",selectedItemRemove:"autocomplete-selectedRemove",recentElement:"autocomplete-recentBox",
recentList:"autocomplete-recentList",selectAllItemsElement:"autocomplete-selectAllItemsBox",removeAllItemsElement:"autocomplete-removeAllItemsBox",suggestionIcon:"autocomplete-suggestionIcon",suggestionUserIcon:"autocomplete-userIcon",suggestionTeamIcon:"autocomplete-teamIcon",suggestionBacklogIcon:"autocomplete-backlogIcon",noResultsIcon:"autocomplete-noResultsIcon"},keyCodes:{enter:13,esc:27,down:40,up:38},inputWaitTime:500},Autocomplete=function(a,b){this._init(a,b)};
Autocomplete.prototype._init=function(a,b){this.parent=a;this.items=[];this.leftPanel=$("\x3cdiv/\x3e").addClass(AutocompleteVars.cssClasses.leftPanel);this.rightPanel=$("\x3cdiv/\x3e").addClass(AutocompleteVars.cssClasses.rightPanel);this.searchBoxContainer=$("\x3cdiv/\x3e");this.selectedBoxContainer=$("\x3cdiv/\x3e");this.selectAllItemsContainer=$("\x3cdiv/\x3e");this.removeAllItemsContainer=$("\x3cdiv/\x3e");this.recentContainer=$("\x3cdiv/\x3e");this.options={multiSelect:!0,dataType:"",params:{},
preSelected:[],visibleSuggestions:5,showRecent:!0,showSelectAllItems:!1,showRemoveAllItems:!1};jQuery.extend(this.options,b);this.dataProvider=null;this.selectedBox=new AutocompleteSelected(this);this.searchBox=new AutocompleteSearch(this);this.recentBox=new AutocompleteRecent(this.recentContainer,this.options.dataType,this,{});this.selectAllItemsBox=new AutocompleteSelectAllItems(this.selectAllItemsContainer,this.options.dataType,this,{});this.removeAllItemsBox=new AutocompleteRemoveAllItems(this.removeAllItemsContainer,
this.options.dataType,this,{})};
Autocomplete.prototype.initialize=function(){this.element=$("\x3cdiv/\x3e").addClass(AutocompleteVars.cssClasses.autocompleteElement).appendTo(this.parent);this.options.showRecent&&this.rightPanel.appendTo(this.element);this.leftPanel.appendTo(this.element);this.dataProvider=AutocompleteDataProvider.getInstance();this.options.showSelectAllItems&&(this.element.addClass("autocomplete-selectallitems-visible"),this._initializeSelectAllItems());this.options.showRemoveAllItems&&(this.element.addClass("autocomplete-removeallitems-visible"),
this._initializeRemoveAllItems());this.searchBoxContainer.appendTo(this.leftPanel);this.options.multiSelect?this._initializeMultiSelect():this._initializeSingleSelect();this.options.showRecent&&(this.element.addClass("autocomplete-recent-visible"),this._initializeRecent());this.searchBox.focus()};
Autocomplete.prototype._initializeMultiSelect=function(){this.selectedBoxContainer.appendTo(this.leftPanel);this.getData();this.searchBox.setItems(this.items);this.selectedBox.setItems(this.dataProvider.filterIdLists(this.items));this.searchBox.initialize(this.searchBoxContainer);this.selectedBox.initialize(this.selectedBoxContainer);this.setSelected(this.options.preSelected)};Autocomplete.prototype._initializeSingleSelect=function(){this.getData();this.searchBox.setItems(this.items);this.searchBox.initialize(this.searchBoxContainer)};
Autocomplete.prototype._initializeRecent=function(){this.recentBox.initialize();this.options.showRecent&&(this.recentContainer.addClass(AutocompleteVars.cssClasses.recentElement).appendTo(this.rightPanel),this.recentBox.render())};Autocomplete.prototype._initializeSelectAllItems=function(){this.selectAllItemsBox.initialize();this.options.showSelectAllItems&&(this.selectAllItemsContainer.addClass(AutocompleteVars.cssClasses.selectAllItemsElement).appendTo(this.leftPanel),this.selectAllItemsBox.render())};
Autocomplete.prototype._initializeRemoveAllItems=function(){this.removeAllItemsBox.initialize();this.options.showRemoveAllItems&&(this.removeAllItemsContainer.addClass(AutocompleteVars.cssClasses.removeAllItemsElement).appendTo(this.leftPanel),this.removeAllItemsBox.render())};Autocomplete.prototype.setSelected=function(a){for(var b=0;b<a.length;b++)this.selectedBox.addItemById(a[b])};
Autocomplete.prototype.selectItem=function(a){this.recentBox.pushToRecent(a);this.options.multiSelect?(this.selectedBox.addItem(a),this.searchBox.clearInput()):this.options.selectCallback(a)};Autocomplete.prototype.selectAndClose=function(){this.options.multiSelect&&this.options.selectCallback&&this.options.selectCallback()};Autocomplete.prototype.getData=function(){this.items=this.dataProvider.get(this.options.dataType,this.options.params)};Autocomplete.prototype.setSearchBoxValue=function(a){this.searchBox.setSearchBoxValue(a)};
Autocomplete.prototype.focusSearchField=function(){this.searchBox.focus()};Autocomplete.prototype.remove=function(){this.element.remove()};Autocomplete.prototype.getSelectedIds=function(){return this.selectedBox.getSelectedIds()};Autocomplete.prototype.isItemSelected=function(a){return this.selectedBox.isItemSelected(a)};Autocomplete.prototype.getSelectedItems=function(){return this.selectedBox.getSelectedItems()};
Autocomplete.prototype.getItemsByIdList=function(a){if(!a)return[];for(var b=[],d=this.dataProvider.filterIdLists(this.items),c=0;c<d.length;c++)-1!==jQuery.inArray(d[c].id,a)&&b.push(d[c]);return b};Autocomplete.prototype.getAllItems=function(){return this.items};Autocomplete.prototype.removeAllSelected=function(){this.selectedBox.removeAllItems()};
AutocompleteDataProvider=function(){};
AutocompleteDataProvider.vars={urls:{usersAndTeams:{url:"ajax/userChooserData.action"},teams:{url:"ajax/teamChooserData.action"},backlogs:{url:"ajax/backlogChooserData.action"},backlogsAndIterations:{url:"ajax/backlogAndIterationChooserData.action"},currentIterations:{url:"ajax/currentIterationChooserData.action"},products:{url:"ajax/productChooserData.action"},projects:{url:"ajax/projectChooserData.action"},teamsAndProducts:{url:"ajax/teamChooserData.action"},teamsAndIterations:{url:"ajax/teamChooserData.action"}}};
AutocompleteDataProvider.instance=null;AutocompleteDataProvider.getInstance=function(){AutocompleteDataProvider.instance||(AutocompleteDataProvider.instance=new AutocompleteDataProvider);return AutocompleteDataProvider.instance};AutocompleteDataProvider.prototype.get=function(a,b){return this._fetchData(AutocompleteDataProvider.vars.urls[a].url,b)};AutocompleteDataProvider.prototype.filterIdLists=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.idList||b.push(d)}return b};
AutocompleteDataProvider.prototype._fetchData=function(a,b){var c=null,d={};jQuery.extend(d,b);jQuery.ajax({async:!1,url:a,cache:!1,dataType:"json",data:d,type:"post",success:function(a,b){c=a},error:function(a,b,c){MessageDisplay.Error("Unable to load data for autocompletion")}});return c};
(function(d){d.widget("ui.autocompleteDialog",{_init:function(){var a=this.element.data(this.widgetName);this.element.removeData(this.widgetName);this.element=d("\x3cdiv /\x3e");this.element.data(this.widgetName,a);var b=this,a=this.options.multiSelect,c={dataType:this.options.dataType,preSelected:this.options.selected,multiSelect:a};this.options.multiSelect?c.selectCallback=function(){b.select()}:c.callback=function(a){b.selectCallback(a)};var e={Ok:function(){b.select()}};this.options.required||
(e.Cancel=function(){b._cancel()});c=new Autocomplete(this.element,c);c.initialize();this.setValue(this.options.selected);this.element.dialog({buttons:e,width:500,modal:!0,minHeight:a?400:150,position:a?"top":"center",title:this.options.title,close:function(){b._cancel()},dialogClass:AutocompleteVars.cssClasses.autocompleteDialog});this.element.data("autocomplete",c)},_cancel:function(){this.options.cancel&&this.options.cancel.call(this);this.destroy()},select:function(a){a?this.options.callback.call(this,
[a.id]):this.options.callback.apply(this,this.value());this.destroy()},value:function(){var a=this.element.data("autocomplete").getSelectedIds(),b=this.element.data("autocomplete").getSelectedItems();return[a,b]},setValue:function(){},destroy:function(){this.element.remove()}});d.extend(d.ui.autocompleteDialog,{getter:"value",defaults:{callback:function(){},cancel:function(){},title:"Select",dataType:"",selected:[],multiSelect:!0}})})(jQuery);
(function(b){b.widget("ui.autocompleteSingleDialog",{_init:function(){var a=this.element.data(this.widgetName);this.element.removeData(this.widgetName);this.element=b("\x3cdiv /\x3e");this.element.data(this.widgetName,a);var c=this,a=new Autocomplete(this.element,{dataType:this.options.dataType,preSelected:this.options.selected,multiSelect:!1,selectCallback:function(a){c.select(a)}});a.initialize();this.setValue(this.options.selected);this.element.dialog({buttons:{Cancel:function(){c._cancel()}},
width:500,minHeight:150,title:this.options.title,modal:!0,close:function(){c._cancel()},dialogClass:AutocompleteVars.cssClasses.autocompleteDialog});this.element.data("autocomplete",a)},_cancel:function(){this.options.cancel&&this.options.cancel.call(this);this.destroy()},select:function(a){this.options.callback.apply(this,[a.id]);this.destroy()},setValue:function(){},destroy:function(){this.element.remove()}});b.extend(b.ui.autocompleteDialog,{getter:"value",defaults:{callback:function(){},cancel:function(){},
title:"Select",dataType:"",selected:[]}})})(jQuery);
(function(c){c.widget("ui.autocompleteInline",{_init:function(){this.element.data(this.widgetName);var a=this,b=new Autocomplete(this.element,{dataType:this.options.dataType,preSelected:this.options.selected,multiSelect:!1,showRecent:this.options.showRecent,selectCallback:function(b){a.setValue(b);b=ModelFactory.updateObject(b.originalObject);a.options.callback(b)}});b.initialize();this.element.data("autocomplete",b);this.setValue(this.options.selected)},select:function(a){a?this.options.callback.call(this,
[a.id]):this.options.callback.apply(this,this.value())},value:function(){var a=this.element.data("autocomplete").getSelectedIds(),b=this.element.data("autocomplete").getSelectedItems();return[a,b]},setValue:function(a){this.selected=a.id;this.element.data("autocomplete").setSearchBoxValue(a.name)}});c.extend(c.ui.autocompleteInline,{getter:"value",defaults:{callback:function(){},cancel:function(){},title:"Select",dataType:"",selected:[],multiSelect:!0,showRecent:!1}})})(jQuery);
var AutocompleteSelectAllItems=function(a,b,d,c){this.element=a;this.parent=d;this.options={caption:"Add all"}};AutocompleteSelectAllItems.prototype.initialize=function(){};AutocompleteSelectAllItems.prototype.render=function(){var a=this;this.caption=$("\x3cspan/\x3e").text(this.options.caption).appendTo(this.element);this.caption.addClass(AutocompleteVars.cssClasses.selectAllItemsElement);this.caption.click(function(){var b=a.parent.getAllItems();$.each(b,function(b,c){a.parent.selectItem(c)})})};
var AutocompleteRemoveAllItems=function(a,c,b,d){this.element=a;this.parent=b;this.options={caption:"Remove all"}};AutocompleteRemoveAllItems.prototype.initialize=function(){};AutocompleteRemoveAllItems.prototype.render=function(){var a=this;this.caption=$("\x3cspan/\x3e").text(this.options.caption).appendTo(this.element);this.caption.addClass(AutocompleteVars.cssClasses.removeAllItemsElement);this.caption.click(function(){a.parent.removeAllSelected()})};
