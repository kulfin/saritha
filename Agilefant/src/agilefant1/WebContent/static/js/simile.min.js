window.Timeline={};window.Timeplot={};window.Timeline.clientLocale="en";window.Timeline.serverLocale="en";
var SimileAjax={loaded:!0,loadingScriptsCount:0,error:null,params:{bundle:"true"},Platform:{},parseURLParameters:function(a,e,g){e=e||{};g=g||{};"undefined"==typeof a&&(a=location.href);var b=a.indexOf("?");if(0>b)return e;a=(a+"#").slice(b+1,a.indexOf("#"));var f=a.split("\x26"),c;a={};for(var h=window.decodeURIComponent||unescape,b=0;c=f[b];b++){var k=c.indexOf("\x3d"),l=h(c.slice(0,k)),d=a[l];"undefined"==typeof d?d=[]:d instanceof Array||(d=[d]);a[l]=d.concat(h(c.slice(k+1)))}for(b in a)a.hasOwnProperty(b)&&
(f=g[b]||String,c=a[b],c instanceof Array||(c=[c]),e[b]=f===Boolean&&"false"==c[0]?!1:f.apply(this,c));return e}};
SimileAjax.version="2.2.1";SimileAjax.jQuery=jQuery;SimileAjax.Platform.os={isMac:!1,isWin:!1,isWin32:!1,isUnix:!1};SimileAjax.Platform.browser={isIE:!1,isNetscape:!1,isMozilla:!1,isFirefox:!1,isOpera:!1,isSafari:!1,majorVersion:0,minorVersion:0};
(function(){var c=navigator.appName.toLowerCase(),a=navigator.userAgent.toLowerCase();SimileAjax.Platform.os.isMac=-1!=a.indexOf("mac");SimileAjax.Platform.os.isWin=-1!=a.indexOf("win");SimileAjax.Platform.os.isWin32=SimileAjax.Platform.isWin&&(-1!=a.indexOf("95")||-1!=a.indexOf("98")||-1!=a.indexOf("nt")||-1!=a.indexOf("win32")||-1!=a.indexOf("32bit"));SimileAjax.Platform.os.isUnix=-1!=a.indexOf("x11");SimileAjax.Platform.browser.isIE=-1!=c.indexOf("microsoft");SimileAjax.Platform.browser.isNetscape=
-1!=c.indexOf("netscape");SimileAjax.Platform.browser.isMozilla=-1!=a.indexOf("mozilla");SimileAjax.Platform.browser.isFirefox=-1!=a.indexOf("firefox");SimileAjax.Platform.browser.isOpera=-1!=c.indexOf("opera");SimileAjax.Platform.browser.isSafari=-1!=c.indexOf("safari");var c=function(a){a=a.split(".");SimileAjax.Platform.browser.majorVersion=parseInt(a[0]);SimileAjax.Platform.browser.minorVersion=parseInt(a[1])},d=function(a,b,c){b=a.indexOf(b,c);return 0<=b?b:a.length};if(SimileAjax.Platform.browser.isMozilla){var b=
a.indexOf("mozilla/");0<=b&&c(a.substring(b+8,d(a," ",b)))}SimileAjax.Platform.browser.isIE&&(b=a.indexOf("msie "),0<=b&&c(a.substring(b+5,d(a,";",b))));SimileAjax.Platform.browser.isNetscape&&(b=a.indexOf("rv:"),0<=b&&c(a.substring(b+3,d(a,")",b))));SimileAjax.Platform.browser.isFirefox&&(b=a.indexOf("firefox/"),0<=b&&c(a.substring(b+8,d(a," ",b))));"localeCompare"in String.prototype||(String.prototype.localeCompare=function(a){return this<a?-1:this>a?1:0})})();
SimileAjax.Platform.getDefaultLocale=function(){return SimileAjax.Platform.clientLocale};
SimileAjax.Debug={silent:!1};SimileAjax.Debug.log=function(a){var b;b="console"in window&&"log"in window.console?function(a){console.log(a)}:function(a){SimileAjax.Debug.silent||alert(a)};SimileAjax.Debug.log=b;b(a)};SimileAjax.Debug.warn=function(a){var b;b="console"in window&&"warn"in window.console?function(a){console.warn(a)}:function(a){SimileAjax.Debug.silent||alert(a)};SimileAjax.Debug.warn=b;b(a)};
SimileAjax.Debug.exception=function(a,b){var d;d="throw"==SimileAjax.parseURLParameters().errors||"throw"==SimileAjax.params.errors?function(a,b){throw a;}:"console"in window&&"error"in window.console?function(a,b){null!=b?console.error(b+" %o",a):console.error(a);throw a;}:function(a,b){SimileAjax.Debug.silent||alert("Caught exception: "+b+"\n\nDetails: "+("description"in a?a.description:a));throw a;};SimileAjax.Debug.exception=d;d(a,b)};
SimileAjax.Debug.objectToString=function(a){return SimileAjax.Debug._objectToString(a,"")};SimileAjax.Debug._objectToString=function(a,b){var d=b+" ";if("object"==typeof a){var c="{";for(e in a)c+=d+e+": "+SimileAjax.Debug._objectToString(a[e],d)+"\n";return c+(b+"}")}if("array"==typeof a){for(var c="[",e=0;e<a.length;e++)c+=SimileAjax.Debug._objectToString(a[e],d)+"\n";return c+=b+"]"}return a};
SimileAjax.DOM={};SimileAjax.DOM.registerEventWithObject=function(a,b,c,d){SimileAjax.DOM.registerEvent(a,b,function(a,b,g){return c[d].call(c,a,b,g)})};SimileAjax.DOM.registerEvent=function(a,b,c){var d=function(b){if(b=b?b:event?event:null){var d=b.target?b.target:b.srcElement?b.srcElement:null;d&&(d=1==d.nodeType||9==d.nodeType?d:d.parentNode);return c(a,b,d)}return!0};SimileAjax.Platform.browser.isIE?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1)};
SimileAjax.DOM.getPageCoordinates=function(a){var b=0,c=0;1!=a.nodeType&&(a=a.parentNode);for(var d=a;null!=d;)b+=d.offsetLeft,c+=d.offsetTop,d=d.offsetParent;for(d=document.body;null!=a&&a!=d;)"scrollLeft"in a&&(b-=a.scrollLeft,c-=a.scrollTop),a=a.parentNode;return{left:b,top:c}};SimileAjax.DOM.getSize=function(a){var b=this.getStyle(a,"width");a=this.getStyle(a,"height");-1<b.indexOf("px")&&(b=b.replace("px",""));-1<a.indexOf("px")&&(a=a.replace("px",""));return{w:b,h:a}};
SimileAjax.DOM.getStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?document.defaultView.getComputedStyle(a,null).getPropertyValue(b):""};
SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){if("mousewheel"==a.type){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}return{x:a.offsetX,y:a.offsetY}}c=SimileAjax.DOM.getPageCoordinates(b);return"DOMMouseScroll"==a.type&&SimileAjax.Platform.browser.isFirefox&&2==SimileAjax.Platform.browser.majorVersion?{x:a.screenX-c.left,y:a.screenY-c.top}:{x:a.pageX-c.left,y:a.pageY-c.top}};
SimileAjax.DOM.getEventPageCoordinates=function(a){return SimileAjax.Platform.browser.isIE?{x:a.clientX+document.body.scrollLeft,y:a.clientY+document.body.scrollTop}:{x:a.pageX,y:a.pageY}};SimileAjax.DOM.hittest=function(a,b,c){return SimileAjax.DOM._hittest(document.body,a,b,c)};
SimileAjax.DOM._hittest=function(a,b,c,d){var e=a.childNodes,f=0;a:for(;f<e.length;f++){for(var g=e[f],h=0;h<d.length;h++)if(g==d[h])continue a;if(0==g.offsetWidth&&0==g.offsetHeight){if(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g)return h}else{for(var l=h=0,k=g;k;)h+=k.offsetTop,l+=k.offsetLeft,k=k.offsetParent;if(l<=b&&h<=c&&b-l<g.offsetWidth&&c-h<g.offsetHeight)return SimileAjax.DOM._hittest(g,b,c,d);if(1==g.nodeType&&"TR"==g.tagName&&(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g))return h}}return a};
SimileAjax.DOM.cancelEvent=function(a){a.returnValue=!1;a.cancelBubble=!0;"preventDefault"in a&&a.preventDefault()};SimileAjax.DOM.appendClassName=function(a,b){for(var c=a.className.split(" "),d=0;d<c.length;d++)if(c[d]==b)return;c.push(b);a.className=c.join(" ")};SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");b.innerHTML="\x3cinput type\x3d'"+a+"' /\x3e";return b.firstChild};
SimileAjax.DOM.createDOMFromTemplate=function(a){var b={};b.elmt=SimileAjax.DOM._createDOMFromTemplate(a,b,null);return b};
SimileAjax.DOM._createDOMFromTemplate=function(a,b,c){if(null==a)return null;if("object"!=typeof a)return a=document.createTextNode(a),null!=c&&c.appendChild(a),a;var d=null;if("tag"in a){var e=a.tag;null!=c&&("tr"==e?d=c.insertRow(c.rows.length):"td"==e&&(d=c.insertCell(c.cells.length)));null==d&&(d="input"==e?SimileAjax.DOM.createInputElement(a.type):document.createElement(e),null!=c&&c.appendChild(d))}else d=a.elmt,null!=c&&c.appendChild(d);for(var f in a)if(c=a[f],"field"==f)b[c]=d;else if("className"==
f)d.className=c;else if("id"==f)d.id=c;else if("title"==f)d.title=c;else if(!("type"==f&&"input"==d.tagName))if("style"==f)for(n in c)e=c[n],"float"==n&&(n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"),d.style[n]=e;else if("children"==f)for(e=0;e<c.length;e++)SimileAjax.DOM._createDOMFromTemplate(c[e],b,d);else"tag"!=f&&"elmt"!=f&&d.setAttribute(f,c);return d};SimileAjax.DOM._cachedParent=null;
SimileAjax.DOM.createElementFromString=function(a){null==SimileAjax.DOM._cachedParent&&(SimileAjax.DOM._cachedParent=document.createElement("div"));SimileAjax.DOM._cachedParent.innerHTML=a;return SimileAjax.DOM._cachedParent.firstChild};SimileAjax.DOM.createDOMFromString=function(a,b,c){a="string"==typeof a?document.createElement(a):a;a.innerHTML=b;b={elmt:a};SimileAjax.DOM._processDOMChildrenConstructedFromString(b,a,null!=c?c:{});return b};
SimileAjax.DOM._processDOMConstructedFromString=function(a,b,c){var d=b.id;if(null!=d&&0<d.length){b.removeAttribute("id");if(d in c){var e=b.parentNode;e.insertBefore(c[d],b);e.removeChild(b);a[d]=c[d];return}a[d]=b}b.hasChildNodes()&&SimileAjax.DOM._processDOMChildrenConstructedFromString(a,b,c)};SimileAjax.DOM._processDOMChildrenConstructedFromString=function(a,b,c){for(b=b.firstChild;null!=b;){var d=b.nextSibling;1==b.nodeType&&SimileAjax.DOM._processDOMConstructedFromString(a,b,c);b=d}};
SimileAjax.Graphics={};SimileAjax.Graphics.pngIsTranslucent=!SimileAjax.Platform.browser.isIE||6<SimileAjax.Platform.browser.majorVersion;SimileAjax.Graphics.pngIsTranslucent||SimileAjax.includeCssFile(document,SimileAjax.urlPrefix+"styles/graphics-ie6.css");SimileAjax.Graphics._createTranslucentImage1=function(a,b){var c=document.createElement("img");c.setAttribute("src",a);null!=b&&(c.style.verticalAlign=b);return c};
SimileAjax.Graphics._createTranslucentImage2=function(a,b){var c=document.createElement("img");c.style.width="1px";c.style.height="1px";c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+a+"', sizingMethod\x3d'image')";c.style.verticalAlign=null!=b?b:"middle";return c};SimileAjax.Graphics.createTranslucentImage=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImage1:SimileAjax.Graphics._createTranslucentImage2;
SimileAjax.Graphics._createTranslucentImageHTML1=function(a,b){return'\x3cimg src\x3d"'+a+'"'+(null!=b?' style\x3d"vertical-align: '+b+';"':"")+" /\x3e"};SimileAjax.Graphics._createTranslucentImageHTML2=function(a,b){return"\x3cimg src\x3d'"+a+"' style\x3d\""+("width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+a+"', sizingMethod\x3d'image');"+(null!=b?" vertical-align: "+b+";":""))+'" /\x3e'};
SimileAjax.Graphics.createTranslucentImageHTML=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImageHTML1:SimileAjax.Graphics._createTranslucentImageHTML2;SimileAjax.Graphics.setOpacity=function(a,b){if(SimileAjax.Platform.browser.isIE)a.style.filter="progid:DXImageTransform.Microsoft.Alpha(Style\x3d0,Opacity\x3d"+b+")";else{var c=(b/100).toString();a.style.opacity=c;a.style.MozOpacity=c}};
SimileAjax.Graphics.bubbleConfig={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20};
SimileAjax.Graphics.createBubbleForContentAndPoint=function(a,b,c,e,f,d){"number"!=typeof e&&(e=300);"number"!=typeof d&&(d=0);a.style.position="absolute";a.style.left="-5000px";a.style.top="0px";a.style.width=e+"px";document.body.appendChild(a);window.setTimeout(function(){var e=a.scrollWidth+10,l=a.scrollHeight+10,k=0;0<d&&l>d&&(l=d,k=e-25);l=SimileAjax.Graphics.createBubbleForPoint(b,c,e,l,f);document.body.removeChild(a);a.style.position="static";a.style.left="";a.style.top="";0<k?(e=document.createElement("div"),
a.style.width="",e.style.width=k+"px",e.appendChild(a),l.content.appendChild(e)):(a.style.width=e+"px",l.content.appendChild(a))},200)};
SimileAjax.Graphics.createBubbleForPoint=function(a,b,c,e,f){c=parseInt(c,10);e=parseInt(e,10);var d=SimileAjax.Graphics.bubbleConfig,p=SimileAjax.Graphics.pngIsTranslucent?"pngTranslucent":"pngNotTranslucent",l=function(a){return a+" "+a+"-"+p},k=document.createElement("div");k.className=l(d.containerCSSClass);k.style.width=c+"px";k.style.height=e+"px";var q=document.createElement("div");q.className=l(d.innerContainerCSSClass);k.appendChild(q);var h={_closed:!1},r=SimileAjax.WindowManager.pushLayer(function(){h._closed||
(document.body.removeChild(h._div),h._doc=null,h._div=null,h._content=null,h._closed=!0)},!0,k);h._div=k;h.close=function(){SimileAjax.WindowManager.popLayer(r)};var g=function(a){var b=document.createElement("div");b.className=l(d.borderGraphicCSSClassPrefix+a);q.appendChild(b)};g("top-left");g("top-right");g("bottom-left");g("bottom-right");g("left");g("right");g("top");g("bottom");g=document.createElement("div");g.className=l(d.contentContainerCSSClass);q.appendChild(g);h.content=g;g=document.createElement("div");
g.className=l(d.closeGraphicCSSClass);q.appendChild(g);SimileAjax.WindowManager.registerEventWithObject(g,"click",h,"close");(function(){var g=SimileAjax.Graphics.getWindowDimensions(),h=g.w,m=g.h,g=Math.ceil(d.arrowGraphicWidth/2),p=function(a){var b=document.createElement("div");b.className=l(d.arrowGraphicCSSClassPrefix+"point-"+a);q.appendChild(b);return b};if(0<a-g-d.borderGraphicSize-d.extraPadding&&a+g+d.borderGraphicSize+d.extraPadding<h){var n=a-Math.round(c/2),n=a<h/2?Math.max(n,d.extraPadding+
d.borderGraphicSize):Math.min(n,h-d.extraPadding-d.borderGraphicSize-c);if(f&&"top"==f||!f&&0<b-d.arrowGraphicTargetOffset-e-d.borderGraphicSize-d.extraPadding){m=p("down");m.style.left=a-g-n+"px";k.style.left=n+"px";k.style.top=b-d.arrowGraphicTargetOffset-e+"px";return}if(f&&"bottom"==f||!f&&b+d.arrowGraphicTargetOffset+e+d.borderGraphicSize+d.extraPadding<m){m=p("up");m.style.left=a-g-n+"px";k.style.left=n+"px";k.style.top=b+d.arrowGraphicTargetOffset+"px";return}}h=b-Math.round(e/2);h=b<m/2?Math.max(h,
d.extraPadding+d.borderGraphicSize):Math.min(h,m-d.extraPadding-d.borderGraphicSize-e);f&&"left"==f||!f&&0<a-d.arrowGraphicTargetOffset-c-d.borderGraphicSize-d.extraPadding?(m=p("right"),m.style.top=b-g-h+"px",k.style.top=h+"px",k.style.left=a-d.arrowGraphicTargetOffset-c+"px"):(m=p("left"),m.style.top=b-g-h+"px",k.style.top=h+"px",k.style.left=a+d.arrowGraphicTargetOffset+"px")})();document.body.appendChild(k);return h};
SimileAjax.Graphics.getWindowDimensions=function(){if("number"==typeof window.innerHeight)return{w:window.innerWidth,h:window.innerHeight};if(document.documentElement&&document.documentElement.clientHeight)return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight};if(document.body&&document.body.clientHeight)return{w:document.body.clientWidth,h:document.body.clientHeight}};
SimileAjax.Graphics.createMessageBubble=function(a){var b=a.createElement("div");if(SimileAjax.Graphics.pngIsTranslucent){var c=a.createElement("div");c.style.height="33px";c.style.background="url("+SimileAjax.urlPrefix+"images/message-top-left.png) top left no-repeat";c.style.paddingLeft="44px";b.appendChild(c);var e=a.createElement("div");e.style.height="33px";e.style.background="url("+SimileAjax.urlPrefix+"images/message-top-right.png) top right no-repeat";c.appendChild(e);c=a.createElement("div");
c.style.background="url("+SimileAjax.urlPrefix+"images/message-left.png) top left repeat-y";c.style.paddingLeft="44px";b.appendChild(c);e=a.createElement("div");e.style.background="url("+SimileAjax.urlPrefix+"images/message-right.png) top right repeat-y";e.style.paddingRight="44px";c.appendChild(e);c=a.createElement("div");e.appendChild(c);e=a.createElement("div");e.style.height="55px";e.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat";e.style.paddingLeft=
"44px";b.appendChild(e);a=a.createElement("div");a.style.height="55px";a.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat";e.appendChild(a)}else b.style.border="2px solid #7777AA",b.style.padding="20px",b.style.background="white",SimileAjax.Graphics.setOpacity(b,90),c=a.createElement("div"),b.appendChild(c);return{containerDiv:b,contentDiv:c}};
SimileAjax.Graphics.createAnimation=function(a,b,c,e,f){return new SimileAjax.Graphics._Animation(a,b,c,e,f)};SimileAjax.Graphics._Animation=function(a,b,c,e,f){this.f=a;this.cont="function"==typeof f?f:function(){};this.from=b;this.to=c;this.current=b;this.duration=e;this.start=(new Date).getTime();this.timePassed=0};SimileAjax.Graphics._Animation.prototype.run=function(){var a=this;window.setTimeout(function(){a.step()},50)};
SimileAjax.Graphics._Animation.prototype.step=function(){this.timePassed+=50;var a=(-Math.cos(this.timePassed/this.duration*Math.PI)/2+0.5)*(this.to-this.from)+this.from;try{this.f(a,a-this.current)}catch(b){}this.current=a;this.timePassed<this.duration?this.run():(this.f(this.to,0),this.cont())};
SimileAjax.Graphics.createStructuredDataCopyButton=function(a,b,c,e){var f=document.createElement("div");f.style.position="relative";f.style.display="inline";f.style.width=b+"px";f.style.height=c+"px";f.style.overflow="hidden";f.style.margin="2px";SimileAjax.Graphics.pngIsTranslucent?f.style.background="url("+a+") no-repeat":f.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+a+"', sizingMethod\x3d'image')";f.innerHTML="\x3ctextarea rows\x3d'1' autocomplete\x3d'off' value\x3d'none' style\x3d'"+
(SimileAjax.Platform.browser.isIE?"filter:alpha(opacity\x3d0)":"opacity: 0")+"' /\x3e";var d=f.firstChild;d.style.width=b+"px";d.style.height=c+"px";d.onmousedown=function(a){a=a?a:event?event:null;2==a.button&&(d.value=e(),d.select())};return f};SimileAjax.Graphics.getWidthHeight=function(a){var b;null==a.getBoundingClientRect?(b=a.offsetWidth,a=a.offsetHeight):(a=a.getBoundingClientRect(),b=Math.ceil(a.right-a.left),a=Math.ceil(a.bottom-a.top));return{width:b,height:a}};
SimileAjax.Graphics.getFontRenderingContext=function(a,b){return new SimileAjax.Graphics._FontRenderingContext(a,b)};SimileAjax.Graphics._FontRenderingContext=function(a,b){this._elmt=a;this._elmt.style.visibility="hidden";"string"==typeof b?this._elmt.style.width=b:"number"==typeof b&&(this._elmt.style.width=b+"px")};SimileAjax.Graphics._FontRenderingContext.prototype.dispose=function(){this._elmt=null};
SimileAjax.Graphics._FontRenderingContext.prototype.update=function(){this._elmt.innerHTML="A";this._lineHeight=this._elmt.offsetHeight};SimileAjax.Graphics._FontRenderingContext.prototype.computeSize=function(a,b){var c=this._elmt;c.innerHTML=a;c.className=void 0===b?"":b;var e=SimileAjax.Graphics.getWidthHeight(c);c.className="";return e};SimileAjax.Graphics._FontRenderingContext.prototype.getLineHeight=function(){return this._lineHeight};
SimileAjax.DateTime={};SimileAjax.DateTime.MILLISECOND=0;SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.YEAR=7;SimileAjax.DateTime.DECADE=8;SimileAjax.DateTime.CENTURY=9;SimileAjax.DateTime.MILLENNIUM=10;SimileAjax.DateTime.EPOCH=-1;SimileAjax.DateTime.ERA=-2;SimileAjax.DateTime.gregorianUnitLengths=[];
(function(){var a=SimileAjax.DateTime,b=a.gregorianUnitLengths;b[a.MILLISECOND]=1;b[a.SECOND]=1E3;b[a.MINUTE]=60*b[a.SECOND];b[a.HOUR]=60*b[a.MINUTE];b[a.DAY]=24*b[a.HOUR];b[a.WEEK]=7*b[a.DAY];b[a.MONTH]=31*b[a.DAY];b[a.YEAR]=365*b[a.DAY];b[a.DECADE]=10*b[a.YEAR];b[a.CENTURY]=100*b[a.YEAR];b[a.MILLENNIUM]=1E3*b[a.YEAR]})();SimileAjax.DateTime._dateRegexp=/^(-?)([0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/;SimileAjax.DateTime._timezoneRegexp=/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/;
SimileAjax.DateTime._timeRegexp=/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/;
SimileAjax.DateTime.setIso8601Date=function(a,b){var c=b.match(SimileAjax.DateTime._dateRegexp);if(!c)throw Error("Invalid date string: "+b);var d=c[5],f=c[7],e=c[9],g=c[11],h=c[13]?c[13]:1;a.setUTCFullYear(("-"==c[1]?-1:1)*c[2]);e?(a.setUTCMonth(0),a.setUTCDate(Number(e))):g?(a.setUTCMonth(0),a.setUTCDate(1),c=(c=a.getUTCDay())?c:7,g=Number(h)+7*Number(g),4>=c?a.setUTCDate(g+1-c):a.setUTCDate(g+8-c)):(d&&(a.setUTCDate(1),a.setUTCMonth(d-1)),f&&a.setUTCDate(f));return a};
SimileAjax.DateTime.setIso8601Time=function(a,b){var c=b.match(SimileAjax.DateTime._timeRegexp);if(!c)return SimileAjax.Debug.warn("Invalid time string: "+b),!1;var d=Number(c[3]?c[3]:0),f=c[5]?c[5]:0,e=c[7]?1E3*Number("0."+c[7]):0;a.setUTCHours(c[1]);a.setUTCMinutes(d);a.setUTCSeconds(f);a.setUTCMilliseconds(e);return a};SimileAjax.DateTime.timezoneOffset=(new Date).getTimezoneOffset();
SimileAjax.DateTime.setIso8601=function(a,b){var c=null,d=-1==b.indexOf("T")?b.split(" "):b.split("T");SimileAjax.DateTime.setIso8601Date(a,d[0]);if(2==d.length){var f=d[1].match(SimileAjax.DateTime._timezoneRegexp);f&&("Z"==f[0]?c=0:(c=60*Number(f[3])+Number(f[5]),c*="-"==f[2]?1:-1),d[1]=d[1].substr(0,d[1].length-f[0].length));SimileAjax.DateTime.setIso8601Time(a,d[1])}null==c&&(c=a.getTimezoneOffset());a.setTime(a.getTime()+6E4*c);return a};
SimileAjax.DateTime.parseIso8601DateTime=function(a){try{return SimileAjax.DateTime.setIso8601(new Date(0),a)}catch(b){return null}};SimileAjax.DateTime.parseGregorianDateTime=function(a){if(null==a)return null;if(a instanceof Date)return a;var b=a.toString();if(0<b.length&&8>b.length){var c=b.indexOf(" ");0<c?(a=parseInt(b.substr(0,c)),"bc"==b.substr(c+1).toLowerCase()&&(a=1-a)):a=parseInt(b);b=new Date(0);b.setUTCFullYear(a);return b}try{return new Date(Date.parse(b))}catch(d){return null}};
SimileAjax.DateTime.roundDownToInterval=function(a,b,c,d,f){c*=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var e=new Date(a.getTime()+c),g=function(a){a.setUTCMilliseconds(0);a.setUTCSeconds(0);a.setUTCMinutes(0);a.setUTCHours(0)},h=function(a){g(a);a.setUTCDate(1);a.setUTCMonth(0)};switch(b){case SimileAjax.DateTime.MILLISECOND:b=e.getUTCMilliseconds();e.setUTCMilliseconds(b-b%d);break;case SimileAjax.DateTime.SECOND:e.setUTCMilliseconds(0);b=e.getUTCSeconds();e.setUTCSeconds(b-
b%d);break;case SimileAjax.DateTime.MINUTE:e.setUTCMilliseconds(0);e.setUTCSeconds(0);b=e.getUTCMinutes();e.setTime(e.getTime()-b%d*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:e.setUTCMilliseconds(0);e.setUTCSeconds(0);e.setUTCMinutes(0);b=e.getUTCHours();e.setUTCHours(b-b%d);break;case SimileAjax.DateTime.DAY:g(e);break;case SimileAjax.DateTime.WEEK:g(e);d=(e.getUTCDay()+7-f)%7;e.setTime(e.getTime()-d*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);
break;case SimileAjax.DateTime.MONTH:g(e);e.setUTCDate(1);b=e.getUTCMonth();e.setUTCMonth(b-b%d);break;case SimileAjax.DateTime.YEAR:h(e);b=e.getUTCFullYear();e.setUTCFullYear(b-b%d);break;case SimileAjax.DateTime.DECADE:h(e);e.setUTCFullYear(10*Math.floor(e.getUTCFullYear()/10));break;case SimileAjax.DateTime.CENTURY:h(e);e.setUTCFullYear(100*Math.floor(e.getUTCFullYear()/100));break;case SimileAjax.DateTime.MILLENNIUM:h(e),e.setUTCFullYear(1E3*Math.floor(e.getUTCFullYear()/1E3))}a.setTime(e.getTime()-
c)};SimileAjax.DateTime.roundUpToInterval=function(a,b,c,d,f){var e=a.getTime();SimileAjax.DateTime.roundDownToInterval(a,b,c,d,f);a.getTime()<e&&a.setTime(a.getTime()+SimileAjax.DateTime.gregorianUnitLengths[b]*d)};
SimileAjax.DateTime.incrementByInterval=function(a,b,c){c=("undefined"==typeof c?0:c)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var d=new Date(a.getTime()+c);switch(b){case SimileAjax.DateTime.MILLISECOND:d.setTime(d.getTime()+1);break;case SimileAjax.DateTime.SECOND:d.setTime(d.getTime()+1E3);break;case SimileAjax.DateTime.MINUTE:d.setTime(d.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:d.setTime(d.getTime()+
SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:d.setUTCDate(d.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:d.setUTCDate(d.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:d.setUTCMonth(d.getUTCMonth()+1);break;case SimileAjax.DateTime.YEAR:d.setUTCFullYear(d.getUTCFullYear()+1);break;case SimileAjax.DateTime.DECADE:d.setUTCFullYear(d.getUTCFullYear()+10);break;case SimileAjax.DateTime.CENTURY:d.setUTCFullYear(d.getUTCFullYear()+100);
break;case SimileAjax.DateTime.MILLENNIUM:d.setUTCFullYear(d.getUTCFullYear()+1E3)}a.setTime(d.getTime()-c)};SimileAjax.DateTime.removeTimeZoneOffset=function(a,b){return new Date(a.getTime()+b*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR])};SimileAjax.DateTime.getTimezone=function(){return(new Date).getTimezoneOffset()/-60};
String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.startsWith=function(a){return this.length>=a.length&&this.substr(0,a.length)==a};String.prototype.endsWith=function(a){return this.length>=a.length&&this.substr(this.length-a.length)==a};
String.substitute=function(a,f){for(var d="",b=0;b<a.length-1;){var c=a.indexOf("%",b);if(0>c||c==a.length-1)break;else if(c>b&&"\\"==a.charAt(c-1))d+=a.substring(b,c-1)+"%",b=c+1;else var e=parseInt(a.charAt(c+1)),d=isNaN(e)||e>=f.length?d+a.substring(b,c+2):d+(a.substring(b,c)+f[e].toString()),b=c+2}b<a.length&&(d+=a.substring(b));return d};
SimileAjax.HTML={};SimileAjax.HTML._e2uHash={};
(function(){var a=SimileAjax.HTML._e2uHash;a.nbsp=" [space]";a.iexcl="¡";a.cent="¢";a.pound="£";a.curren="¤";a.yen="¥";a.brvbar="¦";a.sect="§";a.uml="¨";a.copy="©";a.ordf="ª";a.laquo="«";a.not="¬";a.shy="­";a.reg="®";a.macr="¯";a.deg="°";a.plusmn="±";a.sup2="²";a.sup3="³";a.acute="´";a.micro="µ";a.para="¶";a.middot="·";a.cedil="¸";a.sup1="¹";a.ordm="º";a.raquo="»";a.frac14="¼";a.frac12="½";a.frac34="¾";a.iquest="¿";a.Agrave="À";a.Aacute="Á";a.Acirc="Â";a.Atilde="Ã";a.Auml="Ä";a.Aring="Å";a.AElig=
"Æ";a.Ccedil="Ç";a.Egrave="È";a.Eacute="É";a.Ecirc="Ê";a.Euml="Ë";a.Igrave="Ì";a.Iacute="Í";a.Icirc="Î";a.Iuml="Ï";a.ETH="Ð";a.Ntilde="Ñ";a.Ograve="Ò";a.Oacute="Ó";a.Ocirc="Ô";a.Otilde="Õ";a.Ouml="Ö";a.times="×";a.Oslash="Ø";a.Ugrave="Ù";a.Uacute="Ú";a.Ucirc="Û";a.Uuml="Ü";a.Yacute="Ý";a.THORN="Þ";a.szlig="ß";a.agrave="à";a.aacute="á";a.acirc="â";a.atilde="ã";a.auml="ä";a.aring="å";a.aelig="æ";a.ccedil="ç";a.egrave="è";a.eacute="é";a.ecirc="ê";a.euml="ë";a.igrave="ì";a.iacute="í";a.icirc="î";a.iuml=
"ï";a.eth="ð";a.ntilde="ñ";a.ograve="ò";a.oacute="ó";a.ocirc="ô";a.otilde="õ";a.ouml="ö";a.divide="÷";a.oslash="ø";a.ugrave="ù";a.uacute="ú";a.ucirc="û";a.uuml="ü";a.yacute="ý";a.thorn="þ";a.yuml="ÿ";a.quot='"';a.amp="\x26";a.lt="\x3c";a.gt="\x3e";a.OElig="";a.oelig="œ";a.Scaron="Š";a.scaron="š";a.Yuml="Ÿ";a.circ="ˆ";a.tilde="˜";a.ensp=" ";a.emsp=" ";a.thinsp=" ";a.zwnj="‌";a.zwj="‍";a.lrm="‎";a.rlm="‏";a.ndash="–";a.mdash="—";a.lsquo="‘";a.rsquo="’";a.sbquo="‚";a.ldquo="“";a.rdquo="”";a.bdquo="„";
a.dagger="†";a.Dagger="‡";a.permil="‰";a.lsaquo="‹";a.rsaquo="›";a.euro="€";a.fnof="ƒ";a.Alpha="Α";a.Beta="Β";a.Gamma="Γ";a.Delta="Δ";a.Epsilon="Ε";a.Zeta="Ζ";a.Eta="Η";a.Theta="Θ";a.Iota="Ι";a.Kappa="Κ";a.Lambda="Λ";a.Mu="Μ";a.Nu="Ν";a.Xi="Ξ";a.Omicron="Ο";a.Pi="Π";a.Rho="Ρ";a.Sigma="Σ";a.Tau="Τ";a.Upsilon="Υ";a.Phi="Φ";a.Chi="Χ";a.Psi="Ψ";a.Omega="Ω";a.alpha="α";a.beta="β";a.gamma="γ";a.delta="δ";a.epsilon="ε";a.zeta="ζ";a.eta="η";a.theta="θ";a.iota="ι";a.kappa="κ";a.lambda="λ";a.mu="μ";a.nu="ν";
a.xi="ξ";a.omicron="ο";a.pi="π";a.rho="ρ";a.sigmaf="ς";a.sigma="σ";a.tau="τ";a.upsilon="υ";a.phi="φ";a.chi="χ";a.psi="ψ";a.omega="ω";a.thetasym="ϑ";a.upsih="ϒ";a.piv="ϖ";a.bull="•";a.hellip="…";a.prime="′";a.Prime="″";a.oline="‾";a.frasl="⁄";a.weierp="℘";a.image="ℑ";a.real="ℜ";a.trade="™";a.alefsym="ℵ";a.larr="←";a.uarr="↑";a.rarr="→";a.darr="↓";a.harr="↔";a.crarr="↵";a.lArr="⇐";a.uArr="⇑";a.rArr="⇒";a.dArr="⇓";a.hArr="⇔";a.forall="∀";a.part="∂";a.exist="∃";a.empty="∅";a.nabla="∇";a.isin="∈";a.notin=
"∉";a.ni="∋";a.prod="∏";a.sum="∑";a.minus="−";a.lowast="∗";a.radic="√";a.prop="∝";a.infin="∞";a.ang="∠";a.and="∧";a.or="∨";a.cap="∩";a.cup="∪";a["int"]="∫";a.there4="∴";a.sim="∼";a.cong="≅";a.asymp="≈";a.ne="≠";a.equiv="≡";a.le="≤";a.ge="≥";a.sub="⊂";a.sup="⊃";a.nsub="⊄";a.sube="⊆";a.supe="⊇";a.oplus="⊕";a.otimes="⊗";a.perp="⊥";a.sdot="⋅";a.lceil="⌈";a.rceil="⌉";a.lfloor="⌊";a.rfloor="⌋";a.lang="〈";a.rang="〉";a.loz="◊";a.spades="♠";a.clubs="♣";a.hearts="♥";a.diams="♦"})();
SimileAjax.HTML.deEntify=function(a){for(var c=SimileAjax.HTML._e2uHash,b=/&(\w+?);/;b.test(a);){var d=a.match(b);a=a.replace(b,c[d[1]])}return a};
SimileAjax.Set=function(a){this._hash={};this._count=0;if(a instanceof Array)for(var b=0;b<a.length;b++)this.add(a[b]);else a instanceof SimileAjax.Set&&this.addSet(a)};SimileAjax.Set.prototype.add=function(a){return!(a in this._hash)?(this._hash[a]=!0,this._count++,!0):!1};SimileAjax.Set.prototype.addSet=function(a){for(var b in a._hash)this.add(b)};SimileAjax.Set.prototype.remove=function(a){return a in this._hash?(delete this._hash[a],this._count--,!0):!1};SimileAjax.Set.prototype.removeSet=function(a){for(var b in a._hash)this.remove(b)};
SimileAjax.Set.prototype.retainSet=function(a){for(var b in this._hash)a.contains(b)||(delete this._hash[b],this._count--)};SimileAjax.Set.prototype.contains=function(a){return a in this._hash};SimileAjax.Set.prototype.size=function(){return this._count};SimileAjax.Set.prototype.toArray=function(){var a=[],b;for(b in this._hash)a.push(b);return a};SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash)if(!0==a(b))break};
SimileAjax.SortedArray=function(a,b){this._a=b instanceof Array?b:[];this._compare=a};SimileAjax.SortedArray.prototype.add=function(a){var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length?this._a.splice(c,0,a):this._a.push(a)};SimileAjax.SortedArray.prototype.remove=function(a){for(var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length&&0==this._compare(this._a[c],a);){if(this._a[c]==a)return this._a.splice(c,1),!0;c++}return!1};
SimileAjax.SortedArray.prototype.removeAll=function(){this._a=[]};SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]};SimileAjax.SortedArray.prototype.length=function(){return this._a.length};SimileAjax.SortedArray.prototype.find=function(a){for(var b=0,c=this._a.length;b<c;){var d=Math.floor((b+c)/2),e=a(this._a[d]);if(d==b)return 0>e?b+1:b;0>e?b=d:c=d}return b};SimileAjax.SortedArray.prototype.getFirst=function(){return 0<this._a.length?this._a[0]:null};
SimileAjax.SortedArray.prototype.getLast=function(){return 0<this._a.length?this._a[this._a.length-1]:null};SimileAjax.EventIndex=function(a){var b=this;this._unit=null!=a?a:SimileAjax.NativeDateUnit;this._events=new SimileAjax.SortedArray(function(a,d){return b._unit.compare(a.getStart(),d.getStart())});this._idToEvent={};this._indexed=!0};SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit};SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]};
SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a);this._idToEvent[a.getID()]=a;this._indexed=!1};SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll();this._idToEvent={};this._indexed=!1};SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()};SimileAjax.EventIndex.prototype.getIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)};
SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)};SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return null==a?null:a.getStart()};
SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(null==a)return null;this._indexed||this._index();for(var b=a._earliestOverlapIndex,a=this._events.elementAt(b).getEnd(),b=b+1;b<this._events.length();b++)a=this._unit.later(a,this._events.elementAt(b).getEnd());return a};
SimileAjax.EventIndex.prototype._index=function(){for(var a=this._events.length(),b=0;b<a;b++){var c=this._events.elementAt(b);c._earliestOverlapIndex=b}for(var d=1,b=0;b<a;b++){c=this._events.elementAt(b);c=c.getEnd();for(d=Math.max(d,b+1);d<a;){var e=this._events.elementAt(d),f=e.getStart();if(0>this._unit.compare(f,c))e._earliestOverlapIndex=b,d++;else break}}this._indexed=!0};
SimileAjax.EventIndex._Iterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._currentIndex=a.find(function(a){return d.compare(a.getStart(),b)});0<=this._currentIndex-1&&(this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex);this._currentIndex--;this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}return null},_findNext:function(){for(var a=this._unit;++this._currentIndex<this._maxIndex;){var b=this._events.elementAt(this._currentIndex);if(0>a.compare(b.getStart(),this._endDate)&&0<a.compare(b.getEnd(),this._startDate)){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._ReverseIterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._minIndex=a.find(function(a){return d.compare(a.getStart(),b)});0<=this._minIndex-1&&(this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex);this._currentIndex=this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}return null},_findNext:function(){for(var a=this._unit;--this._currentIndex>=this._minIndex;){var b=this._events.elementAt(this._currentIndex);if(0>a.compare(b.getStart(),this._endDate)&&0<a.compare(b.getEnd(),this._startDate)){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._AllIterator=function(a){this._events=a;this._index=0};SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}};
SimileAjax.NativeDateUnit={};SimileAjax.NativeDateUnit.makeDefaultValue=function(){return new Date};SimileAjax.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};SimileAjax.NativeDateUnit.getParser=function(a){"string"==typeof a&&(a=a.toLowerCase());var b="iso8601"==a||"iso 8601"==a?SimileAjax.DateTime.parseIso8601DateTime:SimileAjax.DateTime.parseGregorianDateTime;return function(a){return"undefined"!=typeof a&&"function"==typeof a.toUTCString?a:b(a)}};
SimileAjax.NativeDateUnit.parseFromObject=function(a){return SimileAjax.DateTime.parseGregorianDateTime(a)};SimileAjax.NativeDateUnit.toNumber=function(a){return a.getTime()};SimileAjax.NativeDateUnit.fromNumber=function(a){return new Date(a)};SimileAjax.NativeDateUnit.compare=function(a,b){var c,d;c="object"==typeof a?a.getTime():Number(a);d="object"==typeof b?b.getTime():Number(b);return c-d};SimileAjax.NativeDateUnit.earlier=function(a,b){return 0>SimileAjax.NativeDateUnit.compare(a,b)?a:b};
SimileAjax.NativeDateUnit.later=function(a,b){return 0<SimileAjax.NativeDateUnit.compare(a,b)?a:b};SimileAjax.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};
SimileAjax.ListenerQueue=function(a){this._listeners=[];this._wildcardHandlerName=a};SimileAjax.ListenerQueue.prototype.add=function(a){this._listeners.push(a)};SimileAjax.ListenerQueue.prototype.remove=function(a){for(var d=this._listeners,b=0;b<d.length;b++)if(d[b]==a){d.splice(b,1);break}};
SimileAjax.ListenerQueue.prototype.fire=function(a,d){for(var b=[].concat(this._listeners),e=0;e<b.length;e++){var c=b[e];if(a in c)try{c[a].apply(c,d)}catch(f){SimileAjax.Debug.exception("Error firing event of name "+a,f)}else if(null!=this._wildcardHandlerName&&this._wildcardHandlerName in c)try{c[this._wildcardHandlerName].apply(c,[a])}catch(g){SimileAjax.Debug.exception("Error firing event of name "+a+" to wildcard handler",g)}}};
SimileAjax.History={maxHistoryLength:10,historyFile:"__history__.html",enabled:!1,_initialized:!1,_listeners:new SimileAjax.ListenerQueue,_actions:[],_baseIndex:0,_currentIndex:0,_plainDocumentTitle:document.title};SimileAjax.History.formatHistoryEntryTitle=function(a){return SimileAjax.History._plainDocumentTitle+" {"+a+"}"};
SimileAjax.History.initialize=function(){if(!SimileAjax.History._initialized){if(SimileAjax.History.enabled){var a=document.createElement("iframe");a.id="simile-ajax-history";a.style.position="absolute";a.style.width="10px";a.style.height="10px";a.style.top="0px";a.style.left="0px";a.style.visibility="hidden";a.src=SimileAjax.History.historyFile+"?0";document.body.appendChild(a);SimileAjax.DOM.registerEvent(a,"load",SimileAjax.History._handleIFrameOnLoad);SimileAjax.History._iframe=a}SimileAjax.History._initialized=
!0}};SimileAjax.History.addListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.add(a)};SimileAjax.History.removeListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.remove(a)};
SimileAjax.History.addAction=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.fire("onBeforePerform",[a]);window.setTimeout(function(){try{if(a.perform(),SimileAjax.History._listeners.fire("onAfterPerform",[a]),SimileAjax.History.enabled){SimileAjax.History._actions=SimileAjax.History._actions.slice(0,SimileAjax.History._currentIndex-SimileAjax.History._baseIndex);SimileAjax.History._actions.push(a);SimileAjax.History._currentIndex++;var b=SimileAjax.History._actions.length-
SimileAjax.History.maxHistoryLength;0<b&&(SimileAjax.History._actions=SimileAjax.History._actions.slice(b),SimileAjax.History._baseIndex+=b);try{SimileAjax.History._iframe.contentWindow.location.search="?"+SimileAjax.History._currentIndex}catch(d){var c=SimileAjax.History.formatHistoryEntryTitle(a.label);document.title=c}}}catch(e){SimileAjax.Debug.exception(e,"Error adding action {"+a.label+"} to history")}},0)};
SimileAjax.History.addLengthyAction=function(a,b,d){SimileAjax.History.addAction({perform:a,undo:b,label:d,uiLayer:SimileAjax.WindowManager.getBaseLayer(),lengthy:!0})};
SimileAjax.History._handleIFrameOnLoad=function(){try{var a=SimileAjax.History._iframe.contentWindow.location.search,b=0==a.length?0:Math.max(0,parseInt(a.substr(1))),d=function(){var a=b-SimileAjax.History._currentIndex;SimileAjax.History._currentIndex+=a;SimileAjax.History._baseIndex+=a;SimileAjax.History._iframe.contentWindow.location.search="?"+b};if(b<SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeUndoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex>
b&&SimileAjax.History._currentIndex>SimileAjax.History._baseIndex;){SimileAjax.History._currentIndex--;var a=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{a.undo()}catch(c){SimileAjax.Debug.exception(c,"History: Failed to undo action {"+a.label+"}")}}SimileAjax.History._listeners.fire("onAfterUndoSeveral",[]);d()},0);else if(b>SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeRedoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex<
b&&SimileAjax.History._currentIndex-SimileAjax.History._baseIndex<SimileAjax.History._actions.length;){var a=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{a.perform()}catch(c){SimileAjax.Debug.exception(c,"History: Failed to redo action {"+a.label+"}")}SimileAjax.History._currentIndex++}SimileAjax.History._listeners.fire("onAfterRedoSeveral",[]);d()},0);else{var c=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1,e=0<=c&&c<SimileAjax.History._actions.length?
SimileAjax.History.formatHistoryEntryTitle(SimileAjax.History._actions[c].label):SimileAjax.History._plainDocumentTitle;SimileAjax.History._iframe.contentWindow.document.title=e;document.title=e}}catch(f){}};SimileAjax.History.getNextUndoAction=function(){try{return SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1]}catch(a){return null}};
SimileAjax.History.getNextRedoAction=function(){try{return SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex]}catch(a){return null}};
SimileAjax.WindowManager={_initialized:!1,_listeners:[],_draggedElement:null,_draggedElementCallback:null,_dropTargetHighlightElement:null,_lastCoords:null,_ghostCoords:null,_draggingMode:"",_dragging:!1,_layers:[]};
SimileAjax.WindowManager.initialize=function(){SimileAjax.WindowManager._initialized||(SimileAjax.DOM.registerEvent(document.body,"mousedown",SimileAjax.WindowManager._onBodyMouseDown),SimileAjax.DOM.registerEvent(document.body,"mousemove",SimileAjax.WindowManager._onBodyMouseMove),SimileAjax.DOM.registerEvent(document.body,"mouseup",SimileAjax.WindowManager._onBodyMouseUp),SimileAjax.DOM.registerEvent(document,"keydown",SimileAjax.WindowManager._onBodyKeyDown),SimileAjax.DOM.registerEvent(document,
"keyup",SimileAjax.WindowManager._onBodyKeyUp),SimileAjax.WindowManager._layers.push({index:0}),SimileAjax.WindowManager._historyListener={onBeforeUndoSeveral:function(){},onAfterUndoSeveral:function(){},onBeforeUndo:function(){},onAfterUndo:function(){},onBeforeRedoSeveral:function(){},onAfterRedoSeveral:function(){},onBeforeRedo:function(){},onAfterRedo:function(){}},SimileAjax.History.addListener(SimileAjax.WindowManager._historyListener),SimileAjax.WindowManager._initialized=!0)};
SimileAjax.WindowManager.getBaseLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[0]};SimileAjax.WindowManager.getHighestLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[SimileAjax.WindowManager._layers.length-1]};SimileAjax.WindowManager.registerEventWithObject=function(a,b,c,d,g){SimileAjax.WindowManager.registerEvent(a,b,function(a,b,g){return c[d].call(c,a,b,g)},g)};
SimileAjax.WindowManager.registerEvent=function(a,b,c,d){null==d&&(d=SimileAjax.WindowManager.getHighestLayer());SimileAjax.DOM.registerEvent(a,b,function(a,b,k){if(SimileAjax.WindowManager._canProcessEventAtLayer(d)){SimileAjax.WindowManager._popToLayer(d.index);try{c(a,b,k)}catch(l){SimileAjax.Debug.exception(l)}}SimileAjax.DOM.cancelEvent(b);return!1})};
SimileAjax.WindowManager.pushLayer=function(a,b,c){a={onPop:a,index:SimileAjax.WindowManager._layers.length,ephemeral:b,elmt:c};SimileAjax.WindowManager._layers.push(a);return a};SimileAjax.WindowManager.popLayer=function(a){for(var b=1;b<SimileAjax.WindowManager._layers.length;b++)if(SimileAjax.WindowManager._layers[b]==a){SimileAjax.WindowManager._popToLayer(b-1);break}};SimileAjax.WindowManager.popAllLayers=function(){SimileAjax.WindowManager._popToLayer(0)};
SimileAjax.WindowManager.registerForDragging=function(a,b,c){SimileAjax.WindowManager.registerEvent(a,"mousedown",function(a,c,h){SimileAjax.WindowManager._handleMouseDown(a,c,b)},c)};SimileAjax.WindowManager._popToLayer=function(a){for(;a+1<SimileAjax.WindowManager._layers.length;)try{var b=SimileAjax.WindowManager._layers.pop();if(null!=b.onPop)b.onPop()}catch(c){}};
SimileAjax.WindowManager._canProcessEventAtLayer=function(a){if(a.index==SimileAjax.WindowManager._layers.length-1)return!0;for(a=a.index+1;a<SimileAjax.WindowManager._layers.length;a++)if(!SimileAjax.WindowManager._layers[a].ephemeral)return!1;return!0};
SimileAjax.WindowManager.cancelPopups=function(a){a=a?SimileAjax.DOM.getEventPageCoordinates(a):{x:-1,y:-1};for(var b=SimileAjax.WindowManager._layers.length-1;0<b&&SimileAjax.WindowManager._layers[b].ephemeral;){var c=SimileAjax.WindowManager._layers[b];if(null!=c.elmt){var c=c.elmt,d=SimileAjax.DOM.getPageCoordinates(c);if(a.x>=d.left&&a.x<d.left+c.offsetWidth&&a.y>=d.top&&a.y<d.top+c.offsetHeight)break}b--}SimileAjax.WindowManager._popToLayer(b)};
SimileAjax.WindowManager._onBodyMouseDown=function(a,b,c){(!("eventPhase"in b)||b.eventPhase==b.BUBBLING_PHASE)&&SimileAjax.WindowManager.cancelPopups(b)};SimileAjax.WindowManager._handleMouseDown=function(a,b,c){SimileAjax.WindowManager._draggedElement=a;SimileAjax.WindowManager._draggedElementCallback=c;SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};SimileAjax.DOM.cancelEvent(b);return!1};
SimileAjax.WindowManager._onBodyKeyDown=function(a,b,c){if(SimileAjax.WindowManager._dragging)if(27==b.keyCode)SimileAjax.WindowManager._cancelDragging();else if((17==b.keyCode||16==b.keyCode)&&"copy"!=SimileAjax.WindowManager._draggingMode)SimileAjax.WindowManager._draggingMode="copy",a=SimileAjax.Graphics.createTranslucentImage(SimileAjax.urlPrefix+"images/copy.png"),a.style.position="absolute",a.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px",a.style.top=SimileAjax.WindowManager._ghostCoords.top+
"px",document.body.appendChild(a),SimileAjax.WindowManager._draggingModeIndicatorElmt=a};SimileAjax.WindowManager._onBodyKeyUp=function(a,b,c){if(SimileAjax.WindowManager._dragging&&(17==b.keyCode||16==b.keyCode))SimileAjax.WindowManager._draggingMode="",null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),SimileAjax.WindowManager._draggingModeIndicatorElmt=null)};
SimileAjax.WindowManager._onBodyMouseMove=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){a=SimileAjax.WindowManager._draggedElementCallback;var d=SimileAjax.WindowManager._lastCoords,g=b.clientX-d.x,d=b.clientY-d.y;if(SimileAjax.WindowManager._dragging)try{SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};if("onDragBy"in a)a.onDragBy(g,d);if("_ghostElmt"in a){e=a._ghostElmt;SimileAjax.WindowManager._ghostCoords.left+=g;SimileAjax.WindowManager._ghostCoords.top+=d;
e.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";e.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";if(null!=SimileAjax.WindowManager._draggingModeIndicatorElmt){var h=SimileAjax.WindowManager._draggingModeIndicatorElmt;h.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px";h.style.top=SimileAjax.WindowManager._ghostCoords.top+"px"}if("droppable"in a&&a.droppable){var k=SimileAjax.DOM.getEventPageCoordinates(b);c=SimileAjax.DOM.hittest(k.x,k.y,[SimileAjax.WindowManager._ghostElmt,
SimileAjax.WindowManager._dropTargetHighlightElement]);c=SimileAjax.WindowManager._findDropTarget(c);if(c!=SimileAjax.WindowManager._potentialDropTarget){null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null,SimileAjax.WindowManager._potentialDropTarget=null);h=!1;if(null!=c&&(!("canDropOn"in a)||a.canDropOn(c))&&(!("canDrop"in c)||c.canDrop(SimileAjax.WindowManager._draggedElement)))h=
!0;if(h){var l=SimileAjax.DOM.getPageCoordinates(c),f=document.createElement("div");f.style.border="4px solid yellow";f.style.backgroundColor="yellow";f.style.position="absolute";f.style.left=l.left+"px";f.style.top=l.top+"px";f.style.width=c.offsetWidth-8+"px";f.style.height=c.offsetHeight-8+"px";SimileAjax.Graphics.setOpacity(f,30);document.body.appendChild(f);SimileAjax.WindowManager._potentialDropTarget=c;SimileAjax.WindowManager._dropTargetHighlightElement=f}}}}}catch(n){SimileAjax.Debug.exception("WindowManager: Error handling mouse move",
n),SimileAjax.WindowManager._cancelDragging()}else if(5<Math.abs(g)||5<Math.abs(d))try{if("onDragStart"in a)a.onDragStart();if("ghost"in a&&a.ghost){var m=SimileAjax.WindowManager._draggedElement;SimileAjax.WindowManager._ghostCoords=SimileAjax.DOM.getPageCoordinates(m);SimileAjax.WindowManager._ghostCoords.left+=g;SimileAjax.WindowManager._ghostCoords.top+=d;var e=m.cloneNode(!0);e.style.position="absolute";e.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";e.style.top=SimileAjax.WindowManager._ghostCoords.top+
"px";e.style.zIndex=1E3;SimileAjax.Graphics.setOpacity(e,50);document.body.appendChild(e);a._ghostElmt=e}SimileAjax.WindowManager._dragging=!0;SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};document.body.focus()}catch(p){SimileAjax.Debug.exception("WindowManager: Error handling mouse down",p),SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(b);return!1}};
SimileAjax.WindowManager._onBodyMouseUp=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){try{if(SimileAjax.WindowManager._dragging){var d=SimileAjax.WindowManager._draggedElementCallback;if("onDragEnd"in d)d.onDragEnd();if("droppable"in d&&d.droppable&&(c=SimileAjax.WindowManager._potentialDropTarget,null!=c&&(!("canDropOn"in d)||d.canDropOn(c))&&(!("canDrop"in c)||c.canDrop(SimileAjax.WindowManager._draggedElement)))){if("onDropOn"in d)d.onDropOn(c);c.ondrop(SimileAjax.WindowManager._draggedElement,
SimileAjax.WindowManager._draggingMode)}}}finally{SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(b);return!1}};
SimileAjax.WindowManager._cancelDragging=function(){var a=SimileAjax.WindowManager._draggedElementCallback;"_ghostElmt"in a&&(document.body.removeChild(a._ghostElmt),delete a._ghostElmt);null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null);null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),
SimileAjax.WindowManager._draggingModeIndicatorElmt=null);SimileAjax.WindowManager._draggedElement=null;SimileAjax.WindowManager._draggedElementCallback=null;SimileAjax.WindowManager._potentialDropTarget=null;SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._lastCoords=null;SimileAjax.WindowManager._ghostCoords=null;SimileAjax.WindowManager._draggingMode="";SimileAjax.WindowManager._dragging=!1};
SimileAjax.WindowManager._findDropTarget=function(a){for(;null!=a&&!("ondrop"in a&&"function"==typeof a.ondrop);)a=a.parentNode;return a};
Timeline.version="2.3.0";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};
Timeline.create=function(a,d,c,b){null==Timeline.timelines&&(Timeline.timelines=[]);var f=Timeline.timelines.length;Timeline.timelines[f]=null;a=new Timeline._Impl(a,d,c,b,f);return Timeline.timelines[f]=a};
Timeline.createBandInfo=function(a){var d="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,b=new Timeline.LinearEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,theme:d}),f=new Timeline.GregorianEtherPainter({unit:a.intervalUnit,multiple:"multiple"in a?a.multiple:1,theme:d,align:"align"in a?a.align:void 0}),e={showText:"showEventText"in a?a.showEventText:!0,theme:d};
if("eventPainterParams"in a)for(var g in a.eventPainterParams)e[g]=a.eventPainterParams[g];"trackHeight"in a&&(e.trackHeight=a.trackHeight);"trackGap"in a&&(e.trackGap=a.trackGap);g="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)e=new a.eventPainter(e);else switch(g){case "overview":e=new Timeline.OverviewEventPainter(e);break;case "detailed":e=new Timeline.DetailedEventPainter(e);break;default:e=new Timeline.OriginalEventPainter(e)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:b,etherPainter:f,eventPainter:e,theme:d,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};
Timeline.createHotZoneBandInfo=function(a){var d="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,b=new Timeline.HotZoneEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,zones:a.zones,theme:d}),f=new Timeline.HotZoneGregorianEtherPainter({unit:a.intervalUnit,zones:a.zones,theme:d,align:"align"in a?a.align:void 0}),e={showText:"showEventText"in a?a.showEventText:!0,theme:d};
if("eventPainterParams"in a)for(var g in a.eventPainterParams)e[g]=a.eventPainterParams[g];"trackHeight"in a&&(e.trackHeight=a.trackHeight);"trackGap"in a&&(e.trackGap=a.trackGap);g="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)e=new a.eventPainter(e);else switch(g){case "overview":e=new Timeline.OverviewEventPainter(e);break;case "detailed":e=new Timeline.DetailedEventPainter(e);break;default:e=new Timeline.OriginalEventPainter(e)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:b,etherPainter:f,eventPainter:e,theme:d,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};Timeline.getDefaultTheme=function(){null==Timeline._defaultTheme&&(Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale()));return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};
Timeline.loadXML=function(a,d){SimileAjax.XmlHttp.get(a,function(c,b,d){alert("Failed to load data xml from "+a+"\n"+c)},function(c){var b=c.responseXML;!b.documentElement&&c.responseStream&&b.load(c.responseStream);d(b,a)})};Timeline.loadJSON=function(a,d){SimileAjax.XmlHttp.get(a,function(c,b,d){alert("Failed to load json data from "+a+"\n"+c)},function(c){d(eval("("+c.responseText+")"),a)})};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};
Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};
Timeline._Impl=function(a,d,c,b,f){SimileAjax.WindowManager.initialize();this._containerDiv=a;this._bandInfos=d;this._orientation=null==c?Timeline.HORIZONTAL:c;this._unit=null!=b?b:SimileAjax.NativeDateUnit;this._starting=!0;this._autoResizing=!1;this.autoWidth=d&&d[0]&&d[0].theme&&d[0].theme.autoWidth;this.autoWidthAnimationTime=d&&d[0]&&d[0].theme&&d[0].theme.autoWidthAnimationTime;this.timelineID=f;this.timeline_start=d&&d[0]&&d[0].theme&&d[0].theme.timeline_start;this.timeline_stop=d&&d[0]&&d[0].theme&&
d[0].theme.timeline_stop;this.timeline_at_stop=this.timeline_at_start=!1;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].dispose();this._bandInfos=this._bands=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};
Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0);this._starting=!1};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].paint()};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};
Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};
Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};
Timeline._Impl.prototype.loadXML=function(a,d){var c=this,b=function(e,b,d){alert("Failed to load data xml from "+a+"\n"+e);c.hideLoadingMessage()},f=function(b){try{var f=b.responseXML;!f.documentElement&&b.responseStream&&f.load(b.responseStream);d(f,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,b,f)},0)};
Timeline._Impl.prototype.loadJSON=function(a,d){var c=this,b=function(b,d,f){alert("Failed to load json data from "+a+"\n"+b);c.hideLoadingMessage()},f=function(b){try{d(eval("("+b.responseText+")"),a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,b,f)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(!1)};
Timeline._Impl.prototype._autoWidthCheck=function(a){function d(){var a=b.getWidthStyle();if(f)b._containerDiv.style[a]=e+"px";else{b._autoResizing=!0;var c={};c[a]=e+"px";SimileAjax.jQuery(b._containerDiv).animate(c,b.autoWidthAnimationTime,"linear",function(){b._autoResizing=!1})}}function c(){var c=0,f=b.getPixelWidth();if(!b._autoResizing){for(var h=0;h<b._bands.length;h++)b._bands[h].checkAutoWidth(),c+=b._bandInfos[h].width;if(c>f||a)e=c,d(),b._distributeWidths()}}var b=this,f=b._starting,e=
0;b.autoWidth&&c()};
Timeline._Impl.prototype._initialize=function(){var a=this._containerDiv,d=a.ownerDocument;a.className=a.className.split(" ").concat("timeline-container").join(" ");var c=this.isHorizontal()?"horizontal":"vertical";for(a.className+=" timeline-"+c;a.firstChild;)a.removeChild(a.firstChild);c=SimileAjax.Graphics.createTranslucentImage(this.isHorizontal()?"static/img/simile_tl_copyright-vertical.png":"static/img/simile_tl_copyright.png");c.className="timeline-copyright";c.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";SimileAjax.DOM.registerEvent(c,
"click",function(){window.location="http://code.google.com/p/simile-widgets/"});a.appendChild(c);this._bands=[];for(c=0;c<this._bandInfos.length;c++){var b=new Timeline._Band(this,this._bandInfos[c],c);this._bands.push(b)}this._distributeWidths();for(c=0;c<this._bandInfos.length;c++)b=this._bandInfos[c],"syncWith"in b&&this._bands[c].setSyncWithBand(this._bands[b.syncWith],"highlight"in b?b.highlight:!1);if(this.autoWidth)for(c=0;c<this._bands.length;c++)this._bands[c].addOnScrollListener(this._autoWidthScrollListener);
var f=SimileAjax.Graphics.createMessageBubble(d);f.containerDiv.className="timeline-message-container";a.appendChild(f.containerDiv);f.contentDiv.className="timeline-message";f.contentDiv.innerHTML=" Loading...";this.showLoadingMessage=function(){f.containerDiv.style.display="block"};this.hideLoadingMessage=function(){f.containerDiv.style.display="none"}};
Timeline._Impl.prototype._distributeWidths=function(){for(var a=this.getPixelLength(),d=this.getPixelWidth(),c=0,b=0;b<this._bands.length;b++){var f=this._bands[b],e=this._bandInfos[b].width;if("string"==typeof e){var g=e.indexOf("%");0<g?(e=parseInt(e.substr(0,g)),e=Math.round(e*d/100)):e=parseInt(e)}f.setBandShiftAndWidth(c,e);f.setViewLength(a);c+=e}};
Timeline._Impl.prototype.shiftOK=function(a,d){var c=0<d,b=0>d;if(c&&null==this.timeline_start||b&&null==this.timeline_stop||0==d)return!0;for(var f=!1,e=0;e<this._bands.length&&!f;e++)f=this._bands[e].busy();if(f)return!0;if(c&&this.timeline_at_start||b&&this.timeline_at_stop)return!1;b=!1;for(e=0;e<this._bands.length&&!b;e++)b=this._bands[e],b=c?(e==a?b.getMinVisibleDateAfterDelta(d):b.getMinVisibleDate())>=this.timeline_start:(e==a?b.getMaxVisibleDateAfterDelta(d):b.getMaxVisibleDate())<=this.timeline_stop;
c?(this.timeline_at_start=!b,this.timeline_at_stop=!1):(this.timeline_at_stop=!b,this.timeline_at_start=!1);return b};Timeline._Impl.prototype.zoom=function(a,d,c,b){var f=null,e=/^timeline-band-([0-9]+)$/.exec(b.id);e&&(f=parseInt(e[1]));null!=f&&this._bands[f].zoom(a,d,c,b);this.paint()};
Timeline.ClassicTheme={};Timeline.ClassicTheme.implementations=[];Timeline.ClassicTheme.create=function(a){null==a&&(a=Timeline.getDefaultLocale());a=Timeline.ClassicTheme.implementations[a];null==a&&(a=Timeline.ClassicTheme._Impl);return new a};
Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=!1;this.autoWidthAnimationTime=500;this.timeline_stop=this.timeline_start=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",
iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},
timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};
Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};
Timeline.LinearEther.prototype.initialize=function(a,c){this._band=a;this._timeline=c;this._unit=c.getUnit();"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/
2))};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(a){this._start=this._unit.change(this._start,this._interval*a/this._pixelsPerInterval)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){a=this._unit.compare(a,this._start);return this._pixelsPerInterval*a/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(a){return this._unit.change(this._start,a*this._interval/this._pixelsPerInterval)};
Timeline.LinearEther.prototype.zoom=function(a){var c=0,e=c=this._band._zoomIndex;a&&0<c&&(e=c-1);!a&&c<this._band._zoomSteps.length-1&&(e=c+1);this._band._zoomIndex=e;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[e].unit];this._pixelsPerInterval=this._band._zoomSteps[e].pixelsPerInterval;return c=this._band._zoomSteps[e].unit-this._band._zoomSteps[c].unit};
Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};
Timeline.HotZoneEther.prototype.initialize=function(a,c){this._band=a;this._timeline=c;this._unit=c.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];for(var e=this._params,d=0;d<e.zones.length;d++)for(var f=e.zones[d],b=this._unit.parseFromObject(f.start),h=this._unit.parseFromObject(f.end),g=0;g<this._zones.length&&0<this._unit.compare(h,b);g++){var k=this._zones[g];0>this._unit.compare(b,k.endTime)&&(0<this._unit.compare(b,k.startTime)&&(this._zones.splice(g,
0,{startTime:k.startTime,endTime:b,magnify:k.magnify}),g++,k.startTime=b),0>this._unit.compare(h,k.endTime)?(this._zones.splice(g,0,{startTime:b,endTime:h,magnify:f.magnify*k.magnify}),g++,b=k.startTime=h):(k.magnify*=f.magnify,b=k.endTime))}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?
this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};
Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(a){var c=0,e=c=this._band._zoomIndex;a&&0<c&&(e=c-1);!a&&c<this._band._zoomSteps.length-1&&(e=c+1);this._band._zoomIndex=e;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[e].unit];this._pixelsPerInterval=this._band._zoomSteps[e].pixelsPerInterval;return c=this._band._zoomSteps[e].unit-this._band._zoomSteps[c].unit};
Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(a,c){var e=this._getScale(),d=a,f=0;if(0>this._unit.compare(d,c)){for(var b=0;b<this._zones.length&&!(0>this._unit.compare(d,this._zones[b].endTime));)b++;for(;0>this._unit.compare(d,c);){var h=this._zones[b],g=this._unit.earlier(c,h.endTime),f=f+this._unit.compare(g,d)/(e/h.magnify),d=g;b++}}else{for(b=this._zones.length-1;0<=b&&!(0<this._unit.compare(d,this._zones[b].startTime));)b--;for(;0<this._unit.compare(d,c);)h=this._zones[b],
g=this._unit.later(c,h.startTime),f+=this._unit.compare(g,d)/(e/h.magnify),d=g,b--}return f};
Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(a,c){var e=this._getScale(),d=c;if(0<a){for(var f=0;f<this._zones.length&&!(0>this._unit.compare(d,this._zones[f].endTime));)f++;for(;0<a;){var b=this._zones[f],h=e/b.magnify;if(b.endTime==Number.POSITIVE_INFINITY)d=this._unit.change(d,a*h),a=0;else{var g=this._unit.compare(b.endTime,d)/h;g>a?(d=this._unit.change(d,a*h),a=0):(d=b.endTime,a-=g)}f++}}else{for(f=this._zones.length-1;0<=f&&!(0<this._unit.compare(d,this._zones[f].startTime));)f--;
for(a=-a;0<a;)b=this._zones[f],h=e/b.magnify,b.startTime==Number.NEGATIVE_INFINITY?(d=this._unit.change(d,-a*h),a=0):(g=this._unit.compare(d,b.startTime)/h,g>a?(d=this._unit.change(d,-a*h),a=0):(d=b.startTime,a-=g)),f--}return d};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};
Timeline.EventUtils={};Timeline.EventUtils.getNewEventID=function(){null==this._lastEventID&&(this._lastEventID=0);this._lastEventID+=1;return"e"+this._lastEventID};Timeline.EventUtils.decodeEventElID=function(b){var a=b.split("-");if("tl"!=a[1])return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};b=Timeline.getTimelineFromID(a[2]).getBand(a[3]);a=b.getEventSource.getEvent(a[4]);return{band:b,evt:a}};
Timeline.EventUtils.encodeEventElID=function(b,a,c,d){return c+"-tl-"+b.timelineID+"-"+a.getIndex()+"-"+d.getID()};
Timeline._Band=function(b,a,c){b.autoWidth&&"string"==typeof a.width&&(a.width=-1<a.width.indexOf("%")?0:parseInt(a.width));this._timeline=b;this._bandInfo=a;this._index=c;this._locale="locale"in a?a.locale:Timeline.getDefaultLocale();this._timeZone="timeZone"in a?a.timeZone:0;this._labeller="labeller"in a?a.labeller:"createLabeller"in b.getUnit()?b.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone);this._theme=a.theme;this._zoomIndex=
"zoomIndex"in a?a.zoomIndex:0;this._zoomSteps="zoomSteps"in a?a.zoomSteps:null;this._changing=this._dragging=!1;this._scrollSpeed=this._originalScrollSpeed=5;this._onScrollListeners=[];var d=this;this._syncWithBand=null;this._syncWithBandHandler=function(a){d._onHighlightBandScroll()};this._selectorListener=function(a){d._onHighlightBandScroll()};var e=this._timeline.getDocument().createElement("div");e.className="timeline-band-input";this._timeline.addDiv(e);this._keyboardInput=document.createElement("input");
this._keyboardInput.type="text";e.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className="timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(this._div,
"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut");SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");c=null!=this._theme?this._theme.mouseWheel:"scroll";if("zoom"===c||"scroll"===c||this._zoomSteps)SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,
"mousewheel",this,"_onMouseScroll");this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=a.ether;a.ether.initialize(this,b);this._etherPainter=a.etherPainter;a.etherPainter.initialize(this,b);if(this._eventSource=a.eventSource)this._eventListener={onAddMany:function(){d._onAddMany()},onClear:function(){d._onClear()}},this._eventSource.addListener(this._eventListener);this._eventPainter=a.eventPainter;
this._eventTrackIncrement=this._eventTracksNeeded=0;a.eventPainter.initialize(this,b);this._decorators="decorators"in a?a.decorators:[];for(a=0;a<this._decorators.length;a++)this._decorators[a].initialize(this,b)};Timeline._Band.SCROLL_MULTIPLES=5;
Timeline._Band.prototype.dispose=function(){this.closeBubble();this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventSource=this._eventListener=null);this._keyboardInput=this._innerDiv=this._div=this._selectorListener=this._syncWithBandHandler=this._onScrollListeners=this._decorators=this._eventPainter=this._etherPainter=this._ether=this._labeller=this._bandInfo=this._timeline=null};Timeline._Band.prototype.addOnScrollListener=function(b){this._onScrollListeners.push(b)};
Timeline._Band.prototype.removeOnScrollListener=function(b){for(var a=0;a<this._onScrollListeners.length;a++)if(this._onScrollListeners[a]==b){this._onScrollListeners.splice(a,1);break}};Timeline._Band.prototype.setSyncWithBand=function(b,a){this._syncWithBand&&this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler);this._syncWithBand=b;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._highlight=a;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};
Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};
Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(b,a){this._eventTrackIncrement=a;b>this._eventTracksNeeded&&(this._eventTracksNeeded=b)};
Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var b="overview"==this._eventPainter.getType(),a=Math.ceil((this._eventTracksNeeded+(b?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin))*this._eventTrackIncrement),a=a+(b?this._theme.event.overviewTrack.offset:this._theme.event.track.offset),b=this._bandInfo;a!=b.width&&(b.width=a)}};Timeline._Band.prototype.layout=function(){this.paint()};
Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};
Timeline._Band.prototype.setBandShiftAndWidth=function(b,a){var c=this._keyboardInput.parentNode,d=b+Math.floor(a/2);this._timeline.isHorizontal()?(this._div.style.top=b+"px",this._div.style.height=a+"px",c.style.top=d+"px",c.style.left="-1em"):(this._div.style.left=b+"px",this._div.style.width=a+"px",c.style.left=d+"px",c.style.top="-1em")};Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth};
Timeline._Band.prototype.setViewLength=function(b){this._viewLength=b;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};
Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(b){return this._ether.pixelOffsetToDate(b)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};
Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(b){return this._ether.pixelOffsetToDate(this._viewLength+b)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(b){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(b)))};Timeline._Band.prototype.setMaxVisibleDate=function(b){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(b)))};
Timeline._Band.prototype.setCenterVisibleDate=function(b){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(b)))};Timeline._Band.prototype.dateToPixelOffset=function(b){return this._ether.dateToPixelOffset(b)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(b){return this._ether.pixelOffsetToDate(b+this._viewOffset)};
Timeline._Band.prototype.createLayerDiv=function(b,a){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+("string"==typeof a?" "+a:"");c.style.zIndex=b;this._innerDiv.appendChild(c);var d=this._timeline.getDocument().createElement("div");d.className="timeline-band-layer-inner";d.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab";c.appendChild(d);return d};Timeline._Band.prototype.removeLayerDiv=function(b){this._innerDiv.removeChild(b.parentNode)};
Timeline._Band.prototype.scrollToCenter=function(b,a){var c=this._ether.dateToPixelOffset(b);c<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(c+this._viewLength)):c>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(c-this._viewLength));this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(b)),a)};
Timeline._Band.prototype.showBubbleForEvent=function(b){var a=this.getEventSource().getEvent(b);if(a){var c=this;this.scrollToCenter(a.getStart(),function(){c._eventPainter.showBubble(a)})}};Timeline._Band.prototype.zoom=function(b,a,c,d){this._zoomSteps&&(a+=this._viewOffset,c=this._ether.pixelOffsetToDate(a),b=this._ether.zoom(b),this._etherPainter.zoom(b),this._moveEther(Math.round(-this._ether.dateToPixelOffset(c))),this._moveEther(a))};
Timeline._Band.prototype._onMouseDown=function(b,a,c){this.closeBubble();this._dragging=!0;this._dragX=a.clientX;this._dragY=a.clientY};Timeline._Band.prototype._onMouseMove=function(b,a,c){this._dragging&&(b=a.clientX-this._dragX,c=a.clientY-this._dragY,this._dragX=a.clientX,this._dragY=a.clientY,this._moveEther(this._timeline.isHorizontal()?b:c),this._positionHighlight())};Timeline._Band.prototype._onMouseUp=function(b,a,c){this._dragging=!1;this._keyboardInput.focus()};
Timeline._Band.prototype._onMouseOut=function(b,a,c){a=SimileAjax.DOM.getEventRelativeCoordinates(a,b);a.x+=this._viewOffset;if(0>a.x||a.x>b.offsetWidth||0>a.y||a.y>b.offsetHeight)this._dragging=!1};
Timeline._Band.prototype._onMouseScroll=function(b,a,c){c=new Date;c=c.getTime();if(!this._lastScrollTime||50<c-this._lastScrollTime){this._lastScrollTime=c;c=0;a.wheelDelta?c=a.wheelDelta/120:a.detail&&(c=-a.detail/3);var d=this._theme.mouseWheel;if(this._zoomSteps||"zoom"===d){if(d=SimileAjax.DOM.getEventRelativeCoordinates(a,b),0!=c){var e;0<c&&(e=!0);0>c&&(e=!1);this._timeline.zoom(e,d.x,d.y,b)}}else"scroll"===d&&this._moveEther(50*(0>c?-1:1))}a.stopPropagation&&a.stopPropagation();a.cancelBubble=
!0;a.preventDefault&&a.preventDefault();a.returnValue=!1};Timeline._Band.prototype._onDblClick=function(b,a,c){b=SimileAjax.DOM.getEventRelativeCoordinates(a,b).x-(this._viewLength/2-this._viewOffset);this._autoScroll(-b)};
Timeline._Band.prototype._onKeyDown=function(b,a,c){if(!this._dragging){switch(a.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return!1}return!0};
Timeline._Band.prototype._onKeyUp=function(b,a,c){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(a.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return!1}return!0};
Timeline._Band.prototype._autoScroll=function(b,a){var c=this;SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,b,1E3,a).run()};
Timeline._Band.prototype._moveEther=function(b){this.closeBubble();this._timeline.shiftOK(this._index,b)&&(this._viewOffset+=b,this._ether.shiftPixels(-b),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._viewOffset>0.5*-this._viewLength||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging())};
Timeline._Band.prototype._onChanging=function(){this._changing=!0;this._fireOnScroll();this._setSyncWithBandDate();this._changing=!1};Timeline._Band.prototype.busy=function(){return this._changing};Timeline._Band.prototype._fireOnScroll=function(){for(var b=0;b<this._onScrollListeners.length;b++)this._onScrollListeners[b](this)};Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var b=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(b)}};
Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var b=this._syncWithBand.getCenterVisibleDate(),b=this._ether.dateToPixelOffset(b);this._moveEther(Math.round(this._viewLength/2-b));this._highlight&&this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};
Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var b=this._syncWithBand.getMinVisibleDate(),a=this._syncWithBand.getMaxVisibleDate();this._highlight&&this._etherPainter.setHighlight(b,a)}};
Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px");this.layout()};Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()};
Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var b=0;b<this._decorators.length;b++)this._decorators[b].paint()};Timeline._Band.prototype._softPaintDecorators=function(){for(var b=0;b<this._decorators.length;b++)this._decorators[b].softPaint()};Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};
Timeline.DefaultEventSource=function(a){this._events=a instanceof Object?a:new SimileAjax.EventIndex;this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};Timeline.DefaultEventSource.prototype.removeListener=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]==a){this._listeners.splice(b,1);break}};
Timeline.DefaultEventSource.prototype.loadXML=function(a,b){for(var f=this._getBaseURL(b),e=a.documentElement.getAttribute("wiki-url"),g=a.documentElement.getAttribute("wiki-section"),k=a.documentElement.getAttribute("date-time-format"),k=this._events.getUnit().getParser(k),d=a.documentElement.firstChild,c=!1;null!=d;){if(1==d.nodeType){c="";null!=d.firstChild&&3==d.firstChild.nodeType&&(c=d.firstChild.nodeValue);var h=null===d.getAttribute("isDuration")&&null===d.getAttribute("durationEvent")||"false"==
d.getAttribute("isDuration")||"false"==d.getAttribute("durationEvent"),c=new Timeline.DefaultEventSource.Event({id:d.getAttribute("id"),start:k(d.getAttribute("start")),end:k(d.getAttribute("end")),latestStart:k(d.getAttribute("latestStart")),earliestEnd:k(d.getAttribute("earliestEnd")),instant:h,text:d.getAttribute("title"),description:c,image:this._resolveRelativeURL(d.getAttribute("image"),f),link:this._resolveRelativeURL(d.getAttribute("link"),f),icon:this._resolveRelativeURL(d.getAttribute("icon"),
f),color:d.getAttribute("color"),textColor:d.getAttribute("textColor"),hoverText:d.getAttribute("hoverText"),classname:d.getAttribute("classname"),tapeImage:d.getAttribute("tapeImage"),tapeRepeat:d.getAttribute("tapeRepeat"),caption:d.getAttribute("caption"),eventID:d.getAttribute("eventID"),trackNum:d.getAttribute("trackNum")});c._node=d;c.getProperty=function(a){return this._node.getAttribute(a)};c.setWikiInfo(e,g);this._events.add(c);c=!0}d=d.nextSibling}c&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadJSON=function(a,b){var f=this._getBaseURL(b),e=!1;if(a&&a.events){var g="wikiURL"in a?a.wikiURL:null,k="wikiSection"in a?a.wikiSection:null,d="dateTimeFormat"in a?a.dateTimeFormat:null,d=this._events.getUnit().getParser(d),c=0;for(;c<a.events.length;c++){var e=a.events[c],h=e.isDuration||null!=e.durationEvent&&!e.durationEvent,h=new Timeline.DefaultEventSource.Event({id:"id"in e?e.id:void 0,start:d(e.start),end:d(e.end),latestStart:d(e.latestStart),earliestEnd:d(e.earliestEnd),
instant:h,text:e.title,description:e.description,image:this._resolveRelativeURL(e.image,f),link:this._resolveRelativeURL(e.link,f),icon:this._resolveRelativeURL(e.icon,f),color:e.color,textColor:e.textColor,hoverText:e.hoverText,classname:e.classname,tapeImage:e.tapeImage,tapeRepeat:e.tapeRepeat,caption:e.caption,eventID:e.eventID,trackNum:e.trackNum});h._obj=e;h.getProperty=function(a){return this._obj[a]};h.setWikiInfo(g,k);this._events.add(h);e=!0}}e&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadSPARQL=function(a,b){var f=this._getBaseURL(b),e=this._events.getUnit().getParser("iso8601");if(null!=a){for(var g=a.documentElement.firstChild;null!=g&&(1!=g.nodeType||"results"!=g.nodeName);)g=g.nextSibling;var k=null,d=null;null!=g&&(k=g.getAttribute("wiki-url"),d=g.getAttribute("wiki-section"),g=g.firstChild);for(var c=!1;null!=g;){if(1==g.nodeType){for(var c={},h=g.firstChild;null!=h;)1==h.nodeType&&(null!=h.firstChild&&1==h.firstChild.nodeType&&null!=
h.firstChild.firstChild&&3==h.firstChild.firstChild.nodeType)&&(c[h.getAttribute("name")]=h.firstChild.firstChild.nodeValue),h=h.nextSibling;null==c.start&&null!=c.date&&(c.start=c.date);h=null===c.isDuration&&null===c.durationEvent||"false"==c.isDuration||"false"==c.durationEvent;h=new Timeline.DefaultEventSource.Event({id:c.id,start:e(c.start),end:e(c.end),latestStart:e(c.latestStart),earliestEnd:e(c.earliestEnd),instant:h,text:c.title,description:c.description,image:this._resolveRelativeURL(c.image,
f),link:this._resolveRelativeURL(c.link,f),icon:this._resolveRelativeURL(c.icon,f),color:c.color,textColor:c.textColor,hoverText:c.hoverText,caption:c.caption,classname:c.classname,tapeImage:c.tapeImage,tapeRepeat:c.tapeRepeat,eventID:c.eventID,trackNum:c.trackNum});h._bindings=c;h.getProperty=function(a){return this._bindings[a]};h.setWikiInfo(k,d);this._events.add(h);c=!0}g=g.nextSibling}c&&this._fire("onAddMany",[])}};
Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};Timeline.DefaultEventSource.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._events.add(a[b]);this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};
Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};
Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};Timeline.DefaultEventSource.prototype._fire=function(a,b){for(var f=0;f<this._listeners.length;f++){var e=this._listeners[f];if(a in e)try{e[a].apply(e,b)}catch(g){SimileAjax.Debug.exception(g)}}};
Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(0>a.indexOf("://")){var b=this._getBaseURL(document.location.href);a="/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a}b=a.lastIndexOf("/");return 0>b?"":a.substr(0,b+1)};Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){return null==a||""==a?a:0<a.indexOf("://")?a:"/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a};
Timeline.DefaultEventSource.Event=function(a){function b(b){return null!=a[b]&&""!=a[b]?a[b]:null}var f=a.id?a.id.trim():"";this._id=0<f.length?f:Timeline.EventUtils.getNewEventID();this._instant=a.instant||null==a.end;this._start=a.start;this._end=null!=a.end?a.end:a.start;this._latestStart=null!=a.latestStart?a.latestStart:a.instant?this._end:this._start;this._earliestEnd=null!=a.earliestEnd?a.earliestEnd:this._end;f=[];this._start>this._latestStart&&(this._latestStart=this._start,f.push("start is \x3e latestStart"));
this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,f.push("start is \x3e earliestEnd"));this._start>this._end&&(this._end=this._earliestEnd,f.push("start is \x3e end"));this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,f.push("latestStart is \x3e earliestEnd"));this._latestStart>this._end&&(this._end=this._earliestEnd,f.push("latestStart is \x3e end"));this._earliestEnd>this._end&&(this._end=this._earliestEnd,f.push("earliestEnd is \x3e end"));this._eventID=
b("eventID");this._text=null!=a.text?SimileAjax.HTML.deEntify(a.text):"";0<f.length&&(this._text+=" PROBLEM: "+f.join(", "));this._description=SimileAjax.HTML.deEntify(a.description);this._image=b("image");this._link=b("link");this._title=b("hoverText");this._title=b("caption");this._icon=b("icon");this._color=b("color");this._textColor=b("textColor");this._classname=b("classname");this._tapeImage=b("tapeImage");this._tapeRepeat=b("tapeRepeat");this._trackNum=b("trackNum");null!=this._trackNum&&(this._trackNum=
parseInt(this._trackNum));this._wikiSection=this._wikiURL=null};
Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},
getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(a){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},
setWikiInfo:function(a,b){this._wikiURL=a;this._wikiSection=b},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(a){a.style.display="none";if(!(null==this._wikiURL||null==this._wikiSection)){var b=this.getProperty("wikiID");if(null==b||0==b.length)b=this.getText();if(!(null==b||0==b.length)){a.style.display="inline";var b=b.replace(/\s/g,"_"),b=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+b,f=document.createElement("a");f.href=b;f.target="new";f.innerHTML=
Timeline.strings[Timeline.clientLocale].wikiLinkLabel;a.appendChild(document.createTextNode("["));a.appendChild(f);a.appendChild(document.createTextNode("]"))}}},fillTime:function(a,b){this._instant?this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))):a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))):this.isImprecise()?
(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))):(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end))))},fillInfoBubble:function(a,
b,f){var e=a.ownerDocument,g=this.getText(),k=this.getLink(),d=this.getImage();if(null!=d){var c=e.createElement("img");c.src=d;b.event.bubble.imageStyler(c);a.appendChild(c)}d=e.createElement("div");g=e.createTextNode(g);null!=k?(c=e.createElement("a"),c.href=k,c.appendChild(g),d.appendChild(c)):d.appendChild(g);b.event.bubble.titleStyler(d);a.appendChild(d);k=e.createElement("div");this.fillDescription(k);b.event.bubble.bodyStyler(k);a.appendChild(k);k=e.createElement("div");this.fillTime(k,f);
b.event.bubble.timeStyler(k);a.appendChild(k);f=e.createElement("div");this.fillWikiInfo(f);b.event.bubble.wikiStyler(f);a.appendChild(f)}};
Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.OriginalEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};
Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(a){for(var b=0;b<this._eventPaintListeners.length;b++)if(this._eventPaintListeners[b]==a){this._eventPaintListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OriginalEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,b.tape.height+this._frc.getLineHeight()),b={trackOffset:b.track.offset,trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width,
maxLabelChar:b.label.maxLabelChar,impreciseIconMargin:b.instant.impreciseIconMargin},d=this._band.getMinDate(),e=this._band.getMaxDate(),c=null!=this._filterMatcher?this._filterMatcher:function(a){return!0},g=null!=this._highlightMatcher?this._highlightMatcher:function(a){return-1},a=a.getEventReverseIterator(d,e);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,g(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display=
"block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null)}};Timeline.OriginalEventPainter.prototype.softPaint=function(){};
Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OriginalEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),g=Math.round(this._band.dateToPixelOffset(g)),f=Math.round(g+b.iconWidth/2),g=Math.round(g-b.iconWidth/2),h=this._getLabelDivClassName(a),k=this._frc.computeSize(e,h),l=f+c.event.label.offsetFromLine,f=this._findFreeTrack(a,l+k.width),q=Math.round(b.trackOffset+f*b.trackIncrement+b.trackHeight/2-k.height/2),m=this._paintEventIcon(a,f,g,b,c,0),e=this._paintEventLabel(a,
e,l,q,k.width,k.height,c,h,d);b=[m.elmt,e.elmt];var n=this,h=function(b,c,d){return n._onClickInstantEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",h);c=this._createHighlightDiv(d,m,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=m.elmt;this._tracks[f]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),k=Math.round(this._band.dateToPixelOffset(f)),g=Math.round(h+b.iconWidth/2),f=Math.round(h-b.iconWidth/2),l=this._getLabelDivClassName(a),q=this._frc.computeSize(e,l),m=g+c.event.label.offsetFromLine,g=Math.max(m+q.width,k),g=this._findFreeTrack(a,g),n=c.event.tape.height,r=Math.round(b.trackOffset+
g*b.trackIncrement+n),p=this._paintEventIcon(a,g,f,b,c,n),e=this._paintEventLabel(a,e,m,r,q.width,q.height,c,l,d),l=a.getColor(),l=null!=l?l:c.event.instant.impreciseColor,h=this._paintEventTape(a,g,h,k,l,c.event.instant.impreciseOpacity,b,c,0);b=[p.elmt,e.elmt,h.elmt];var s=this,k=function(b,c,d){return s._onClickInstantEvent(p.elmt,c,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(h.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",k);c=this._createHighlightDiv(d,
p,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=p.elmt;this._tracks[g]=f};
Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getEnd(),g=Math.round(this._band.dateToPixelOffset(g)),h=Math.round(this._band.dateToPixelOffset(f)),k=this._getLabelDivClassName(a),l=this._frc.computeSize(e,k),f=Math.max(g+l.width,h),f=this._findFreeTrack(a,f),q=Math.round(b.trackOffset+f*b.trackIncrement+c.event.tape.height),m=a.getColor(),m=null!=m?m:c.event.duration.color,n=this._paintEventTape(a,
f,g,h,m,100,b,c,0),e=this._paintEventLabel(a,e,g,q,l.width,l.height,c,k,d);b=[n.elmt,e.elmt];var r=this,h=function(b,c,d){return r._onClickDurationEvent(n.elmt,c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",h);c=this._createHighlightDiv(d,n,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=n.elmt;this._tracks[f]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var e=a.getText(),g=a.getStart(),f=a.getLatestStart(),h=a.getEnd(),k=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(g)),f=Math.round(this._band.dateToPixelOffset(f)),h=Math.round(this._band.dateToPixelOffset(h)),l=Math.round(this._band.dateToPixelOffset(k)),q=this._getLabelDivClassName(a),m=this._frc.computeSize(e,q),k=Math.max(f+m.width,h),k=this._findFreeTrack(a,k),n=
Math.round(b.trackOffset+k*b.trackIncrement+c.event.tape.height),r=a.getColor(),r=null!=r?r:c.event.duration.color,h=this._paintEventTape(a,k,g,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c,0),p=this._paintEventTape(a,k,f,l,r,100,b,c,1);b=this._paintEventLabel(a,e,f,n,m.width,m.height,c,q,d);var e=[h.elmt,p.elmt,b.elmt],s=this,f=function(b,c,d){return s._onClickDurationEvent(p.elmt,c,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,
"mousedown",f);c=this._createHighlightDiv(d,p,c,a);null!=c&&e.push(c);this._fireEventPaintListeners("paintedEvent",a,e);this._eventIdToElmt[a.getID()]=p.elmt;this._tracks[k]=g};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(a,b){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,a,b)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(a,b){var c=a.getTrackNum();if(null!=c)return c;for(c=0;c<this._tracks.length&&!(this._tracks[c]>b);c++);return c};
Timeline.OriginalEventPainter.prototype._paintEventIcon=function(a,b,c,d,e,g){e=a.getIcon();e=null!=e?e:d.icon;b=0<g?d.trackOffset+b*d.trackIncrement+g+d.impreciseIconMargin:Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);g=SimileAjax.Graphics.createTranslucentImage(e);e=this._timeline.getDocument().createElement("div");e.className=this._getElClassName("timeline-event-icon",a,"icon");e.id=this._encodeEventElID("icon",a);e.style.left=c+"px";e.style.top=b+"px";e.appendChild(g);
null!=a._title&&(e.title=a._title);this._eventLayer.appendChild(e);return{left:c,top:b,width:d.iconWidth,height:d.iconHeight,elmt:e}};
Timeline.OriginalEventPainter.prototype._paintEventLabel=function(a,b,c,d,e,g,f,h,k){var l=this._timeline.getDocument().createElement("div");l.className=h;l.id=this._encodeEventElID("label",a);l.style.left=c+"px";l.style.width=e+"px";l.style.top=d+"px";l.innerHTML=b;null!=a._title&&(l.title=a._title);b=a.getTextColor();null==b&&(b=a.getColor());null!=b&&(l.style.color=b);f.event.highlightLabelBackground&&0<=k&&(l.style.background=this._getHighlightColor(k,f));this._eventLayer.appendChild(l);return{left:c,
top:d,width:e,height:g,elmt:l}};
Timeline.OriginalEventPainter.prototype._paintEventTape=function(a,b,c,d,e,g,f,h,k){d-=c;h=h.event.tape.height;b=f.trackOffset+b*f.trackIncrement;f=this._timeline.getDocument().createElement("div");f.className=this._getElClassName("timeline-event-tape",a,"tape");f.id=this._encodeEventElID("tape"+k,a);f.style.left=c+"px";f.style.width=d+"px";f.style.height=h+"px";f.style.top=b+"px";null!=a._title&&(f.title=a._title);null!=e&&(f.style.backgroundColor=e);e=a.getTapeImage();a=a.getTapeRepeat();a=null!=
a?a:"repeat";null!=e&&(f.style.backgroundImage="url("+e+")",f.style.backgroundRepeat=a);SimileAjax.Graphics.setOpacity(f,g);this._eventLayer.appendChild(f);return{left:c,top:b,width:d,height:h,elmt:f}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(a,b,c){b=b.getClassName();var d=[];b&&(c&&d.push(c+"-"+b+" "),d.push(b+" "));d.push(a);return d.join("")};
Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,b){var c=b.event.highlightColors;return c[Math.min(a,c.length-1)]};
Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,b,c,d){var e=null;0<=a&&(e=this._timeline.getDocument(),a=this._getHighlightColor(a,c),e=e.createElement("div"),e.className=this._getElClassName("timeline-event-highlight",d,"highlight"),e.id=this._encodeEventElID("highlight0",d),e.style.position="absolute",e.style.overflow="hidden",e.style.left=b.left-2+"px",e.style.width=b.width+4+"px",e.style.top=b.top-2+"px",e.style.height=b.height+4+"px",e.style.background=a,this._highlightLayer.appendChild(e));
return e};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.OriginalEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),e=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,e.width,null,e.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(a,b,c){for(var d=0;d<this._eventPaintListeners.length;d++)this._eventPaintListeners[d](this._band,a,b,c)};
Timeline.DetailedEventPainter=function(b){this._params=b;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.DetailedEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(b){this._onSelectListeners.push(b)};
Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++)if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(b){this._filterMatcher=b};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(b){this._highlightMatcher=b};
Timeline.DetailedEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(null!=b){this._eventIdToElmt={};this._prepareForPainting();for(var a=this._params.theme.event,c=Math.max(a.track.height,this._frc.getLineHeight()),a={trackOffset:Math.round(this._band.getViewWidth()/2-c/2),trackHeight:c,trackGap:a.track.gap,trackIncrement:c+a.track.gap,icon:a.instant.icon,iconWidth:a.instant.iconWidth,iconHeight:a.instant.iconHeight,labelWidth:a.label.width},d=this._band.getMinDate(),f=this._band.getMaxDate(),
c=null!=this._filterMatcher?this._filterMatcher:function(a){return!0},h=null!=this._highlightMatcher?this._highlightMatcher:function(a){return-1},b=b.getEventReverseIterator(d,f);b.hasNext();)d=b.next(),c(d)&&this.paintEvent(d,a,this._params.theme,h(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,a.trackIncrement)}};
Timeline.DetailedEventPainter.prototype.softPaint=function(){};
Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];null!=this._highlightLayer&&b.removeLayerDiv(this._highlightLayer);
this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&b.removeLayerDiv(this._lineLayer);this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&b.removeLayerDiv(this._eventLayer);this._eventLayer=b.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.DetailedEventPainter.prototype.paintEvent=function(b,a,c,d){b.isInstant()?this.paintInstantEvent(b,a,c,d):this.paintDurationEvent(b,a,c,d)};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(b,a,c,d){b.isImprecise()?this.paintImpreciseInstantEvent(b,a,c,d):this.paintPreciseInstantEvent(b,a,c,d)};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(b,a,c,d){b.isImprecise()?this.paintImpreciseDurationEvent(b,a,c,d):this.paintPreciseDurationEvent(b,a,c,d)};
Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(b,a,c,d){this._timeline.getDocument();var f=b.getText(),h=b.getStart(),e=Math.round(this._band.dateToPixelOffset(h)),g=Math.round(e+a.iconWidth/2),k=Math.round(e-a.iconWidth/2),h=this._frc.computeSize(f),l=this._findFreeTrackForSolid(g,e),n=this._paintEventIcon(b,l,k,a,c),g=g+c.event.label.offsetFromLine,m=l,p=this._getTrackData(l);Math.min(p.solid,p.text)>=g+h.width?(p.solid=k,p.text=g):(p.solid=k,g=e+c.event.label.offsetFromLine,
m=this._findFreeTrackForText(l,g+h.width,function(a){a.line=e-2}),this._getTrackData(m).text=k,this._paintEventLine(b,e,l,m,a,c));a=Math.round(a.trackOffset+m*a.trackIncrement+a.trackHeight/2-h.height/2);var f=this._paintEventLabel(b,f,g,a,h.width,h.height,c),q=this;a=function(a,c,d){return q._onClickInstantEvent(n.elmt,c,b)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",a);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",a);this._createHighlightDiv(d,n,c);this._eventIdToElmt[b.getID()]=n.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(b,a,c,d){this._timeline.getDocument();var f=b.getText(),h=b.getStart(),e=b.getEnd(),g=Math.round(this._band.dateToPixelOffset(h)),k=Math.round(this._band.dateToPixelOffset(e)),l=Math.round(g+a.iconWidth/2),n=Math.round(g-a.iconWidth/2),e=this._frc.computeSize(f),m=this._findFreeTrackForSolid(k,g),h=this._paintEventTape(b,m,g,k,c.event.instant.impreciseColor,c.event.instant.impreciseOpacity,a,c),p=this._paintEventIcon(b,m,
n,a,c);this._getTrackData(m).solid=n;var l=l+c.event.label.offsetFromLine,q=l+e.width;q<k?k=m:(l=g+c.event.label.offsetFromLine,q=l+e.width,k=this._findFreeTrackForText(m,q,function(a){a.line=g-2}),this._getTrackData(k).text=n,this._paintEventLine(b,g,m,k,a,c));a=Math.round(a.trackOffset+k*a.trackIncrement+a.trackHeight/2-e.height/2);var f=this._paintEventLabel(b,f,l,a,e.width,e.height,c),r=this;a=function(a,c,d){return r._onClickInstantEvent(p.elmt,c,b)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",
a);SimileAjax.DOM.registerEvent(h.elmt,"mousedown",a);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",a);this._createHighlightDiv(d,p,c);this._eventIdToElmt[b.getID()]=p.elmt};
Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(b,a,c,d){this._timeline.getDocument();var f=b.getText(),h=b.getStart(),e=b.getEnd(),g=Math.round(this._band.dateToPixelOffset(h)),k=Math.round(this._band.dateToPixelOffset(e)),h=this._frc.computeSize(f),e=this._findFreeTrackForSolid(k),l=b.getColor(),l=null!=l?l:c.event.duration.color,n=this._paintEventTape(b,e,g,k,l,100,a,c);this._getTrackData(e).solid=g;k=g+c.event.label.offsetFromLine;l=this._findFreeTrackForText(e,k+h.width,
function(a){a.line=g-2});this._getTrackData(l).text=g-2;this._paintEventLine(b,g,e,l,a,c);a=Math.round(a.trackOffset+l*a.trackIncrement+a.trackHeight/2-h.height/2);var f=this._paintEventLabel(b,f,k,a,h.width,h.height,c),m=this;a=function(a,c,d){return m._onClickDurationEvent(n.elmt,c,b)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",a);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",a);this._createHighlightDiv(d,n,c);this._eventIdToElmt[b.getID()]=n.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(b,a,c,d){this._timeline.getDocument();var f=b.getText(),h=b.getStart(),e=b.getLatestStart(),g=b.getEnd(),k=b.getEarliestEnd(),h=Math.round(this._band.dateToPixelOffset(h)),l=Math.round(this._band.dateToPixelOffset(e)),g=Math.round(this._band.dateToPixelOffset(g)),n=Math.round(this._band.dateToPixelOffset(k)),k=this._frc.computeSize(f),e=this._findFreeTrackForSolid(g),m=b.getColor(),m=null!=m?m:c.event.duration.color;this._paintEventTape(b,
e,h,g,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,a,c);var p=this._paintEventTape(b,e,l,n,m,100,a,c);this._getTrackData(e).solid=h;h=l+c.event.label.offsetFromLine;g=this._findFreeTrackForText(e,h+k.width,function(a){a.line=l-2});this._getTrackData(g).text=l-2;this._paintEventLine(b,l,e,g,a,c);a=Math.round(a.trackOffset+g*a.trackIncrement+a.trackHeight/2-k.height/2);var f=this._paintEventLabel(b,f,h,a,k.width,k.height,c),q=this;a=function(a,c,d){return q._onClickDurationEvent(p.elmt,
c,b)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",a);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",a);this._createHighlightDiv(d,p,c);this._eventIdToElmt[b.getID()]=p.elmt};
Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(b,a){for(var c=0;;c++){if(c<this._lowerTracks.length){var d=this._lowerTracks[c];if(Math.min(d.solid,d.text)>b&&(!a||d.line>a))return c}else return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),c;if(c<this._upperTracks.length){if(d=this._upperTracks[c],Math.min(d.solid,d.text)>b&&(!a||d.line>a))return-1-c}else return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,
text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-c}};
Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(b,a,c){var d,f;0>b?(d=!0,b=-b,a=this._findFreeUpperTrackForText(b,a),f=-1-a):0<b?(d=!1,b+=1,f=a=this._findFreeLowerTrackForText(b,a)):(f=this._findFreeUpperTrackForText(0,a),a=this._findFreeLowerTrackForText(1,a),a-1<=f?(d=!1,b=1,f=a):(d=!0,b=0,a=f,f=-1-a));if(d){a==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=b;d<a;d++)c(this._upperTracks[d])}else{a==
this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=b;d<a;d++)c(this._lowerTracks[d])}return f};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(b,a){for(;b<this._lowerTracks.length;b++){var c=this._lowerTracks[b];if(Math.min(c.solid,c.text)>=a)break}return b};
Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(b,a){for(;b<this._upperTracks.length;b++){var c=this._upperTracks[b];if(Math.min(c.solid,c.text)>=a)break}return b};Timeline.DetailedEventPainter.prototype._getTrackData=function(b){return 0>b?this._upperTracks[-b-1]:this._lowerTracks[b]};
Timeline.DetailedEventPainter.prototype._paintEventLine=function(b,a,c,d,f,h){b=Math.round(f.trackOffset+c*f.trackIncrement+f.trackHeight/2);f=Math.round(Math.abs(d-c)*f.trackIncrement);var e="1px solid "+h.event.label.lineColor,g=this._timeline.getDocument().createElement("div");g.style.position="absolute";g.style.left=a+"px";g.style.width=h.event.label.offsetFromLine+"px";g.style.height=f+"px";c>d?(g.style.top=b-f+"px",g.style.borderTop=e):(g.style.top=b+"px",g.style.borderBottom=e);g.style.borderLeft=
e;this._lineLayer.appendChild(g)};
Timeline.DetailedEventPainter.prototype._paintEventIcon=function(b,a,c,d,f){f=b.getIcon();f=null!=f?f:d.icon;a=Math.round(d.trackOffset+a*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);f=SimileAjax.Graphics.createTranslucentImage(f);var h=this._timeline.getDocument().createElement("div");h.style.position="absolute";h.style.left=c+"px";h.style.top=a+"px";h.appendChild(f);h.style.cursor="pointer";null!=b._title&&(h.title=b._title);this._eventLayer.appendChild(h);return{left:c,top:a,width:d.iconWidth,
height:d.iconHeight,elmt:h}};
Timeline.DetailedEventPainter.prototype._paintEventLabel=function(b,a,c,d,f,h,e){var g=this._timeline.getDocument(),k=g.createElement("div");k.style.position="absolute";k.style.left=c+"px";k.style.width=f+"px";k.style.top=d+"px";k.style.height=h+"px";k.style.backgroundColor=e.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(k,e.event.label.backgroundOpacity);this._eventLayer.appendChild(k);e=g.createElement("div");e.style.position="absolute";e.style.left=c+"px";e.style.width=f+"px";e.style.top=
d+"px";e.innerHTML=a;e.style.cursor="pointer";null!=b._title&&(e.title=b._title);a=b.getTextColor();null==a&&(a=b.getColor());null!=a&&(e.style.color=a);this._eventLayer.appendChild(e);return{left:c,top:d,width:f,height:h,elmt:e}};
Timeline.DetailedEventPainter.prototype._paintEventTape=function(b,a,c,d,f,h,e,g){d-=c;g=g.event.tape.height;a=Math.round(e.trackOffset+a*e.trackIncrement+e.trackHeight/2-g/2);e=this._timeline.getDocument().createElement("div");e.style.position="absolute";e.style.left=c+"px";e.style.width=d+"px";e.style.top=a+"px";e.style.height=g+"px";e.style.backgroundColor=f;e.style.overflow="hidden";e.style.cursor="pointer";null!=b._title&&(e.title=b._title);SimileAjax.Graphics.setOpacity(e,h);this._eventLayer.appendChild(e);
return{left:c,top:a,width:d,height:g,elmt:e}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(b,a,c){if(0<=b){var d=this._timeline.getDocument();c=c.event;b=c.highlightColors[Math.min(b,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=a.left-2+"px";d.style.width=a.width+4+"px";d.style.top=a.top-2+"px";d.style.height=a.height+4+"px";d.style.background=b;this._highlightLayer.appendChild(d)}};
Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(b,a,c){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+Math.ceil(b.offsetWidth/2),d.top+Math.ceil(b.offsetHeight/2),c);this._fireOnSelect(c.getID());a.cancelBubble=!0;SimileAjax.DOM.cancelEvent(a);return!1};
Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(b,a,c){if("pageX"in a){b=a.pageX;var d=a.pageY}else d=SimileAjax.DOM.getPageCoordinates(b),b=a.offsetX+d.left,d=a.offsetY+d.top;this._showBubble(b,d,c);this._fireOnSelect(c.getID());a.cancelBubble=!0;SimileAjax.DOM.cancelEvent(a);return!1};
Timeline.DetailedEventPainter.prototype.showBubble=function(b){var a=this._eventIdToElmt[b.getID()];if(a){var c=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(c.left+a.offsetWidth/2,c.top+a.offsetHeight/2,b)}};
Timeline.DetailedEventPainter.prototype._showBubble=function(b,a,c){var d=document.createElement("div"),f=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,b,a,f.width,null,f.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++)this._onSelectListeners[a](b)};
Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._highlightMatcher=this._filterMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._highlightLayer=this._eventLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OverviewEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._prepareForPainting();for(var b=this._params.theme.event,b={trackOffset:b.overviewTrack.offset,trackHeight:b.overviewTrack.height,trackGap:b.overviewTrack.gap,trackIncrement:b.overviewTrack.height+b.overviewTrack.gap},c=this._band.getMinDate(),d=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(a){return!0},e=null!=this._highlightMatcher?this._highlightMatcher:
function(a){return-1},a=a.getEventReverseIterator(c,d);a.hasNext();)c=a.next(),f(c)&&this.paintEvent(c,b,this._params.theme,e(c));this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement)}};Timeline.OverviewEventPainter.prototype.softPaint=function(){};
Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OverviewEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(a,b,c,d){var f=a.getStart(),f=Math.round(this._band.dateToPixelOffset(f)),e=a.getColor(),e=a.getClassName()?null:null!=e?e:c.event.duration.color;a=this._paintEventTick(a,f,e,100,b,c);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(a,b,c,d){for(var f=a.getLatestStart(),e=a.getEarliestEnd(),f=Math.round(this._band.dateToPixelOffset(f)),e=Math.round(this._band.dateToPixelOffset(e)),g=0;g<this._tracks.length&&!(e<this._tracks[g]);g++);this._tracks[g]=e;var h=a.getColor(),k=a.getClassName(),h=k?null:null!=h?h:c.event.duration.color;a=this._paintEventTape(a,g,f,e,h,100,b,c,k);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype._paintEventTape=function(a,b,c,d,f,e,g,h,k){a=g.trackOffset+b*g.trackIncrement;d-=c;g=g.trackHeight;b=this._timeline.getDocument().createElement("div");b.className="timeline-small-event-tape";k&&(b.className+=" small-"+k);b.style.left=c+"px";b.style.width=d+"px";b.style.top=a+"px";b.style.height=g+"px";f&&(b.style.backgroundColor=f);100>e&&SimileAjax.Graphics.setOpacity(b,e);this._eventLayer.appendChild(b);return{left:c,top:a,width:d,height:g,elmt:b}};
Timeline.OverviewEventPainter.prototype._paintEventTick=function(a,b,c,d,f,e){c=e.event.overviewTrack.tickHeight;f=f.trackOffset-c;e=this._timeline.getDocument().createElement("div");e.className="timeline-small-event-icon";e.style.left=b+"px";e.style.top=f+"px";if(a=a.getClassName())e.className+=" small-"+a;100>d&&SimileAjax.Graphics.setOpacity(e,d);this._eventLayer.appendChild(e);return{left:b,top:f,width:1,height:c,elmt:e}};
Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();c=c.event;a=c.highlightColors[Math.min(a,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-1+"px";d.style.width=b.width+2+"px";d.style.top=b.top-1+"px";d.style.height=b.height+2+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};Timeline.OverviewEventPainter.prototype.showBubble=function(a){};
Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple="multiple"in a?a.multiple:1};
Timeline.GregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate(),
c=this._band.getTimeZone(),d=this._band.getLabeller();for(SimileAjax.DateTime.roundDownToInterval(a,this._unit,c,this._multiple,this._theme.firstDayOfWeek);a.getTime()<b.getTime();){this._intervalMarkerLayout.createIntervalMarker(a,d,this._unit,this._markerLayer,this._lineLayer);for(var c=a,f=0;f<this._multiple;f++)SimileAjax.DateTime.incrementByInterval(c,this._unit)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};
Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){0!=a&&(this._unit+=a)};
Timeline.HotZoneGregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:a.unit,multiple:1}];for(var b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=SimileAjax.DateTime.parseGregorianDateTime(c.start).getTime(),f=SimileAjax.DateTime.parseGregorianDateTime(c.end).getTime(),g=0;g<this._zones.length&&f>d;g++){var e=this._zones[g];d<e.endTime&&(d>e.startTime&&(this._zones.splice(g,0,{startTime:e.startTime,
endTime:d,unit:e.unit,multiple:e.multiple}),g++,e.startTime=d),f<e.endTime?(this._zones.splice(g,0,{startTime:d,endTime:f,unit:c.unit,multiple:c.multiple?c.multiple:1}),g++,d=e.startTime=f):(e.multiple=c.multiple,e.unit=c.unit,d=e.endTime))}};
Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";for(var a=this._band.getMinDate(),b=
this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller(),f=0;f<this._zones.length&&!(a.getTime()<this._zones[f].endTime);)f++;for(var g=this._zones.length-1;0<=g&&!(b.getTime()>this._zones[g].startTime);)g--;for(;f<=g;f++){var e=this._zones[f],m=new Date(Math.max(a.getTime(),e.startTime)),l=new Date(Math.min(b.getTime(),e.endTime));SimileAjax.DateTime.roundDownToInterval(m,e.unit,c,e.multiple,this._theme.firstDayOfWeek);for(SimileAjax.DateTime.roundUpToInterval(l,e.unit,c,e.multiple,
this._theme.firstDayOfWeek);m.getTime()<l.getTime();){this._intervalMarkerLayout.createIntervalMarker(m,d,e.unit,this._markerLayer,this._lineLayer);for(var t=m,k=e,p=0;p<k.multiple;p++)SimileAjax.DateTime.incrementByInterval(t,k.unit)}}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};
Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(a){if(0!=a)for(var b=0;b<this._zones.length;++b)this._zones[b]&&(this._zones[b].unit+=a)};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple="multiple"in a?a.multiple:1};
Timeline.YearCountEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(this._startDate.getTime()),b=
this._band.getMaxDate(),c=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();a.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-c%this._multiple);for(var d=this,c=function(a){for(var b=0;b<d._multiple;b++)SimileAjax.DateTime.incrementByInterval(a,SimileAjax.DateTime.YEAR)},f={labelInterval:function(a,b){var c=a.getUTCFullYear()-d._startDate.getUTCFullYear();return{text:c,emphasized:0==c}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,f,SimileAjax.DateTime.YEAR,
this._markerLayer,this._lineLayer),c(a);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};
Timeline.QuarterlyEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(0),b=this._band.getMaxDate();
a.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));a.setUTCMonth(this._startDate.getUTCMonth());for(var c=this,d={labelInterval:function(a,b){var e=(4+(a.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;return 0!=e?{text:"Q"+(e+1),emphasized:!1}:{text:"Y"+(a.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:!0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),
a.setUTCMonth(a.getUTCMonth()+3);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};
Timeline.EtherIntervalMarkerLayout=function(a,b,c,d,f){var g=a.isHorizontal();this.positionDiv=g?"Top"==d?function(a,b){a.style.left=b+"px";a.style.top="0px"}:function(a,b){a.style.left=b+"px";a.style.bottom="0px"}:"Left"==d?function(a,b){a.style.top=b+"px";a.style.left="0px"}:function(a,b){a.style.top=b+"px";a.style.right="0px"};var e=c.ether.interval.line,m=c.ether.interval.weekend,l=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(d,k,p,u,s){var r=
Math.round(b.dateToPixelOffset(d));if(f&&p!=SimileAjax.DateTime.WEEK){var h=a.getDocument().createElement("div");h.className="timeline-ether-lines";100>e.opacity&&SimileAjax.Graphics.setOpacity(h,e.opacity);g?h.style.left=r+"px":h.style.top=r+"px";s.appendChild(h)}if(p==SimileAjax.DateTime.WEEK){var h=c.firstDayOfWeek,h=new Date(d.getTime()+(6-h-7)*l),q=new Date(h.getTime()+2*l),h=Math.round(b.dateToPixelOffset(h)),q=Math.round(b.dateToPixelOffset(q)),q=Math.max(1,q-h),n=a.getDocument().createElement("div");
n.className="timeline-ether-weekends";100>m.opacity&&SimileAjax.Graphics.setOpacity(n,m.opacity);g?(n.style.left=h+"px",n.style.width=q+"px"):(n.style.top=h+"px",n.style.height=q+"px");s.appendChild(n)}d=k.labelInterval(d,p);k=a.getDocument().createElement("div");k.innerHTML=d.text;k.className="timeline-date-label";d.emphasized&&(k.className+=" timeline-date-label-em");this.positionDiv(k,r);u.appendChild(k);return k}};
Timeline.EtherHighlight=function(a,b,c,d){var f=a.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(null==this._highlightDiv){this._highlightDiv=a.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var b=c.ether.highlightOpacity;100>b&&SimileAjax.Graphics.setOpacity(this._highlightDiv,b);d.appendChild(this._highlightDiv)}};this.position=function(a,c){this._createHighlightDiv();
var d=Math.round(b.dateToPixelOffset(a)),l=Math.round(b.dateToPixelOffset(c)),l=Math.max(l-d,3);f?(this._highlightDiv.style.left=d+"px",this._highlightDiv.style.width=l+"px",this._highlightDiv.style.height=b.getViewWidth()-4+"px"):(this._highlightDiv.style.top=d+"px",this._highlightDiv.style.height=l+"px",this._highlightDiv.style.width=b.getViewWidth()-4+"px")}};
Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.CompactEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._prepareForPainting();var b=this._params.theme,c=b.event,b={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:b.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:
5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:c.instant.icon,defaultIconWidth:c.instant.iconWidth,defaultIconHeight:c.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:c.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:c.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:
2};"compositeIcon"in this._params?(b.compositeIcon=this._params.compositeIcon,b.compositeIconWidth=this._params.compositeIconWidth||b.customIconWidth,b.compositeIconHeight=this._params.compositeIconHeight||b.customIconHeight):(b.compositeIcon=b.defaultIcon,b.compositeIconWidth=b.defaultIconWidth,b.compositeIconHeight=b.defaultIconHeight);b.defaultStackIcon="icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:b.defaultIcon;b.defaultStackIconWidth=
"iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:b.defaultIconWidth;b.defaultStackIconHeight="iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:b.defaultIconHeight;var d=this._band.getMinDate(),h=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(a){return!0},c=null!=this._highlightMatcher?this._highlightMatcher:function(a){return-1},
h=a.getEventIterator(d,h),a="stackConcurrentPreciseInstantEvents"in this._params&&"object"==typeof this._params.stackConcurrentPreciseInstantEvents;if("collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents||a){for(var d=[],e=null;h.hasNext();){var k=h.next();f(k)&&(!k.isInstant()||k.isImprecise()?this.paintEvent(k,b,this._params.theme,c(k)):null!=e&&e.getStart().getTime()==k.getStart().getTime()?d[d.length-1].push(k):(d.push([k]),e=k))}for(f=0;f<
d.length;f++)if(h=d[f],1==h.length)this.paintEvent(h[0],b,this._params.theme,c(k));else{for(var e=-1,g=0;0>e&&g<h.length;g++)e=c(h[g]);a?this.paintStackedPreciseInstantEvents(h,b,this._params.theme,e):this.paintCompositePreciseInstantEvents(h,b,this._params.theme,e)}}else for(;h.hasNext();)k=h.next(),f(k)&&this.paintEvent(k,b,this._params.theme,c(k));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block"}};
Timeline.CompactEventPainter.prototype.softPaint=function(){};
Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.CompactEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var h={tooltip:a.getProperty("tooltip")||a.getText()},f={url:a.getIcon()};null==f.url?(f.url=b.defaultIcon,f.width=b.defaultIconWidth,f.height=b.defaultIconHeight,f.className="timeline-event-icon-default"):(f.width=a.getProperty("iconWidth")||b.customIconWidth,f.height=a.getProperty("iconHeight")||b.customIconHeight);var e={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},k=this.paintTapeIconLabel(a.getStart(),
h,null,f,e,b,c,d),g=this;b=function(b,c,d){return g._onClickInstantEvent(k.iconElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",b);this._eventIdToElmt[a.getID()]=k.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(a,b,c,d){for(var h=a[0],f=[],e=0;e<a.length;e++)f.push(a[e].getProperty("tooltip")||a[e].getText());var f={tooltip:f.join("; ")},e={url:b.compositeIcon,width:b.compositeIconWidth,height:b.compositeIconHeight,className:"timeline-event-icon-composite"},k={text:String.substitute(this._params.compositeEventLabelTemplate,[a.length])},g=this.paintTapeIconLabel(h.getStart(),f,null,e,k,b,c,d),l=this;b=function(b,c,d){return l._onClickMultiplePreciseInstantEvent(g.iconElmtData.elmt,
c,a)};SimileAjax.DOM.registerEvent(g.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(g.labelElmtData.elmt,"mousedown",b);for(e=0;e<a.length;e++)this._eventIdToElmt[a[e].getID()]=g.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(a,b,c,d){d="limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10;var h="moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events",f=d<=a.length-2,e=this._band,k=function(a){var c={url:a.getIcon()};null==c.url?(c.url=b.defaultStackIcon,c.width=b.defaultStackIconWidth,
c.height=b.defaultStackIconHeight,c.className="timeline-event-icon-stack timeline-event-icon-default"):(c.width=a.getProperty("iconWidth")||b.customIconWidth,c.height=a.getProperty("iconHeight")||b.customIconHeight,c.className="timeline-event-icon-stack");return c},g=k(a[0]),l=0,q=0,m=0,r=0,t=[],n=0;for(;n<a.length&&(!f||n<d);n++){var p=a[n],s=p.getText(),p=k(p),v=this._frc.computeSize(s),s={text:s,iconData:p,labelSize:v,iconLeft:g.width+5*n-p.width};s.labelLeft=g.width+5*n+b.iconLabelGap;s.top=m;
t.push(s);l=Math.min(l,s.iconLeft);m+=v.height;q=Math.max(q,s.labelLeft+v.width);r=Math.max(r,s.top+p.height)}if(f)var z=String.substitute(h,[a.length-d]),x=this._frc.computeSize(z),D=g.width+5*(d-1)+b.iconLabelGap,F=m,m=m+x.height,q=Math.max(q,D+x.width);for(var q=q+b.labelRightMargin,m=m+b.labelBottomMargin,r=r+b.iconBottomMargin,y=function(a){return Math.round(e.dateToPixelOffset(a))}(a[0].getStart()),h=[],k=Math.ceil(Math.max(r,m)/b.trackHeight),g=g.width+5*(a.length-1),n=0;n<k;n++)h.push({start:l,
end:g});l=Math.ceil(m/b.trackHeight);for(n=0;n<l;n++)m=h[n],m.end=Math.max(m.end,q);var A=this._fitTracks(y,h)*b.trackHeight+b.trackOffset,u=this._timeline.getDocument().createElement("div");u.className="timeline-event-icon-stack";u.style.position="absolute";u.style.overflow="visible";u.style.left=y+"px";u.style.top=A+"px";u.style.width=g+"px";u.style.height=r+"px";u.innerHTML="\x3cdiv style\x3d'position: relative'\x3e\x3c/div\x3e";this._eventLayer.appendChild(u);var w=this,E=function(a){try{var b=
parseInt(this.getAttribute("index")),c=u.firstChild.childNodes;for(a=0;a<c.length;a++)c[a].style.zIndex=a==b?c.length:c.length-a}catch(d){}},q=function(b){var d=t[b],e=a[b],f=e.getProperty("tooltip")||e.getText(),g=w._paintEventLabel({tooltip:f},{text:d.text},y+d.labelLeft,A+d.top,d.labelSize.width,d.labelSize.height,c);g.elmt.setAttribute("index",b);g.elmt.onmouseover=E;var h=SimileAjax.Graphics.createTranslucentImage(d.iconData.url),f=w._timeline.getDocument().createElement("div");f.className="timeline-event-icon"+
("className"in d.iconData?" "+d.iconData.className:"");f.style.left=d.iconLeft+"px";f.style.top=d.top+"px";f.style.zIndex=t.length-b;f.appendChild(h);f.setAttribute("index",b);f.onmouseover=E;u.firstChild.appendChild(f);b=function(a,b,c){return w._onClickInstantEvent(g.elmt,b,e)};SimileAjax.DOM.registerEvent(f,"mousedown",b);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",b);w._eventIdToElmt[e.getID()]=f},n=0;for(;n<t.length;n++)q(n);if(f){var B=a.slice(d),C=this._paintEventLabel({tooltip:z},{text:z},
y+D,A+F,x.width,x.height,c);SimileAjax.DOM.registerEvent(C.elmt,"mousedown",function(a,b,c){return w._onClickMultiplePreciseInstantEvent(C.elmt,b,B)});for(n=0;n<B.length;n++)this._eventIdToElmt[B[n].getID()]=C.elmt}};
Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var h={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!0},e={url:a.getIcon()};null==e.url?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var k={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},g=this.paintTapeIconLabel(a.getStart(),
h,f,e,k,b,c,d),l=this;b=null!=e?function(b,c,d){return l._onClickInstantEvent(g.iconElmtData.elmt,c,a)}:function(b,c,d){return l._onClickInstantEvent(g.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(g.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(g.impreciseTapeElmtData.elmt,"mousedown",b);null!=e?(SimileAjax.DOM.registerEvent(g.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=g.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=g.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var h={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),isInstant:!1},e={url:a.getIcon()};null==e.url?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var k={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},g=this.paintTapeIconLabel(a.getLatestStart(),h,f,e,k,b,c,d),l=this;b=null!=
e?function(b,c,d){return l._onClickInstantEvent(g.iconElmtData.elmt,c,a)}:function(b,c,d){return l._onClickInstantEvent(g.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(g.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(g.tapeElmtData.elmt,"mousedown",b);null!=e?(SimileAjax.DOM.registerEvent(g.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=g.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=g.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var h={tooltip:a.getProperty("tooltip")||a.getText()},f={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!1},e={url:a.getIcon()};null==e.url?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var k={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},g=this.paintTapeIconLabel(a.getLatestStart(),
h,f,e,k,b,c,d),l=this;b=null!=e?function(b,c,d){return l._onClickInstantEvent(g.iconElmtData.elmt,c,a)}:function(b,c,d){return l._onClickInstantEvent(g.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(g.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(g.tapeElmtData.elmt,"mousedown",b);null!=e?(SimileAjax.DOM.registerEvent(g.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=g.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=g.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(a,b,c,d,h,f,e,k){var g=this._band;k=function(a){return Math.round(g.dateToPixelOffset(a))};a=k(a);var l=[],q=0,m=0,r=0;if(null!=c){for(var q=f.tapeHeight+f.tapeBottomMargin,m=Math.ceil(f.tapeHeight/f.trackHeight),t=k(c.end)-a,n=k(c.start)-a,p=0;p<m;p++)l.push({start:n,end:t});r=f.trackHeight-q%f.tapeHeight}n=t=0;if(null!=d){"iconAlign"in d&&"center"==d.iconAlign&&(t=-Math.floor(d.width/2));n=t+d.width+f.iconLabelGap;0<m&&(l[m-1].end=
Math.max(l[m-1].end,n));for(p=d.height+f.iconBottomMargin+r;0<p;)l.push({start:t,end:n}),p-=f.trackHeight}var p=this._frc.computeSize(h.text),r=p.height+f.labelBottomMargin+r,s=n+p.width+f.labelRightMargin;0<m&&(l[m-1].end=Math.max(l[m-1].end,s));for(var v=0;0<r;v++)m+v<l.length?l[m+v].end=s:l.push({start:0,end:s}),r-=f.trackHeight;l=this._fitTracks(a,l)*f.trackHeight+f.trackOffset;m={};m.labelElmtData=this._paintEventLabel(b,h,a+n,l+q,p.width,p.height,e);if(null!=c){if("latestStart"in c||"earliestEnd"in
c)m.impreciseTapeElmtData=this._paintEventTape(b,c,f.tapeHeight,l,k(c.start),k(c.end),e.event.duration.impreciseColor,e.event.duration.impreciseOpacity,f,e);!c.isInstant&&("start"in c&&"end"in c)&&(m.tapeElmtData=this._paintEventTape(b,c,f.tapeHeight,l,a,k("earliestEnd"in c?c.earliestEnd:c.end),c.color,100,f,e))}null!=d&&(m.iconElmtData=this._paintEventIcon(b,d,l+q,a+t,f,e));return m};
Timeline.CompactEventPainter.prototype._fitTracks=function(a,b){var c;for(c=0;c<this._tracks.length;c++){for(var d=!0,h=0;h<b.length&&c+h<this._tracks.length;h++)if(a+b[h].start<this._tracks[c+h]){d=!1;break}if(d)break}for(d=0;d<b.length;d++)this._tracks[c+d]=a+b[d].end;return c};
Timeline.CompactEventPainter.prototype._paintEventIcon=function(a,b,c,d,h,f){f=SimileAjax.Graphics.createTranslucentImage(b.url);var e=this._timeline.getDocument().createElement("div");e.className="timeline-event-icon"+("className"in b?" "+b.className:"");e.style.left=d+"px";e.style.top=c+"px";e.appendChild(f);"tooltip"in a&&"string"==typeof a.tooltip&&(e.title=a.tooltip);this._eventLayer.appendChild(e);return{left:d,top:c,width:h.iconWidth,height:h.iconHeight,elmt:e}};
Timeline.CompactEventPainter.prototype._paintEventLabel=function(a,b,c,d,h,f,e){e=this._timeline.getDocument().createElement("div");e.className="timeline-event-label";e.style.left=c+"px";e.style.width=h+1+"px";e.style.top=d+"px";e.innerHTML=b.text;"tooltip"in a&&"string"==typeof a.tooltip&&(e.title=a.tooltip);"color"in b&&"string"==typeof b.color&&(e.style.color=b.color);"className"in b&&"string"==typeof b.className&&(e.className+=" "+b.className);this._eventLayer.appendChild(e);return{left:c,top:d,
width:h,height:f,elmt:e}};
Timeline.CompactEventPainter.prototype._paintEventTape=function(a,b,c,d,h,f,e,k,g,l){f-=h;g=this._timeline.getDocument().createElement("div");g.className="timeline-event-tape";g.style.left=h+"px";g.style.top=d+"px";g.style.width=f+"px";g.style.height=c+"px";"tooltip"in a&&"string"==typeof a.tooltip&&(g.title=a.tooltip);null!=e&&"string"==typeof b.color&&(g.style.backgroundColor=e);"backgroundImage"in b&&"string"==typeof b.backgroundImage&&(g.style.backgroundImage="url("+backgroundImage+")",g.style.backgroundRepeat=
"backgroundRepeat"in b&&"string"==typeof b.backgroundRepeat?b.backgroundRepeat:"repeat");SimileAjax.Graphics.setOpacity(g,k);"className"in b&&"string"==typeof b.className&&(g.className+=" "+b.className);this._eventLayer.appendChild(g);return{left:h,top:d,width:f,height:c,elmt:g}};
Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();Math.min(a,c.event.highlightColors.length-1);a=d.createElement("div");a.style.position="absolute";a.style.overflow="hidden";a.style.left=b.left-2+"px";a.style.width=b.width+4+"px";a.style.top=b.top-2+"px";a.style.height=b.height+4+"px";this._highlightLayer.appendChild(a)}};
Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);a=[];for(d=0;d<c.length;d++)a.push(c[d].getID());this._fireOnSelect(a);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,[a])}};
Timeline.CompactEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div");c="fillInfoBubble"in c?[c]:c;for(var h=0;h<c.length;h++){var f=document.createElement("div");d.appendChild(f);c[h].fillInfoBubble(f,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.SpanHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._startDate="string"==typeof a.startDate?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate="string"==typeof a.endDate?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=null!=a.startLabel?a.startLabel:"";this._endLabel=null!=a.endLabel?a.endLabel:"";this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:null;this._opacity=null!=a.opacity?a.opacity:100;this._zIndex=
null!=a.inFront&&a.inFront?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.SpanHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(0>this._unit.compare(this._startDate,b)&&0<this._unit.compare(this._endDate,a)){var a=this._unit.later(a,this._startDate),b=this._unit.earlier(b,this._endDate),a=this._band.dateToPixelOffset(a),
b=this._band.dateToPixelOffset(b),g=this._timeline.getDocument(),c=function(){var a=g.createElement("table");a.insertRow(0).insertCell(0);return a},d=g.createElement("div");d.className="timeline-highlight-decorator";this._cssClass&&(d.className+=" "+this._cssClass);null!=this._color&&(d.style.backgroundColor=this._color);100>this._opacity&&SimileAjax.Graphics.setOpacity(d,this._opacity);this._layerDiv.appendChild(d);var e=c();e.className="timeline-highlight-label timeline-highlight-label-start";var f=
e.rows[0].cells[0];f.innerHTML=this._startLabel;this._cssClass&&(f.className="label_"+this._cssClass);this._layerDiv.appendChild(e);c=c();c.className="timeline-highlight-label timeline-highlight-label-end";f=c.rows[0].cells[0];f.innerHTML=this._endLabel;this._cssClass&&(f.className="label_"+this._cssClass);this._layerDiv.appendChild(c);this._timeline.isHorizontal()?(d.style.left=a+"px",d.style.width=b-a+"px",e.style.right=this._band.getTotalViewLength()-a+"px",e.style.width=this._startLabel.length+
"em",c.style.left=b+"px",c.style.width=this._endLabel.length+"em"):(d.style.top=a+"px",d.style.height=b-a+"px",e.style.bottom=a+"px",e.style.height="1.5px",c.style.top=b+"px",c.style.height="1.5px")}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};
Timeline.PointHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._date="string"==typeof a.date?this._unit.parseFromObject(a.date):a.date;this._width=null!=a.width?a.width:10;this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:"";this._opacity=null!=a.opacity?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.PointHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();0>this._unit.compare(this._date,b)&&0<this._unit.compare(this._date,a)&&(a=this._band.dateToPixelOffset(this._date)-Math.round(this._width/2),b=this._timeline.getDocument().createElement("div"),
b.className="timeline-highlight-point-decorator",b.className+=" "+this._cssClass,null!=this._color&&(b.style.backgroundColor=this._color),100>this._opacity&&SimileAjax.Graphics.setOpacity(b,this._opacity),this._layerDiv.appendChild(b),this._timeline.isHorizontal()?(b.style.left=a+"px",b.style.width=this._width):(b.style.top=a+"px",b.style.height=this._width));this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};
Timeline.NativeDateUnit={};Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)};Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date};Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};Timeline.NativeDateUnit.getParser=function(a){"string"==typeof a&&(a=a.toLowerCase());return"iso8601"==a||"iso 8601"==a?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime};
Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)};Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()};Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)};Timeline.NativeDateUnit.compare=function(a,b){var c,d;c="object"==typeof a?a.getTime():Number(a);d="object"==typeof b?b.getTime():Number(b);return c-d};Timeline.NativeDateUnit.earlier=function(a,b){return 0>Timeline.NativeDateUnit.compare(a,b)?a:b};
Timeline.NativeDateUnit.later=function(a,b){return 0<Timeline.NativeDateUnit.compare(a,b)?a:b};Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};
Timeline.GregorianDateLabeller=function(a,c){this._locale=a;this._timeZone=c};Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.getMonthName=function(a,c){return Timeline.GregorianDateLabeller.monthNames[c][a]};
Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,c){var b=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];null==b&&(b=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval);return b.call(this,a,c)};Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};
Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(a,c){var b,d=!1;a=SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone);switch(c){case SimileAjax.DateTime.MILLISECOND:b=a.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:b=a.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:b=a.getUTCMinutes();0==b&&(b=a.getUTCHours()+":00",d=!0);break;case SimileAjax.DateTime.HOUR:b=a.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:b=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),
this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.WEEK:b=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.MONTH:if(b=a.getUTCMonth(),0!=b){b=Timeline.GregorianDateLabeller.getMonthName(b,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:d=a.getUTCFullYear();b=0<d?a.getUTCFullYear():1-d+"BC";d=c==SimileAjax.DateTime.MONTH||
c==SimileAjax.DateTime.DECADE&&0==d%100||c==SimileAjax.DateTime.CENTURY&&0==d%1E3;break;default:b=a.toUTCString()}return{text:b,emphasized:d}};
Timeline.Debug=SimileAjax.Debug;var log=SimileAjax.Debug.log;Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a};Timeplot.create=function(a,b){return new Timeplot._Impl(a,b)};
Timeplot.createPlotInfo=function(a){return{id:"id"in a?a.id:"p"+Math.round(1E6*Math.random()),dataSource:"dataSource"in a?a.dataSource:null,eventSource:"eventSource"in a?a.eventSource:null,timeGeometry:"timeGeometry"in a?a.timeGeometry:new Timeplot.DefaultTimeGeometry,valueGeometry:"valueGeometry"in a?a.valueGeometry:new Timeplot.DefaultValueGeometry,timeZone:"timeZone"in a?a.timeZone:0,fillColor:"fillColor"in a?"string"==a.fillColor?new Timeplot.Color(a.fillColor):a.fillColor:null,fillGradient:"fillGradient"in
a?a.fillGradient:!0,fillFrom:"fillFrom"in a?a.fillFrom:Number.NEGATIVE_INFINITY,lineColor:"lineColor"in a?"string"==a.lineColor?new Timeplot.Color(a.lineColor):a.lineColor:new Timeplot.Color("#606060"),lineWidth:"lineWidth"in a?a.lineWidth:1,dotRadius:"dotRadius"in a?a.dotRadius:2,dotColor:"dotColor"in a?a.dotColor:null,eventLineWidth:"eventLineWidth"in a?a.eventLineWidth:1,showValues:"showValues"in a?a.showValues:!1,roundValues:"roundValues"in a?a.roundValues:!0,valuesOpacity:"valuesOpacity"in a?
a.valuesOpacity:75,bubbleWidth:"bubbleWidth"in a?a.bubbleWidth:300,bubbleHeight:"bubbleHeight"in a?a.bubbleHeight:200}};Timeplot._Impl=function(a,b){this._id="t"+Math.round(1E6*Math.random());this._containerDiv=a;this._plotInfos=b;this._painters={background:[],foreground:[]};this._painter=null;this._upright=this._active=!1;this._initialize()};
Timeplot._Impl.prototype={dispose:function(){for(var a=0;a<this._plots.length;a++)this._plots[a].dispose();this._plotsInfos=this._plots=null;this._containerDiv.innerHTML=""},getElement:function(){return this._containerDiv},getDocument:function(){return this._containerDiv.ownerDocument},add:function(a){this._containerDiv.appendChild(a)},remove:function(a){this._containerDiv.removeChild(a)},addPainter:function(a,b){var c=this._painters[a];if(c){for(var d=0;d<c.length;d++)if(c[d].context._id==b.context._id)return;
c.push(b)}},removePainter:function(a,b){var c=this._painters[a];if(c)for(var d=0;d<c.length;d++)if(c[d].context._id==b.context._id){c.splice(d,1);break}},getWidth:function(){return this._containerDiv.clientWidth},getHeight:function(){return this._containerDiv.clientHeight},getCanvas:function(){return this._canvas},loadText:function(a,b,c,d,e){if(this._active){var f=this,h=function(b,c,d){alert("Failed to load data xml from "+a+"\n"+b);f.hideLoadingMessage()},g=function(h){try{c.loadText(h.responseText,
b,a,d,e)}catch(g){SimileAjax.Debug.exception(g)}finally{f.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,h,g)},0)}},loadXML:function(a,b){if(this._active){var c=this,d=function(b,d,e){alert("Failed to load data xml from "+a+"\n"+b);c.hideLoadingMessage()},e=function(d){try{var e=d.responseXML;!e.documentElement&&d.responseStream&&e.load(d.responseStream);b.loadXML(e,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,
d,e)},0)}},putText:function(a,b,c,d){a=this.putDiv(a,"timeplot-div "+c,d);a.innerHTML=b;return a},putDiv:function(a,b,c){a=this._id+"-"+a;var d=document.getElementById(a);if(!d){var e=this._containerDiv.firstChild,d=document.createElement("div");d.setAttribute("id",a);e.appendChild(d)}d.setAttribute("class","timeplot-div "+b);d.setAttribute("className","timeplot-div "+b);this.placeDiv(d,c);return d},placeDiv:function(a,b){if(b)for(style in b)"left"==style?(b[style]+=this._paddingX,b[style]+="px"):
"right"==style?(b[style]+=this._paddingX,b[style]+="px"):"top"==style?(b[style]+=this._paddingY,b[style]+="px"):"bottom"==style?(b[style]+=this._paddingY,b[style]+="px"):"width"==style?(0>b[style]&&(b[style]=0),b[style]+="px"):"height"==style&&(0>b[style]&&(b[style]=0),b[style]+="px"),a.style[style]=b[style]},locate:function(a){return{x:a.offsetLeft-this._paddingX,y:a.offsetTop-this._paddingY}},update:function(){if(this._active){for(var a=0;a<this._plots.length;a++){var b=this._plots[a],c=b.getDataSource();
if(c&&(c=c.getRange()))b._valueGeometry.setRange(c),b._timeGeometry.setRange(c);b.hideValues()}this.paint()}},repaint:function(){if(this._active){this._prepareCanvas();for(var a=0;a<this._plots.length;a++){var b=this._plots[a];b._timeGeometry&&b._timeGeometry.reset();b._valueGeometry&&b._valueGeometry.reset()}this.paint()}},paint:function(){if(this._active&&null==this._painter){var a=this;this._painter=window.setTimeout(function(){a._clearCanvas();for(var b=function(b,c){try{c.setTimeplot&&c.setTimeplot(a),
b.apply(c,[])}catch(d){SimileAjax.Debug.exception(d)}},c=a._painters.background,d=0;d<c.length;d++)b(c[d].action,c[d].context);c=a._painters.foreground;for(d=0;d<c.length;d++)b(c[d].action,c[d].context);a._painter=null},20)}},_clearCanvas:function(){var a=this.getCanvas();a.getContext("2d").clearRect(0,0,a.width,a.height)},_clearLabels:function(){var a=this._containerDiv.firstChild;a&&this._containerDiv.removeChild(a);a=document.createElement("div");this._containerDiv.appendChild(a)},_prepareCanvas:function(){var a=
this.getCanvas(),b=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(b.css("paddingLeft"))+parseInt(b.css("paddingRight")))/2;this._paddingY=(parseInt(b.css("paddingTop"))+parseInt(b.css("paddingBottom")))/2;a.width=this.getWidth()-2*this._paddingX;a.height=this.getHeight()-2*this._paddingY;b=a.getContext("2d");this._setUpright(b,a);b.globalCompositeOperation="source-over"},_setUpright:function(a,b){SimileAjax.Platform.browser.isIE||(this._upright=!1);this._upright||(this._upright=!0,
a.translate(0,b.height),a.scale(1,-1))},_isBrowserSupported:function(a){var b=SimileAjax.Platform.browser;return a.getContext&&window.getComputedStyle||b.isIE&&6<=b.majorVersion?!0:!1},_initialize:function(){SimileAjax.WindowManager.initialize();var a=this._containerDiv,b=a.ownerDocument;for(a.className="timeplot-container "+a.className;a.firstChild;)a.removeChild(a.firstChild);var c=b.createElement("canvas");if(this._isBrowserSupported(c)){this._clearLabels();this._canvas=c;c.className="timeplot-canvas";
a.appendChild(c);!c.getContext&&G_vmlCanvasManager&&(this._canvas=c=G_vmlCanvasManager.initElement(this._canvas));this._prepareCanvas();c=SimileAjax.Graphics.createTranslucentImage("static/img/simile_copyright.png");c.className="timeplot-copyright";c.title="SIMILE Timeplot - http://www.simile-widgets.org/timeplot/";SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://www.simile-widgets.org/timeplot/"});a.appendChild(c);var d=this,c={onAddMany:function(){d.update()},onClear:function(){d.update()}};
this._plots=[];if(this._plotInfos)for(var e=0;e<this._plotInfos.length;e++){var f;f=this._plotInfos[e].plot?new this._plotInfos[e].plot(this,this._plotInfos[e]):new Timeplot.Plot(this,this._plotInfos[e]);var h=f.getDataSource();h&&h.addListener(c);this.addPainter("background",{context:f.getTimeGeometry(),action:f.getTimeGeometry().paint});this.addPainter("background",{context:f.getValueGeometry(),action:f.getValueGeometry().paint});this.addPainter("foreground",{context:f,action:f.paint});this._plots.push(f);
f.initialize()}var g=SimileAjax.Graphics.createMessageBubble(b);g.containerDiv.className="timeplot-message-container";a.appendChild(g.containerDiv);g.contentDiv.className="timeplot-message";g.contentDiv.innerHTML=" Loading...";this.showLoadingMessage=function(){g.containerDiv.style.display="block"};this.hideLoadingMessage=function(){g.containerDiv.style.display="none"};this._active=!0}else this._message=SimileAjax.Graphics.createMessageBubble(b),this._message.containerDiv.className="timeplot-message-container",
this._message.containerDiv.style.top="15%",this._message.containerDiv.style.left="20%",this._message.containerDiv.style.right="20%",this._message.containerDiv.style.minWidth="20em",this._message.contentDiv.className="timeplot-message",this._message.contentDiv.innerHTML="We're terribly sorry, but your browser is not currently supported by \x3ca href\x3d'http://www.simile-widgets.org/timeplot/'\x3eTimeplot\x3c/a\x3e.",this._message.containerDiv.style.display="block",a.appendChild(this._message.containerDiv)}};
Timeplot.Plot=function(b,a){this._timeplot=b;this._canvas=b.getCanvas();this._plotInfo=a;this._id=a.id;this._timeGeometry=a.timeGeometry;this._valueGeometry=a.valueGeometry;this._theme=new Timeline.getDefaultTheme;this._dataSource=a.dataSource;this._eventSource=a.eventSource;this._bubble=null};
Timeplot.Plot.prototype={initialize:function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");this._valueFlagLineLeft.firstChild||(this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+
"images/line_left.png")),this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png")));this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var b=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,b);SimileAjax.Graphics.setOpacity(this._valueFlag,b);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,b);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,b);SimileAjax.Graphics.setOpacity(this._valueFlagPole,
b);var a=this,k=function(b,c,f){if("undefined"!=typeof SimileAjax&&a._plotInfo.showValues){b=a._canvas;c=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(c,a._canvas).x);c>b.width&&(c=b.width);if(isNaN(c)||0>c)c=0;c=a._timeGeometry.fromScreen(c);if(0==c)a._valueFlag.style.display="none";else{var d=a._dataSource.getClosestValidTime(c);c=a._timeGeometry.toScreen(d);f=a._dataSource.getValue(d);a._plotInfo.roundValues&&(f=Math.round(f));a._valueFlag.innerHTML=new String(f);var d=new Date(d),e=a._timeGeometry.getPeriod();
a._timeFlag.innerHTML=864E5>e?d.toLocaleTimeString():2592E6<e?d.toLocaleDateString():d.asDateOnly();var d=a._timeFlag.clientHeight,e=Math.round(a._timeFlag.clientWidth/2),g=a._valueFlag.clientWidth,h=a._valueFlag.clientHeight;f=a._valueGeometry.toScreen(f);var k=c+e>b.width?b.width-e:0>c-e?e:c;"top"==a._timeGeometry._timeValuePosition?(a._timeplot.placeDiv(a._valueFlagPole,{left:c,top:d-5,height:b.height-f-d+6,display:"block"}),a._timeplot.placeDiv(a._timeFlag,{left:k-e,top:-6,display:"block"})):
(a._timeplot.placeDiv(a._valueFlagPole,{left:c,bottom:d-5,height:f-d+6,display:"block"}),a._timeplot.placeDiv(a._timeFlag,{left:k-e,bottom:-6,display:"block"}));c+g+14>b.width&&f+h+4>b.height?(a._valueFlagLineLeft.style.display="none",a._timeplot.placeDiv(a._valueFlagLineRight,{left:c-14,bottom:f-14,display:"block"}),a._timeplot.placeDiv(a._valueFlag,{left:c-g-13,bottom:f-h-13,display:"block"})):c+g+14>b.width&&f+h+4<b.height?(a._valueFlagLineRight.style.display="none",a._timeplot.placeDiv(a._valueFlagLineLeft,
{left:c-14,bottom:f,display:"block"}),a._timeplot.placeDiv(a._valueFlag,{left:c-g-13,bottom:f+13,display:"block"})):c+g+14<b.width&&f+h+4>b.height?(a._valueFlagLineRight.style.display="none",a._timeplot.placeDiv(a._valueFlagLineLeft,{left:c,bottom:f-13,display:"block"}),a._timeplot.placeDiv(a._valueFlag,{left:c+13,bottom:f-13,display:"block"})):(a._valueFlagLineLeft.style.display="none",a._timeplot.placeDiv(a._valueFlagLineRight,{left:c,bottom:f,display:"block"}),a._timeplot.placeDiv(a._valueFlag,
{left:c+13,bottom:f+13,display:"block"}))}}},b=this._timeplot.getElement();SimileAjax.DOM.registerEvent(b,"mouseover",function(b,c,f){a._plotInfo.showValues&&(a._valueFlag.style.display="block",k(b,c,f))});SimileAjax.DOM.registerEvent(b,"mousemove",k)}},dispose:function(){this._dataSource&&(this._dataSource.removeListener(this._paintingListener),this._paintingListener=null,this._dataSource.dispose(),this._dataSource=null)},hideValues:function(){this._valueFlag&&(this._valueFlag.style.display="none");
this._timeFlag&&(this._timeFlag.style.display="none");this._valueFlagLineLeft&&(this._valueFlagLineLeft.style.display="none");this._valueFlagLineRight&&(this._valueFlagLineRight.style.display="none");this._valueFlagPole&&(this._valueFlagPole.style.display="none")},getDataSource:function(){return this._dataSource?this._dataSource:this._eventSource},getTimeGeometry:function(){return this._timeGeometry},getValueGeometry:function(){return this._valueGeometry},paint:function(){var b=this._canvas.getContext("2d");
b.lineWidth=this._plotInfo.lineWidth;b.lineJoin="miter";if(this._dataSource){if(this._plotInfo.fillColor){if(this._plotInfo.fillGradient){var a=b.createLinearGradient(0,this._canvas.height,0,0);a.addColorStop(0,this._plotInfo.fillColor.toString());a.addColorStop(0.5,this._plotInfo.fillColor.toString());a.addColorStop(1,"rgba(255,255,255,0)");b.fillStyle=a}else b.fillStyle=this._plotInfo.fillColor.toString();b.beginPath();b.moveTo(0,0);this._plot(function(a,c){b.lineTo(a,c)});this._plotInfo.fillFrom==
Number.NEGATIVE_INFINITY?b.lineTo(this._canvas.width,0):this._plotInfo.fillFrom==Number.POSITIVE_INFINITY?(b.lineTo(this._canvas.width,this._canvas.height),b.lineTo(0,this._canvas.height)):(b.lineTo(this._canvas.width,this._valueGeometry.toScreen(this._plotInfo.fillFrom)),b.lineTo(0,this._valueGeometry.toScreen(this._plotInfo.fillFrom)));b.fill()}if(this._plotInfo.lineColor){b.strokeStyle=this._plotInfo.lineColor.toString();b.beginPath();var k=!0;this._plot(function(a,c){k&&(k=!1,b.moveTo(a,c));b.lineTo(a,
c)});b.stroke()}if(this._plotInfo.dotColor){b.fillStyle=this._plotInfo.dotColor.toString();var l=this._plotInfo.dotRadius;this._plot(function(a,c){b.beginPath();b.arc(a,c,l,0,2*Math.PI,!0);b.fill()})}}if(this._eventSource){a=b.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(1,"rgba(255,255,255,0)");b.strokeStyle=a;b.fillStyle=a;b.lineWidth=this._plotInfo.eventLineWidth;b.lineJoin="miter";for(var c=this._eventSource.getAllEventIterator();c.hasNext();){var f=c.next(),d=f.getColor(),d=
d?new Timeplot.Color(d):this._plotInfo.lineColor,e=f.getStart().getTime(),g=f.getEnd().getTime();e==g?(d=d.toString(),a.addColorStop(0,d),e=this._timeGeometry.toScreen(e),d=e=Math.floor(e)+0.5,b.beginPath(),b.moveTo(e,0),b.lineTo(e,this._canvas.height),b.stroke(),g=e-4,e=7):(d=d.toString(0.5),a.addColorStop(0,d),e=this._timeGeometry.toScreen(e),e=Math.floor(e)+0.5,d=this._timeGeometry.toScreen(g),d=Math.floor(d)+0.5,b.fillRect(e,0,d-e,this._canvas.height),g=e,e=d-e-1);var g=this._timeplot.putDiv(f.getID(),
"timeplot-event-box",{left:Math.round(g),width:Math.round(e),top:0,height:this._canvas.height-1}),h=this,e=function(a){return function(b,c,d){h._timeplot.getDocument();h._closeBubble();c=SimileAjax.DOM.getEventPageCoordinates(c);b=SimileAjax.DOM.getPageCoordinates(b);h._bubble=SimileAjax.Graphics.createBubbleForPoint(c.x,b.top+h._canvas.height,h._plotInfo.bubbleWidth,h._plotInfo.bubbleHeight,"bottom");a.fillInfoBubble(h._bubble.content,h._theme,h._timeGeometry.getLabeler())}},d=function(a,b,c){a.oldClass=
a.className;a.className+=" timeplot-event-box-highlight"},m=function(a,b,c){a.className=a.oldClass;a.oldClass=null};g.instrumented||(SimileAjax.DOM.registerEvent(g,"click",e(f)),SimileAjax.DOM.registerEvent(g,"mouseover",d),SimileAjax.DOM.registerEvent(g,"mouseout",m),g.instrumented=!0)}}},_plot:function(b){var a=this._dataSource.getData();if(a)for(var k=a.times,a=a.values,l=k.length,c=0;c<l;c++){var f=this._timeGeometry.toScreen(k[c]),d=this._valueGeometry.toScreen(a[c]);b(f,d)}},_closeBubble:function(){null!=
this._bubble&&(this._bubble.close(),this._bubble=null)}};
Timeplot.DefaultEventSource=function(a){Timeline.DefaultEventSource.apply(this,arguments)};Object.extend(Timeplot.DefaultEventSource.prototype,Timeline.DefaultEventSource.prototype);
Timeplot.DefaultEventSource.prototype.loadText=function(a,c,b,e,g){if(null!=a){this._events.maxValues=[];this._getBaseURL(b);g||(g="iso8601");b=this._events.getUnit().getParser(g);a=this._parseText(a,c);c=!1;e&&(a=e(a));if(a)for(e=0;e<a.length;e++)if(g=a[e],1<g.length){var f=SimileAjax.jQuery.trim(g[0]);if(f=b(f))c=new Timeplot.DefaultEventSource.NumericEvent(f,g.slice(1)),this._events.add(c),c=!0}c&&this._fire("onAddMany",[])}};
Timeplot.DefaultEventSource.prototype._parseText=function(a,c){a=a.replace(/\r\n?/g,"\n");for(var b=0,e=a.length,g=[];b<e;){var f=[];if("#"!=a.charAt(b))for(;b<e;){if('"'==a.charAt(b)){for(var d=a.indexOf('"',b+1);d<e&&-1<d&&'"'==a.charAt(d+1);)d=a.indexOf('"',d+2);if(!(0>d))if(a.charAt(d+1)==c){b=a.substr(b+1,d-b-1);b=b.replace(/""/g,'"');f[f.length]=b;b=d+2;continue}else if("\n"==a.charAt(d+1)||e==d+1){b=a.substr(b+1,d-b-1);b=b.replace(/""/g,'"');f[f.length]=b;b=d+2;break}}var d=a.indexOf(c,b),
h=a.indexOf("\n",b);0>h&&(h=e);if(-1<d&&d<h)f[f.length]=a.substr(b,d-b),b=d+1;else{f[f.length]=a.substr(b,h-b);b=h+1;break}}else h=a.indexOf("\n",b),b=-1<h?h+1:cur;0<f.length&&(g[g.length]=f)}if(!(0>g.length))return g};Timeplot.DefaultEventSource.prototype.getRange=function(){var a=this.getEarliestDate(),c=this.getLatestDate();return{earliestDate:a?a:null,latestDate:c?c:null,min:0,max:0}};
Timeplot.DefaultEventSource.NumericEvent=function(a,c){this._id="e"+Math.round(1E6*Math.random());this._time=a;this._values=c};Timeplot.DefaultEventSource.NumericEvent.prototype={getID:function(){return this._id},getTime:function(){return this._time},getValues:function(){return this._values},getStart:function(){return this._time},getEnd:function(){return this._time}};
Timeplot.DataSource=function(a){this._eventSource=a;var c=this;this._processingListener={onAddMany:function(){c._process()},onClear:function(){c._clear()}};this.addListener(this._processingListener);this._listeners=[];this._range=this._data=null};
Timeplot.DataSource.prototype={_clear:function(){this._range=this._data=null},_process:function(){this._data={times:[],values:[]};this._range={earliestDate:null,latestDate:null,min:0,max:0}},getRange:function(){return this._range},getData:function(){return this._data},getValue:function(a){if(this._data)for(var c=0;c<this._data.times.length;c++)if(this._data.times[c]>=a)return this._data.values[c];return 0},getClosestValidTime:function(a){if(this._data)for(var c=0;c<this._data.times.length;c++){var b=
this._data.times[c];if(b>=a){if(0>=c)return b;c=this._data.times[c-1];return a-c<b-a?c:b}}return 0},addListener:function(a){this._eventSource.addListener(a)},removeListener:function(a){this._eventSource.removeListener(a)},replaceListener:function(a,c){this.removeListener(a);this.addListener(c)}};Timeplot.ColumnSource=function(a,c){Timeplot.DataSource.apply(this,arguments);this._column=c-1};Object.extend(Timeplot.ColumnSource.prototype,Timeplot.DataSource.prototype);
Timeplot.ColumnSource.prototype.dispose=function(){this.removeListener(this._processingListener);this._clear()};
Timeplot.ColumnSource.prototype._process=function(){for(var a=this._eventSource.getCount(),c=Array(a),a=Array(a),b=Number.MAX_VALUE,e=Number.MIN_VALUE,g=0,f=this._eventSource.getAllEventIterator();f.hasNext();){var d=f.next(),h=d.getTime();c[g]=h;d=this._getValue(d);isNaN(d)||(d<b&&(b=d),d>e&&(e=d),a[g]=d);g++}this._data={times:c,values:a};e==Number.MIN_VALUE&&(e=1);this._range={earliestDate:this._eventSource.getEarliestDate(),latestDate:this._eventSource.getLatestDate(),min:b,max:e}};
Timeplot.ColumnSource.prototype._getValue=function(a){return parseFloat(a.getValues()[this._column])};Timeplot.ColumnDiffSource=function(a,c,b){Timeplot.ColumnSource.apply(this,arguments);this._column2=b-1};Object.extend(Timeplot.ColumnDiffSource.prototype,Timeplot.ColumnSource.prototype);Timeplot.ColumnDiffSource.prototype._getValue=function(a){var c=parseFloat(a.getValues()[this._column]);a=parseFloat(a.getValues()[this._column2]);return c-a};
Timeplot.DefaultValueGeometry=function(a){a||(a={});this._id="id"in a?a.id:"g"+Math.round(1E6*Math.random());this._axisColor="axisColor"in a?"string"==typeof a.axisColor?new Timeplot.Color(a.axisColor):a.axisColor:new Timeplot.Color("#606060");this._gridColor="gridColor"in a?"string"==typeof a.gridColor?new Timeplot.Color(a.gridColor):a.gridColor:null;this._gridLineWidth="gridLineWidth"in a?a.gridLineWidth:0.5;this._axisLabelsPlacement="axisLabelsPlacement"in a?a.axisLabelsPlacement:"right";this._gridSpacing=
"gridSpacing"in a?a.gridStep:50;this._gridType="gridType"in a?a.gridType:"short";this._gridShortSize="gridShortSize"in a?a.gridShortSize:10;this._minValue="min"in a?a.min:null;this._maxValue="max"in a?a.max:null;this._map=this._linMap={direct:function(a){return a},inverse:function(a){return a}};this._labels=[];this._grid=[]};
Timeplot.DefaultValueGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if(null==this._minValue||null!=this._minValue&&a.min<this._minValue)this._minValue=a.min;if(null==this._maxValue||null!=this._maxValue&&1.05*a.max>this._maxValue)this._maxValue=1.05*a.max;this._updateMappedValues();0==this._minValue&&0==this._maxValue||(this._grid=this._calculateGrid())},reset:function(){this._clearLabels();this._updateMappedValues();this._grid=
this._calculateGrid()},toScreen:function(a){return this._canvas&&this._maxValue?this._canvas.height*this._map.direct(a-this._minValue)/this._mappedRange:-50},fromScreen:function(a){return this._canvas?this._map.inverse(this._mappedRange*a/this._canvas.height)+this._minValue:0},paint:function(){if(this._timeplot){var a=this._canvas.getContext("2d");a.lineJoin="miter";if(this._gridColor){var b=a.createLinearGradient(0,0,0,this._canvas.height);b.addColorStop(0,this._gridColor.toHexString());b.addColorStop(0.3,
this._gridColor.toHexString());b.addColorStop(1,"rgba(255,255,255,0.5)");a.lineWidth=this._gridLineWidth;a.strokeStyle=b;for(b=0;b<this._grid.length;b++){var c=this._grid[b],d=Math.floor(c.y)+0.5;if("undefined"!=typeof c.label){if("left"==this._axisLabelsPlacement){var e=this._timeplot.putText(this._id+"-"+b,c.label,"timeplot-grid-label",{left:4,bottom:d+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(e)}else"right"==this._axisLabelsPlacement&&(e=this._timeplot.putText(this._id+
"-"+b,c.label,"timeplot-grid-label",{right:4,bottom:d+2,color:this._gridColor.toHexString(),visibility:"hidden"}),this._labels.push(e));d+e.clientHeight<this._canvas.height+10&&(e.style.visibility="visible")}a.beginPath();"long"==this._gridType||0==c.label?(a.moveTo(0,d),a.lineTo(this._canvas.width,d)):"short"==this._gridType&&("left"==this._axisLabelsPlacement?(a.moveTo(0,d),a.lineTo(this._gridShortSize,d)):"right"==this._axisLabelsPlacement&&(a.moveTo(this._canvas.width,d),a.lineTo(this._canvas.width-
this._gridShortSize,d)));a.stroke()}}e=a.createLinearGradient(0,0,0,this._canvas.height);e.addColorStop(0,this._axisColor.toString());e.addColorStop(0.5,this._axisColor.toString());e.addColorStop(1,"rgba(255,255,255,0.5)");a.lineWidth=1;a.strokeStyle=e;a.beginPath();a.moveTo(0,this._canvas.height);a.lineTo(0,0);a.stroke();a.beginPath();a.moveTo(this._canvas.width,0);a.lineTo(this._canvas.width,this._canvas.height);a.stroke()}},_clearLabels:function(){for(var a=0;a<this._labels.length;a++){var b=this._labels[a],
c=b.parentNode;c&&c.removeChild(b)}},_calculateGrid:function(){var a=[];if(!this._canvas||0==this._valueRange)return a;var b=0;if(1<this._valueRange){for(;Math.pow(10,b)<this._valueRange;)b++;b--}else for(;Math.pow(10,b)>this._valueRange;)b--;for(var c=Math.pow(10,b),b=c;;){for(var d=this.toScreen(this._minValue+b);d<this._gridSpacing;)b+=c,d=this.toScreen(this._minValue+b);if(d>2*this._gridSpacing)b=c/=10;else break}c=0;d=this.toScreen(c);if(0<=this._minValue)for(;d<this._canvas.height;)0<d&&a.push({y:d,
label:c}),c+=b,d=this.toScreen(c);else{if(!(0>=this._maxValue)){for(;d<this._canvas.height;)0<d&&a.push({y:d,label:c}),c+=b,d=this.toScreen(c);c=-b;d=this.toScreen(c)}for(;0<d;)d<this._canvas.height&&a.push({y:d,label:c}),c-=b,d=this.toScreen(c)}return a},_updateMappedValues:function(){this._valueRange=Math.abs(this._maxValue-this._minValue);this._mappedRange=this._map.direct(this._valueRange)}};
Timeplot.LogarithmicValueGeometry=function(a){Timeplot.DefaultValueGeometry.apply(this,arguments);this._logMap={direct:function(a){return Math.log(a+1)/Math.log(10)},inverse:function(a){return Math.exp(Math.log(10)*a)-1}};this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid};Timeplot.LogarithmicValueGeometry.prototype._linearCalculateGrid=Timeplot.DefaultValueGeometry.prototype._calculateGrid;Object.extend(Timeplot.LogarithmicValueGeometry.prototype,Timeplot.DefaultValueGeometry.prototype);
Timeplot.LogarithmicValueGeometry.prototype._logarithmicCalculateGrid=function(){var a=[];if(!this._canvas||0==this._valueRange)return a;for(var b=1,c=this.toScreen(b);c<this._canvas.height||isNaN(c);)0<c&&a.push({y:c,label:b}),b*=10,c=this.toScreen(b);return a};Timeplot.LogarithmicValueGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this._calculateGrid=this._linearCalculateGrid;this.reset()};
Timeplot.LogarithmicValueGeometry.prototype.actLogarithmic=function(){this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.toggle=function(){"log"==this._mode?this.actLinear():this.actLogarithmic()};
Timeplot.DefaultTimeGeometry=function(a){a||(a={});this._id="id"in a?a.id:"g"+Math.round(1E6*Math.random());this._locale="locale"in a?a.locale:"en";this._timeZone="timeZone"in a?a.timeZone:SimileAjax.DateTime.getTimezone();this._labeler="labeller"in a?a.labeller:null;this._axisColor="axisColor"in a?"string"==a.axisColor?new Timeplot.Color(a.axisColor):a.axisColor:new Timeplot.Color("#606060");this._gridColor="gridColor"in a?"string"==a.gridColor?new Timeplot.Color(a.gridColor):a.gridColor:null;this._gridLineWidth=
"gridLineWidth"in a?a.gridLineWidth:0.5;this._axisLabelsPlacement="axisLabelsPlacement"in a?a.axisLabelsPlacement:"bottom";this._gridStep="gridStep"in a?a.gridStep:100;this._gridStepRange="gridStepRange"in a?a.gridStepRange:20;this._min="min"in a?a.min:null;this._max="max"in a?a.max:null;this._timeValuePosition="timeValuePosition"in a?a.timeValuePosition:"bottom";this._unit="unit"in a?a.unit:Timeline.NativeDateUnit;this._map=this._linMap={direct:function(a){return a},inverse:function(a){return a}};
this._labeler||(this._labeler=this._unit.createLabeller(this._locale,this._timeZone));a=this._unit.getParser("iso8601");this._min&&!this._min.getTime&&(this._min=a(this._min));this._max&&!this._max.getTime&&(this._max=a(this._max));this._labels=[];this._grid=[]};
Timeplot.DefaultTimeGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if(this._min)this._earliestDate=this._min;else if(a.earliestDate&&(null==this._earliestDate||null!=this._earliestDate&&a.earliestDate.getTime()<this._earliestDate.getTime()))this._earliestDate=a.earliestDate;if(this._max)this._latestDate=this._max;else if(a.latestDate&&(null==this._latestDate||null!=this._latestDate&&a.latestDate.getTime()>this._latestDate.getTime()))this._latestDate=
a.latestDate;!this._earliestDate&&!this._latestDate?this._grid=[]:this.reset()},reset:function(){this._updateMappedValues();this._canvas&&(this._grid=this._calculateGrid())},toScreen:function(a){return this._canvas&&this._latestDate?(a-=this._earliestDate.getTime(),a=0<this._mappedPeriod?this._map.direct(a)/this._mappedPeriod:0,this._canvas.width*a):-50},fromScreen:function(a){return this._canvas?this._map.inverse(this._mappedPeriod*a/this._canvas.width)+this._earliestDate.getTime():0},getPeriod:function(){return this._period},
getLabeler:function(){return this._labeler},getUnit:function(){return this._unit},paint:function(){if(this._canvas){var a=this._canvas.getContext("2d"),b=a.createLinearGradient(0,0,0,this._canvas.height);a.strokeStyle=b;a.lineWidth=this._gridLineWidth;a.lineJoin="miter";if(this._gridColor){b.addColorStop(0,this._gridColor.toString());b.addColorStop(1,"rgba(255,255,255,0.9)");for(var c=0;c<this._grid.length;c++){var d=this._grid[c],e=Math.floor(d.x)+0.5;if("top"==this._axisLabelsPlacement){var f=this._timeplot.putText(this._id+
"-"+c,d.label,"timeplot-grid-label",{left:e+4,top:2,visibility:"hidden"});this._labels.push(f)}else"bottom"==this._axisLabelsPlacement&&(f=this._timeplot.putText(this._id+"-"+c,d.label,"timeplot-grid-label",{left:e+4,bottom:2,visibility:"hidden"}),this._labels.push(f));e+f.clientWidth<this._canvas.width+10&&(f.style.visibility="visible");a.beginPath();a.moveTo(e,0);a.lineTo(e,this._canvas.height);a.stroke()}}b.addColorStop(0,this._axisColor.toString());b.addColorStop(1,"rgba(255,255,255,0.5)");a.lineWidth=
1;b.addColorStop(0,this._axisColor.toString());a.beginPath();a.moveTo(0,0);a.lineTo(this._canvas.width,0);a.stroke()}},_calculateGrid:function(){var a=[],b=SimileAjax.DateTime,c=this._unit,d=this._period;if(0==d)return a;if(d>b.gregorianUnitLengths[b.MILLENNIUM])e=b.MILLENNIUM;else for(var e=b.MILLENNIUM;0<e;e--)if(b.gregorianUnitLengths[e-1]<=d&&d<b.gregorianUnitLengths[e]){e--;break}d=c.cloneValue(this._earliestDate);do{b.roundDownToInterval(d,e,this._timeZone,1,0);var f=this.toScreen(c.toNumber(d));
switch(e){case b.SECOND:var g=d.toLocaleTimeString();break;case b.MINUTE:g=d.getMinutes();g=d.getHours()+":"+(10>g?"0":"")+g;break;case b.HOUR:g=d.getHours()+":00";break;case b.DAY:case b.WEEK:case b.MONTH:g=d.toLocaleDateString();break;case b.YEAR:case b.DECADE:case b.CENTURY:case b.MILLENNIUM:g=d.getUTCFullYear()}0<f&&a.push({x:f,label:g});b.incrementByInterval(d,e,this._timeZone)}while(d.getTime()<this._latestDate.getTime());return a},_clearLabels:function(){for(var a=0;a<this._labels.length;a++){var b=
this._labels[a],c=b.parentNode;c&&c.removeChild(b)}},_updateMappedValues:function(){this._latestDate&&this._earliestDate?(this._period=this._latestDate.getTime()-this._earliestDate.getTime(),this._mappedPeriod=this._map.direct(this._period)):this._mappedPeriod=this._period=0}};
Timeplot.MagnifyingTimeGeometry=function(a){Timeplot.DefaultTimeGeometry.apply(this,arguments);var b=this;this._MagnifyingMap={direct:function(a){return a<b._leftTimeMargin?a*b._leftRate:b._leftTimeMargin<a&&a<b._rightTimeMargin?a*b._expandedRate+b._expandedTimeTranslation:a*b._rightRate+b._rightTimeTranslation},inverse:function(a){return a<b._leftScreenMargin?a/b._leftRate:b._leftScreenMargin<a&&a<b._rightScreenMargin?a/b._expandedRate+b._expandedScreenTranslation:a/b._rightRate+b._rightScreenTranslation}};
this._mode="lin";this._map=this._linMap};Object.extend(Timeplot.MagnifyingTimeGeometry.prototype,Timeplot.DefaultTimeGeometry.prototype);
Timeplot.MagnifyingTimeGeometry.prototype.initialize=function(a){Timeplot.DefaultTimeGeometry.prototype.initialize.apply(this,arguments);this._lens||(this._lens=this._timeplot.putDiv("lens","timeplot-lens"));var b=this,c=function(a){var c=a.clientWidth;a=b._timeplot.locate(a);b.setMagnifyingParams(a.x+c/2,c,2592E6);b.actMagnifying();b._timeplot.paint()},d=function(a,c,d){b._canvas.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(c,a);b._canvas.pressed=!0},e=function(a,d,e){b._canvas.pressed=
!1;a=SimileAjax.DOM.getEventRelativeCoordinates(d,a);Timeplot.Math.isClose(a,b._canvas.startCoords,5)?(b._lens.style.display="none",b.actLinear(),b._timeplot.paint()):(b._lens.style.cursor="move",c(b._lens))},f=function(a,c,d){b._canvas.pressed&&(a=SimileAjax.DOM.getEventRelativeCoordinates(c,a),0>a.x&&(a.x=0),a.x>b._canvas.width&&(a.x=b._canvas.width),b._timeplot.placeDiv(b._lens,{left:b._canvas.startCoords.x,width:a.x-b._canvas.startCoords.x,bottom:0,height:b._canvas.height,display:"block"}))},
g=function(a,c,d){b._lens.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(c,a);b._lens.pressed=!0},h=function(a,c,d){b._lens.pressed=!1},k=function(a,d,e){b._lens.pressed&&(d=SimileAjax.DOM.getEventRelativeCoordinates(d,a),a=b._lens,d=a.offsetLeft+d.x-a.startCoords.x,d<b._timeplot._paddingX&&(d=b._timeplot._paddingX),d+a.clientWidth>b._canvas.width-b._timeplot._paddingX&&(d=b._canvas.width-a.clientWidth+b._timeplot._paddingX),a.style.left=d,c(a))};this._canvas.instrumented||(SimileAjax.DOM.registerEvent(this._canvas,
"mousedown",d),SimileAjax.DOM.registerEvent(this._canvas,"mousemove",f),SimileAjax.DOM.registerEvent(this._canvas,"mouseup",e),SimileAjax.DOM.registerEvent(this._canvas,"mouseup",h),this._canvas.instrumented=!0);this._lens.instrumented||(SimileAjax.DOM.registerEvent(this._lens,"mousedown",g),SimileAjax.DOM.registerEvent(this._lens,"mousemove",k),SimileAjax.DOM.registerEvent(this._lens,"mouseup",h),SimileAjax.DOM.registerEvent(this._lens,"mouseup",e),this._lens.instrumented=!0)};
Timeplot.MagnifyingTimeGeometry.prototype.setMagnifyingParams=function(a,b,c){b/=2;c/=2;var d=this._canvas.width,e=this._period;0>a&&(a=0);a>d&&(a=d);0>a-b&&(b=a);a+b>d&&(b=d-a);var f=this.fromScreen(a)-this._earliestDate.getTime();0>f-c&&(c=f);f+c>e&&(c=e-f);this._centerX=a;this._centerTime=f;this._aperture=b;this._aperturePeriod=c;this._leftScreenMargin=this._centerX-this._aperture;this._rightScreenMargin=this._centerX+this._aperture;this._leftTimeMargin=this._centerTime-this._aperturePeriod;this._rightTimeMargin=
this._centerTime+this._aperturePeriod;this._leftRate=(a-b)/(f-c);this._expandedRate=b/c;this._rightRate=(d-a-b)/(e-f-c);this._expandedTimeTranslation=this._centerX-this._centerTime*this._expandedRate;this._expandedScreenTranslation=this._centerTime-this._centerX/this._expandedRate;this._rightTimeTranslation=a+b-(f+c)*this._rightRate;this._rightScreenTranslation=f+c-(a+b)/this._rightRate;this._updateMappedValues()};
Timeplot.MagnifyingTimeGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.actMagnifying=function(){this._mode="Magnifying";this._map=this._MagnifyingMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.toggle=function(){"Magnifying"==this._mode?this.actLinear():this.actMagnifying()};
Timeplot.Color=function(a){this._fromHex(a)};
Timeplot.Color.prototype={set:function(a,b,d,c){this.r=a;this.g=b;this.b=d;this.a=c?c:1;return this.check()},transparency:function(a){this.a=a;return this.check()},lighten:function(a){return(new Timeplot.Color).set(this.r+=parseInt(a,10),this.g+=parseInt(a,10),this.b+=parseInt(a,10))},darken:function(a){return(new Timeplot.Color).set(this.r-=parseInt(a,10),this.g-=parseInt(a,10),this.b-=parseInt(a,10))},check:function(){255<this.r?this.r=255:0>this.r&&(this.r=0);255<this.g?this.g=255:0>this.g&&(this.g=
0);255<this.b?this.b=255:0>this.b&&(this.b=0);1<this.a?this.a=1:0>this.a&&(this.a=0);return this},toString:function(a){return"rgba("+this.r+","+this.g+","+this.b+","+(a?a:this.a?this.a:1)+")"},toHexString:function(){return"#"+this._toHex(this.r)+this._toHex(this.g)+this._toHex(this.b)},_fromHex:function(a){/^#?([\da-f]{3}|[\da-f]{6})$/i.test(a)?(a=a.replace(/^#/,"").replace(/^([\da-f])([\da-f])([\da-f])$/i,"$1$1$2$2$3$3"),this.r=parseInt(a.substr(0,2),16),this.g=parseInt(a.substr(2,2),16),this.b=
parseInt(a.substr(4,2),16)):/^rgb *\( *\d{0,3} *, *\d{0,3} *, *\d{0,3} *\)$/i.test(a)&&(a=a.match(/^rgb *\( *(\d{0,3}) *, *(\d{0,3}) *, *(\d{0,3}) *\)$/i),this.r=parseInt(a[1],10),this.g=parseInt(a[2],10),this.b=parseInt(a[3],10));this.a=1;return this.check()},_toHex:function(a){if(0>a)return"00";if(255<a)return"FF";var b=a%16;return"0123456789ABCDEF".charAt(Math.floor(a/16))+"0123456789ABCDEF".charAt(b)}};
Timeplot.Math={range:function(a){for(var d=a.length,b=Number.MAX_VALUE,c=Number.MIN_VALUE,e=0;e<d;e++){var f=a[e];f<b&&(b=f);f>c&&(c=f)}return{min:b,max:c}},movingAverage:function(a,d){for(var b=a.length,c=Array(b),e=0;e<b;e++){for(var f=0,g=e-d;g<e+d;g++)f+=0>g?a[0]:g>=b?c[e-1]:a[g];c[e]=f/(2*d)}return c},integral:function(a){for(var d=a.length,b=Array(d),c=0,e=0;e<d;e++)c+=a[e],b[e]=c;return b},normalize:function(a){for(var d=a.length,b=0,c=0;c<d;c++)b+=a[c];for(c=0;c<d;c++)a[c]/=b;return a},convolution:function(a,
d){for(var b=a.length,c=d.length,e=Array(b),f=0;f<b;f++){for(var g=0,k=f+c<b?f+c:b,h=f;h<k;h++)g+=a[h-c]*d[h-f];e[f]=g}return e},heavyside:function(a){for(var d=Array(a),b=1/a,c=0;c<a;c++)d[c]=b;return d},gaussian:function(a,d){with(Math)for(var b=a/2,c=b*b/log(d),e=Array(a),f=0;f<a;f++){var g=f-b;e[f]=exp(-c*g*g)}return this.normalize(e)},round:function(a,d){with(Math){if(1<abs(a)){var b=floor(log(a)/log(10)),b=round(exp((b-d+1)*log(10)));return round(round(a/b)*b)}log("FIXME(SM): still to implement for 0 \x3c abs(x) \x3c 1");
return a}},tanh:function(a){if(5<a)return 1;if(5>a)return-1;a=Math.exp(2*a);return(a-1)/(a+1)},isClose:function(a,d,b){return a&&d&&Math.abs(a.x-d.x)<b&&Math.abs(a.y-d.y)<b}};
Timeplot.Operator={sum:function(a,b){return Timeplot.Math.integral(a.values)},average:function(a,b){return Timeplot.Math.movingAverage(a.values,"size"in b?b.size:30)}};Timeplot.Processor=function(a,b,d){this._dataSource=a;this._operator=b;this._params=d;this._data={times:[],values:[]};this._range={earliestDate:null,latestDate:null,min:0,max:0};var c=this;this._processingListener={onAddMany:function(){c._process()},onClear:function(){c._clear()}};this.addListener(this._processingListener)};
Timeplot.Processor.prototype={_clear:function(){this.removeListener(this._processingListener);this._dataSource._clear()},_process:function(){var a=this._dataSource.getData(),b=this._dataSource.getRange(),d=this._operator(a,this._params),c=Timeplot.Math.range(d);this._data={times:a.times,values:d};this._range={earliestDate:b.earliestDate,latestDate:b.latestDate,min:c.min,max:c.max}},getRange:function(){return this._range},getData:function(){return this._data},getValue:Timeplot.DataSource.prototype.getValue,
getClosestValidTime:Timeplot.DataSource.prototype.getClosestValidTime,addListener:function(a){this._dataSource.addListener(a)},removeListener:function(a){this._dataSource.removeListener(a)}};
